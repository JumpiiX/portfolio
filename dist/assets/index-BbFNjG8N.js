(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const mh="164",nr={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},ir={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Jm=0,Kh=1,eg=2,Hf=1,tg=2,zi=3,qi=0,Nn=1,qn=2,ji=0,Dr=1,Zh=2,Qh=3,Jh=4,ng=5,Us=100,ig=101,sg=102,rg=103,og=104,ag=200,lg=201,cg=202,hg=203,Ic=204,Dc=205,ug=206,dg=207,fg=208,pg=209,mg=210,gg=211,vg=212,_g=213,yg=214,xg=0,wg=1,bg=2,$a=3,Mg=4,Sg=5,Ag=6,Eg=7,pl=0,Tg=1,Cg=2,ps=0,Rg=1,Pg=2,Lg=3,Ig=4,Dg=5,Fg=6,kg=7,eu="attached",Ng="detached",Gf=300,Vr=301,Hr=302,Ka=303,Fc=304,ml=306,vs=1e3,Si=1001,Za=1002,Bt=1003,Wf=1004,yo=1005,Vt=1006,Ha=1007,Gi=1008,_s=1009,Og=1010,Bg=1011,Xf=1012,jf=1013,Gr=1014,Ai=1015,$o=1016,qf=1017,Yf=1018,Ko=1020,Ug=35902,zg=1021,Vg=1022,fi=1023,Hg=1024,Gg=1025,Fr=1026,Fo=1027,$f=1028,Kf=1029,Wg=1030,Zf=1031,Qf=1033,Tl=33776,Cl=33777,Rl=33778,Pl=33779,tu=35840,nu=35841,iu=35842,su=35843,ru=36196,ou=37492,au=37496,lu=37808,cu=37809,hu=37810,uu=37811,du=37812,fu=37813,pu=37814,mu=37815,gu=37816,vu=37817,_u=37818,yu=37819,xu=37820,wu=37821,Ll=36492,bu=36494,Mu=36495,Xg=36283,Su=36284,Au=36285,Eu=36286,ko=2300,Wr=2301,Il=2302,Tu=2400,Cu=2401,Ru=2402,jg=2500,qg=0,Jf=1,kc=2,Yg=3200,$g=3201,Zo=0,Kg=1,cs="",sn="srgb",_n="srgb-linear",gh="display-p3",gl="display-p3-linear",Qa="linear",zt="srgb",Ja="rec709",el="p3",sr=7680,Pu=519,Zg=512,Qg=513,Jg=514,ep=515,ev=516,tv=517,nv=518,iv=519,Nc=35044,Lu="300 es",Wi=2e3,tl=2001;class Qs{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,r=i.length;s<r;s++)i[s].call(this,e);e.target=null}}}const Sn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Iu=1234567;const Eo=Math.PI/180,Xr=180/Math.PI;function pi(){const o=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Sn[o&255]+Sn[o>>8&255]+Sn[o>>16&255]+Sn[o>>24&255]+"-"+Sn[e&255]+Sn[e>>8&255]+"-"+Sn[e>>16&15|64]+Sn[e>>24&255]+"-"+Sn[t&63|128]+Sn[t>>8&255]+"-"+Sn[t>>16&255]+Sn[t>>24&255]+Sn[n&255]+Sn[n>>8&255]+Sn[n>>16&255]+Sn[n>>24&255]).toLowerCase()}function un(o,e,t){return Math.max(e,Math.min(t,o))}function vh(o,e){return(o%e+e)%e}function sv(o,e,t,n,i){return n+(o-e)*(i-n)/(t-e)}function rv(o,e,t){return o!==e?(t-o)/(e-o):0}function To(o,e,t){return(1-t)*o+t*e}function ov(o,e,t,n){return To(o,e,1-Math.exp(-t*n))}function av(o,e=1){return e-Math.abs(vh(o,e*2)-e)}function lv(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*(3-2*o))}function cv(o,e,t){return o<=e?0:o>=t?1:(o=(o-e)/(t-e),o*o*o*(o*(o*6-15)+10))}function hv(o,e){return o+Math.floor(Math.random()*(e-o+1))}function uv(o,e){return o+Math.random()*(e-o)}function dv(o){return o*(.5-Math.random())}function fv(o){o!==void 0&&(Iu=o);let e=Iu+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function pv(o){return o*Eo}function mv(o){return o*Xr}function gv(o){return(o&o-1)===0&&o!==0}function vv(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function _v(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function yv(o,e,t,n,i){const s=Math.cos,r=Math.sin,a=s(t/2),c=r(t/2),u=s((e+n)/2),d=r((e+n)/2),l=s((e-n)/2),h=r((e-n)/2),f=s((n-e)/2),p=r((n-e)/2);switch(i){case"XYX":o.set(a*d,c*l,c*h,a*u);break;case"YZY":o.set(c*h,a*d,c*l,a*u);break;case"ZXZ":o.set(c*l,c*h,a*d,a*u);break;case"XZX":o.set(a*d,c*p,c*f,a*u);break;case"YXY":o.set(c*f,a*d,c*p,a*u);break;case"ZYZ":o.set(c*p,c*f,a*d,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function di(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return o/4294967295;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int32Array:return Math.max(o/2147483647,-1);case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function Rt(o,e){switch(e.constructor){case Float32Array:return o;case Uint32Array:return Math.round(o*4294967295);case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int32Array:return Math.round(o*2147483647);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}const bn={DEG2RAD:Eo,RAD2DEG:Xr,generateUUID:pi,clamp:un,euclideanModulo:vh,mapLinear:sv,inverseLerp:rv,lerp:To,damp:ov,pingpong:av,smoothstep:lv,smootherstep:cv,randInt:hv,randFloat:uv,randFloatSpread:dv,seededRandom:fv,degToRad:pv,radToDeg:mv,isPowerOfTwo:gv,ceilPowerOfTwo:vv,floorPowerOfTwo:_v,setQuaternionFromProperEuler:yv,normalize:Rt,denormalize:di};class Fe{constructor(e=0,t=0){Fe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(un(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*n-r*i+e.x,this.y=s*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class dt{constructor(e,t,n,i,s,r,a,c,u){dt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,r,a,c,u)}set(e,t,n,i,s,r,a,c,u){const d=this.elements;return d[0]=e,d[1]=i,d[2]=a,d[3]=t,d[4]=s,d[5]=c,d[6]=n,d[7]=r,d[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],a=n[3],c=n[6],u=n[1],d=n[4],l=n[7],h=n[2],f=n[5],p=n[8],g=i[0],m=i[3],v=i[6],_=i[1],y=i[4],x=i[7],M=i[2],S=i[5],A=i[8];return s[0]=r*g+a*_+c*M,s[3]=r*m+a*y+c*S,s[6]=r*v+a*x+c*A,s[1]=u*g+d*_+l*M,s[4]=u*m+d*y+l*S,s[7]=u*v+d*x+l*A,s[2]=h*g+f*_+p*M,s[5]=h*m+f*y+p*S,s[8]=h*v+f*x+p*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],c=e[6],u=e[7],d=e[8];return t*r*d-t*a*u-n*s*d+n*a*c+i*s*u-i*r*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],c=e[6],u=e[7],d=e[8],l=d*r-a*u,h=a*c-d*s,f=u*s-r*c,p=t*l+n*h+i*f;if(p===0)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=l*g,e[1]=(i*u-d*n)*g,e[2]=(a*n-i*r)*g,e[3]=h*g,e[4]=(d*t-i*c)*g,e[5]=(i*s-a*t)*g,e[6]=f*g,e[7]=(n*c-u*t)*g,e[8]=(r*t-n*s)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,r,a){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*r+u*a)+r+e,-i*u,i*c,-i*(-u*r+c*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Dl.makeScale(e,t)),this}rotate(e){return this.premultiply(Dl.makeRotation(-e)),this}translate(e,t){return this.premultiply(Dl.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Dl=new dt;function tp(o){for(let e=o.length-1;e>=0;--e)if(o[e]>=65535)return!0;return!1}function No(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function xv(){const o=No("canvas");return o.style.display="block",o}const Du={};function np(o){o in Du||(Du[o]=!0,console.warn(o))}const Fu=new dt().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ku=new dt().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),na={[_n]:{transfer:Qa,primaries:Ja,toReference:o=>o,fromReference:o=>o},[sn]:{transfer:zt,primaries:Ja,toReference:o=>o.convertSRGBToLinear(),fromReference:o=>o.convertLinearToSRGB()},[gl]:{transfer:Qa,primaries:el,toReference:o=>o.applyMatrix3(ku),fromReference:o=>o.applyMatrix3(Fu)},[gh]:{transfer:zt,primaries:el,toReference:o=>o.convertSRGBToLinear().applyMatrix3(ku),fromReference:o=>o.applyMatrix3(Fu).convertLinearToSRGB()}},wv=new Set([_n,gl]),Et={enabled:!0,_workingColorSpace:_n,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(o){if(!wv.has(o))throw new Error(`Unsupported working color space, "${o}".`);this._workingColorSpace=o},convert:function(o,e,t){if(this.enabled===!1||e===t||!e||!t)return o;const n=na[e].toReference,i=na[t].fromReference;return i(n(o))},fromWorkingColorSpace:function(o,e){return this.convert(o,this._workingColorSpace,e)},toWorkingColorSpace:function(o,e){return this.convert(o,e,this._workingColorSpace)},getPrimaries:function(o){return na[o].primaries},getTransfer:function(o){return o===cs?Qa:na[o].transfer}};function kr(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function Fl(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}let rr;class bv{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{rr===void 0&&(rr=No("canvas")),rr.width=e.width,rr.height=e.height;const n=rr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=rr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=No("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let r=0;r<s.length;r++)s[r]=kr(s[r]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(kr(t[n]/255)*255):t[n]=kr(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Mv=0;class ip{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Mv++}),this.uuid=pi(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let r=0,a=i.length;r<a;r++)i[r].isDataTexture?s.push(kl(i[r].image)):s.push(kl(i[r]))}else s=kl(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function kl(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?bv.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Sv=0;class qt extends Qs{constructor(e=qt.DEFAULT_IMAGE,t=qt.DEFAULT_MAPPING,n=Si,i=Si,s=Vt,r=Gi,a=fi,c=_s,u=qt.DEFAULT_ANISOTROPY,d=cs){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Sv++}),this.uuid=pi(),this.name="",this.source=new ip(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=r,this.anisotropy=u,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Fe(0,0),this.repeat=new Fe(1,1),this.center=new Fe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new dt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==Gf)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case vs:e.x=e.x-Math.floor(e.x);break;case Si:e.x=e.x<0?0:1;break;case Za:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case vs:e.y=e.y-Math.floor(e.y);break;case Si:e.y=e.y<0?0:1;break;case Za:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}qt.DEFAULT_IMAGE=null;qt.DEFAULT_MAPPING=Gf;qt.DEFAULT_ANISOTROPY=1;class At{constructor(e=0,t=0,n=0,i=1){At.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12]*s,this.y=r[1]*t+r[5]*n+r[9]*i+r[13]*s,this.z=r[2]*t+r[6]*n+r[10]*i+r[14]*s,this.w=r[3]*t+r[7]*n+r[11]*i+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const c=e.elements,u=c[0],d=c[4],l=c[8],h=c[1],f=c[5],p=c[9],g=c[2],m=c[6],v=c[10];if(Math.abs(d-h)<.01&&Math.abs(l-g)<.01&&Math.abs(p-m)<.01){if(Math.abs(d+h)<.1&&Math.abs(l+g)<.1&&Math.abs(p+m)<.1&&Math.abs(u+f+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const y=(u+1)/2,x=(f+1)/2,M=(v+1)/2,S=(d+h)/4,A=(l+g)/4,T=(p+m)/4;return y>x&&y>M?y<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(y),i=S/n,s=A/n):x>M?x<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(x),n=S/i,s=T/i):M<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(M),n=A/s,i=T/s),this.set(n,i,s,t),this}let _=Math.sqrt((m-p)*(m-p)+(l-g)*(l-g)+(h-d)*(h-d));return Math.abs(_)<.001&&(_=1),this.x=(m-p)/_,this.y=(l-g)/_,this.z=(h-d)/_,this.w=Math.acos((u+f+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Av extends Qs{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new At(0,0,e,t),this.scissorTest=!1,this.viewport=new At(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Vt,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const s=new qt(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];const r=n.count;for(let a=0;a<r;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let n=0,i=e.textures.length;n<i;n++)this.textures[n]=e.textures[n].clone(),this.textures[n].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ip(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ys extends Av{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class sp extends qt{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=Si,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ev extends qt{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Bt,this.minFilter=Bt,this.wrapR=Si,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Lt{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,r,a){let c=n[i+0],u=n[i+1],d=n[i+2],l=n[i+3];const h=s[r+0],f=s[r+1],p=s[r+2],g=s[r+3];if(a===0){e[t+0]=c,e[t+1]=u,e[t+2]=d,e[t+3]=l;return}if(a===1){e[t+0]=h,e[t+1]=f,e[t+2]=p,e[t+3]=g;return}if(l!==g||c!==h||u!==f||d!==p){let m=1-a;const v=c*h+u*f+d*p+l*g,_=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){const M=Math.sqrt(y),S=Math.atan2(M,v*_);m=Math.sin(m*S)/M,a=Math.sin(a*S)/M}const x=a*_;if(c=c*m+h*x,u=u*m+f*x,d=d*m+p*x,l=l*m+g*x,m===1-a){const M=1/Math.sqrt(c*c+u*u+d*d+l*l);c*=M,u*=M,d*=M,l*=M}}e[t]=c,e[t+1]=u,e[t+2]=d,e[t+3]=l}static multiplyQuaternionsFlat(e,t,n,i,s,r){const a=n[i],c=n[i+1],u=n[i+2],d=n[i+3],l=s[r],h=s[r+1],f=s[r+2],p=s[r+3];return e[t]=a*p+d*l+c*f-u*h,e[t+1]=c*p+d*h+u*l-a*f,e[t+2]=u*p+d*f+a*h-c*l,e[t+3]=d*p-a*l-c*h-u*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,r=e._order,a=Math.cos,c=Math.sin,u=a(n/2),d=a(i/2),l=a(s/2),h=c(n/2),f=c(i/2),p=c(s/2);switch(r){case"XYZ":this._x=h*d*l+u*f*p,this._y=u*f*l-h*d*p,this._z=u*d*p+h*f*l,this._w=u*d*l-h*f*p;break;case"YXZ":this._x=h*d*l+u*f*p,this._y=u*f*l-h*d*p,this._z=u*d*p-h*f*l,this._w=u*d*l+h*f*p;break;case"ZXY":this._x=h*d*l-u*f*p,this._y=u*f*l+h*d*p,this._z=u*d*p+h*f*l,this._w=u*d*l-h*f*p;break;case"ZYX":this._x=h*d*l-u*f*p,this._y=u*f*l+h*d*p,this._z=u*d*p-h*f*l,this._w=u*d*l+h*f*p;break;case"YZX":this._x=h*d*l+u*f*p,this._y=u*f*l+h*d*p,this._z=u*d*p-h*f*l,this._w=u*d*l-h*f*p;break;case"XZY":this._x=h*d*l-u*f*p,this._y=u*f*l-h*d*p,this._z=u*d*p+h*f*l,this._w=u*d*l+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],r=t[1],a=t[5],c=t[9],u=t[2],d=t[6],l=t[10],h=n+a+l;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(d-c)*f,this._y=(s-u)*f,this._z=(r-i)*f}else if(n>a&&n>l){const f=2*Math.sqrt(1+n-a-l);this._w=(d-c)/f,this._x=.25*f,this._y=(i+r)/f,this._z=(s+u)/f}else if(a>l){const f=2*Math.sqrt(1+a-n-l);this._w=(s-u)/f,this._x=(i+r)/f,this._y=.25*f,this._z=(c+d)/f}else{const f=2*Math.sqrt(1+l-n-a);this._w=(r-i)/f,this._x=(s+u)/f,this._y=(c+d)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(un(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,r=e._w,a=t._x,c=t._y,u=t._z,d=t._w;return this._x=n*d+r*a+i*u-s*c,this._y=i*d+r*c+s*a-n*u,this._z=s*d+r*u+n*c-i*a,this._w=r*d-n*a-i*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,r=this._w;let a=r*e._w+n*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=n,this._y=i,this._z=s,this;const c=1-a*a;if(c<=Number.EPSILON){const f=1-t;return this._w=f*r+t*this._w,this._x=f*n+t*this._x,this._y=f*i+t*this._y,this._z=f*s+t*this._z,this.normalize(),this}const u=Math.sqrt(c),d=Math.atan2(u,a),l=Math.sin((1-t)*d)/u,h=Math.sin(t*d)/u;return this._w=r*l+this._w*h,this._x=n*l+this._x*h,this._y=i*l+this._y*h,this._z=s*l+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class D{constructor(e=0,t=0,n=0){D.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Nu.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Nu.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,r=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*r,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*r,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,r=e.y,a=e.z,c=e.w,u=2*(r*i-a*n),d=2*(a*t-s*i),l=2*(s*n-r*t);return this.x=t+c*u+r*l-a*d,this.y=n+c*d+a*u-s*l,this.z=i+c*l+s*d-r*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,r=t.x,a=t.y,c=t.z;return this.x=i*c-s*a,this.y=s*r-n*c,this.z=n*a-i*r,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Nl.copy(this).projectOnVector(e),this.sub(Nl)}reflect(e){return this.sub(Nl.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(un(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Nl=new D,Nu=new Lt;class Zi{constructor(e=new D(1/0,1/0,1/0),t=new D(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(oi.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(oi.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=oi.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let r=0,a=s.count;r<a;r++)e.isMesh===!0?e.getVertexPosition(r,oi):oi.fromBufferAttribute(s,r),oi.applyMatrix4(e.matrixWorld),this.expandByPoint(oi);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),ia.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),ia.copy(n.boundingBox)),ia.applyMatrix4(e.matrixWorld),this.union(ia)}const i=e.children;for(let s=0,r=i.length;s<r;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,oi),oi.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(io),sa.subVectors(this.max,io),or.subVectors(e.a,io),ar.subVectors(e.b,io),lr.subVectors(e.c,io),Qi.subVectors(ar,or),Ji.subVectors(lr,ar),Es.subVectors(or,lr);let t=[0,-Qi.z,Qi.y,0,-Ji.z,Ji.y,0,-Es.z,Es.y,Qi.z,0,-Qi.x,Ji.z,0,-Ji.x,Es.z,0,-Es.x,-Qi.y,Qi.x,0,-Ji.y,Ji.x,0,-Es.y,Es.x,0];return!Ol(t,or,ar,lr,sa)||(t=[1,0,0,0,1,0,0,0,1],!Ol(t,or,ar,lr,sa))?!1:(ra.crossVectors(Qi,Ji),t=[ra.x,ra.y,ra.z],Ol(t,or,ar,lr,sa))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,oi).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(oi).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fi),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Fi=[new D,new D,new D,new D,new D,new D,new D,new D],oi=new D,ia=new Zi,or=new D,ar=new D,lr=new D,Qi=new D,Ji=new D,Es=new D,io=new D,sa=new D,ra=new D,Ts=new D;function Ol(o,e,t,n,i){for(let s=0,r=o.length-3;s<=r;s+=3){Ts.fromArray(o,s);const a=i.x*Math.abs(Ts.x)+i.y*Math.abs(Ts.y)+i.z*Math.abs(Ts.z),c=e.dot(Ts),u=t.dot(Ts),d=n.dot(Ts);if(Math.max(-Math.max(c,u,d),Math.min(c,u,d))>a)return!1}return!0}const Tv=new Zi,so=new D,Bl=new D;class Pi{constructor(e=new D,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):Tv.setFromPoints(e).getCenter(n);let i=0;for(let s=0,r=e.length;s<r;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;so.subVectors(e,this.center);const t=so.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(so,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Bl.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(so.copy(e.center).add(Bl)),this.expandByPoint(so.copy(e.center).sub(Bl))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ki=new D,Ul=new D,oa=new D,es=new D,zl=new D,aa=new D,Vl=new D;class Qr{constructor(e=new D,t=new D(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ki)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ki.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ki.copy(this.origin).addScaledVector(this.direction,t),ki.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){Ul.copy(e).add(t).multiplyScalar(.5),oa.copy(t).sub(e).normalize(),es.copy(this.origin).sub(Ul);const s=e.distanceTo(t)*.5,r=-this.direction.dot(oa),a=es.dot(this.direction),c=-es.dot(oa),u=es.lengthSq(),d=Math.abs(1-r*r);let l,h,f,p;if(d>0)if(l=r*c-a,h=r*a-c,p=s*d,l>=0)if(h>=-p)if(h<=p){const g=1/d;l*=g,h*=g,f=l*(l+r*h+2*a)+h*(r*l+h+2*c)+u}else h=s,l=Math.max(0,-(r*h+a)),f=-l*l+h*(h+2*c)+u;else h=-s,l=Math.max(0,-(r*h+a)),f=-l*l+h*(h+2*c)+u;else h<=-p?(l=Math.max(0,-(-r*s+a)),h=l>0?-s:Math.min(Math.max(-s,-c),s),f=-l*l+h*(h+2*c)+u):h<=p?(l=0,h=Math.min(Math.max(-s,-c),s),f=h*(h+2*c)+u):(l=Math.max(0,-(r*s+a)),h=l>0?s:Math.min(Math.max(-s,-c),s),f=-l*l+h*(h+2*c)+u);else h=r>0?-s:s,l=Math.max(0,-(r*h+a)),f=-l*l+h*(h+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,l),i&&i.copy(Ul).addScaledVector(oa,h),f}intersectSphere(e,t){ki.subVectors(e.center,this.origin);const n=ki.dot(this.direction),i=ki.dot(ki)-n*n,s=e.radius*e.radius;if(i>s)return null;const r=Math.sqrt(s-i),a=n-r,c=n+r;return c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,r,a,c;const u=1/this.direction.x,d=1/this.direction.y,l=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,i=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,i=(e.min.x-h.x)*u),d>=0?(s=(e.min.y-h.y)*d,r=(e.max.y-h.y)*d):(s=(e.max.y-h.y)*d,r=(e.min.y-h.y)*d),n>r||s>i||((s>n||isNaN(n))&&(n=s),(r<i||isNaN(i))&&(i=r),l>=0?(a=(e.min.z-h.z)*l,c=(e.max.z-h.z)*l):(a=(e.max.z-h.z)*l,c=(e.min.z-h.z)*l),n>c||a>i)||((a>n||n!==n)&&(n=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,ki)!==null}intersectTriangle(e,t,n,i,s){zl.subVectors(t,e),aa.subVectors(n,e),Vl.crossVectors(zl,aa);let r=this.direction.dot(Vl),a;if(r>0){if(i)return null;a=1}else if(r<0)a=-1,r=-r;else return null;es.subVectors(this.origin,e);const c=a*this.direction.dot(aa.crossVectors(es,aa));if(c<0)return null;const u=a*this.direction.dot(zl.cross(es));if(u<0||c+u>r)return null;const d=-a*es.dot(Vl);return d<0?null:this.at(d/r,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ye{constructor(e,t,n,i,s,r,a,c,u,d,l,h,f,p,g,m){Ye.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,r,a,c,u,d,l,h,f,p,g,m)}set(e,t,n,i,s,r,a,c,u,d,l,h,f,p,g,m){const v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=i,v[1]=s,v[5]=r,v[9]=a,v[13]=c,v[2]=u,v[6]=d,v[10]=l,v[14]=h,v[3]=f,v[7]=p,v[11]=g,v[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ye().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/cr.setFromMatrixColumn(e,0).length(),s=1/cr.setFromMatrixColumn(e,1).length(),r=1/cr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,r=Math.cos(n),a=Math.sin(n),c=Math.cos(i),u=Math.sin(i),d=Math.cos(s),l=Math.sin(s);if(e.order==="XYZ"){const h=r*d,f=r*l,p=a*d,g=a*l;t[0]=c*d,t[4]=-c*l,t[8]=u,t[1]=f+p*u,t[5]=h-g*u,t[9]=-a*c,t[2]=g-h*u,t[6]=p+f*u,t[10]=r*c}else if(e.order==="YXZ"){const h=c*d,f=c*l,p=u*d,g=u*l;t[0]=h+g*a,t[4]=p*a-f,t[8]=r*u,t[1]=r*l,t[5]=r*d,t[9]=-a,t[2]=f*a-p,t[6]=g+h*a,t[10]=r*c}else if(e.order==="ZXY"){const h=c*d,f=c*l,p=u*d,g=u*l;t[0]=h-g*a,t[4]=-r*l,t[8]=p+f*a,t[1]=f+p*a,t[5]=r*d,t[9]=g-h*a,t[2]=-r*u,t[6]=a,t[10]=r*c}else if(e.order==="ZYX"){const h=r*d,f=r*l,p=a*d,g=a*l;t[0]=c*d,t[4]=p*u-f,t[8]=h*u+g,t[1]=c*l,t[5]=g*u+h,t[9]=f*u-p,t[2]=-u,t[6]=a*c,t[10]=r*c}else if(e.order==="YZX"){const h=r*c,f=r*u,p=a*c,g=a*u;t[0]=c*d,t[4]=g-h*l,t[8]=p*l+f,t[1]=l,t[5]=r*d,t[9]=-a*d,t[2]=-u*d,t[6]=f*l+p,t[10]=h-g*l}else if(e.order==="XZY"){const h=r*c,f=r*u,p=a*c,g=a*u;t[0]=c*d,t[4]=-l,t[8]=u*d,t[1]=h*l+g,t[5]=r*d,t[9]=f*l-p,t[2]=p*l-f,t[6]=a*d,t[10]=g*l+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Cv,e,Rv)}lookAt(e,t,n){const i=this.elements;return Hn.subVectors(e,t),Hn.lengthSq()===0&&(Hn.z=1),Hn.normalize(),ts.crossVectors(n,Hn),ts.lengthSq()===0&&(Math.abs(n.z)===1?Hn.x+=1e-4:Hn.z+=1e-4,Hn.normalize(),ts.crossVectors(n,Hn)),ts.normalize(),la.crossVectors(Hn,ts),i[0]=ts.x,i[4]=la.x,i[8]=Hn.x,i[1]=ts.y,i[5]=la.y,i[9]=Hn.y,i[2]=ts.z,i[6]=la.z,i[10]=Hn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],a=n[4],c=n[8],u=n[12],d=n[1],l=n[5],h=n[9],f=n[13],p=n[2],g=n[6],m=n[10],v=n[14],_=n[3],y=n[7],x=n[11],M=n[15],S=i[0],A=i[4],T=i[8],b=i[12],w=i[1],P=i[5],N=i[9],I=i[13],H=i[2],G=i[6],J=i[10],U=i[14],k=i[3],q=i[7],Y=i[11],V=i[15];return s[0]=r*S+a*w+c*H+u*k,s[4]=r*A+a*P+c*G+u*q,s[8]=r*T+a*N+c*J+u*Y,s[12]=r*b+a*I+c*U+u*V,s[1]=d*S+l*w+h*H+f*k,s[5]=d*A+l*P+h*G+f*q,s[9]=d*T+l*N+h*J+f*Y,s[13]=d*b+l*I+h*U+f*V,s[2]=p*S+g*w+m*H+v*k,s[6]=p*A+g*P+m*G+v*q,s[10]=p*T+g*N+m*J+v*Y,s[14]=p*b+g*I+m*U+v*V,s[3]=_*S+y*w+x*H+M*k,s[7]=_*A+y*P+x*G+M*q,s[11]=_*T+y*N+x*J+M*Y,s[15]=_*b+y*I+x*U+M*V,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],r=e[1],a=e[5],c=e[9],u=e[13],d=e[2],l=e[6],h=e[10],f=e[14],p=e[3],g=e[7],m=e[11],v=e[15];return p*(+s*c*l-i*u*l-s*a*h+n*u*h+i*a*f-n*c*f)+g*(+t*c*f-t*u*h+s*r*h-i*r*f+i*u*d-s*c*d)+m*(+t*u*l-t*a*f-s*r*l+n*r*f+s*a*d-n*u*d)+v*(-i*a*d-t*c*l+t*a*h+i*r*l-n*r*h+n*c*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],a=e[5],c=e[6],u=e[7],d=e[8],l=e[9],h=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],_=l*m*u-g*h*u+g*c*f-a*m*f-l*c*v+a*h*v,y=p*h*u-d*m*u-p*c*f+r*m*f+d*c*v-r*h*v,x=d*g*u-p*l*u+p*a*f-r*g*f-d*a*v+r*l*v,M=p*l*c-d*g*c-p*a*h+r*g*h+d*a*m-r*l*m,S=t*_+n*y+i*x+s*M;if(S===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/S;return e[0]=_*A,e[1]=(g*h*s-l*m*s-g*i*f+n*m*f+l*i*v-n*h*v)*A,e[2]=(a*m*s-g*c*s+g*i*u-n*m*u-a*i*v+n*c*v)*A,e[3]=(l*c*s-a*h*s-l*i*u+n*h*u+a*i*f-n*c*f)*A,e[4]=y*A,e[5]=(d*m*s-p*h*s+p*i*f-t*m*f-d*i*v+t*h*v)*A,e[6]=(p*c*s-r*m*s-p*i*u+t*m*u+r*i*v-t*c*v)*A,e[7]=(r*h*s-d*c*s+d*i*u-t*h*u-r*i*f+t*c*f)*A,e[8]=x*A,e[9]=(p*l*s-d*g*s-p*n*f+t*g*f+d*n*v-t*l*v)*A,e[10]=(r*g*s-p*a*s+p*n*u-t*g*u-r*n*v+t*a*v)*A,e[11]=(d*a*s-r*l*s-d*n*u+t*l*u+r*n*f-t*a*f)*A,e[12]=M*A,e[13]=(d*g*i-p*l*i+p*n*h-t*g*h-d*n*m+t*l*m)*A,e[14]=(p*a*i-r*g*i-p*n*c+t*g*c+r*n*m-t*a*m)*A,e[15]=(r*l*i-d*a*i+d*n*c-t*l*c-r*n*h+t*a*h)*A,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,r=e.x,a=e.y,c=e.z,u=s*r,d=s*a;return this.set(u*r+n,u*a-i*c,u*c+i*a,0,u*a+i*c,d*a+n,d*c-i*r,0,u*c-i*a,d*c+i*r,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,r){return this.set(1,n,s,0,e,1,r,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,r=t._y,a=t._z,c=t._w,u=s+s,d=r+r,l=a+a,h=s*u,f=s*d,p=s*l,g=r*d,m=r*l,v=a*l,_=c*u,y=c*d,x=c*l,M=n.x,S=n.y,A=n.z;return i[0]=(1-(g+v))*M,i[1]=(f+x)*M,i[2]=(p-y)*M,i[3]=0,i[4]=(f-x)*S,i[5]=(1-(h+v))*S,i[6]=(m+_)*S,i[7]=0,i[8]=(p+y)*A,i[9]=(m-_)*A,i[10]=(1-(h+g))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=cr.set(i[0],i[1],i[2]).length();const r=cr.set(i[4],i[5],i[6]).length(),a=cr.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],ai.copy(this);const u=1/s,d=1/r,l=1/a;return ai.elements[0]*=u,ai.elements[1]*=u,ai.elements[2]*=u,ai.elements[4]*=d,ai.elements[5]*=d,ai.elements[6]*=d,ai.elements[8]*=l,ai.elements[9]*=l,ai.elements[10]*=l,t.setFromRotationMatrix(ai),n.x=s,n.y=r,n.z=a,this}makePerspective(e,t,n,i,s,r,a=Wi){const c=this.elements,u=2*s/(t-e),d=2*s/(n-i),l=(t+e)/(t-e),h=(n+i)/(n-i);let f,p;if(a===Wi)f=-(r+s)/(r-s),p=-2*r*s/(r-s);else if(a===tl)f=-r/(r-s),p=-r*s/(r-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=l,c[12]=0,c[1]=0,c[5]=d,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=f,c[14]=p,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,s,r,a=Wi){const c=this.elements,u=1/(t-e),d=1/(n-i),l=1/(r-s),h=(t+e)*u,f=(n+i)*d;let p,g;if(a===Wi)p=(r+s)*l,g=-2*l;else if(a===tl)p=s*l,g=-1*l;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*d,c[9]=0,c[13]=-f,c[2]=0,c[6]=0,c[10]=g,c[14]=-p,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const cr=new D,ai=new Ye,Cv=new D(0,0,0),Rv=new D(1,1,1),ts=new D,la=new D,Hn=new D,Ou=new Ye,Bu=new Lt;class ht{constructor(e=0,t=0,n=0,i=ht.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],r=i[4],a=i[8],c=i[1],u=i[5],d=i[9],l=i[2],h=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(un(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-d,f),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-un(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-l,s),this._z=0);break;case"ZXY":this._x=Math.asin(un(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-r,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-un(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-r,u));break;case"YZX":this._z=Math.asin(un(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-l,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-un(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-d,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ou.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ou,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Bu.setFromEuler(this),this.setFromQuaternion(Bu,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ht.DEFAULT_ORDER="XYZ";class _h{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Pv=0;const Uu=new D,hr=new Lt,Ni=new Ye,ca=new D,ro=new D,Lv=new D,Iv=new Lt,zu=new D(1,0,0),Vu=new D(0,1,0),Hu=new D(0,0,1),Gu={type:"added"},Dv={type:"removed"},ur={type:"childadded",child:null},Hl={type:"childremoved",child:null};class et extends Qs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Pv++}),this.uuid=pi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=et.DEFAULT_UP.clone();const e=new D,t=new ht,n=new Lt,i=new D(1,1,1);function s(){n.setFromEuler(t,!1)}function r(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ye},normalMatrix:{value:new dt}}),this.matrix=new Ye,this.matrixWorld=new Ye,this.matrixAutoUpdate=et.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=et.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _h,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.multiply(hr),this}rotateOnWorldAxis(e,t){return hr.setFromAxisAngle(e,t),this.quaternion.premultiply(hr),this}rotateX(e){return this.rotateOnAxis(zu,e)}rotateY(e){return this.rotateOnAxis(Vu,e)}rotateZ(e){return this.rotateOnAxis(Hu,e)}translateOnAxis(e,t){return Uu.copy(e).applyQuaternion(this.quaternion),this.position.add(Uu.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(zu,e)}translateY(e){return this.translateOnAxis(Vu,e)}translateZ(e){return this.translateOnAxis(Hu,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Ni.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?ca.copy(e):ca.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),ro.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ni.lookAt(ro,ca,this.up):Ni.lookAt(ca,ro,this.up),this.quaternion.setFromRotationMatrix(Ni),i&&(Ni.extractRotation(i.matrixWorld),hr.setFromRotationMatrix(Ni),this.quaternion.premultiply(hr.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Gu),ur.child=e,this.dispatchEvent(ur),ur.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Dv),Hl.child=e,this.dispatchEvent(Hl),Hl.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Ni.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ni.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ni),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Gu),ur.child=e,this.dispatchEvent(ur),ur.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const r=this.children[n].getObjectByProperty(e,t);if(r!==void 0)return r}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,r=i.length;s<r;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ro,e,Lv),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ro,Iv,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,r=i.length;s<r;s++){const a=i[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let u=0,d=c.length;u<d;u++){const l=c[u];s(e.shapes,l)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,u=this.material.length;c<u;c++)a.push(s(e.materials,this.material[c]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(s(e.animations,c))}}if(t){const a=r(e.geometries),c=r(e.materials),u=r(e.textures),d=r(e.images),l=r(e.shapes),h=r(e.skeletons),f=r(e.animations),p=r(e.nodes);a.length>0&&(n.geometries=a),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),d.length>0&&(n.images=d),l.length>0&&(n.shapes=l),h.length>0&&(n.skeletons=h),f.length>0&&(n.animations=f),p.length>0&&(n.nodes=p)}return n.object=i,n;function r(a){const c=[];for(const u in a){const d=a[u];delete d.metadata,c.push(d)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}et.DEFAULT_UP=new D(0,1,0);et.DEFAULT_MATRIX_AUTO_UPDATE=!0;et.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const li=new D,Oi=new D,Gl=new D,Bi=new D,dr=new D,fr=new D,Wu=new D,Wl=new D,Xl=new D,jl=new D;class bi{constructor(e=new D,t=new D,n=new D){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),li.subVectors(e,t),i.cross(li);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){li.subVectors(i,t),Oi.subVectors(n,t),Gl.subVectors(e,t);const r=li.dot(li),a=li.dot(Oi),c=li.dot(Gl),u=Oi.dot(Oi),d=Oi.dot(Gl),l=r*u-a*a;if(l===0)return s.set(0,0,0),null;const h=1/l,f=(u*c-a*d)*h,p=(r*d-a*c)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Bi)===null?!1:Bi.x>=0&&Bi.y>=0&&Bi.x+Bi.y<=1}static getInterpolation(e,t,n,i,s,r,a,c){return this.getBarycoord(e,t,n,i,Bi)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,Bi.x),c.addScaledVector(r,Bi.y),c.addScaledVector(a,Bi.z),c)}static isFrontFacing(e,t,n,i){return li.subVectors(n,t),Oi.subVectors(e,t),li.cross(Oi).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return li.subVectors(this.c,this.b),Oi.subVectors(this.a,this.b),li.cross(Oi).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return bi.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return bi.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return bi.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return bi.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return bi.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let r,a;dr.subVectors(i,n),fr.subVectors(s,n),Wl.subVectors(e,n);const c=dr.dot(Wl),u=fr.dot(Wl);if(c<=0&&u<=0)return t.copy(n);Xl.subVectors(e,i);const d=dr.dot(Xl),l=fr.dot(Xl);if(d>=0&&l<=d)return t.copy(i);const h=c*l-d*u;if(h<=0&&c>=0&&d<=0)return r=c/(c-d),t.copy(n).addScaledVector(dr,r);jl.subVectors(e,s);const f=dr.dot(jl),p=fr.dot(jl);if(p>=0&&f<=p)return t.copy(s);const g=f*u-c*p;if(g<=0&&u>=0&&p<=0)return a=u/(u-p),t.copy(n).addScaledVector(fr,a);const m=d*p-f*l;if(m<=0&&l-d>=0&&f-p>=0)return Wu.subVectors(s,i),a=(l-d)/(l-d+(f-p)),t.copy(i).addScaledVector(Wu,a);const v=1/(m+g+h);return r=g*v,a=h*v,t.copy(n).addScaledVector(dr,r).addScaledVector(fr,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const rp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ns={h:0,s:0,l:0},ha={h:0,s:0,l:0};function ql(o,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?o+(e-o)*6*t:t<1/2?e:t<2/3?o+(e-o)*6*(2/3-t):o}let He=class{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=sn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Et.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=Et.workingColorSpace){return this.r=e,this.g=t,this.b=n,Et.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=Et.workingColorSpace){if(e=vh(e,1),t=un(t,0,1),n=un(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,r=2*n-s;this.r=ql(r,s,e+1/3),this.g=ql(r,s,e),this.b=ql(r,s,e-1/3)}return Et.toWorkingColorSpace(this,i),this}setStyle(e,t=sn){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],r=s.length;if(r===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(r===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=sn){const n=rp[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=kr(e.r),this.g=kr(e.g),this.b=kr(e.b),this}copyLinearToSRGB(e){return this.r=Fl(e.r),this.g=Fl(e.g),this.b=Fl(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=sn){return Et.fromWorkingColorSpace(An.copy(this),e),Math.round(un(An.r*255,0,255))*65536+Math.round(un(An.g*255,0,255))*256+Math.round(un(An.b*255,0,255))}getHexString(e=sn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Et.workingColorSpace){Et.fromWorkingColorSpace(An.copy(this),t);const n=An.r,i=An.g,s=An.b,r=Math.max(n,i,s),a=Math.min(n,i,s);let c,u;const d=(a+r)/2;if(a===r)c=0,u=0;else{const l=r-a;switch(u=d<=.5?l/(r+a):l/(2-r-a),r){case n:c=(i-s)/l+(i<s?6:0);break;case i:c=(s-n)/l+2;break;case s:c=(n-i)/l+4;break}c/=6}return e.h=c,e.s=u,e.l=d,e}getRGB(e,t=Et.workingColorSpace){return Et.fromWorkingColorSpace(An.copy(this),t),e.r=An.r,e.g=An.g,e.b=An.b,e}getStyle(e=sn){Et.fromWorkingColorSpace(An.copy(this),e);const t=An.r,n=An.g,i=An.b;return e!==sn?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(ns),this.setHSL(ns.h+e,ns.s+t,ns.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(ns),e.getHSL(ha);const n=To(ns.h,ha.h,t),i=To(ns.s,ha.s,t),s=To(ns.l,ha.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const An=new He;He.NAMES=rp;let Fv=0;class Kn extends Qs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Fv++}),this.uuid=pi(),this.name="",this.type="Material",this.blending=Dr,this.side=qi,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Ic,this.blendDst=Dc,this.blendEquation=Us,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new He(0,0,0),this.blendAlpha=0,this.depthFunc=$a,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Pu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=sr,this.stencilZFail=sr,this.stencilZPass=sr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Dr&&(n.blending=this.blending),this.side!==qi&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Ic&&(n.blendSrc=this.blendSrc),this.blendDst!==Dc&&(n.blendDst=this.blendDst),this.blendEquation!==Us&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==$a&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Pu&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==sr&&(n.stencilFail=this.stencilFail),this.stencilZFail!==sr&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==sr&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const r=[];for(const a in s){const c=s[a];delete c.metadata,r.push(c)}return r}if(t){const s=i(e.textures),r=i(e.images);s.length>0&&(n.textures=s),r.length>0&&(n.images=r)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Mt extends Kn{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new He(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ht,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const rn=new D,ua=new Fe;class an{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Nc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Ai,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return np("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)ua.fromBufferAttribute(this,t),ua.applyMatrix3(e),this.setXY(t,ua.x,ua.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)rn.fromBufferAttribute(this,t),rn.applyMatrix3(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)rn.fromBufferAttribute(this,t),rn.applyMatrix4(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)rn.fromBufferAttribute(this,t),rn.applyNormalMatrix(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)rn.fromBufferAttribute(this,t),rn.transformDirection(e),this.setXYZ(t,rn.x,rn.y,rn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=di(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Rt(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=di(t,this.array)),t}setX(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=di(t,this.array)),t}setY(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=di(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=di(t,this.array)),t}setW(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array),i=Rt(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array),i=Rt(i,this.array),s=Rt(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Nc&&(e.usage=this.usage),e}}class yh extends an{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class op extends an{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class yt extends an{constructor(e,t,n){super(new Float32Array(e),t,n)}}let kv=0;const Jn=new Ye,Yl=new et,pr=new D,Gn=new Zi,oo=new Zi,mn=new D;class Ft extends Qs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:kv++}),this.uuid=pi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(tp(e)?op:yh)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new dt().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Jn.makeRotationFromQuaternion(e),this.applyMatrix4(Jn),this}rotateX(e){return Jn.makeRotationX(e),this.applyMatrix4(Jn),this}rotateY(e){return Jn.makeRotationY(e),this.applyMatrix4(Jn),this}rotateZ(e){return Jn.makeRotationZ(e),this.applyMatrix4(Jn),this}translate(e,t,n){return Jn.makeTranslation(e,t,n),this.applyMatrix4(Jn),this}scale(e,t,n){return Jn.makeScale(e,t,n),this.applyMatrix4(Jn),this}lookAt(e){return Yl.lookAt(e),Yl.updateMatrix(),this.applyMatrix4(Yl.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(pr).negate(),this.translate(pr.x,pr.y,pr.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new yt(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Zi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new D(-1/0,-1/0,-1/0),new D(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];Gn.setFromBufferAttribute(s),this.morphTargetsRelative?(mn.addVectors(this.boundingBox.min,Gn.min),this.boundingBox.expandByPoint(mn),mn.addVectors(this.boundingBox.max,Gn.max),this.boundingBox.expandByPoint(mn)):(this.boundingBox.expandByPoint(Gn.min),this.boundingBox.expandByPoint(Gn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Pi);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new D,1/0);return}if(e){const n=this.boundingSphere.center;if(Gn.setFromBufferAttribute(e),t)for(let s=0,r=t.length;s<r;s++){const a=t[s];oo.setFromBufferAttribute(a),this.morphTargetsRelative?(mn.addVectors(Gn.min,oo.min),Gn.expandByPoint(mn),mn.addVectors(Gn.max,oo.max),Gn.expandByPoint(mn)):(Gn.expandByPoint(oo.min),Gn.expandByPoint(oo.max))}Gn.getCenter(n);let i=0;for(let s=0,r=e.count;s<r;s++)mn.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(mn));if(t)for(let s=0,r=t.length;s<r;s++){const a=t[s],c=this.morphTargetsRelative;for(let u=0,d=a.count;u<d;u++)mn.fromBufferAttribute(a,u),c&&(pr.fromBufferAttribute(e,u),mn.add(pr)),i=Math.max(i,n.distanceToSquared(mn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new an(new Float32Array(4*n.count),4));const r=this.getAttribute("tangent"),a=[],c=[];for(let T=0;T<n.count;T++)a[T]=new D,c[T]=new D;const u=new D,d=new D,l=new D,h=new Fe,f=new Fe,p=new Fe,g=new D,m=new D;function v(T,b,w){u.fromBufferAttribute(n,T),d.fromBufferAttribute(n,b),l.fromBufferAttribute(n,w),h.fromBufferAttribute(s,T),f.fromBufferAttribute(s,b),p.fromBufferAttribute(s,w),d.sub(u),l.sub(u),f.sub(h),p.sub(h);const P=1/(f.x*p.y-p.x*f.y);isFinite(P)&&(g.copy(d).multiplyScalar(p.y).addScaledVector(l,-f.y).multiplyScalar(P),m.copy(l).multiplyScalar(f.x).addScaledVector(d,-p.x).multiplyScalar(P),a[T].add(g),a[b].add(g),a[w].add(g),c[T].add(m),c[b].add(m),c[w].add(m))}let _=this.groups;_.length===0&&(_=[{start:0,count:e.count}]);for(let T=0,b=_.length;T<b;++T){const w=_[T],P=w.start,N=w.count;for(let I=P,H=P+N;I<H;I+=3)v(e.getX(I+0),e.getX(I+1),e.getX(I+2))}const y=new D,x=new D,M=new D,S=new D;function A(T){M.fromBufferAttribute(i,T),S.copy(M);const b=a[T];y.copy(b),y.sub(M.multiplyScalar(M.dot(b))).normalize(),x.crossVectors(S,b);const P=x.dot(c[T])<0?-1:1;r.setXYZW(T,y.x,y.y,y.z,P)}for(let T=0,b=_.length;T<b;++T){const w=_[T],P=w.start,N=w.count;for(let I=P,H=P+N;I<H;I+=3)A(e.getX(I+0)),A(e.getX(I+1)),A(e.getX(I+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new an(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let h=0,f=n.count;h<f;h++)n.setXYZ(h,0,0,0);const i=new D,s=new D,r=new D,a=new D,c=new D,u=new D,d=new D,l=new D;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),g=e.getX(h+1),m=e.getX(h+2);i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,g),r.fromBufferAttribute(t,m),d.subVectors(r,s),l.subVectors(i,s),d.cross(l),a.fromBufferAttribute(n,p),c.fromBufferAttribute(n,g),u.fromBufferAttribute(n,m),a.add(d),c.add(d),u.add(d),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(g,c.x,c.y,c.z),n.setXYZ(m,u.x,u.y,u.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),r.fromBufferAttribute(t,h+2),d.subVectors(r,s),l.subVectors(i,s),d.cross(l),n.setXYZ(h+0,d.x,d.y,d.z),n.setXYZ(h+1,d.x,d.y,d.z),n.setXYZ(h+2,d.x,d.y,d.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)mn.fromBufferAttribute(e,t),mn.normalize(),e.setXYZ(t,mn.x,mn.y,mn.z)}toNonIndexed(){function e(a,c){const u=a.array,d=a.itemSize,l=a.normalized,h=new u.constructor(c.length*d);let f=0,p=0;for(let g=0,m=c.length;g<m;g++){a.isInterleavedBufferAttribute?f=c[g]*a.data.stride+a.offset:f=c[g]*d;for(let v=0;v<d;v++)h[p++]=u[f++]}return new an(h,d,l)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ft,n=this.index.array,i=this.attributes;for(const a in i){const c=i[a],u=e(c,n);t.setAttribute(a,u)}const s=this.morphAttributes;for(const a in s){const c=[],u=s[a];for(let d=0,l=u.length;d<l;d++){const h=u[d],f=e(h,n);c.push(f)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,c=r.length;a<c;a++){const u=r[a];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const u=n[c];e.data.attributes[c]=u.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],d=[];for(let l=0,h=u.length;l<h;l++){const f=u[l];d.push(f.toJSON(e.data))}d.length>0&&(i[c]=d,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const u in i){const d=i[u];this.setAttribute(u,d.clone(t))}const s=e.morphAttributes;for(const u in s){const d=[],l=s[u];for(let h=0,f=l.length;h<f;h++)d.push(l[h].clone(t));this.morphAttributes[u]=d}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let u=0,d=r.length;u<d;u++){const l=r[u];this.addGroup(l.start,l.count,l.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Xu=new Ye,Cs=new Qr,da=new Pi,ju=new D,mr=new D,gr=new D,vr=new D,$l=new D,fa=new D,pa=new Fe,ma=new Fe,ga=new Fe,qu=new D,Yu=new D,$u=new D,va=new D,_a=new D;class Se extends et{constructor(e=new Ft,t=new Mt){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,r=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){fa.set(0,0,0);for(let c=0,u=s.length;c<u;c++){const d=a[c],l=s[c];d!==0&&($l.fromBufferAttribute(l,e),r?fa.addScaledVector($l,d):fa.addScaledVector($l.sub(t),d))}t.add(fa)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),da.copy(n.boundingSphere),da.applyMatrix4(s),Cs.copy(e.ray).recast(e.near),!(da.containsPoint(Cs.origin)===!1&&(Cs.intersectSphere(da,ju)===null||Cs.origin.distanceToSquared(ju)>(e.far-e.near)**2))&&(Xu.copy(s).invert(),Cs.copy(e.ray).applyMatrix4(Xu),!(n.boundingBox!==null&&Cs.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Cs)))}_computeIntersections(e,t,n){let i;const s=this.geometry,r=this.material,a=s.index,c=s.attributes.position,u=s.attributes.uv,d=s.attributes.uv1,l=s.attributes.normal,h=s.groups,f=s.drawRange;if(a!==null)if(Array.isArray(r))for(let p=0,g=h.length;p<g;p++){const m=h[p],v=r[m.materialIndex],_=Math.max(m.start,f.start),y=Math.min(a.count,Math.min(m.start+m.count,f.start+f.count));for(let x=_,M=y;x<M;x+=3){const S=a.getX(x),A=a.getX(x+1),T=a.getX(x+2);i=ya(this,v,e,n,u,d,l,S,A,T),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=m.materialIndex,t.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(a.count,f.start+f.count);for(let m=p,v=g;m<v;m+=3){const _=a.getX(m),y=a.getX(m+1),x=a.getX(m+2);i=ya(this,r,e,n,u,d,l,_,y,x),i&&(i.faceIndex=Math.floor(m/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(r))for(let p=0,g=h.length;p<g;p++){const m=h[p],v=r[m.materialIndex],_=Math.max(m.start,f.start),y=Math.min(c.count,Math.min(m.start+m.count,f.start+f.count));for(let x=_,M=y;x<M;x+=3){const S=x,A=x+1,T=x+2;i=ya(this,v,e,n,u,d,l,S,A,T),i&&(i.faceIndex=Math.floor(x/3),i.face.materialIndex=m.materialIndex,t.push(i))}}else{const p=Math.max(0,f.start),g=Math.min(c.count,f.start+f.count);for(let m=p,v=g;m<v;m+=3){const _=m,y=m+1,x=m+2;i=ya(this,r,e,n,u,d,l,_,y,x),i&&(i.faceIndex=Math.floor(m/3),t.push(i))}}}}function Nv(o,e,t,n,i,s,r,a){let c;if(e.side===Nn?c=n.intersectTriangle(r,s,i,!0,a):c=n.intersectTriangle(i,s,r,e.side===qi,a),c===null)return null;_a.copy(a),_a.applyMatrix4(o.matrixWorld);const u=t.ray.origin.distanceTo(_a);return u<t.near||u>t.far?null:{distance:u,point:_a.clone(),object:o}}function ya(o,e,t,n,i,s,r,a,c,u){o.getVertexPosition(a,mr),o.getVertexPosition(c,gr),o.getVertexPosition(u,vr);const d=Nv(o,e,t,n,mr,gr,vr,va);if(d){i&&(pa.fromBufferAttribute(i,a),ma.fromBufferAttribute(i,c),ga.fromBufferAttribute(i,u),d.uv=bi.getInterpolation(va,mr,gr,vr,pa,ma,ga,new Fe)),s&&(pa.fromBufferAttribute(s,a),ma.fromBufferAttribute(s,c),ga.fromBufferAttribute(s,u),d.uv1=bi.getInterpolation(va,mr,gr,vr,pa,ma,ga,new Fe)),r&&(qu.fromBufferAttribute(r,a),Yu.fromBufferAttribute(r,c),$u.fromBufferAttribute(r,u),d.normal=bi.getInterpolation(va,mr,gr,vr,qu,Yu,$u,new D),d.normal.dot(n.direction)>0&&d.normal.multiplyScalar(-1));const l={a,b:c,c:u,normal:new D,materialIndex:0};bi.getNormal(mr,gr,vr,l.normal),d.face=l}return d}class Xt extends Ft{constructor(e=1,t=1,n=1,i=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:r};const a=this;i=Math.floor(i),s=Math.floor(s),r=Math.floor(r);const c=[],u=[],d=[],l=[];let h=0,f=0;p("z","y","x",-1,-1,n,t,e,r,s,0),p("z","y","x",1,-1,n,t,-e,r,s,1),p("x","z","y",1,1,e,n,t,i,r,2),p("x","z","y",1,-1,e,n,-t,i,r,3),p("x","y","z",1,-1,e,t,n,i,s,4),p("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new yt(u,3)),this.setAttribute("normal",new yt(d,3)),this.setAttribute("uv",new yt(l,2));function p(g,m,v,_,y,x,M,S,A,T,b){const w=x/A,P=M/T,N=x/2,I=M/2,H=S/2,G=A+1,J=T+1;let U=0,k=0;const q=new D;for(let Y=0;Y<J;Y++){const V=Y*P-I;for(let Z=0;Z<G;Z++){const W=Z*w-N;q[g]=W*_,q[m]=V*y,q[v]=H,u.push(q.x,q.y,q.z),q[g]=0,q[m]=0,q[v]=S>0?1:-1,d.push(q.x,q.y,q.z),l.push(Z/A),l.push(1-Y/T),U+=1}}for(let Y=0;Y<T;Y++)for(let V=0;V<A;V++){const Z=h+V+G*Y,W=h+V+G*(Y+1),L=h+(V+1)+G*(Y+1),F=h+(V+1)+G*Y;c.push(Z,W,F),c.push(W,L,F),k+=6}a.addGroup(f,k,b),f+=k,h+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xt(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function jr(o){const e={};for(const t in o){e[t]={};for(const n in o[t]){const i=o[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function Dn(o){const e={};for(let t=0;t<o.length;t++){const n=jr(o[t]);for(const i in n)e[i]=n[i]}return e}function Ov(o){const e=[];for(let t=0;t<o.length;t++)e.push(o[t].clone());return e}function ap(o){const e=o.getRenderTarget();return e===null?o.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Et.workingColorSpace}const lp={clone:jr,merge:Dn};var Bv=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Uv=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Mn extends Kn{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Bv,this.fragmentShader=Uv,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=jr(e.uniforms),this.uniformsGroups=Ov(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?t.uniforms[i]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[i]={type:"m4",value:r.toArray()}:t.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}let cp=class extends et{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ye,this.projectionMatrix=new Ye,this.projectionMatrixInverse=new Ye,this.coordinateSystem=Wi}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};const is=new D,Ku=new Fe,Zu=new Fe;class Tn extends cp{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Xr*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Eo*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Xr*2*Math.atan(Math.tan(Eo*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){is.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(is.x,is.y).multiplyScalar(-e/is.z),is.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(is.x,is.y).multiplyScalar(-e/is.z)}getViewSize(e,t){return this.getViewBounds(e,Ku,Zu),t.subVectors(Zu,Ku)}setViewOffset(e,t,n,i,s,r){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Eo*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const r=this.view;if(this.view!==null&&this.view.enabled){const c=r.fullWidth,u=r.fullHeight;s+=r.offsetX*i/c,t-=r.offsetY*n/u,i*=r.width/c,n*=r.height/u}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const _r=-90,yr=1;class zv extends et{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Tn(_r,yr,e,t);i.layers=this.layers,this.add(i);const s=new Tn(_r,yr,e,t);s.layers=this.layers,this.add(s);const r=new Tn(_r,yr,e,t);r.layers=this.layers,this.add(r);const a=new Tn(_r,yr,e,t);a.layers=this.layers,this.add(a);const c=new Tn(_r,yr,e,t);c.layers=this.layers,this.add(c);const u=new Tn(_r,yr,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,r,a,c]=t;for(const u of t)this.remove(u);if(e===Wi)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===tl)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,r,a,c,u,d]=this.children,l=e.getRenderTarget(),h=e.getActiveCubeFace(),f=e.getActiveMipmapLevel(),p=e.xr.enabled;e.xr.enabled=!1;const g=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,r),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,c),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=g,e.setRenderTarget(n,5,i),e.render(t,d),e.setRenderTarget(l,h,f),e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}}class hp extends qt{constructor(e,t,n,i,s,r,a,c,u,d){e=e!==void 0?e:[],t=t!==void 0?t:Vr,super(e,t,n,i,s,r,a,c,u,d),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Vv extends ys{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new hp(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Vt}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Xt(5,5,5),s=new Mn({name:"CubemapFromEquirect",uniforms:jr(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Nn,blending:ji});s.uniforms.tEquirect.value=t;const r=new Se(i,s),a=t.minFilter;return t.minFilter===Gi&&(t.minFilter=Vt),new zv(1,10,this).update(e,r),t.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,i){const s=e.getRenderTarget();for(let r=0;r<6;r++)e.setRenderTarget(this,r),e.clear(t,n,i);e.setRenderTarget(s)}}const Kl=new D,Hv=new D,Gv=new dt;class as{constructor(e=new D(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=Kl.subVectors(n,t).cross(Hv.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(Kl),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Gv.getNormalMatrix(e),i=this.coplanarPoint(Kl).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Rs=new Pi,xa=new D;class xh{constructor(e=new as,t=new as,n=new as,i=new as,s=new as,r=new as){this.planes=[e,t,n,i,s,r]}set(e,t,n,i,s,r){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Wi){const n=this.planes,i=e.elements,s=i[0],r=i[1],a=i[2],c=i[3],u=i[4],d=i[5],l=i[6],h=i[7],f=i[8],p=i[9],g=i[10],m=i[11],v=i[12],_=i[13],y=i[14],x=i[15];if(n[0].setComponents(c-s,h-u,m-f,x-v).normalize(),n[1].setComponents(c+s,h+u,m+f,x+v).normalize(),n[2].setComponents(c+r,h+d,m+p,x+_).normalize(),n[3].setComponents(c-r,h-d,m-p,x-_).normalize(),n[4].setComponents(c-a,h-l,m-g,x-y).normalize(),t===Wi)n[5].setComponents(c+a,h+l,m+g,x+y).normalize();else if(t===tl)n[5].setComponents(a,l,g,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Rs.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Rs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Rs)}intersectsSprite(e){return Rs.center.set(0,0,0),Rs.radius=.7071067811865476,Rs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Rs)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(xa.x=i.normal.x>0?e.max.x:e.min.x,xa.y=i.normal.y>0?e.max.y:e.min.y,xa.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(xa)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function up(){let o=null,e=!1,t=null,n=null;function i(s,r){t(s,r),n=o.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=o.requestAnimationFrame(i),e=!0)},stop:function(){o.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){o=s}}}function Wv(o){const e=new WeakMap;function t(a,c){const u=a.array,d=a.usage,l=u.byteLength,h=o.createBuffer();o.bindBuffer(c,h),o.bufferData(c,u,d),a.onUploadCallback();let f;if(u instanceof Float32Array)f=o.FLOAT;else if(u instanceof Uint16Array)a.isFloat16BufferAttribute?f=o.HALF_FLOAT:f=o.UNSIGNED_SHORT;else if(u instanceof Int16Array)f=o.SHORT;else if(u instanceof Uint32Array)f=o.UNSIGNED_INT;else if(u instanceof Int32Array)f=o.INT;else if(u instanceof Int8Array)f=o.BYTE;else if(u instanceof Uint8Array)f=o.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)f=o.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:h,type:f,bytesPerElement:u.BYTES_PER_ELEMENT,version:a.version,size:l}}function n(a,c,u){const d=c.array,l=c._updateRange,h=c.updateRanges;if(o.bindBuffer(u,a),l.count===-1&&h.length===0&&o.bufferSubData(u,0,d),h.length!==0){for(let f=0,p=h.length;f<p;f++){const g=h[f];o.bufferSubData(u,g.start*d.BYTES_PER_ELEMENT,d,g.start,g.count)}c.clearUpdateRanges()}l.count!==-1&&(o.bufferSubData(u,l.offset*d.BYTES_PER_ELEMENT,d,l.offset,l.count),l.count=-1),c.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const c=e.get(a);c&&(o.deleteBuffer(c.buffer),e.delete(a))}function r(a,c){if(a.isGLBufferAttribute){const d=e.get(a);(!d||d.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}a.isInterleavedBufferAttribute&&(a=a.data);const u=e.get(a);if(u===void 0)e.set(a,t(a,c));else if(u.version<a.version){if(u.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,a,c),u.version=a.version}}return{get:i,remove:s,update:r}}class ln extends Ft{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,r=t/2,a=Math.floor(n),c=Math.floor(i),u=a+1,d=c+1,l=e/a,h=t/c,f=[],p=[],g=[],m=[];for(let v=0;v<d;v++){const _=v*h-r;for(let y=0;y<u;y++){const x=y*l-s;p.push(x,-_,0),g.push(0,0,1),m.push(y/a),m.push(1-v/c)}}for(let v=0;v<c;v++)for(let _=0;_<a;_++){const y=_+u*v,x=_+u*(v+1),M=_+1+u*(v+1),S=_+1+u*v;f.push(y,x,S),f.push(x,M,S)}this.setIndex(f),this.setAttribute("position",new yt(p,3)),this.setAttribute("normal",new yt(g,3)),this.setAttribute("uv",new yt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ln(e.width,e.height,e.widthSegments,e.heightSegments)}}var Xv=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,jv=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,qv=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Yv=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,$v=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Kv=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Zv=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Qv=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Jv=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,e0=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,t0=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,n0=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,i0=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,s0=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,r0=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,o0=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,a0=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,l0=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,c0=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,h0=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,u0=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,d0=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,f0=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,p0=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,m0=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,g0=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,v0=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,_0=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,y0=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,x0=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,w0="gl_FragColor = linearToOutputTexel( gl_FragColor );",b0=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,M0=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,S0=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,A0=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,E0=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,T0=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,C0=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,R0=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,P0=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,L0=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,I0=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,D0=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,F0=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,k0=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,N0=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,O0=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,B0=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,U0=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,z0=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,V0=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,H0=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,G0=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,W0=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,X0=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,j0=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,q0=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Y0=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,$0=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,K0=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Z0=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Q0=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,J0=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,e_=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,t_=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,n_=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,i_=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,s_=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,r_=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,o_=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,a_=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,l_=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,c_=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,h_=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,u_=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,d_=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,f_=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,p_=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,m_=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,g_=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,v_=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,__=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,y_=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,x_=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,w_=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,b_=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,M_=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,S_=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,A_=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,E_=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,T_=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,C_=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,R_=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,P_=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,L_=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,I_=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,D_=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,F_=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,k_=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,N_=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,O_=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,B_=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,U_=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,z_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,V_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,H_=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,G_=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const W_=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,X_=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,j_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,q_=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Y_=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$_=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,K_=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Z_=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,Q_=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,J_=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,ey=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,ty=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ny=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,iy=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sy=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ry=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oy=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,ay=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ly=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,cy=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hy=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,uy=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,dy=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fy=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,py=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,my=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,gy=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vy=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_y=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,yy=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,xy=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wy=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,by=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,My=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ft={alphahash_fragment:Xv,alphahash_pars_fragment:jv,alphamap_fragment:qv,alphamap_pars_fragment:Yv,alphatest_fragment:$v,alphatest_pars_fragment:Kv,aomap_fragment:Zv,aomap_pars_fragment:Qv,batching_pars_vertex:Jv,batching_vertex:e0,begin_vertex:t0,beginnormal_vertex:n0,bsdfs:i0,iridescence_fragment:s0,bumpmap_pars_fragment:r0,clipping_planes_fragment:o0,clipping_planes_pars_fragment:a0,clipping_planes_pars_vertex:l0,clipping_planes_vertex:c0,color_fragment:h0,color_pars_fragment:u0,color_pars_vertex:d0,color_vertex:f0,common:p0,cube_uv_reflection_fragment:m0,defaultnormal_vertex:g0,displacementmap_pars_vertex:v0,displacementmap_vertex:_0,emissivemap_fragment:y0,emissivemap_pars_fragment:x0,colorspace_fragment:w0,colorspace_pars_fragment:b0,envmap_fragment:M0,envmap_common_pars_fragment:S0,envmap_pars_fragment:A0,envmap_pars_vertex:E0,envmap_physical_pars_fragment:O0,envmap_vertex:T0,fog_vertex:C0,fog_pars_vertex:R0,fog_fragment:P0,fog_pars_fragment:L0,gradientmap_pars_fragment:I0,lightmap_pars_fragment:D0,lights_lambert_fragment:F0,lights_lambert_pars_fragment:k0,lights_pars_begin:N0,lights_toon_fragment:B0,lights_toon_pars_fragment:U0,lights_phong_fragment:z0,lights_phong_pars_fragment:V0,lights_physical_fragment:H0,lights_physical_pars_fragment:G0,lights_fragment_begin:W0,lights_fragment_maps:X0,lights_fragment_end:j0,logdepthbuf_fragment:q0,logdepthbuf_pars_fragment:Y0,logdepthbuf_pars_vertex:$0,logdepthbuf_vertex:K0,map_fragment:Z0,map_pars_fragment:Q0,map_particle_fragment:J0,map_particle_pars_fragment:e_,metalnessmap_fragment:t_,metalnessmap_pars_fragment:n_,morphinstance_vertex:i_,morphcolor_vertex:s_,morphnormal_vertex:r_,morphtarget_pars_vertex:o_,morphtarget_vertex:a_,normal_fragment_begin:l_,normal_fragment_maps:c_,normal_pars_fragment:h_,normal_pars_vertex:u_,normal_vertex:d_,normalmap_pars_fragment:f_,clearcoat_normal_fragment_begin:p_,clearcoat_normal_fragment_maps:m_,clearcoat_pars_fragment:g_,iridescence_pars_fragment:v_,opaque_fragment:__,packing:y_,premultiplied_alpha_fragment:x_,project_vertex:w_,dithering_fragment:b_,dithering_pars_fragment:M_,roughnessmap_fragment:S_,roughnessmap_pars_fragment:A_,shadowmap_pars_fragment:E_,shadowmap_pars_vertex:T_,shadowmap_vertex:C_,shadowmask_pars_fragment:R_,skinbase_vertex:P_,skinning_pars_vertex:L_,skinning_vertex:I_,skinnormal_vertex:D_,specularmap_fragment:F_,specularmap_pars_fragment:k_,tonemapping_fragment:N_,tonemapping_pars_fragment:O_,transmission_fragment:B_,transmission_pars_fragment:U_,uv_pars_fragment:z_,uv_pars_vertex:V_,uv_vertex:H_,worldpos_vertex:G_,background_vert:W_,background_frag:X_,backgroundCube_vert:j_,backgroundCube_frag:q_,cube_vert:Y_,cube_frag:$_,depth_vert:K_,depth_frag:Z_,distanceRGBA_vert:Q_,distanceRGBA_frag:J_,equirect_vert:ey,equirect_frag:ty,linedashed_vert:ny,linedashed_frag:iy,meshbasic_vert:sy,meshbasic_frag:ry,meshlambert_vert:oy,meshlambert_frag:ay,meshmatcap_vert:ly,meshmatcap_frag:cy,meshnormal_vert:hy,meshnormal_frag:uy,meshphong_vert:dy,meshphong_frag:fy,meshphysical_vert:py,meshphysical_frag:my,meshtoon_vert:gy,meshtoon_frag:vy,points_vert:_y,points_frag:yy,shadow_vert:xy,shadow_frag:wy,sprite_vert:by,sprite_frag:My},Be={common:{diffuse:{value:new He(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new dt},alphaMap:{value:null},alphaMapTransform:{value:new dt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new dt}},envmap:{envMap:{value:null},envMapRotation:{value:new dt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new dt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new dt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new dt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new dt},normalScale:{value:new Fe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new dt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new dt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new dt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new dt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new He(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new He(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new dt},alphaTest:{value:0},uvTransform:{value:new dt}},sprite:{diffuse:{value:new He(16777215)},opacity:{value:1},center:{value:new Fe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new dt},alphaMap:{value:null},alphaMapTransform:{value:new dt},alphaTest:{value:0}}},wi={basic:{uniforms:Dn([Be.common,Be.specularmap,Be.envmap,Be.aomap,Be.lightmap,Be.fog]),vertexShader:ft.meshbasic_vert,fragmentShader:ft.meshbasic_frag},lambert:{uniforms:Dn([Be.common,Be.specularmap,Be.envmap,Be.aomap,Be.lightmap,Be.emissivemap,Be.bumpmap,Be.normalmap,Be.displacementmap,Be.fog,Be.lights,{emissive:{value:new He(0)}}]),vertexShader:ft.meshlambert_vert,fragmentShader:ft.meshlambert_frag},phong:{uniforms:Dn([Be.common,Be.specularmap,Be.envmap,Be.aomap,Be.lightmap,Be.emissivemap,Be.bumpmap,Be.normalmap,Be.displacementmap,Be.fog,Be.lights,{emissive:{value:new He(0)},specular:{value:new He(1118481)},shininess:{value:30}}]),vertexShader:ft.meshphong_vert,fragmentShader:ft.meshphong_frag},standard:{uniforms:Dn([Be.common,Be.envmap,Be.aomap,Be.lightmap,Be.emissivemap,Be.bumpmap,Be.normalmap,Be.displacementmap,Be.roughnessmap,Be.metalnessmap,Be.fog,Be.lights,{emissive:{value:new He(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ft.meshphysical_vert,fragmentShader:ft.meshphysical_frag},toon:{uniforms:Dn([Be.common,Be.aomap,Be.lightmap,Be.emissivemap,Be.bumpmap,Be.normalmap,Be.displacementmap,Be.gradientmap,Be.fog,Be.lights,{emissive:{value:new He(0)}}]),vertexShader:ft.meshtoon_vert,fragmentShader:ft.meshtoon_frag},matcap:{uniforms:Dn([Be.common,Be.bumpmap,Be.normalmap,Be.displacementmap,Be.fog,{matcap:{value:null}}]),vertexShader:ft.meshmatcap_vert,fragmentShader:ft.meshmatcap_frag},points:{uniforms:Dn([Be.points,Be.fog]),vertexShader:ft.points_vert,fragmentShader:ft.points_frag},dashed:{uniforms:Dn([Be.common,Be.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ft.linedashed_vert,fragmentShader:ft.linedashed_frag},depth:{uniforms:Dn([Be.common,Be.displacementmap]),vertexShader:ft.depth_vert,fragmentShader:ft.depth_frag},normal:{uniforms:Dn([Be.common,Be.bumpmap,Be.normalmap,Be.displacementmap,{opacity:{value:1}}]),vertexShader:ft.meshnormal_vert,fragmentShader:ft.meshnormal_frag},sprite:{uniforms:Dn([Be.sprite,Be.fog]),vertexShader:ft.sprite_vert,fragmentShader:ft.sprite_frag},background:{uniforms:{uvTransform:{value:new dt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ft.background_vert,fragmentShader:ft.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new dt}},vertexShader:ft.backgroundCube_vert,fragmentShader:ft.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ft.cube_vert,fragmentShader:ft.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ft.equirect_vert,fragmentShader:ft.equirect_frag},distanceRGBA:{uniforms:Dn([Be.common,Be.displacementmap,{referencePosition:{value:new D},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ft.distanceRGBA_vert,fragmentShader:ft.distanceRGBA_frag},shadow:{uniforms:Dn([Be.lights,Be.fog,{color:{value:new He(0)},opacity:{value:1}}]),vertexShader:ft.shadow_vert,fragmentShader:ft.shadow_frag}};wi.physical={uniforms:Dn([wi.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new dt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new dt},clearcoatNormalScale:{value:new Fe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new dt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new dt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new dt},sheen:{value:0},sheenColor:{value:new He(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new dt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new dt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new dt},transmissionSamplerSize:{value:new Fe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new dt},attenuationDistance:{value:0},attenuationColor:{value:new He(0)},specularColor:{value:new He(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new dt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new dt},anisotropyVector:{value:new Fe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new dt}}]),vertexShader:ft.meshphysical_vert,fragmentShader:ft.meshphysical_frag};const wa={r:0,b:0,g:0},Ps=new ht,Sy=new Ye;function Ay(o,e,t,n,i,s,r){const a=new He(0);let c=s===!0?0:1,u,d,l=null,h=0,f=null;function p(_){let y=_.isScene===!0?_.background:null;return y&&y.isTexture&&(y=(_.backgroundBlurriness>0?t:e).get(y)),y}function g(_){let y=!1;const x=p(_);x===null?v(a,c):x&&x.isColor&&(v(x,1),y=!0);const M=o.xr.getEnvironmentBlendMode();M==="additive"?n.buffers.color.setClear(0,0,0,1,r):M==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,r),(o.autoClear||y)&&o.clear(o.autoClearColor,o.autoClearDepth,o.autoClearStencil)}function m(_,y){const x=p(y);x&&(x.isCubeTexture||x.mapping===ml)?(d===void 0&&(d=new Se(new Xt(1,1,1),new Mn({name:"BackgroundCubeMaterial",uniforms:jr(wi.backgroundCube.uniforms),vertexShader:wi.backgroundCube.vertexShader,fragmentShader:wi.backgroundCube.fragmentShader,side:Nn,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),d.geometry.deleteAttribute("uv"),d.onBeforeRender=function(M,S,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(d.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(d)),Ps.copy(y.backgroundRotation),Ps.x*=-1,Ps.y*=-1,Ps.z*=-1,x.isCubeTexture&&x.isRenderTargetTexture===!1&&(Ps.y*=-1,Ps.z*=-1),d.material.uniforms.envMap.value=x,d.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,d.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,d.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,d.material.uniforms.backgroundRotation.value.setFromMatrix4(Sy.makeRotationFromEuler(Ps)),d.material.toneMapped=Et.getTransfer(x.colorSpace)!==zt,(l!==x||h!==x.version||f!==o.toneMapping)&&(d.material.needsUpdate=!0,l=x,h=x.version,f=o.toneMapping),d.layers.enableAll(),_.unshift(d,d.geometry,d.material,0,0,null)):x&&x.isTexture&&(u===void 0&&(u=new Se(new ln(2,2),new Mn({name:"BackgroundMaterial",uniforms:jr(wi.background.uniforms),vertexShader:wi.background.vertexShader,fragmentShader:wi.background.fragmentShader,side:qi,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=x,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.toneMapped=Et.getTransfer(x.colorSpace)!==zt,x.matrixAutoUpdate===!0&&x.updateMatrix(),u.material.uniforms.uvTransform.value.copy(x.matrix),(l!==x||h!==x.version||f!==o.toneMapping)&&(u.material.needsUpdate=!0,l=x,h=x.version,f=o.toneMapping),u.layers.enableAll(),_.unshift(u,u.geometry,u.material,0,0,null))}function v(_,y){_.getRGB(wa,ap(o)),n.buffers.color.setClear(wa.r,wa.g,wa.b,y,r)}return{getClearColor:function(){return a},setClearColor:function(_,y=1){a.set(_),c=y,v(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(_){c=_,v(a,c)},render:g,addToRenderList:m}}function Ey(o,e){const t=o.getParameter(o.MAX_VERTEX_ATTRIBS),n={},i=h(null);let s=i,r=!1;function a(w,P,N,I,H){let G=!1;const J=l(I,N,P);s!==J&&(s=J,u(s.object)),G=f(w,I,N,H),G&&p(w,I,N,H),H!==null&&e.update(H,o.ELEMENT_ARRAY_BUFFER),(G||r)&&(r=!1,x(w,P,N,I),H!==null&&o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,e.get(H).buffer))}function c(){return o.createVertexArray()}function u(w){return o.bindVertexArray(w)}function d(w){return o.deleteVertexArray(w)}function l(w,P,N){const I=N.wireframe===!0;let H=n[w.id];H===void 0&&(H={},n[w.id]=H);let G=H[P.id];G===void 0&&(G={},H[P.id]=G);let J=G[I];return J===void 0&&(J=h(c()),G[I]=J),J}function h(w){const P=[],N=[],I=[];for(let H=0;H<t;H++)P[H]=0,N[H]=0,I[H]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:N,attributeDivisors:I,object:w,attributes:{},index:null}}function f(w,P,N,I){const H=s.attributes,G=P.attributes;let J=0;const U=N.getAttributes();for(const k in U)if(U[k].location>=0){const Y=H[k];let V=G[k];if(V===void 0&&(k==="instanceMatrix"&&w.instanceMatrix&&(V=w.instanceMatrix),k==="instanceColor"&&w.instanceColor&&(V=w.instanceColor)),Y===void 0||Y.attribute!==V||V&&Y.data!==V.data)return!0;J++}return s.attributesNum!==J||s.index!==I}function p(w,P,N,I){const H={},G=P.attributes;let J=0;const U=N.getAttributes();for(const k in U)if(U[k].location>=0){let Y=G[k];Y===void 0&&(k==="instanceMatrix"&&w.instanceMatrix&&(Y=w.instanceMatrix),k==="instanceColor"&&w.instanceColor&&(Y=w.instanceColor));const V={};V.attribute=Y,Y&&Y.data&&(V.data=Y.data),H[k]=V,J++}s.attributes=H,s.attributesNum=J,s.index=I}function g(){const w=s.newAttributes;for(let P=0,N=w.length;P<N;P++)w[P]=0}function m(w){v(w,0)}function v(w,P){const N=s.newAttributes,I=s.enabledAttributes,H=s.attributeDivisors;N[w]=1,I[w]===0&&(o.enableVertexAttribArray(w),I[w]=1),H[w]!==P&&(o.vertexAttribDivisor(w,P),H[w]=P)}function _(){const w=s.newAttributes,P=s.enabledAttributes;for(let N=0,I=P.length;N<I;N++)P[N]!==w[N]&&(o.disableVertexAttribArray(N),P[N]=0)}function y(w,P,N,I,H,G,J){J===!0?o.vertexAttribIPointer(w,P,N,H,G):o.vertexAttribPointer(w,P,N,I,H,G)}function x(w,P,N,I){g();const H=I.attributes,G=N.getAttributes(),J=P.defaultAttributeValues;for(const U in G){const k=G[U];if(k.location>=0){let q=H[U];if(q===void 0&&(U==="instanceMatrix"&&w.instanceMatrix&&(q=w.instanceMatrix),U==="instanceColor"&&w.instanceColor&&(q=w.instanceColor)),q!==void 0){const Y=q.normalized,V=q.itemSize,Z=e.get(q);if(Z===void 0)continue;const W=Z.buffer,L=Z.type,F=Z.bytesPerElement,X=L===o.INT||L===o.UNSIGNED_INT||q.gpuType===jf;if(q.isInterleavedBufferAttribute){const ee=q.data,re=ee.stride,K=q.offset;if(ee.isInstancedInterleavedBuffer){for(let O=0;O<k.locationSize;O++)v(k.location+O,ee.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=ee.meshPerAttribute*ee.count)}else for(let O=0;O<k.locationSize;O++)m(k.location+O);o.bindBuffer(o.ARRAY_BUFFER,W);for(let O=0;O<k.locationSize;O++)y(k.location+O,V/k.locationSize,L,Y,re*F,(K+V/k.locationSize*O)*F,X)}else{if(q.isInstancedBufferAttribute){for(let ee=0;ee<k.locationSize;ee++)v(k.location+ee,q.meshPerAttribute);w.isInstancedMesh!==!0&&I._maxInstanceCount===void 0&&(I._maxInstanceCount=q.meshPerAttribute*q.count)}else for(let ee=0;ee<k.locationSize;ee++)m(k.location+ee);o.bindBuffer(o.ARRAY_BUFFER,W);for(let ee=0;ee<k.locationSize;ee++)y(k.location+ee,V/k.locationSize,L,Y,V*F,V/k.locationSize*ee*F,X)}}else if(J!==void 0){const Y=J[U];if(Y!==void 0)switch(Y.length){case 2:o.vertexAttrib2fv(k.location,Y);break;case 3:o.vertexAttrib3fv(k.location,Y);break;case 4:o.vertexAttrib4fv(k.location,Y);break;default:o.vertexAttrib1fv(k.location,Y)}}}}_()}function M(){T();for(const w in n){const P=n[w];for(const N in P){const I=P[N];for(const H in I)d(I[H].object),delete I[H];delete P[N]}delete n[w]}}function S(w){if(n[w.id]===void 0)return;const P=n[w.id];for(const N in P){const I=P[N];for(const H in I)d(I[H].object),delete I[H];delete P[N]}delete n[w.id]}function A(w){for(const P in n){const N=n[P];if(N[w.id]===void 0)continue;const I=N[w.id];for(const H in I)d(I[H].object),delete I[H];delete N[w.id]}}function T(){b(),r=!0,s!==i&&(s=i,u(s.object))}function b(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:T,resetDefaultState:b,dispose:M,releaseStatesOfGeometry:S,releaseStatesOfProgram:A,initAttributes:g,enableAttribute:m,disableUnusedAttributes:_}}function Ty(o,e,t){let n;function i(u){n=u}function s(u,d){o.drawArrays(n,u,d),t.update(d,n,1)}function r(u,d,l){l!==0&&(o.drawArraysInstanced(n,u,d,l),t.update(d,n,l))}function a(u,d,l){if(l===0)return;const h=e.get("WEBGL_multi_draw");if(h===null)for(let f=0;f<l;f++)this.render(u[f],d[f]);else{h.multiDrawArraysWEBGL(n,u,0,d,0,l);let f=0;for(let p=0;p<l;p++)f+=d[p];t.update(f,n,1)}}function c(u,d,l,h){if(l===0)return;const f=e.get("WEBGL_multi_draw");if(f===null)for(let p=0;p<u.length;p++)r(u[p],d[p],h[p]);else{f.multiDrawArraysInstancedWEBGL(n,u,0,d,0,h,0,l);let p=0;for(let g=0;g<l;g++)p+=d[g];for(let g=0;g<h.length;g++)t.update(p,n,h[g])}}this.setMode=i,this.render=s,this.renderInstances=r,this.renderMultiDraw=a,this.renderMultiDrawInstances=c}function Cy(o,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const S=e.get("EXT_texture_filter_anisotropic");i=o.getParameter(S.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function r(S){return!(S!==fi&&n.convert(S)!==o.getParameter(o.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(S){const A=S===$o&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(S!==_s&&n.convert(S)!==o.getParameter(o.IMPLEMENTATION_COLOR_READ_TYPE)&&S!==Ai&&!A)}function c(S){if(S==="highp"){if(o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.HIGH_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.HIGH_FLOAT).precision>0)return"highp";S="mediump"}return S==="mediump"&&o.getShaderPrecisionFormat(o.VERTEX_SHADER,o.MEDIUM_FLOAT).precision>0&&o.getShaderPrecisionFormat(o.FRAGMENT_SHADER,o.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const d=c(u);d!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",d,"instead."),u=d);const l=t.logarithmicDepthBuffer===!0,h=o.getParameter(o.MAX_TEXTURE_IMAGE_UNITS),f=o.getParameter(o.MAX_VERTEX_TEXTURE_IMAGE_UNITS),p=o.getParameter(o.MAX_TEXTURE_SIZE),g=o.getParameter(o.MAX_CUBE_MAP_TEXTURE_SIZE),m=o.getParameter(o.MAX_VERTEX_ATTRIBS),v=o.getParameter(o.MAX_VERTEX_UNIFORM_VECTORS),_=o.getParameter(o.MAX_VARYING_VECTORS),y=o.getParameter(o.MAX_FRAGMENT_UNIFORM_VECTORS),x=f>0,M=o.getParameter(o.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:r,textureTypeReadable:a,precision:u,logarithmicDepthBuffer:l,maxTextures:h,maxVertexTextures:f,maxTextureSize:p,maxCubemapSize:g,maxAttributes:m,maxVertexUniforms:v,maxVaryings:_,maxFragmentUniforms:y,vertexTextures:x,maxSamples:M}}function Ry(o){const e=this;let t=null,n=0,i=!1,s=!1;const r=new as,a=new dt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(l,h){const f=l.length!==0||h||n!==0||i;return i=h,n=l.length,f},this.beginShadows=function(){s=!0,d(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(l,h){t=d(l,h,0)},this.setState=function(l,h,f){const p=l.clippingPlanes,g=l.clipIntersection,m=l.clipShadows,v=o.get(l);if(!i||p===null||p.length===0||s&&!m)s?d(null):u();else{const _=s?0:n,y=_*4;let x=v.clippingState||null;c.value=x,x=d(p,h,y,f);for(let M=0;M!==y;++M)x[M]=t[M];v.clippingState=x,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=_}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function d(l,h,f,p){const g=l!==null?l.length:0;let m=null;if(g!==0){if(m=c.value,p!==!0||m===null){const v=f+g*4,_=h.matrixWorldInverse;a.getNormalMatrix(_),(m===null||m.length<v)&&(m=new Float32Array(v));for(let y=0,x=f;y!==g;++y,x+=4)r.copy(l[y]).applyMatrix4(_,a),r.normal.toArray(m,x),m[x+3]=r.constant}c.value=m,c.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,m}}function Py(o){let e=new WeakMap;function t(r,a){return a===Ka?r.mapping=Vr:a===Fc&&(r.mapping=Hr),r}function n(r){if(r&&r.isTexture){const a=r.mapping;if(a===Ka||a===Fc)if(e.has(r)){const c=e.get(r).texture;return t(c,r.mapping)}else{const c=r.image;if(c&&c.height>0){const u=new Vv(c.height);return u.fromEquirectangularTexture(o,r),e.set(r,u),r.addEventListener("dispose",i),t(u.texture,r.mapping)}else return null}}return r}function i(r){const a=r.target;a.removeEventListener("dispose",i);const c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class Qo extends cp{constructor(e=-1,t=1,n=1,i=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,r=n+e,a=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,d=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,r=s+u*this.view.width,a-=d*this.view.offsetY,c=a-d*this.view.height}this.projectionMatrix.makeOrthographic(s,r,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Er=4,Qu=[.125,.215,.35,.446,.526,.582],zs=20,Zl=new Qo,Ju=new He;let Ql=null,Jl=0,ec=0,tc=!1;const Ns=(1+Math.sqrt(5))/2,xr=1/Ns,ed=[new D(-Ns,xr,0),new D(Ns,xr,0),new D(-xr,0,Ns),new D(xr,0,Ns),new D(0,Ns,-xr),new D(0,Ns,xr),new D(-1,1,-1),new D(1,1,-1),new D(-1,1,1),new D(1,1,1)];class td{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){Ql=this._renderer.getRenderTarget(),Jl=this._renderer.getActiveCubeFace(),ec=this._renderer.getActiveMipmapLevel(),tc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=sd(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=id(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ql,Jl,ec),this._renderer.xr.enabled=tc,e.scissorTest=!1,ba(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Vr||e.mapping===Hr?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ql=this._renderer.getRenderTarget(),Jl=this._renderer.getActiveCubeFace(),ec=this._renderer.getActiveMipmapLevel(),tc=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Vt,minFilter:Vt,generateMipmaps:!1,type:$o,format:fi,colorSpace:_n,depthBuffer:!1},i=nd(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=nd(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Ly(s)),this._blurMaterial=Iy(s,e,t)}return i}_compileMaterial(e){const t=new Se(this._lodPlanes[0],e);this._renderer.compile(t,Zl)}_sceneToCubeUV(e,t,n,i){const a=new Tn(90,1,t,n),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],d=this._renderer,l=d.autoClear,h=d.toneMapping;d.getClearColor(Ju),d.toneMapping=ps,d.autoClear=!1;const f=new Mt({name:"PMREM.Background",side:Nn,depthWrite:!1,depthTest:!1}),p=new Se(new Xt,f);let g=!1;const m=e.background;m?m.isColor&&(f.color.copy(m),e.background=null,g=!0):(f.color.copy(Ju),g=!0);for(let v=0;v<6;v++){const _=v%3;_===0?(a.up.set(0,c[v],0),a.lookAt(u[v],0,0)):_===1?(a.up.set(0,0,c[v]),a.lookAt(0,u[v],0)):(a.up.set(0,c[v],0),a.lookAt(0,0,u[v]));const y=this._cubeSize;ba(i,_*y,v>2?y:0,y,y),d.setRenderTarget(i),g&&d.render(p,a),d.render(e,a)}p.geometry.dispose(),p.material.dispose(),d.toneMapping=h,d.autoClear=l,e.background=m}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Vr||e.mapping===Hr;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=sd()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=id());const s=i?this._cubemapMaterial:this._equirectMaterial,r=new Se(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const c=this._cubeSize;ba(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(r,Zl)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const r=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),a=ed[(i-s-1)%ed.length];this._blur(e,s-1,s,r,a)}t.autoClear=n}_blur(e,t,n,i,s){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,n,i,"latitudinal",s),this._halfBlur(r,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,r,a){const c=this._renderer,u=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const d=3,l=new Se(this._lodPlanes[i],u),h=u.uniforms,f=this._sizeLods[n]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/(2*zs-1),g=s/p,m=isFinite(s)?1+Math.floor(d*g):zs;m>zs&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${zs}`);const v=[];let _=0;for(let A=0;A<zs;++A){const T=A/g,b=Math.exp(-T*T/2);v.push(b),A===0?_+=b:A<m&&(_+=2*b)}for(let A=0;A<v.length;A++)v[A]=v[A]/_;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=v,h.latitudinal.value=r==="latitudinal",a&&(h.poleAxis.value=a);const{_lodMax:y}=this;h.dTheta.value=p,h.mipInt.value=y-n;const x=this._sizeLods[i],M=3*x*(i>y-Er?i-y+Er:0),S=4*(this._cubeSize-x);ba(t,M,S,3*x,2*x),c.setRenderTarget(t),c.render(l,Zl)}}function Ly(o){const e=[],t=[],n=[];let i=o;const s=o-Er+1+Qu.length;for(let r=0;r<s;r++){const a=Math.pow(2,i);t.push(a);let c=1/a;r>o-Er?c=Qu[r-o+Er-1]:r===0&&(c=0),n.push(c);const u=1/(a-2),d=-u,l=1+u,h=[d,d,l,d,l,l,d,d,l,l,d,l],f=6,p=6,g=3,m=2,v=1,_=new Float32Array(g*p*f),y=new Float32Array(m*p*f),x=new Float32Array(v*p*f);for(let S=0;S<f;S++){const A=S%3*2/3-1,T=S>2?0:-1,b=[A,T,0,A+2/3,T,0,A+2/3,T+1,0,A,T,0,A+2/3,T+1,0,A,T+1,0];_.set(b,g*p*S),y.set(h,m*p*S);const w=[S,S,S,S,S,S];x.set(w,v*p*S)}const M=new Ft;M.setAttribute("position",new an(_,g)),M.setAttribute("uv",new an(y,m)),M.setAttribute("faceIndex",new an(x,v)),e.push(M),i>Er&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function nd(o,e,t){const n=new ys(o,e,t);return n.texture.mapping=ml,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ba(o,e,t,n,i){o.viewport.set(e,t,n,i),o.scissor.set(e,t,n,i)}function Iy(o,e,t){const n=new Float32Array(zs),i=new D(0,1,0);return new Mn({name:"SphericalGaussianBlur",defines:{n:zs,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${o}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:wh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ji,depthTest:!1,depthWrite:!1})}function id(){return new Mn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:wh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ji,depthTest:!1,depthWrite:!1})}function sd(){return new Mn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:wh(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ji,depthTest:!1,depthWrite:!1})}function wh(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Dy(o){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const c=a.mapping,u=c===Ka||c===Fc,d=c===Vr||c===Hr;if(u||d){let l=e.get(a);const h=l!==void 0?l.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==h)return t===null&&(t=new td(o)),l=u?t.fromEquirectangular(a,l):t.fromCubemap(a,l),l.texture.pmremVersion=a.pmremVersion,e.set(a,l),l.texture;if(l!==void 0)return l.texture;{const f=a.image;return u&&f&&f.height>0||d&&f&&i(f)?(t===null&&(t=new td(o)),l=u?t.fromEquirectangular(a):t.fromCubemap(a),l.texture.pmremVersion=a.pmremVersion,e.set(a,l),a.addEventListener("dispose",s),l.texture):null}}}return a}function i(a){let c=0;const u=6;for(let d=0;d<u;d++)a[d]!==void 0&&c++;return c===u}function s(a){const c=a.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}function r(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:r}}function Fy(o){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=o.getExtension("WEBGL_depth_texture")||o.getExtension("MOZ_WEBGL_depth_texture")||o.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=o.getExtension("WEBGL_compressed_texture_s3tc")||o.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=o.getExtension("WEBGL_compressed_texture_pvrtc")||o.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=o.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function ky(o,e,t,n){const i={},s=new WeakMap;function r(l){const h=l.target;h.index!==null&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);for(const p in h.morphAttributes){const g=h.morphAttributes[p];for(let m=0,v=g.length;m<v;m++)e.remove(g[m])}h.removeEventListener("dispose",r),delete i[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),n.releaseStatesOfGeometry(h),h.isInstancedBufferGeometry===!0&&delete h._maxInstanceCount,t.memory.geometries--}function a(l,h){return i[h.id]===!0||(h.addEventListener("dispose",r),i[h.id]=!0,t.memory.geometries++),h}function c(l){const h=l.attributes;for(const p in h)e.update(h[p],o.ARRAY_BUFFER);const f=l.morphAttributes;for(const p in f){const g=f[p];for(let m=0,v=g.length;m<v;m++)e.update(g[m],o.ARRAY_BUFFER)}}function u(l){const h=[],f=l.index,p=l.attributes.position;let g=0;if(f!==null){const _=f.array;g=f.version;for(let y=0,x=_.length;y<x;y+=3){const M=_[y+0],S=_[y+1],A=_[y+2];h.push(M,S,S,A,A,M)}}else if(p!==void 0){const _=p.array;g=p.version;for(let y=0,x=_.length/3-1;y<x;y+=3){const M=y+0,S=y+1,A=y+2;h.push(M,S,S,A,A,M)}}else return;const m=new(tp(h)?op:yh)(h,1);m.version=g;const v=s.get(l);v&&e.remove(v),s.set(l,m)}function d(l){const h=s.get(l);if(h){const f=l.index;f!==null&&h.version<f.version&&u(l)}else u(l);return s.get(l)}return{get:a,update:c,getWireframeAttribute:d}}function Ny(o,e,t){let n;function i(h){n=h}let s,r;function a(h){s=h.type,r=h.bytesPerElement}function c(h,f){o.drawElements(n,f,s,h*r),t.update(f,n,1)}function u(h,f,p){p!==0&&(o.drawElementsInstanced(n,f,s,h*r,p),t.update(f,n,p))}function d(h,f,p){if(p===0)return;const g=e.get("WEBGL_multi_draw");if(g===null)for(let m=0;m<p;m++)this.render(h[m]/r,f[m]);else{g.multiDrawElementsWEBGL(n,f,0,s,h,0,p);let m=0;for(let v=0;v<p;v++)m+=f[v];t.update(m,n,1)}}function l(h,f,p,g){if(p===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let v=0;v<h.length;v++)u(h[v]/r,f[v],g[v]);else{m.multiDrawElementsInstancedWEBGL(n,f,0,s,h,0,g,0,p);let v=0;for(let _=0;_<p;_++)v+=f[_];for(let _=0;_<g.length;_++)t.update(v,n,g[_])}}this.setMode=i,this.setIndex=a,this.render=c,this.renderInstances=u,this.renderMultiDraw=d,this.renderMultiDrawInstances=l}function Oy(o){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,r,a){switch(t.calls++,r){case o.TRIANGLES:t.triangles+=a*(s/3);break;case o.LINES:t.lines+=a*(s/2);break;case o.LINE_STRIP:t.lines+=a*(s-1);break;case o.LINE_LOOP:t.lines+=a*s;break;case o.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",r);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function By(o,e,t){const n=new WeakMap,i=new At;function s(r,a,c){const u=r.morphTargetInfluences,d=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,l=d!==void 0?d.length:0;let h=n.get(a);if(h===void 0||h.count!==l){let w=function(){T.dispose(),n.delete(a),a.removeEventListener("dispose",w)};var f=w;h!==void 0&&h.texture.dispose();const p=a.morphAttributes.position!==void 0,g=a.morphAttributes.normal!==void 0,m=a.morphAttributes.color!==void 0,v=a.morphAttributes.position||[],_=a.morphAttributes.normal||[],y=a.morphAttributes.color||[];let x=0;p===!0&&(x=1),g===!0&&(x=2),m===!0&&(x=3);let M=a.attributes.position.count*x,S=1;M>e.maxTextureSize&&(S=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const A=new Float32Array(M*S*4*l),T=new sp(A,M,S,l);T.type=Ai,T.needsUpdate=!0;const b=x*4;for(let P=0;P<l;P++){const N=v[P],I=_[P],H=y[P],G=M*S*4*P;for(let J=0;J<N.count;J++){const U=J*b;p===!0&&(i.fromBufferAttribute(N,J),A[G+U+0]=i.x,A[G+U+1]=i.y,A[G+U+2]=i.z,A[G+U+3]=0),g===!0&&(i.fromBufferAttribute(I,J),A[G+U+4]=i.x,A[G+U+5]=i.y,A[G+U+6]=i.z,A[G+U+7]=0),m===!0&&(i.fromBufferAttribute(H,J),A[G+U+8]=i.x,A[G+U+9]=i.y,A[G+U+10]=i.z,A[G+U+11]=H.itemSize===4?i.w:1)}}h={count:l,texture:T,size:new Fe(M,S)},n.set(a,h),a.addEventListener("dispose",w)}if(r.isInstancedMesh===!0&&r.morphTexture!==null)c.getUniforms().setValue(o,"morphTexture",r.morphTexture,t);else{let p=0;for(let m=0;m<u.length;m++)p+=u[m];const g=a.morphTargetsRelative?1:1-p;c.getUniforms().setValue(o,"morphTargetBaseInfluence",g),c.getUniforms().setValue(o,"morphTargetInfluences",u)}c.getUniforms().setValue(o,"morphTargetsTexture",h.texture,t),c.getUniforms().setValue(o,"morphTargetsTextureSize",h.size)}return{update:s}}function Uy(o,e,t,n){let i=new WeakMap;function s(c){const u=n.render.frame,d=c.geometry,l=e.get(c,d);if(i.get(l)!==u&&(e.update(l),i.set(l,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),i.get(c)!==u&&(t.update(c.instanceMatrix,o.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,o.ARRAY_BUFFER),i.set(c,u))),c.isSkinnedMesh){const h=c.skeleton;i.get(h)!==u&&(h.update(),i.set(h,u))}return l}function r(){i=new WeakMap}function a(c){const u=c.target;u.removeEventListener("dispose",a),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:r}}class dp extends qt{constructor(e,t,n,i,s,r,a,c,u,d){if(d=d!==void 0?d:Fr,d!==Fr&&d!==Fo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&d===Fr&&(n=Gr),n===void 0&&d===Fo&&(n=Ko),super(null,i,s,r,a,c,d,n,u),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:Bt,this.minFilter=c!==void 0?c:Bt,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const fp=new qt,pp=new dp(1,1);pp.compareFunction=ep;const mp=new sp,gp=new Ev,vp=new hp,rd=[],od=[],ad=new Float32Array(16),ld=new Float32Array(9),cd=new Float32Array(4);function Jr(o,e,t){const n=o[0];if(n<=0||n>0)return o;const i=e*t;let s=rd[i];if(s===void 0&&(s=new Float32Array(i),rd[i]=s),e!==0){n.toArray(s,0);for(let r=1,a=0;r!==e;++r)a+=t,o[r].toArray(s,a)}return s}function dn(o,e){if(o.length!==e.length)return!1;for(let t=0,n=o.length;t<n;t++)if(o[t]!==e[t])return!1;return!0}function fn(o,e){for(let t=0,n=e.length;t<n;t++)o[t]=e[t]}function vl(o,e){let t=od[e];t===void 0&&(t=new Int32Array(e),od[e]=t);for(let n=0;n!==e;++n)t[n]=o.allocateTextureUnit();return t}function zy(o,e){const t=this.cache;t[0]!==e&&(o.uniform1f(this.addr,e),t[0]=e)}function Vy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;o.uniform2fv(this.addr,e),fn(t,e)}}function Hy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(o.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(dn(t,e))return;o.uniform3fv(this.addr,e),fn(t,e)}}function Gy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;o.uniform4fv(this.addr,e),fn(t,e)}}function Wy(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(dn(t,e))return;o.uniformMatrix2fv(this.addr,!1,e),fn(t,e)}else{if(dn(t,n))return;cd.set(n),o.uniformMatrix2fv(this.addr,!1,cd),fn(t,n)}}function Xy(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(dn(t,e))return;o.uniformMatrix3fv(this.addr,!1,e),fn(t,e)}else{if(dn(t,n))return;ld.set(n),o.uniformMatrix3fv(this.addr,!1,ld),fn(t,n)}}function jy(o,e){const t=this.cache,n=e.elements;if(n===void 0){if(dn(t,e))return;o.uniformMatrix4fv(this.addr,!1,e),fn(t,e)}else{if(dn(t,n))return;ad.set(n),o.uniformMatrix4fv(this.addr,!1,ad),fn(t,n)}}function qy(o,e){const t=this.cache;t[0]!==e&&(o.uniform1i(this.addr,e),t[0]=e)}function Yy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;o.uniform2iv(this.addr,e),fn(t,e)}}function $y(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dn(t,e))return;o.uniform3iv(this.addr,e),fn(t,e)}}function Ky(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;o.uniform4iv(this.addr,e),fn(t,e)}}function Zy(o,e){const t=this.cache;t[0]!==e&&(o.uniform1ui(this.addr,e),t[0]=e)}function Qy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(o.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(dn(t,e))return;o.uniform2uiv(this.addr,e),fn(t,e)}}function Jy(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(o.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(dn(t,e))return;o.uniform3uiv(this.addr,e),fn(t,e)}}function ex(o,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(o.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(dn(t,e))return;o.uniform4uiv(this.addr,e),fn(t,e)}}function tx(o,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i);const s=this.type===o.SAMPLER_2D_SHADOW?pp:fp;t.setTexture2D(e||s,i)}function nx(o,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||gp,i)}function ix(o,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||vp,i)}function sx(o,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(o.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||mp,i)}function rx(o){switch(o){case 5126:return zy;case 35664:return Vy;case 35665:return Hy;case 35666:return Gy;case 35674:return Wy;case 35675:return Xy;case 35676:return jy;case 5124:case 35670:return qy;case 35667:case 35671:return Yy;case 35668:case 35672:return $y;case 35669:case 35673:return Ky;case 5125:return Zy;case 36294:return Qy;case 36295:return Jy;case 36296:return ex;case 35678:case 36198:case 36298:case 36306:case 35682:return tx;case 35679:case 36299:case 36307:return nx;case 35680:case 36300:case 36308:case 36293:return ix;case 36289:case 36303:case 36311:case 36292:return sx}}function ox(o,e){o.uniform1fv(this.addr,e)}function ax(o,e){const t=Jr(e,this.size,2);o.uniform2fv(this.addr,t)}function lx(o,e){const t=Jr(e,this.size,3);o.uniform3fv(this.addr,t)}function cx(o,e){const t=Jr(e,this.size,4);o.uniform4fv(this.addr,t)}function hx(o,e){const t=Jr(e,this.size,4);o.uniformMatrix2fv(this.addr,!1,t)}function ux(o,e){const t=Jr(e,this.size,9);o.uniformMatrix3fv(this.addr,!1,t)}function dx(o,e){const t=Jr(e,this.size,16);o.uniformMatrix4fv(this.addr,!1,t)}function fx(o,e){o.uniform1iv(this.addr,e)}function px(o,e){o.uniform2iv(this.addr,e)}function mx(o,e){o.uniform3iv(this.addr,e)}function gx(o,e){o.uniform4iv(this.addr,e)}function vx(o,e){o.uniform1uiv(this.addr,e)}function _x(o,e){o.uniform2uiv(this.addr,e)}function yx(o,e){o.uniform3uiv(this.addr,e)}function xx(o,e){o.uniform4uiv(this.addr,e)}function wx(o,e,t){const n=this.cache,i=e.length,s=vl(t,i);dn(n,s)||(o.uniform1iv(this.addr,s),fn(n,s));for(let r=0;r!==i;++r)t.setTexture2D(e[r]||fp,s[r])}function bx(o,e,t){const n=this.cache,i=e.length,s=vl(t,i);dn(n,s)||(o.uniform1iv(this.addr,s),fn(n,s));for(let r=0;r!==i;++r)t.setTexture3D(e[r]||gp,s[r])}function Mx(o,e,t){const n=this.cache,i=e.length,s=vl(t,i);dn(n,s)||(o.uniform1iv(this.addr,s),fn(n,s));for(let r=0;r!==i;++r)t.setTextureCube(e[r]||vp,s[r])}function Sx(o,e,t){const n=this.cache,i=e.length,s=vl(t,i);dn(n,s)||(o.uniform1iv(this.addr,s),fn(n,s));for(let r=0;r!==i;++r)t.setTexture2DArray(e[r]||mp,s[r])}function Ax(o){switch(o){case 5126:return ox;case 35664:return ax;case 35665:return lx;case 35666:return cx;case 35674:return hx;case 35675:return ux;case 35676:return dx;case 5124:case 35670:return fx;case 35667:case 35671:return px;case 35668:case 35672:return mx;case 35669:case 35673:return gx;case 5125:return vx;case 36294:return _x;case 36295:return yx;case 36296:return xx;case 35678:case 36198:case 36298:case 36306:case 35682:return wx;case 35679:case 36299:case 36307:return bx;case 35680:case 36300:case 36308:case 36293:return Mx;case 36289:case 36303:case 36311:case 36292:return Sx}}class Ex{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=rx(t.type)}}class Tx{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=Ax(t.type)}}class Cx{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,r=i.length;s!==r;++s){const a=i[s];a.setValue(e,t[a.id],n)}}}const nc=/(\w+)(\])?(\[|\.)?/g;function hd(o,e){o.seq.push(e),o.map[e.id]=e}function Rx(o,e,t){const n=o.name,i=n.length;for(nc.lastIndex=0;;){const s=nc.exec(n),r=nc.lastIndex;let a=s[1];const c=s[2]==="]",u=s[3];if(c&&(a=a|0),u===void 0||u==="["&&r+2===i){hd(t,u===void 0?new Ex(a,o,e):new Tx(a,o,e));break}else{let l=t.map[a];l===void 0&&(l=new Cx(a),hd(t,l)),t=l}}}class Ga{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),r=e.getUniformLocation(t,s.name);Rx(s,r,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,r=t.length;s!==r;++s){const a=t[s],c=n[a.id];c.needsUpdate!==!1&&a.setValue(e,c.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const r=e[i];r.id in t&&n.push(r)}return n}}function ud(o,e,t){const n=o.createShader(e);return o.shaderSource(n,t),o.compileShader(n),n}const Px=37297;let Lx=0;function Ix(o,e){const t=o.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let r=i;r<s;r++){const a=r+1;n.push(`${a===e?">":" "} ${a}: ${t[r]}`)}return n.join(`
`)}function Dx(o){const e=Et.getPrimaries(Et.workingColorSpace),t=Et.getPrimaries(o);let n;switch(e===t?n="":e===el&&t===Ja?n="LinearDisplayP3ToLinearSRGB":e===Ja&&t===el&&(n="LinearSRGBToLinearDisplayP3"),o){case _n:case gl:return[n,"LinearTransferOETF"];case sn:case gh:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",o),[n,"LinearTransferOETF"]}}function dd(o,e,t){const n=o.getShaderParameter(e,o.COMPILE_STATUS),i=o.getShaderInfoLog(e).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const r=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+Ix(o.getShaderSource(e),r)}else return i}function Fx(o,e){const t=Dx(e);return`vec4 ${o}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function kx(o,e){let t;switch(e){case Rg:t="Linear";break;case Pg:t="Reinhard";break;case Lg:t="OptimizedCineon";break;case Ig:t="ACESFilmic";break;case Fg:t="AgX";break;case kg:t="Neutral";break;case Dg:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+o+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Nx(o){return[o.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",o.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(xo).join(`
`)}function Ox(o){const e=[];for(const t in o){const n=o[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Bx(o,e){const t={},n=o.getProgramParameter(e,o.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=o.getActiveAttrib(e,i),r=s.name;let a=1;s.type===o.FLOAT_MAT2&&(a=2),s.type===o.FLOAT_MAT3&&(a=3),s.type===o.FLOAT_MAT4&&(a=4),t[r]={type:s.type,location:o.getAttribLocation(e,r),locationSize:a}}return t}function xo(o){return o!==""}function fd(o,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return o.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function pd(o,e){return o.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Ux=/^[ \t]*#include +<([\w\d./]+)>/gm;function Oc(o){return o.replace(Ux,Vx)}const zx=new Map;function Vx(o,e){let t=ft[e];if(t===void 0){const n=zx.get(e);if(n!==void 0)t=ft[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Oc(t)}const Hx=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function md(o){return o.replace(Hx,Gx)}function Gx(o,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function gd(o){let e=`precision ${o.precision} float;
	precision ${o.precision} int;
	precision ${o.precision} sampler2D;
	precision ${o.precision} samplerCube;
	precision ${o.precision} sampler3D;
	precision ${o.precision} sampler2DArray;
	precision ${o.precision} sampler2DShadow;
	precision ${o.precision} samplerCubeShadow;
	precision ${o.precision} sampler2DArrayShadow;
	precision ${o.precision} isampler2D;
	precision ${o.precision} isampler3D;
	precision ${o.precision} isamplerCube;
	precision ${o.precision} isampler2DArray;
	precision ${o.precision} usampler2D;
	precision ${o.precision} usampler3D;
	precision ${o.precision} usamplerCube;
	precision ${o.precision} usampler2DArray;
	`;return o.precision==="highp"?e+=`
#define HIGH_PRECISION`:o.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:o.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function Wx(o){let e="SHADOWMAP_TYPE_BASIC";return o.shadowMapType===Hf?e="SHADOWMAP_TYPE_PCF":o.shadowMapType===tg?e="SHADOWMAP_TYPE_PCF_SOFT":o.shadowMapType===zi&&(e="SHADOWMAP_TYPE_VSM"),e}function Xx(o){let e="ENVMAP_TYPE_CUBE";if(o.envMap)switch(o.envMapMode){case Vr:case Hr:e="ENVMAP_TYPE_CUBE";break;case ml:e="ENVMAP_TYPE_CUBE_UV";break}return e}function jx(o){let e="ENVMAP_MODE_REFLECTION";if(o.envMap)switch(o.envMapMode){case Hr:e="ENVMAP_MODE_REFRACTION";break}return e}function qx(o){let e="ENVMAP_BLENDING_NONE";if(o.envMap)switch(o.combine){case pl:e="ENVMAP_BLENDING_MULTIPLY";break;case Tg:e="ENVMAP_BLENDING_MIX";break;case Cg:e="ENVMAP_BLENDING_ADD";break}return e}function Yx(o){const e=o.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function $x(o,e,t,n){const i=o.getContext(),s=t.defines;let r=t.vertexShader,a=t.fragmentShader;const c=Wx(t),u=Xx(t),d=jx(t),l=qx(t),h=Yx(t),f=Nx(t),p=Ox(s),g=i.createProgram();let m,v,_=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(xo).join(`
`),m.length>0&&(m+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p].filter(xo).join(`
`),v.length>0&&(v+=`
`)):(m=[gd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(xo).join(`
`),v=[gd(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",t.envMap?"#define "+l:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==ps?"#define TONE_MAPPING":"",t.toneMapping!==ps?ft.tonemapping_pars_fragment:"",t.toneMapping!==ps?kx("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ft.colorspace_pars_fragment,Fx("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(xo).join(`
`)),r=Oc(r),r=fd(r,t),r=pd(r,t),a=Oc(a),a=fd(a,t),a=pd(a,t),r=md(r),a=md(a),t.isRawShaderMaterial!==!0&&(_=`#version 300 es
`,m=[f,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,v=["#define varying in",t.glslVersion===Lu?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Lu?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const y=_+m+r,x=_+v+a,M=ud(i,i.VERTEX_SHADER,y),S=ud(i,i.FRAGMENT_SHADER,x);i.attachShader(g,M),i.attachShader(g,S),t.index0AttributeName!==void 0?i.bindAttribLocation(g,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(g,0,"position"),i.linkProgram(g);function A(P){if(o.debug.checkShaderErrors){const N=i.getProgramInfoLog(g).trim(),I=i.getShaderInfoLog(M).trim(),H=i.getShaderInfoLog(S).trim();let G=!0,J=!0;if(i.getProgramParameter(g,i.LINK_STATUS)===!1)if(G=!1,typeof o.debug.onShaderError=="function")o.debug.onShaderError(i,g,M,S);else{const U=dd(i,M,"vertex"),k=dd(i,S,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(g,i.VALIDATE_STATUS)+`

Material Name: `+P.name+`
Material Type: `+P.type+`

Program Info Log: `+N+`
`+U+`
`+k)}else N!==""?console.warn("THREE.WebGLProgram: Program Info Log:",N):(I===""||H==="")&&(J=!1);J&&(P.diagnostics={runnable:G,programLog:N,vertexShader:{log:I,prefix:m},fragmentShader:{log:H,prefix:v}})}i.deleteShader(M),i.deleteShader(S),T=new Ga(i,g),b=Bx(i,g)}let T;this.getUniforms=function(){return T===void 0&&A(this),T};let b;this.getAttributes=function(){return b===void 0&&A(this),b};let w=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return w===!1&&(w=i.getProgramParameter(g,Px)),w},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(g),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Lx++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=M,this.fragmentShader=S,this}let Kx=0;class Zx{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),r=this._getShaderCacheForMaterial(e);return r.has(i)===!1&&(r.add(i),i.usedTimes++),r.has(s)===!1&&(r.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new Qx(e),t.set(e,n)),n}}class Qx{constructor(e){this.id=Kx++,this.code=e,this.usedTimes=0}}function Jx(o,e,t,n,i,s,r){const a=new _h,c=new Zx,u=new Set,d=[],l=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(b){return u.add(b),b===0?"uv":`uv${b}`}function m(b,w,P,N,I){const H=N.fog,G=I.geometry,J=b.isMeshStandardMaterial?N.environment:null,U=(b.isMeshStandardMaterial?t:e).get(b.envMap||J),k=U&&U.mapping===ml?U.image.height:null,q=p[b.type];b.precision!==null&&(f=i.getMaxPrecision(b.precision),f!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",f,"instead."));const Y=G.morphAttributes.position||G.morphAttributes.normal||G.morphAttributes.color,V=Y!==void 0?Y.length:0;let Z=0;G.morphAttributes.position!==void 0&&(Z=1),G.morphAttributes.normal!==void 0&&(Z=2),G.morphAttributes.color!==void 0&&(Z=3);let W,L,F,X;if(q){const pt=wi[q];W=pt.vertexShader,L=pt.fragmentShader}else W=b.vertexShader,L=b.fragmentShader,c.update(b),F=c.getVertexShaderID(b),X=c.getFragmentShaderID(b);const ee=o.getRenderTarget(),re=I.isInstancedMesh===!0,K=I.isBatchedMesh===!0,O=!!b.map,de=!!b.matcap,_e=!!U,Me=!!b.aoMap,me=!!b.lightMap,le=!!b.bumpMap,ue=!!b.normalMap,We=!!b.displacementMap,Ge=!!b.emissiveMap,B=!!b.metalnessMap,C=!!b.roughnessMap,ie=b.anisotropy>0,he=b.clearcoat>0,fe=b.dispersion>0,ge=b.iridescence>0,Ie=b.sheen>0,Ee=b.transmission>0,we=ie&&!!b.anisotropyMap,Ke=he&&!!b.clearcoatMap,Ce=he&&!!b.clearcoatNormalMap,$e=he&&!!b.clearcoatRoughnessMap,at=ge&&!!b.iridescenceMap,Ze=ge&&!!b.iridescenceThicknessMap,ze=Ie&&!!b.sheenColorMap,Je=Ie&&!!b.sheenRoughnessMap,rt=!!b.specularMap,vt=!!b.specularColorMap,tt=!!b.specularIntensityMap,E=Ee&&!!b.transmissionMap,te=Ee&&!!b.thicknessMap,se=!!b.gradientMap,ye=!!b.alphaMap,Te=b.alphaTest>0,nt=!!b.alphaHash,ot=!!b.extensions;let St=ps;b.toneMapped&&(ee===null||ee.isXRRenderTarget===!0)&&(St=o.toneMapping);const Ut={shaderID:q,shaderType:b.type,shaderName:b.name,vertexShader:W,fragmentShader:L,defines:b.defines,customVertexShaderID:F,customFragmentShaderID:X,isRawShaderMaterial:b.isRawShaderMaterial===!0,glslVersion:b.glslVersion,precision:f,batching:K,instancing:re,instancingColor:re&&I.instanceColor!==null,instancingMorph:re&&I.morphTexture!==null,supportsVertexTextures:h,outputColorSpace:ee===null?o.outputColorSpace:ee.isXRRenderTarget===!0?ee.texture.colorSpace:_n,alphaToCoverage:!!b.alphaToCoverage,map:O,matcap:de,envMap:_e,envMapMode:_e&&U.mapping,envMapCubeUVHeight:k,aoMap:Me,lightMap:me,bumpMap:le,normalMap:ue,displacementMap:h&&We,emissiveMap:Ge,normalMapObjectSpace:ue&&b.normalMapType===Kg,normalMapTangentSpace:ue&&b.normalMapType===Zo,metalnessMap:B,roughnessMap:C,anisotropy:ie,anisotropyMap:we,clearcoat:he,clearcoatMap:Ke,clearcoatNormalMap:Ce,clearcoatRoughnessMap:$e,dispersion:fe,iridescence:ge,iridescenceMap:at,iridescenceThicknessMap:Ze,sheen:Ie,sheenColorMap:ze,sheenRoughnessMap:Je,specularMap:rt,specularColorMap:vt,specularIntensityMap:tt,transmission:Ee,transmissionMap:E,thicknessMap:te,gradientMap:se,opaque:b.transparent===!1&&b.blending===Dr&&b.alphaToCoverage===!1,alphaMap:ye,alphaTest:Te,alphaHash:nt,combine:b.combine,mapUv:O&&g(b.map.channel),aoMapUv:Me&&g(b.aoMap.channel),lightMapUv:me&&g(b.lightMap.channel),bumpMapUv:le&&g(b.bumpMap.channel),normalMapUv:ue&&g(b.normalMap.channel),displacementMapUv:We&&g(b.displacementMap.channel),emissiveMapUv:Ge&&g(b.emissiveMap.channel),metalnessMapUv:B&&g(b.metalnessMap.channel),roughnessMapUv:C&&g(b.roughnessMap.channel),anisotropyMapUv:we&&g(b.anisotropyMap.channel),clearcoatMapUv:Ke&&g(b.clearcoatMap.channel),clearcoatNormalMapUv:Ce&&g(b.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:$e&&g(b.clearcoatRoughnessMap.channel),iridescenceMapUv:at&&g(b.iridescenceMap.channel),iridescenceThicknessMapUv:Ze&&g(b.iridescenceThicknessMap.channel),sheenColorMapUv:ze&&g(b.sheenColorMap.channel),sheenRoughnessMapUv:Je&&g(b.sheenRoughnessMap.channel),specularMapUv:rt&&g(b.specularMap.channel),specularColorMapUv:vt&&g(b.specularColorMap.channel),specularIntensityMapUv:tt&&g(b.specularIntensityMap.channel),transmissionMapUv:E&&g(b.transmissionMap.channel),thicknessMapUv:te&&g(b.thicknessMap.channel),alphaMapUv:ye&&g(b.alphaMap.channel),vertexTangents:!!G.attributes.tangent&&(ue||ie),vertexColors:b.vertexColors,vertexAlphas:b.vertexColors===!0&&!!G.attributes.color&&G.attributes.color.itemSize===4,pointsUvs:I.isPoints===!0&&!!G.attributes.uv&&(O||ye),fog:!!H,useFog:b.fog===!0,fogExp2:!!H&&H.isFogExp2,flatShading:b.flatShading===!0,sizeAttenuation:b.sizeAttenuation===!0,logarithmicDepthBuffer:l,skinning:I.isSkinnedMesh===!0,morphTargets:G.morphAttributes.position!==void 0,morphNormals:G.morphAttributes.normal!==void 0,morphColors:G.morphAttributes.color!==void 0,morphTargetsCount:V,morphTextureStride:Z,numDirLights:w.directional.length,numPointLights:w.point.length,numSpotLights:w.spot.length,numSpotLightMaps:w.spotLightMap.length,numRectAreaLights:w.rectArea.length,numHemiLights:w.hemi.length,numDirLightShadows:w.directionalShadowMap.length,numPointLightShadows:w.pointShadowMap.length,numSpotLightShadows:w.spotShadowMap.length,numSpotLightShadowsWithMaps:w.numSpotLightShadowsWithMaps,numLightProbes:w.numLightProbes,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:b.dithering,shadowMapEnabled:o.shadowMap.enabled&&P.length>0,shadowMapType:o.shadowMap.type,toneMapping:St,useLegacyLights:o._useLegacyLights,decodeVideoTexture:O&&b.map.isVideoTexture===!0&&Et.getTransfer(b.map.colorSpace)===zt,premultipliedAlpha:b.premultipliedAlpha,doubleSided:b.side===qn,flipSided:b.side===Nn,useDepthPacking:b.depthPacking>=0,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionClipCullDistance:ot&&b.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:ot&&b.extensions.multiDraw===!0&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:b.customProgramCacheKey()};return Ut.vertexUv1s=u.has(1),Ut.vertexUv2s=u.has(2),Ut.vertexUv3s=u.has(3),u.clear(),Ut}function v(b){const w=[];if(b.shaderID?w.push(b.shaderID):(w.push(b.customVertexShaderID),w.push(b.customFragmentShaderID)),b.defines!==void 0)for(const P in b.defines)w.push(P),w.push(b.defines[P]);return b.isRawShaderMaterial===!1&&(_(w,b),y(w,b),w.push(o.outputColorSpace)),w.push(b.customProgramCacheKey),w.join()}function _(b,w){b.push(w.precision),b.push(w.outputColorSpace),b.push(w.envMapMode),b.push(w.envMapCubeUVHeight),b.push(w.mapUv),b.push(w.alphaMapUv),b.push(w.lightMapUv),b.push(w.aoMapUv),b.push(w.bumpMapUv),b.push(w.normalMapUv),b.push(w.displacementMapUv),b.push(w.emissiveMapUv),b.push(w.metalnessMapUv),b.push(w.roughnessMapUv),b.push(w.anisotropyMapUv),b.push(w.clearcoatMapUv),b.push(w.clearcoatNormalMapUv),b.push(w.clearcoatRoughnessMapUv),b.push(w.iridescenceMapUv),b.push(w.iridescenceThicknessMapUv),b.push(w.sheenColorMapUv),b.push(w.sheenRoughnessMapUv),b.push(w.specularMapUv),b.push(w.specularColorMapUv),b.push(w.specularIntensityMapUv),b.push(w.transmissionMapUv),b.push(w.thicknessMapUv),b.push(w.combine),b.push(w.fogExp2),b.push(w.sizeAttenuation),b.push(w.morphTargetsCount),b.push(w.morphAttributeCount),b.push(w.numDirLights),b.push(w.numPointLights),b.push(w.numSpotLights),b.push(w.numSpotLightMaps),b.push(w.numHemiLights),b.push(w.numRectAreaLights),b.push(w.numDirLightShadows),b.push(w.numPointLightShadows),b.push(w.numSpotLightShadows),b.push(w.numSpotLightShadowsWithMaps),b.push(w.numLightProbes),b.push(w.shadowMapType),b.push(w.toneMapping),b.push(w.numClippingPlanes),b.push(w.numClipIntersection),b.push(w.depthPacking)}function y(b,w){a.disableAll(),w.supportsVertexTextures&&a.enable(0),w.instancing&&a.enable(1),w.instancingColor&&a.enable(2),w.instancingMorph&&a.enable(3),w.matcap&&a.enable(4),w.envMap&&a.enable(5),w.normalMapObjectSpace&&a.enable(6),w.normalMapTangentSpace&&a.enable(7),w.clearcoat&&a.enable(8),w.iridescence&&a.enable(9),w.alphaTest&&a.enable(10),w.vertexColors&&a.enable(11),w.vertexAlphas&&a.enable(12),w.vertexUv1s&&a.enable(13),w.vertexUv2s&&a.enable(14),w.vertexUv3s&&a.enable(15),w.vertexTangents&&a.enable(16),w.anisotropy&&a.enable(17),w.alphaHash&&a.enable(18),w.batching&&a.enable(19),w.dispersion&&a.enable(20),b.push(a.mask),a.disableAll(),w.fog&&a.enable(0),w.useFog&&a.enable(1),w.flatShading&&a.enable(2),w.logarithmicDepthBuffer&&a.enable(3),w.skinning&&a.enable(4),w.morphTargets&&a.enable(5),w.morphNormals&&a.enable(6),w.morphColors&&a.enable(7),w.premultipliedAlpha&&a.enable(8),w.shadowMapEnabled&&a.enable(9),w.useLegacyLights&&a.enable(10),w.doubleSided&&a.enable(11),w.flipSided&&a.enable(12),w.useDepthPacking&&a.enable(13),w.dithering&&a.enable(14),w.transmission&&a.enable(15),w.sheen&&a.enable(16),w.opaque&&a.enable(17),w.pointsUvs&&a.enable(18),w.decodeVideoTexture&&a.enable(19),w.alphaToCoverage&&a.enable(20),b.push(a.mask)}function x(b){const w=p[b.type];let P;if(w){const N=wi[w];P=lp.clone(N.uniforms)}else P=b.uniforms;return P}function M(b,w){let P;for(let N=0,I=d.length;N<I;N++){const H=d[N];if(H.cacheKey===w){P=H,++P.usedTimes;break}}return P===void 0&&(P=new $x(o,w,b,s),d.push(P)),P}function S(b){if(--b.usedTimes===0){const w=d.indexOf(b);d[w]=d[d.length-1],d.pop(),b.destroy()}}function A(b){c.remove(b)}function T(){c.dispose()}return{getParameters:m,getProgramCacheKey:v,getUniforms:x,acquireProgram:M,releaseProgram:S,releaseShaderCache:A,programs:d,dispose:T}}function ew(){let o=new WeakMap;function e(s){let r=o.get(s);return r===void 0&&(r={},o.set(s,r)),r}function t(s){o.delete(s)}function n(s,r,a){o.get(s)[r]=a}function i(){o=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function tw(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.material.id!==e.material.id?o.material.id-e.material.id:o.z!==e.z?o.z-e.z:o.id-e.id}function vd(o,e){return o.groupOrder!==e.groupOrder?o.groupOrder-e.groupOrder:o.renderOrder!==e.renderOrder?o.renderOrder-e.renderOrder:o.z!==e.z?e.z-o.z:o.id-e.id}function _d(){const o=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function r(l,h,f,p,g,m){let v=o[e];return v===void 0?(v={id:l.id,object:l,geometry:h,material:f,groupOrder:p,renderOrder:l.renderOrder,z:g,group:m},o[e]=v):(v.id=l.id,v.object=l,v.geometry=h,v.material=f,v.groupOrder=p,v.renderOrder=l.renderOrder,v.z=g,v.group=m),e++,v}function a(l,h,f,p,g,m){const v=r(l,h,f,p,g,m);f.transmission>0?n.push(v):f.transparent===!0?i.push(v):t.push(v)}function c(l,h,f,p,g,m){const v=r(l,h,f,p,g,m);f.transmission>0?n.unshift(v):f.transparent===!0?i.unshift(v):t.unshift(v)}function u(l,h){t.length>1&&t.sort(l||tw),n.length>1&&n.sort(h||vd),i.length>1&&i.sort(h||vd)}function d(){for(let l=e,h=o.length;l<h;l++){const f=o[l];if(f.id===null)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:a,unshift:c,finish:d,sort:u}}function nw(){let o=new WeakMap;function e(n,i){const s=o.get(n);let r;return s===void 0?(r=new _d,o.set(n,[r])):i>=s.length?(r=new _d,s.push(r)):r=s[i],r}function t(){o=new WeakMap}return{get:e,dispose:t}}function iw(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new D,color:new He};break;case"SpotLight":t={position:new D,direction:new D,color:new He,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new D,color:new He,distance:0,decay:0};break;case"HemisphereLight":t={direction:new D,skyColor:new He,groundColor:new He};break;case"RectAreaLight":t={color:new He,position:new D,halfWidth:new D,halfHeight:new D};break}return o[e.id]=t,t}}}function sw(){const o={};return{get:function(e){if(o[e.id]!==void 0)return o[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Fe,shadowCameraNear:1,shadowCameraFar:1e3};break}return o[e.id]=t,t}}}let rw=0;function ow(o,e){return(e.castShadow?2:0)-(o.castShadow?2:0)+(e.map?1:0)-(o.map?1:0)}function aw(o){const e=new iw,t=sw(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new D);const i=new D,s=new Ye,r=new Ye;function a(u,d){let l=0,h=0,f=0;for(let P=0;P<9;P++)n.probe[P].set(0,0,0);let p=0,g=0,m=0,v=0,_=0,y=0,x=0,M=0,S=0,A=0,T=0;u.sort(ow);const b=d===!0?Math.PI:1;for(let P=0,N=u.length;P<N;P++){const I=u[P],H=I.color,G=I.intensity,J=I.distance,U=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)l+=H.r*G*b,h+=H.g*G*b,f+=H.b*G*b;else if(I.isLightProbe){for(let k=0;k<9;k++)n.probe[k].addScaledVector(I.sh.coefficients[k],G);T++}else if(I.isDirectionalLight){const k=e.get(I);if(k.color.copy(I.color).multiplyScalar(I.intensity*b),I.castShadow){const q=I.shadow,Y=t.get(I);Y.shadowBias=q.bias,Y.shadowNormalBias=q.normalBias,Y.shadowRadius=q.radius,Y.shadowMapSize=q.mapSize,n.directionalShadow[p]=Y,n.directionalShadowMap[p]=U,n.directionalShadowMatrix[p]=I.shadow.matrix,y++}n.directional[p]=k,p++}else if(I.isSpotLight){const k=e.get(I);k.position.setFromMatrixPosition(I.matrixWorld),k.color.copy(H).multiplyScalar(G*b),k.distance=J,k.coneCos=Math.cos(I.angle),k.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),k.decay=I.decay,n.spot[m]=k;const q=I.shadow;if(I.map&&(n.spotLightMap[S]=I.map,S++,q.updateMatrices(I),I.castShadow&&A++),n.spotLightMatrix[m]=q.matrix,I.castShadow){const Y=t.get(I);Y.shadowBias=q.bias,Y.shadowNormalBias=q.normalBias,Y.shadowRadius=q.radius,Y.shadowMapSize=q.mapSize,n.spotShadow[m]=Y,n.spotShadowMap[m]=U,M++}m++}else if(I.isRectAreaLight){const k=e.get(I);k.color.copy(H).multiplyScalar(G),k.halfWidth.set(I.width*.5,0,0),k.halfHeight.set(0,I.height*.5,0),n.rectArea[v]=k,v++}else if(I.isPointLight){const k=e.get(I);if(k.color.copy(I.color).multiplyScalar(I.intensity*b),k.distance=I.distance,k.decay=I.decay,I.castShadow){const q=I.shadow,Y=t.get(I);Y.shadowBias=q.bias,Y.shadowNormalBias=q.normalBias,Y.shadowRadius=q.radius,Y.shadowMapSize=q.mapSize,Y.shadowCameraNear=q.camera.near,Y.shadowCameraFar=q.camera.far,n.pointShadow[g]=Y,n.pointShadowMap[g]=U,n.pointShadowMatrix[g]=I.shadow.matrix,x++}n.point[g]=k,g++}else if(I.isHemisphereLight){const k=e.get(I);k.skyColor.copy(I.color).multiplyScalar(G*b),k.groundColor.copy(I.groundColor).multiplyScalar(G*b),n.hemi[_]=k,_++}}v>0&&(o.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Be.LTC_FLOAT_1,n.rectAreaLTC2=Be.LTC_FLOAT_2):(n.rectAreaLTC1=Be.LTC_HALF_1,n.rectAreaLTC2=Be.LTC_HALF_2)),n.ambient[0]=l,n.ambient[1]=h,n.ambient[2]=f;const w=n.hash;(w.directionalLength!==p||w.pointLength!==g||w.spotLength!==m||w.rectAreaLength!==v||w.hemiLength!==_||w.numDirectionalShadows!==y||w.numPointShadows!==x||w.numSpotShadows!==M||w.numSpotMaps!==S||w.numLightProbes!==T)&&(n.directional.length=p,n.spot.length=m,n.rectArea.length=v,n.point.length=g,n.hemi.length=_,n.directionalShadow.length=y,n.directionalShadowMap.length=y,n.pointShadow.length=x,n.pointShadowMap.length=x,n.spotShadow.length=M,n.spotShadowMap.length=M,n.directionalShadowMatrix.length=y,n.pointShadowMatrix.length=x,n.spotLightMatrix.length=M+S-A,n.spotLightMap.length=S,n.numSpotLightShadowsWithMaps=A,n.numLightProbes=T,w.directionalLength=p,w.pointLength=g,w.spotLength=m,w.rectAreaLength=v,w.hemiLength=_,w.numDirectionalShadows=y,w.numPointShadows=x,w.numSpotShadows=M,w.numSpotMaps=S,w.numLightProbes=T,n.version=rw++)}function c(u,d){let l=0,h=0,f=0,p=0,g=0;const m=d.matrixWorldInverse;for(let v=0,_=u.length;v<_;v++){const y=u[v];if(y.isDirectionalLight){const x=n.directional[l];x.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(m),l++}else if(y.isSpotLight){const x=n.spot[f];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(m),x.direction.setFromMatrixPosition(y.matrixWorld),i.setFromMatrixPosition(y.target.matrixWorld),x.direction.sub(i),x.direction.transformDirection(m),f++}else if(y.isRectAreaLight){const x=n.rectArea[p];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(m),r.identity(),s.copy(y.matrixWorld),s.premultiply(m),r.extractRotation(s),x.halfWidth.set(y.width*.5,0,0),x.halfHeight.set(0,y.height*.5,0),x.halfWidth.applyMatrix4(r),x.halfHeight.applyMatrix4(r),p++}else if(y.isPointLight){const x=n.point[h];x.position.setFromMatrixPosition(y.matrixWorld),x.position.applyMatrix4(m),h++}else if(y.isHemisphereLight){const x=n.hemi[g];x.direction.setFromMatrixPosition(y.matrixWorld),x.direction.transformDirection(m),g++}}}return{setup:a,setupView:c,state:n}}function yd(o){const e=new aw(o),t=[],n=[];function i(d){u.camera=d,t.length=0,n.length=0}function s(d){t.push(d)}function r(d){n.push(d)}function a(d){e.setup(t,d)}function c(d){e.setupView(t,d)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:a,setupLightsView:c,pushLight:s,pushShadow:r}}function lw(o){let e=new WeakMap;function t(i,s=0){const r=e.get(i);let a;return r===void 0?(a=new yd(o),e.set(i,[a])):s>=r.length?(a=new yd(o),r.push(a)):a=r[s],a}function n(){e=new WeakMap}return{get:t,dispose:n}}class cw extends Kn{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Yg,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class hw extends Kn{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const uw=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,dw=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function fw(o,e,t){let n=new xh;const i=new Fe,s=new Fe,r=new At,a=new cw({depthPacking:$g}),c=new hw,u={},d=t.maxTextureSize,l={[qi]:Nn,[Nn]:qi,[qn]:qn},h=new Mn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Fe},radius:{value:4}},vertexShader:uw,fragmentShader:dw}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new Ft;p.setAttribute("position",new an(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Se(p,h),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Hf;let v=this.type;this.render=function(S,A,T){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||S.length===0)return;const b=o.getRenderTarget(),w=o.getActiveCubeFace(),P=o.getActiveMipmapLevel(),N=o.state;N.setBlending(ji),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);const I=v!==zi&&this.type===zi,H=v===zi&&this.type!==zi;for(let G=0,J=S.length;G<J;G++){const U=S[G],k=U.shadow;if(k===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(k.autoUpdate===!1&&k.needsUpdate===!1)continue;i.copy(k.mapSize);const q=k.getFrameExtents();if(i.multiply(q),s.copy(k.mapSize),(i.x>d||i.y>d)&&(i.x>d&&(s.x=Math.floor(d/q.x),i.x=s.x*q.x,k.mapSize.x=s.x),i.y>d&&(s.y=Math.floor(d/q.y),i.y=s.y*q.y,k.mapSize.y=s.y)),k.map===null||I===!0||H===!0){const V=this.type!==zi?{minFilter:Bt,magFilter:Bt}:{};k.map!==null&&k.map.dispose(),k.map=new ys(i.x,i.y,V),k.map.texture.name=U.name+".shadowMap",k.camera.updateProjectionMatrix()}o.setRenderTarget(k.map),o.clear();const Y=k.getViewportCount();for(let V=0;V<Y;V++){const Z=k.getViewport(V);r.set(s.x*Z.x,s.y*Z.y,s.x*Z.z,s.y*Z.w),N.viewport(r),k.updateMatrices(U,V),n=k.getFrustum(),x(A,T,k.camera,U,this.type)}k.isPointLightShadow!==!0&&this.type===zi&&_(k,T),k.needsUpdate=!1}v=this.type,m.needsUpdate=!1,o.setRenderTarget(b,w,P)};function _(S,A){const T=e.update(g);h.defines.VSM_SAMPLES!==S.blurSamples&&(h.defines.VSM_SAMPLES=S.blurSamples,f.defines.VSM_SAMPLES=S.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),S.mapPass===null&&(S.mapPass=new ys(i.x,i.y)),h.uniforms.shadow_pass.value=S.map.texture,h.uniforms.resolution.value=S.mapSize,h.uniforms.radius.value=S.radius,o.setRenderTarget(S.mapPass),o.clear(),o.renderBufferDirect(A,null,T,h,g,null),f.uniforms.shadow_pass.value=S.mapPass.texture,f.uniforms.resolution.value=S.mapSize,f.uniforms.radius.value=S.radius,o.setRenderTarget(S.map),o.clear(),o.renderBufferDirect(A,null,T,f,g,null)}function y(S,A,T,b){let w=null;const P=T.isPointLight===!0?S.customDistanceMaterial:S.customDepthMaterial;if(P!==void 0)w=P;else if(w=T.isPointLight===!0?c:a,o.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0){const N=w.uuid,I=A.uuid;let H=u[N];H===void 0&&(H={},u[N]=H);let G=H[I];G===void 0&&(G=w.clone(),H[I]=G,A.addEventListener("dispose",M)),w=G}if(w.visible=A.visible,w.wireframe=A.wireframe,b===zi?w.side=A.shadowSide!==null?A.shadowSide:A.side:w.side=A.shadowSide!==null?A.shadowSide:l[A.side],w.alphaMap=A.alphaMap,w.alphaTest=A.alphaTest,w.map=A.map,w.clipShadows=A.clipShadows,w.clippingPlanes=A.clippingPlanes,w.clipIntersection=A.clipIntersection,w.displacementMap=A.displacementMap,w.displacementScale=A.displacementScale,w.displacementBias=A.displacementBias,w.wireframeLinewidth=A.wireframeLinewidth,w.linewidth=A.linewidth,T.isPointLight===!0&&w.isMeshDistanceMaterial===!0){const N=o.properties.get(w);N.light=T}return w}function x(S,A,T,b,w){if(S.visible===!1)return;if(S.layers.test(A.layers)&&(S.isMesh||S.isLine||S.isPoints)&&(S.castShadow||S.receiveShadow&&w===zi)&&(!S.frustumCulled||n.intersectsObject(S))){S.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,S.matrixWorld);const I=e.update(S),H=S.material;if(Array.isArray(H)){const G=I.groups;for(let J=0,U=G.length;J<U;J++){const k=G[J],q=H[k.materialIndex];if(q&&q.visible){const Y=y(S,q,b,w);S.onBeforeShadow(o,S,A,T,I,Y,k),o.renderBufferDirect(T,null,I,Y,S,k),S.onAfterShadow(o,S,A,T,I,Y,k)}}}else if(H.visible){const G=y(S,H,b,w);S.onBeforeShadow(o,S,A,T,I,G,null),o.renderBufferDirect(T,null,I,G,S,null),S.onAfterShadow(o,S,A,T,I,G,null)}}const N=S.children;for(let I=0,H=N.length;I<H;I++)x(N[I],A,T,b,w)}function M(S){S.target.removeEventListener("dispose",M);for(const T in u){const b=u[T],w=S.target.uuid;w in b&&(b[w].dispose(),delete b[w])}}}function pw(o){function e(){let E=!1;const te=new At;let se=null;const ye=new At(0,0,0,0);return{setMask:function(Te){se!==Te&&!E&&(o.colorMask(Te,Te,Te,Te),se=Te)},setLocked:function(Te){E=Te},setClear:function(Te,nt,ot,St,Ut){Ut===!0&&(Te*=St,nt*=St,ot*=St),te.set(Te,nt,ot,St),ye.equals(te)===!1&&(o.clearColor(Te,nt,ot,St),ye.copy(te))},reset:function(){E=!1,se=null,ye.set(-1,0,0,0)}}}function t(){let E=!1,te=null,se=null,ye=null;return{setTest:function(Te){Te?X(o.DEPTH_TEST):ee(o.DEPTH_TEST)},setMask:function(Te){te!==Te&&!E&&(o.depthMask(Te),te=Te)},setFunc:function(Te){if(se!==Te){switch(Te){case xg:o.depthFunc(o.NEVER);break;case wg:o.depthFunc(o.ALWAYS);break;case bg:o.depthFunc(o.LESS);break;case $a:o.depthFunc(o.LEQUAL);break;case Mg:o.depthFunc(o.EQUAL);break;case Sg:o.depthFunc(o.GEQUAL);break;case Ag:o.depthFunc(o.GREATER);break;case Eg:o.depthFunc(o.NOTEQUAL);break;default:o.depthFunc(o.LEQUAL)}se=Te}},setLocked:function(Te){E=Te},setClear:function(Te){ye!==Te&&(o.clearDepth(Te),ye=Te)},reset:function(){E=!1,te=null,se=null,ye=null}}}function n(){let E=!1,te=null,se=null,ye=null,Te=null,nt=null,ot=null,St=null,Ut=null;return{setTest:function(pt){E||(pt?X(o.STENCIL_TEST):ee(o.STENCIL_TEST))},setMask:function(pt){te!==pt&&!E&&(o.stencilMask(pt),te=pt)},setFunc:function(pt,mt,oe){(se!==pt||ye!==mt||Te!==oe)&&(o.stencilFunc(pt,mt,oe),se=pt,ye=mt,Te=oe)},setOp:function(pt,mt,oe){(nt!==pt||ot!==mt||St!==oe)&&(o.stencilOp(pt,mt,oe),nt=pt,ot=mt,St=oe)},setLocked:function(pt){E=pt},setClear:function(pt){Ut!==pt&&(o.clearStencil(pt),Ut=pt)},reset:function(){E=!1,te=null,se=null,ye=null,Te=null,nt=null,ot=null,St=null,Ut=null}}}const i=new e,s=new t,r=new n,a=new WeakMap,c=new WeakMap;let u={},d={},l=new WeakMap,h=[],f=null,p=!1,g=null,m=null,v=null,_=null,y=null,x=null,M=null,S=new He(0,0,0),A=0,T=!1,b=null,w=null,P=null,N=null,I=null;const H=o.getParameter(o.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let G=!1,J=0;const U=o.getParameter(o.VERSION);U.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(U)[1]),G=J>=1):U.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(U)[1]),G=J>=2);let k=null,q={};const Y=o.getParameter(o.SCISSOR_BOX),V=o.getParameter(o.VIEWPORT),Z=new At().fromArray(Y),W=new At().fromArray(V);function L(E,te,se,ye){const Te=new Uint8Array(4),nt=o.createTexture();o.bindTexture(E,nt),o.texParameteri(E,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(E,o.TEXTURE_MAG_FILTER,o.NEAREST);for(let ot=0;ot<se;ot++)E===o.TEXTURE_3D||E===o.TEXTURE_2D_ARRAY?o.texImage3D(te,0,o.RGBA,1,1,ye,0,o.RGBA,o.UNSIGNED_BYTE,Te):o.texImage2D(te+ot,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,Te);return nt}const F={};F[o.TEXTURE_2D]=L(o.TEXTURE_2D,o.TEXTURE_2D,1),F[o.TEXTURE_CUBE_MAP]=L(o.TEXTURE_CUBE_MAP,o.TEXTURE_CUBE_MAP_POSITIVE_X,6),F[o.TEXTURE_2D_ARRAY]=L(o.TEXTURE_2D_ARRAY,o.TEXTURE_2D_ARRAY,1,1),F[o.TEXTURE_3D]=L(o.TEXTURE_3D,o.TEXTURE_3D,1,1),i.setClear(0,0,0,1),s.setClear(1),r.setClear(0),X(o.DEPTH_TEST),s.setFunc($a),le(!1),ue(Kh),X(o.CULL_FACE),Me(ji);function X(E){u[E]!==!0&&(o.enable(E),u[E]=!0)}function ee(E){u[E]!==!1&&(o.disable(E),u[E]=!1)}function re(E,te){return d[E]!==te?(o.bindFramebuffer(E,te),d[E]=te,E===o.DRAW_FRAMEBUFFER&&(d[o.FRAMEBUFFER]=te),E===o.FRAMEBUFFER&&(d[o.DRAW_FRAMEBUFFER]=te),!0):!1}function K(E,te){let se=h,ye=!1;if(E){se=l.get(te),se===void 0&&(se=[],l.set(te,se));const Te=E.textures;if(se.length!==Te.length||se[0]!==o.COLOR_ATTACHMENT0){for(let nt=0,ot=Te.length;nt<ot;nt++)se[nt]=o.COLOR_ATTACHMENT0+nt;se.length=Te.length,ye=!0}}else se[0]!==o.BACK&&(se[0]=o.BACK,ye=!0);ye&&o.drawBuffers(se)}function O(E){return f!==E?(o.useProgram(E),f=E,!0):!1}const de={[Us]:o.FUNC_ADD,[ig]:o.FUNC_SUBTRACT,[sg]:o.FUNC_REVERSE_SUBTRACT};de[rg]=o.MIN,de[og]=o.MAX;const _e={[ag]:o.ZERO,[lg]:o.ONE,[cg]:o.SRC_COLOR,[Ic]:o.SRC_ALPHA,[mg]:o.SRC_ALPHA_SATURATE,[fg]:o.DST_COLOR,[ug]:o.DST_ALPHA,[hg]:o.ONE_MINUS_SRC_COLOR,[Dc]:o.ONE_MINUS_SRC_ALPHA,[pg]:o.ONE_MINUS_DST_COLOR,[dg]:o.ONE_MINUS_DST_ALPHA,[gg]:o.CONSTANT_COLOR,[vg]:o.ONE_MINUS_CONSTANT_COLOR,[_g]:o.CONSTANT_ALPHA,[yg]:o.ONE_MINUS_CONSTANT_ALPHA};function Me(E,te,se,ye,Te,nt,ot,St,Ut,pt){if(E===ji){p===!0&&(ee(o.BLEND),p=!1);return}if(p===!1&&(X(o.BLEND),p=!0),E!==ng){if(E!==g||pt!==T){if((m!==Us||y!==Us)&&(o.blendEquation(o.FUNC_ADD),m=Us,y=Us),pt)switch(E){case Dr:o.blendFuncSeparate(o.ONE,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case Zh:o.blendFunc(o.ONE,o.ONE);break;case Qh:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case Jh:o.blendFuncSeparate(o.ZERO,o.SRC_COLOR,o.ZERO,o.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}else switch(E){case Dr:o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA);break;case Zh:o.blendFunc(o.SRC_ALPHA,o.ONE);break;case Qh:o.blendFuncSeparate(o.ZERO,o.ONE_MINUS_SRC_COLOR,o.ZERO,o.ONE);break;case Jh:o.blendFunc(o.ZERO,o.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",E);break}v=null,_=null,x=null,M=null,S.set(0,0,0),A=0,g=E,T=pt}return}Te=Te||te,nt=nt||se,ot=ot||ye,(te!==m||Te!==y)&&(o.blendEquationSeparate(de[te],de[Te]),m=te,y=Te),(se!==v||ye!==_||nt!==x||ot!==M)&&(o.blendFuncSeparate(_e[se],_e[ye],_e[nt],_e[ot]),v=se,_=ye,x=nt,M=ot),(St.equals(S)===!1||Ut!==A)&&(o.blendColor(St.r,St.g,St.b,Ut),S.copy(St),A=Ut),g=E,T=!1}function me(E,te){E.side===qn?ee(o.CULL_FACE):X(o.CULL_FACE);let se=E.side===Nn;te&&(se=!se),le(se),E.blending===Dr&&E.transparent===!1?Me(ji):Me(E.blending,E.blendEquation,E.blendSrc,E.blendDst,E.blendEquationAlpha,E.blendSrcAlpha,E.blendDstAlpha,E.blendColor,E.blendAlpha,E.premultipliedAlpha),s.setFunc(E.depthFunc),s.setTest(E.depthTest),s.setMask(E.depthWrite),i.setMask(E.colorWrite);const ye=E.stencilWrite;r.setTest(ye),ye&&(r.setMask(E.stencilWriteMask),r.setFunc(E.stencilFunc,E.stencilRef,E.stencilFuncMask),r.setOp(E.stencilFail,E.stencilZFail,E.stencilZPass)),Ge(E.polygonOffset,E.polygonOffsetFactor,E.polygonOffsetUnits),E.alphaToCoverage===!0?X(o.SAMPLE_ALPHA_TO_COVERAGE):ee(o.SAMPLE_ALPHA_TO_COVERAGE)}function le(E){b!==E&&(E?o.frontFace(o.CW):o.frontFace(o.CCW),b=E)}function ue(E){E!==Jm?(X(o.CULL_FACE),E!==w&&(E===Kh?o.cullFace(o.BACK):E===eg?o.cullFace(o.FRONT):o.cullFace(o.FRONT_AND_BACK))):ee(o.CULL_FACE),w=E}function We(E){E!==P&&(G&&o.lineWidth(E),P=E)}function Ge(E,te,se){E?(X(o.POLYGON_OFFSET_FILL),(N!==te||I!==se)&&(o.polygonOffset(te,se),N=te,I=se)):ee(o.POLYGON_OFFSET_FILL)}function B(E){E?X(o.SCISSOR_TEST):ee(o.SCISSOR_TEST)}function C(E){E===void 0&&(E=o.TEXTURE0+H-1),k!==E&&(o.activeTexture(E),k=E)}function ie(E,te,se){se===void 0&&(k===null?se=o.TEXTURE0+H-1:se=k);let ye=q[se];ye===void 0&&(ye={type:void 0,texture:void 0},q[se]=ye),(ye.type!==E||ye.texture!==te)&&(k!==se&&(o.activeTexture(se),k=se),o.bindTexture(E,te||F[E]),ye.type=E,ye.texture=te)}function he(){const E=q[k];E!==void 0&&E.type!==void 0&&(o.bindTexture(E.type,null),E.type=void 0,E.texture=void 0)}function fe(){try{o.compressedTexImage2D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ge(){try{o.compressedTexImage3D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ie(){try{o.texSubImage2D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ee(){try{o.texSubImage3D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function we(){try{o.compressedTexSubImage2D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ke(){try{o.compressedTexSubImage3D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ce(){try{o.texStorage2D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function $e(){try{o.texStorage3D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function at(){try{o.texImage2D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function Ze(){try{o.texImage3D.apply(o,arguments)}catch(E){console.error("THREE.WebGLState:",E)}}function ze(E){Z.equals(E)===!1&&(o.scissor(E.x,E.y,E.z,E.w),Z.copy(E))}function Je(E){W.equals(E)===!1&&(o.viewport(E.x,E.y,E.z,E.w),W.copy(E))}function rt(E,te){let se=c.get(te);se===void 0&&(se=new WeakMap,c.set(te,se));let ye=se.get(E);ye===void 0&&(ye=o.getUniformBlockIndex(te,E.name),se.set(E,ye))}function vt(E,te){const ye=c.get(te).get(E);a.get(te)!==ye&&(o.uniformBlockBinding(te,ye,E.__bindingPointIndex),a.set(te,ye))}function tt(){o.disable(o.BLEND),o.disable(o.CULL_FACE),o.disable(o.DEPTH_TEST),o.disable(o.POLYGON_OFFSET_FILL),o.disable(o.SCISSOR_TEST),o.disable(o.STENCIL_TEST),o.disable(o.SAMPLE_ALPHA_TO_COVERAGE),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.ONE,o.ZERO),o.blendFuncSeparate(o.ONE,o.ZERO,o.ONE,o.ZERO),o.blendColor(0,0,0,0),o.colorMask(!0,!0,!0,!0),o.clearColor(0,0,0,0),o.depthMask(!0),o.depthFunc(o.LESS),o.clearDepth(1),o.stencilMask(4294967295),o.stencilFunc(o.ALWAYS,0,4294967295),o.stencilOp(o.KEEP,o.KEEP,o.KEEP),o.clearStencil(0),o.cullFace(o.BACK),o.frontFace(o.CCW),o.polygonOffset(0,0),o.activeTexture(o.TEXTURE0),o.bindFramebuffer(o.FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.useProgram(null),o.lineWidth(1),o.scissor(0,0,o.canvas.width,o.canvas.height),o.viewport(0,0,o.canvas.width,o.canvas.height),u={},k=null,q={},d={},l=new WeakMap,h=[],f=null,p=!1,g=null,m=null,v=null,_=null,y=null,x=null,M=null,S=new He(0,0,0),A=0,T=!1,b=null,w=null,P=null,N=null,I=null,Z.set(0,0,o.canvas.width,o.canvas.height),W.set(0,0,o.canvas.width,o.canvas.height),i.reset(),s.reset(),r.reset()}return{buffers:{color:i,depth:s,stencil:r},enable:X,disable:ee,bindFramebuffer:re,drawBuffers:K,useProgram:O,setBlending:Me,setMaterial:me,setFlipSided:le,setCullFace:ue,setLineWidth:We,setPolygonOffset:Ge,setScissorTest:B,activeTexture:C,bindTexture:ie,unbindTexture:he,compressedTexImage2D:fe,compressedTexImage3D:ge,texImage2D:at,texImage3D:Ze,updateUBOMapping:rt,uniformBlockBinding:vt,texStorage2D:Ce,texStorage3D:$e,texSubImage2D:Ie,texSubImage3D:Ee,compressedTexSubImage2D:we,compressedTexSubImage3D:Ke,scissor:ze,viewport:Je,reset:tt}}function mw(o,e,t,n,i,s,r){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new Fe,d=new WeakMap;let l;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function p(B,C){return f?new OffscreenCanvas(B,C):No("canvas")}function g(B,C,ie){let he=1;const fe=Ge(B);if((fe.width>ie||fe.height>ie)&&(he=ie/Math.max(fe.width,fe.height)),he<1)if(typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&B instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&B instanceof ImageBitmap||typeof VideoFrame<"u"&&B instanceof VideoFrame){const ge=Math.floor(he*fe.width),Ie=Math.floor(he*fe.height);l===void 0&&(l=p(ge,Ie));const Ee=C?p(ge,Ie):l;return Ee.width=ge,Ee.height=Ie,Ee.getContext("2d").drawImage(B,0,0,ge,Ie),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+fe.width+"x"+fe.height+") to ("+ge+"x"+Ie+")."),Ee}else return"data"in B&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+fe.width+"x"+fe.height+")."),B;return B}function m(B){return B.generateMipmaps&&B.minFilter!==Bt&&B.minFilter!==Vt}function v(B){o.generateMipmap(B)}function _(B,C,ie,he,fe=!1){if(B!==null){if(o[B]!==void 0)return o[B];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+B+"'")}let ge=C;if(C===o.RED&&(ie===o.FLOAT&&(ge=o.R32F),ie===o.HALF_FLOAT&&(ge=o.R16F),ie===o.UNSIGNED_BYTE&&(ge=o.R8)),C===o.RED_INTEGER&&(ie===o.UNSIGNED_BYTE&&(ge=o.R8UI),ie===o.UNSIGNED_SHORT&&(ge=o.R16UI),ie===o.UNSIGNED_INT&&(ge=o.R32UI),ie===o.BYTE&&(ge=o.R8I),ie===o.SHORT&&(ge=o.R16I),ie===o.INT&&(ge=o.R32I)),C===o.RG&&(ie===o.FLOAT&&(ge=o.RG32F),ie===o.HALF_FLOAT&&(ge=o.RG16F),ie===o.UNSIGNED_BYTE&&(ge=o.RG8)),C===o.RG_INTEGER&&(ie===o.UNSIGNED_BYTE&&(ge=o.RG8UI),ie===o.UNSIGNED_SHORT&&(ge=o.RG16UI),ie===o.UNSIGNED_INT&&(ge=o.RG32UI),ie===o.BYTE&&(ge=o.RG8I),ie===o.SHORT&&(ge=o.RG16I),ie===o.INT&&(ge=o.RG32I)),C===o.RGB&&ie===o.UNSIGNED_INT_5_9_9_9_REV&&(ge=o.RGB9_E5),C===o.RGBA){const Ie=fe?Qa:Et.getTransfer(he);ie===o.FLOAT&&(ge=o.RGBA32F),ie===o.HALF_FLOAT&&(ge=o.RGBA16F),ie===o.UNSIGNED_BYTE&&(ge=Ie===zt?o.SRGB8_ALPHA8:o.RGBA8),ie===o.UNSIGNED_SHORT_4_4_4_4&&(ge=o.RGBA4),ie===o.UNSIGNED_SHORT_5_5_5_1&&(ge=o.RGB5_A1)}return(ge===o.R16F||ge===o.R32F||ge===o.RG16F||ge===o.RG32F||ge===o.RGBA16F||ge===o.RGBA32F)&&e.get("EXT_color_buffer_float"),ge}function y(B,C){return m(B)===!0||B.isFramebufferTexture&&B.minFilter!==Bt&&B.minFilter!==Vt?Math.log2(Math.max(C.width,C.height))+1:B.mipmaps!==void 0&&B.mipmaps.length>0?B.mipmaps.length:B.isCompressedTexture&&Array.isArray(B.image)?C.mipmaps.length:1}function x(B){const C=B.target;C.removeEventListener("dispose",x),S(C),C.isVideoTexture&&d.delete(C)}function M(B){const C=B.target;C.removeEventListener("dispose",M),T(C)}function S(B){const C=n.get(B);if(C.__webglInit===void 0)return;const ie=B.source,he=h.get(ie);if(he){const fe=he[C.__cacheKey];fe.usedTimes--,fe.usedTimes===0&&A(B),Object.keys(he).length===0&&h.delete(ie)}n.remove(B)}function A(B){const C=n.get(B);o.deleteTexture(C.__webglTexture);const ie=B.source,he=h.get(ie);delete he[C.__cacheKey],r.memory.textures--}function T(B){const C=n.get(B);if(B.depthTexture&&B.depthTexture.dispose(),B.isWebGLCubeRenderTarget)for(let he=0;he<6;he++){if(Array.isArray(C.__webglFramebuffer[he]))for(let fe=0;fe<C.__webglFramebuffer[he].length;fe++)o.deleteFramebuffer(C.__webglFramebuffer[he][fe]);else o.deleteFramebuffer(C.__webglFramebuffer[he]);C.__webglDepthbuffer&&o.deleteRenderbuffer(C.__webglDepthbuffer[he])}else{if(Array.isArray(C.__webglFramebuffer))for(let he=0;he<C.__webglFramebuffer.length;he++)o.deleteFramebuffer(C.__webglFramebuffer[he]);else o.deleteFramebuffer(C.__webglFramebuffer);if(C.__webglDepthbuffer&&o.deleteRenderbuffer(C.__webglDepthbuffer),C.__webglMultisampledFramebuffer&&o.deleteFramebuffer(C.__webglMultisampledFramebuffer),C.__webglColorRenderbuffer)for(let he=0;he<C.__webglColorRenderbuffer.length;he++)C.__webglColorRenderbuffer[he]&&o.deleteRenderbuffer(C.__webglColorRenderbuffer[he]);C.__webglDepthRenderbuffer&&o.deleteRenderbuffer(C.__webglDepthRenderbuffer)}const ie=B.textures;for(let he=0,fe=ie.length;he<fe;he++){const ge=n.get(ie[he]);ge.__webglTexture&&(o.deleteTexture(ge.__webglTexture),r.memory.textures--),n.remove(ie[he])}n.remove(B)}let b=0;function w(){b=0}function P(){const B=b;return B>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+B+" texture units while this GPU supports only "+i.maxTextures),b+=1,B}function N(B){const C=[];return C.push(B.wrapS),C.push(B.wrapT),C.push(B.wrapR||0),C.push(B.magFilter),C.push(B.minFilter),C.push(B.anisotropy),C.push(B.internalFormat),C.push(B.format),C.push(B.type),C.push(B.generateMipmaps),C.push(B.premultiplyAlpha),C.push(B.flipY),C.push(B.unpackAlignment),C.push(B.colorSpace),C.join()}function I(B,C){const ie=n.get(B);if(B.isVideoTexture&&ue(B),B.isRenderTargetTexture===!1&&B.version>0&&ie.__version!==B.version){const he=B.image;if(he===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(he.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Z(ie,B,C);return}}t.bindTexture(o.TEXTURE_2D,ie.__webglTexture,o.TEXTURE0+C)}function H(B,C){const ie=n.get(B);if(B.version>0&&ie.__version!==B.version){Z(ie,B,C);return}t.bindTexture(o.TEXTURE_2D_ARRAY,ie.__webglTexture,o.TEXTURE0+C)}function G(B,C){const ie=n.get(B);if(B.version>0&&ie.__version!==B.version){Z(ie,B,C);return}t.bindTexture(o.TEXTURE_3D,ie.__webglTexture,o.TEXTURE0+C)}function J(B,C){const ie=n.get(B);if(B.version>0&&ie.__version!==B.version){W(ie,B,C);return}t.bindTexture(o.TEXTURE_CUBE_MAP,ie.__webglTexture,o.TEXTURE0+C)}const U={[vs]:o.REPEAT,[Si]:o.CLAMP_TO_EDGE,[Za]:o.MIRRORED_REPEAT},k={[Bt]:o.NEAREST,[Wf]:o.NEAREST_MIPMAP_NEAREST,[yo]:o.NEAREST_MIPMAP_LINEAR,[Vt]:o.LINEAR,[Ha]:o.LINEAR_MIPMAP_NEAREST,[Gi]:o.LINEAR_MIPMAP_LINEAR},q={[Zg]:o.NEVER,[iv]:o.ALWAYS,[Qg]:o.LESS,[ep]:o.LEQUAL,[Jg]:o.EQUAL,[nv]:o.GEQUAL,[ev]:o.GREATER,[tv]:o.NOTEQUAL};function Y(B,C){if(C.type===Ai&&e.has("OES_texture_float_linear")===!1&&(C.magFilter===Vt||C.magFilter===Ha||C.magFilter===yo||C.magFilter===Gi||C.minFilter===Vt||C.minFilter===Ha||C.minFilter===yo||C.minFilter===Gi)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),o.texParameteri(B,o.TEXTURE_WRAP_S,U[C.wrapS]),o.texParameteri(B,o.TEXTURE_WRAP_T,U[C.wrapT]),(B===o.TEXTURE_3D||B===o.TEXTURE_2D_ARRAY)&&o.texParameteri(B,o.TEXTURE_WRAP_R,U[C.wrapR]),o.texParameteri(B,o.TEXTURE_MAG_FILTER,k[C.magFilter]),o.texParameteri(B,o.TEXTURE_MIN_FILTER,k[C.minFilter]),C.compareFunction&&(o.texParameteri(B,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.texParameteri(B,o.TEXTURE_COMPARE_FUNC,q[C.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(C.magFilter===Bt||C.minFilter!==yo&&C.minFilter!==Gi||C.type===Ai&&e.has("OES_texture_float_linear")===!1)return;if(C.anisotropy>1||n.get(C).__currentAnisotropy){const ie=e.get("EXT_texture_filter_anisotropic");o.texParameterf(B,ie.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(C.anisotropy,i.getMaxAnisotropy())),n.get(C).__currentAnisotropy=C.anisotropy}}}function V(B,C){let ie=!1;B.__webglInit===void 0&&(B.__webglInit=!0,C.addEventListener("dispose",x));const he=C.source;let fe=h.get(he);fe===void 0&&(fe={},h.set(he,fe));const ge=N(C);if(ge!==B.__cacheKey){fe[ge]===void 0&&(fe[ge]={texture:o.createTexture(),usedTimes:0},r.memory.textures++,ie=!0),fe[ge].usedTimes++;const Ie=fe[B.__cacheKey];Ie!==void 0&&(fe[B.__cacheKey].usedTimes--,Ie.usedTimes===0&&A(C)),B.__cacheKey=ge,B.__webglTexture=fe[ge].texture}return ie}function Z(B,C,ie){let he=o.TEXTURE_2D;(C.isDataArrayTexture||C.isCompressedArrayTexture)&&(he=o.TEXTURE_2D_ARRAY),C.isData3DTexture&&(he=o.TEXTURE_3D);const fe=V(B,C),ge=C.source;t.bindTexture(he,B.__webglTexture,o.TEXTURE0+ie);const Ie=n.get(ge);if(ge.version!==Ie.__version||fe===!0){t.activeTexture(o.TEXTURE0+ie);const Ee=Et.getPrimaries(Et.workingColorSpace),we=C.colorSpace===cs?null:Et.getPrimaries(C.colorSpace),Ke=C.colorSpace===cs||Ee===we?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,C.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,C.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ke);let Ce=g(C.image,!1,i.maxTextureSize);Ce=We(C,Ce);const $e=s.convert(C.format,C.colorSpace),at=s.convert(C.type);let Ze=_(C.internalFormat,$e,at,C.colorSpace,C.isVideoTexture);Y(he,C);let ze;const Je=C.mipmaps,rt=C.isVideoTexture!==!0,vt=Ie.__version===void 0||fe===!0,tt=ge.dataReady,E=y(C,Ce);if(C.isDepthTexture)Ze=o.DEPTH_COMPONENT16,C.type===Ai?Ze=o.DEPTH_COMPONENT32F:C.type===Gr?Ze=o.DEPTH_COMPONENT24:C.type===Ko&&(Ze=o.DEPTH24_STENCIL8),vt&&(rt?t.texStorage2D(o.TEXTURE_2D,1,Ze,Ce.width,Ce.height):t.texImage2D(o.TEXTURE_2D,0,Ze,Ce.width,Ce.height,0,$e,at,null));else if(C.isDataTexture)if(Je.length>0){rt&&vt&&t.texStorage2D(o.TEXTURE_2D,E,Ze,Je[0].width,Je[0].height);for(let te=0,se=Je.length;te<se;te++)ze=Je[te],rt?tt&&t.texSubImage2D(o.TEXTURE_2D,te,0,0,ze.width,ze.height,$e,at,ze.data):t.texImage2D(o.TEXTURE_2D,te,Ze,ze.width,ze.height,0,$e,at,ze.data);C.generateMipmaps=!1}else rt?(vt&&t.texStorage2D(o.TEXTURE_2D,E,Ze,Ce.width,Ce.height),tt&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,Ce.width,Ce.height,$e,at,Ce.data)):t.texImage2D(o.TEXTURE_2D,0,Ze,Ce.width,Ce.height,0,$e,at,Ce.data);else if(C.isCompressedTexture)if(C.isCompressedArrayTexture){rt&&vt&&t.texStorage3D(o.TEXTURE_2D_ARRAY,E,Ze,Je[0].width,Je[0].height,Ce.depth);for(let te=0,se=Je.length;te<se;te++)ze=Je[te],C.format!==fi?$e!==null?rt?tt&&t.compressedTexSubImage3D(o.TEXTURE_2D_ARRAY,te,0,0,0,ze.width,ze.height,Ce.depth,$e,ze.data,0,0):t.compressedTexImage3D(o.TEXTURE_2D_ARRAY,te,Ze,ze.width,ze.height,Ce.depth,0,ze.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):rt?tt&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,te,0,0,0,ze.width,ze.height,Ce.depth,$e,at,ze.data):t.texImage3D(o.TEXTURE_2D_ARRAY,te,Ze,ze.width,ze.height,Ce.depth,0,$e,at,ze.data)}else{rt&&vt&&t.texStorage2D(o.TEXTURE_2D,E,Ze,Je[0].width,Je[0].height);for(let te=0,se=Je.length;te<se;te++)ze=Je[te],C.format!==fi?$e!==null?rt?tt&&t.compressedTexSubImage2D(o.TEXTURE_2D,te,0,0,ze.width,ze.height,$e,ze.data):t.compressedTexImage2D(o.TEXTURE_2D,te,Ze,ze.width,ze.height,0,ze.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):rt?tt&&t.texSubImage2D(o.TEXTURE_2D,te,0,0,ze.width,ze.height,$e,at,ze.data):t.texImage2D(o.TEXTURE_2D,te,Ze,ze.width,ze.height,0,$e,at,ze.data)}else if(C.isDataArrayTexture)rt?(vt&&t.texStorage3D(o.TEXTURE_2D_ARRAY,E,Ze,Ce.width,Ce.height,Ce.depth),tt&&t.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,0,Ce.width,Ce.height,Ce.depth,$e,at,Ce.data)):t.texImage3D(o.TEXTURE_2D_ARRAY,0,Ze,Ce.width,Ce.height,Ce.depth,0,$e,at,Ce.data);else if(C.isData3DTexture)rt?(vt&&t.texStorage3D(o.TEXTURE_3D,E,Ze,Ce.width,Ce.height,Ce.depth),tt&&t.texSubImage3D(o.TEXTURE_3D,0,0,0,0,Ce.width,Ce.height,Ce.depth,$e,at,Ce.data)):t.texImage3D(o.TEXTURE_3D,0,Ze,Ce.width,Ce.height,Ce.depth,0,$e,at,Ce.data);else if(C.isFramebufferTexture){if(vt)if(rt)t.texStorage2D(o.TEXTURE_2D,E,Ze,Ce.width,Ce.height);else{let te=Ce.width,se=Ce.height;for(let ye=0;ye<E;ye++)t.texImage2D(o.TEXTURE_2D,ye,Ze,te,se,0,$e,at,null),te>>=1,se>>=1}}else if(Je.length>0){if(rt&&vt){const te=Ge(Je[0]);t.texStorage2D(o.TEXTURE_2D,E,Ze,te.width,te.height)}for(let te=0,se=Je.length;te<se;te++)ze=Je[te],rt?tt&&t.texSubImage2D(o.TEXTURE_2D,te,0,0,$e,at,ze):t.texImage2D(o.TEXTURE_2D,te,Ze,$e,at,ze);C.generateMipmaps=!1}else if(rt){if(vt){const te=Ge(Ce);t.texStorage2D(o.TEXTURE_2D,E,Ze,te.width,te.height)}tt&&t.texSubImage2D(o.TEXTURE_2D,0,0,0,$e,at,Ce)}else t.texImage2D(o.TEXTURE_2D,0,Ze,$e,at,Ce);m(C)&&v(he),Ie.__version=ge.version,C.onUpdate&&C.onUpdate(C)}B.__version=C.version}function W(B,C,ie){if(C.image.length!==6)return;const he=V(B,C),fe=C.source;t.bindTexture(o.TEXTURE_CUBE_MAP,B.__webglTexture,o.TEXTURE0+ie);const ge=n.get(fe);if(fe.version!==ge.__version||he===!0){t.activeTexture(o.TEXTURE0+ie);const Ie=Et.getPrimaries(Et.workingColorSpace),Ee=C.colorSpace===cs?null:Et.getPrimaries(C.colorSpace),we=C.colorSpace===cs||Ie===Ee?o.NONE:o.BROWSER_DEFAULT_WEBGL;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,C.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,C.unpackAlignment),o.pixelStorei(o.UNPACK_COLORSPACE_CONVERSION_WEBGL,we);const Ke=C.isCompressedTexture||C.image[0].isCompressedTexture,Ce=C.image[0]&&C.image[0].isDataTexture,$e=[];for(let se=0;se<6;se++)!Ke&&!Ce?$e[se]=g(C.image[se],!0,i.maxCubemapSize):$e[se]=Ce?C.image[se].image:C.image[se],$e[se]=We(C,$e[se]);const at=$e[0],Ze=s.convert(C.format,C.colorSpace),ze=s.convert(C.type),Je=_(C.internalFormat,Ze,ze,C.colorSpace),rt=C.isVideoTexture!==!0,vt=ge.__version===void 0||he===!0,tt=fe.dataReady;let E=y(C,at);Y(o.TEXTURE_CUBE_MAP,C);let te;if(Ke){rt&&vt&&t.texStorage2D(o.TEXTURE_CUBE_MAP,E,Je,at.width,at.height);for(let se=0;se<6;se++){te=$e[se].mipmaps;for(let ye=0;ye<te.length;ye++){const Te=te[ye];C.format!==fi?Ze!==null?rt?tt&&t.compressedTexSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye,0,0,Te.width,Te.height,Ze,Te.data):t.compressedTexImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye,Je,Te.width,Te.height,0,Te.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):rt?tt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye,0,0,Te.width,Te.height,Ze,ze,Te.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye,Je,Te.width,Te.height,0,Ze,ze,Te.data)}}}else{if(te=C.mipmaps,rt&&vt){te.length>0&&E++;const se=Ge($e[0]);t.texStorage2D(o.TEXTURE_CUBE_MAP,E,Je,se.width,se.height)}for(let se=0;se<6;se++)if(Ce){rt?tt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,0,0,$e[se].width,$e[se].height,Ze,ze,$e[se].data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,Je,$e[se].width,$e[se].height,0,Ze,ze,$e[se].data);for(let ye=0;ye<te.length;ye++){const nt=te[ye].image[se].image;rt?tt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye+1,0,0,nt.width,nt.height,Ze,ze,nt.data):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye+1,Je,nt.width,nt.height,0,Ze,ze,nt.data)}}else{rt?tt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,0,0,Ze,ze,$e[se]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,Je,Ze,ze,$e[se]);for(let ye=0;ye<te.length;ye++){const Te=te[ye];rt?tt&&t.texSubImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye+1,0,0,Ze,ze,Te.image[se]):t.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+se,ye+1,Je,Ze,ze,Te.image[se])}}}m(C)&&v(o.TEXTURE_CUBE_MAP),ge.__version=fe.version,C.onUpdate&&C.onUpdate(C)}B.__version=C.version}function L(B,C,ie,he,fe,ge){const Ie=s.convert(ie.format,ie.colorSpace),Ee=s.convert(ie.type),we=_(ie.internalFormat,Ie,Ee,ie.colorSpace);if(!n.get(C).__hasExternalTextures){const Ce=Math.max(1,C.width>>ge),$e=Math.max(1,C.height>>ge);fe===o.TEXTURE_3D||fe===o.TEXTURE_2D_ARRAY?t.texImage3D(fe,ge,we,Ce,$e,C.depth,0,Ie,Ee,null):t.texImage2D(fe,ge,we,Ce,$e,0,Ie,Ee,null)}t.bindFramebuffer(o.FRAMEBUFFER,B),le(C)?a.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,he,fe,n.get(ie).__webglTexture,0,me(C)):(fe===o.TEXTURE_2D||fe>=o.TEXTURE_CUBE_MAP_POSITIVE_X&&fe<=o.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&o.framebufferTexture2D(o.FRAMEBUFFER,he,fe,n.get(ie).__webglTexture,ge),t.bindFramebuffer(o.FRAMEBUFFER,null)}function F(B,C,ie){if(o.bindRenderbuffer(o.RENDERBUFFER,B),C.depthBuffer&&!C.stencilBuffer){let he=o.DEPTH_COMPONENT24;if(ie||le(C)){const fe=C.depthTexture;fe&&fe.isDepthTexture&&(fe.type===Ai?he=o.DEPTH_COMPONENT32F:fe.type===Gr&&(he=o.DEPTH_COMPONENT24));const ge=me(C);le(C)?a.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,ge,he,C.width,C.height):o.renderbufferStorageMultisample(o.RENDERBUFFER,ge,he,C.width,C.height)}else o.renderbufferStorage(o.RENDERBUFFER,he,C.width,C.height);o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.RENDERBUFFER,B)}else if(C.depthBuffer&&C.stencilBuffer){const he=me(C);ie&&le(C)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,he,o.DEPTH24_STENCIL8,C.width,C.height):le(C)?a.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,he,o.DEPTH24_STENCIL8,C.width,C.height):o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,C.width,C.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,B)}else{const he=C.textures;for(let fe=0;fe<he.length;fe++){const ge=he[fe],Ie=s.convert(ge.format,ge.colorSpace),Ee=s.convert(ge.type),we=_(ge.internalFormat,Ie,Ee,ge.colorSpace),Ke=me(C);ie&&le(C)===!1?o.renderbufferStorageMultisample(o.RENDERBUFFER,Ke,we,C.width,C.height):le(C)?a.renderbufferStorageMultisampleEXT(o.RENDERBUFFER,Ke,we,C.width,C.height):o.renderbufferStorage(o.RENDERBUFFER,we,C.width,C.height)}}o.bindRenderbuffer(o.RENDERBUFFER,null)}function X(B,C){if(C&&C.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(o.FRAMEBUFFER,B),!(C.depthTexture&&C.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(C.depthTexture).__webglTexture||C.depthTexture.image.width!==C.width||C.depthTexture.image.height!==C.height)&&(C.depthTexture.image.width=C.width,C.depthTexture.image.height=C.height,C.depthTexture.needsUpdate=!0),I(C.depthTexture,0);const he=n.get(C.depthTexture).__webglTexture,fe=me(C);if(C.depthTexture.format===Fr)le(C)?a.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,he,0,fe):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_ATTACHMENT,o.TEXTURE_2D,he,0);else if(C.depthTexture.format===Fo)le(C)?a.framebufferTexture2DMultisampleEXT(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,he,0,fe):o.framebufferTexture2D(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.TEXTURE_2D,he,0);else throw new Error("Unknown depthTexture format")}function ee(B){const C=n.get(B),ie=B.isWebGLCubeRenderTarget===!0;if(B.depthTexture&&!C.__autoAllocateDepthBuffer){if(ie)throw new Error("target.depthTexture not supported in Cube render targets");X(C.__webglFramebuffer,B)}else if(ie){C.__webglDepthbuffer=[];for(let he=0;he<6;he++)t.bindFramebuffer(o.FRAMEBUFFER,C.__webglFramebuffer[he]),C.__webglDepthbuffer[he]=o.createRenderbuffer(),F(C.__webglDepthbuffer[he],B,!1)}else t.bindFramebuffer(o.FRAMEBUFFER,C.__webglFramebuffer),C.__webglDepthbuffer=o.createRenderbuffer(),F(C.__webglDepthbuffer,B,!1);t.bindFramebuffer(o.FRAMEBUFFER,null)}function re(B,C,ie){const he=n.get(B);C!==void 0&&L(he.__webglFramebuffer,B,B.texture,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,0),ie!==void 0&&ee(B)}function K(B){const C=B.texture,ie=n.get(B),he=n.get(C);B.addEventListener("dispose",M);const fe=B.textures,ge=B.isWebGLCubeRenderTarget===!0,Ie=fe.length>1;if(Ie||(he.__webglTexture===void 0&&(he.__webglTexture=o.createTexture()),he.__version=C.version,r.memory.textures++),ge){ie.__webglFramebuffer=[];for(let Ee=0;Ee<6;Ee++)if(C.mipmaps&&C.mipmaps.length>0){ie.__webglFramebuffer[Ee]=[];for(let we=0;we<C.mipmaps.length;we++)ie.__webglFramebuffer[Ee][we]=o.createFramebuffer()}else ie.__webglFramebuffer[Ee]=o.createFramebuffer()}else{if(C.mipmaps&&C.mipmaps.length>0){ie.__webglFramebuffer=[];for(let Ee=0;Ee<C.mipmaps.length;Ee++)ie.__webglFramebuffer[Ee]=o.createFramebuffer()}else ie.__webglFramebuffer=o.createFramebuffer();if(Ie)for(let Ee=0,we=fe.length;Ee<we;Ee++){const Ke=n.get(fe[Ee]);Ke.__webglTexture===void 0&&(Ke.__webglTexture=o.createTexture(),r.memory.textures++)}if(B.samples>0&&le(B)===!1){ie.__webglMultisampledFramebuffer=o.createFramebuffer(),ie.__webglColorRenderbuffer=[],t.bindFramebuffer(o.FRAMEBUFFER,ie.__webglMultisampledFramebuffer);for(let Ee=0;Ee<fe.length;Ee++){const we=fe[Ee];ie.__webglColorRenderbuffer[Ee]=o.createRenderbuffer(),o.bindRenderbuffer(o.RENDERBUFFER,ie.__webglColorRenderbuffer[Ee]);const Ke=s.convert(we.format,we.colorSpace),Ce=s.convert(we.type),$e=_(we.internalFormat,Ke,Ce,we.colorSpace,B.isXRRenderTarget===!0),at=me(B);o.renderbufferStorageMultisample(o.RENDERBUFFER,at,$e,B.width,B.height),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+Ee,o.RENDERBUFFER,ie.__webglColorRenderbuffer[Ee])}o.bindRenderbuffer(o.RENDERBUFFER,null),B.depthBuffer&&(ie.__webglDepthRenderbuffer=o.createRenderbuffer(),F(ie.__webglDepthRenderbuffer,B,!0)),t.bindFramebuffer(o.FRAMEBUFFER,null)}}if(ge){t.bindTexture(o.TEXTURE_CUBE_MAP,he.__webglTexture),Y(o.TEXTURE_CUBE_MAP,C);for(let Ee=0;Ee<6;Ee++)if(C.mipmaps&&C.mipmaps.length>0)for(let we=0;we<C.mipmaps.length;we++)L(ie.__webglFramebuffer[Ee][we],B,C,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,we);else L(ie.__webglFramebuffer[Ee],B,C,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,0);m(C)&&v(o.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ie){for(let Ee=0,we=fe.length;Ee<we;Ee++){const Ke=fe[Ee],Ce=n.get(Ke);t.bindTexture(o.TEXTURE_2D,Ce.__webglTexture),Y(o.TEXTURE_2D,Ke),L(ie.__webglFramebuffer,B,Ke,o.COLOR_ATTACHMENT0+Ee,o.TEXTURE_2D,0),m(Ke)&&v(o.TEXTURE_2D)}t.unbindTexture()}else{let Ee=o.TEXTURE_2D;if((B.isWebGL3DRenderTarget||B.isWebGLArrayRenderTarget)&&(Ee=B.isWebGL3DRenderTarget?o.TEXTURE_3D:o.TEXTURE_2D_ARRAY),t.bindTexture(Ee,he.__webglTexture),Y(Ee,C),C.mipmaps&&C.mipmaps.length>0)for(let we=0;we<C.mipmaps.length;we++)L(ie.__webglFramebuffer[we],B,C,o.COLOR_ATTACHMENT0,Ee,we);else L(ie.__webglFramebuffer,B,C,o.COLOR_ATTACHMENT0,Ee,0);m(C)&&v(Ee),t.unbindTexture()}B.depthBuffer&&ee(B)}function O(B){const C=B.textures;for(let ie=0,he=C.length;ie<he;ie++){const fe=C[ie];if(m(fe)){const ge=B.isWebGLCubeRenderTarget?o.TEXTURE_CUBE_MAP:o.TEXTURE_2D,Ie=n.get(fe).__webglTexture;t.bindTexture(ge,Ie),v(ge),t.unbindTexture()}}}const de=[],_e=[];function Me(B){if(B.samples>0){if(le(B)===!1){const C=B.textures,ie=B.width,he=B.height;let fe=o.COLOR_BUFFER_BIT;const ge=B.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT,Ie=n.get(B),Ee=C.length>1;if(Ee)for(let we=0;we<C.length;we++)t.bindFramebuffer(o.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+we,o.RENDERBUFFER,null),t.bindFramebuffer(o.FRAMEBUFFER,Ie.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+we,o.TEXTURE_2D,null,0);t.bindFramebuffer(o.READ_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ie.__webglFramebuffer);for(let we=0;we<C.length;we++){if(B.resolveDepthBuffer&&(B.depthBuffer&&(fe|=o.DEPTH_BUFFER_BIT),B.stencilBuffer&&B.resolveStencilBuffer&&(fe|=o.STENCIL_BUFFER_BIT)),Ee){o.framebufferRenderbuffer(o.READ_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.RENDERBUFFER,Ie.__webglColorRenderbuffer[we]);const Ke=n.get(C[we]).__webglTexture;o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,Ke,0)}o.blitFramebuffer(0,0,ie,he,0,0,ie,he,fe,o.NEAREST),c===!0&&(de.length=0,_e.length=0,de.push(o.COLOR_ATTACHMENT0+we),B.depthBuffer&&B.resolveDepthBuffer===!1&&(de.push(ge),_e.push(ge),o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,_e)),o.invalidateFramebuffer(o.READ_FRAMEBUFFER,de))}if(t.bindFramebuffer(o.READ_FRAMEBUFFER,null),t.bindFramebuffer(o.DRAW_FRAMEBUFFER,null),Ee)for(let we=0;we<C.length;we++){t.bindFramebuffer(o.FRAMEBUFFER,Ie.__webglMultisampledFramebuffer),o.framebufferRenderbuffer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+we,o.RENDERBUFFER,Ie.__webglColorRenderbuffer[we]);const Ke=n.get(C[we]).__webglTexture;t.bindFramebuffer(o.FRAMEBUFFER,Ie.__webglFramebuffer),o.framebufferTexture2D(o.DRAW_FRAMEBUFFER,o.COLOR_ATTACHMENT0+we,o.TEXTURE_2D,Ke,0)}t.bindFramebuffer(o.DRAW_FRAMEBUFFER,Ie.__webglMultisampledFramebuffer)}else if(B.depthBuffer&&B.resolveDepthBuffer===!1&&c){const C=B.stencilBuffer?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT;o.invalidateFramebuffer(o.DRAW_FRAMEBUFFER,[C])}}}function me(B){return Math.min(i.maxSamples,B.samples)}function le(B){const C=n.get(B);return B.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&C.__useRenderToTexture!==!1}function ue(B){const C=r.render.frame;d.get(B)!==C&&(d.set(B,C),B.update())}function We(B,C){const ie=B.colorSpace,he=B.format,fe=B.type;return B.isCompressedTexture===!0||B.isVideoTexture===!0||ie!==_n&&ie!==cs&&(Et.getTransfer(ie)===zt?(he!==fi||fe!==_s)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ie)),C}function Ge(B){return typeof HTMLImageElement<"u"&&B instanceof HTMLImageElement?(u.width=B.naturalWidth||B.width,u.height=B.naturalHeight||B.height):typeof VideoFrame<"u"&&B instanceof VideoFrame?(u.width=B.displayWidth,u.height=B.displayHeight):(u.width=B.width,u.height=B.height),u}this.allocateTextureUnit=P,this.resetTextureUnits=w,this.setTexture2D=I,this.setTexture2DArray=H,this.setTexture3D=G,this.setTextureCube=J,this.rebindTextures=re,this.setupRenderTarget=K,this.updateRenderTargetMipmap=O,this.updateMultisampleRenderTarget=Me,this.setupDepthRenderbuffer=ee,this.setupFrameBufferTexture=L,this.useMultisampledRTT=le}function gw(o,e){function t(n,i=cs){let s;const r=Et.getTransfer(i);if(n===_s)return o.UNSIGNED_BYTE;if(n===qf)return o.UNSIGNED_SHORT_4_4_4_4;if(n===Yf)return o.UNSIGNED_SHORT_5_5_5_1;if(n===Ug)return o.UNSIGNED_INT_5_9_9_9_REV;if(n===Og)return o.BYTE;if(n===Bg)return o.SHORT;if(n===Xf)return o.UNSIGNED_SHORT;if(n===jf)return o.INT;if(n===Gr)return o.UNSIGNED_INT;if(n===Ai)return o.FLOAT;if(n===$o)return o.HALF_FLOAT;if(n===zg)return o.ALPHA;if(n===Vg)return o.RGB;if(n===fi)return o.RGBA;if(n===Hg)return o.LUMINANCE;if(n===Gg)return o.LUMINANCE_ALPHA;if(n===Fr)return o.DEPTH_COMPONENT;if(n===Fo)return o.DEPTH_STENCIL;if(n===$f)return o.RED;if(n===Kf)return o.RED_INTEGER;if(n===Wg)return o.RG;if(n===Zf)return o.RG_INTEGER;if(n===Qf)return o.RGBA_INTEGER;if(n===Tl||n===Cl||n===Rl||n===Pl)if(r===zt)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===Tl)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Cl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Rl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Pl)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===Tl)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Cl)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Rl)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Pl)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===tu||n===nu||n===iu||n===su)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===tu)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===nu)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===iu)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===su)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===ru||n===ou||n===au)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===ru||n===ou)return r===zt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===au)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===lu||n===cu||n===hu||n===uu||n===du||n===fu||n===pu||n===mu||n===gu||n===vu||n===_u||n===yu||n===xu||n===wu)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===lu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===cu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===hu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===uu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===du)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===fu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===pu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===mu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===gu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===vu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===_u)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===yu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===xu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===wu)return r===zt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===Ll||n===bu||n===Mu)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===Ll)return r===zt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===bu)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===Mu)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Xg||n===Su||n===Au||n===Eu)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===Ll)return s.COMPRESSED_RED_RGTC1_EXT;if(n===Su)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Au)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Eu)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Ko?o.UNSIGNED_INT_24_8:o[n]!==void 0?o[n]:null}return{convert:t}}class vw extends Tn{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Xi extends et{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _w={type:"move"};class ic{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new D,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new D),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new D,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new D),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,r=null;const a=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){r=!0;for(const g of e.hand.values()){const m=t.getJointPose(g,n),v=this._getHandJoint(u,g);m!==null&&(v.matrix.fromArray(m.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=m.radius),v.visible=m!==null}const d=u.joints["index-finger-tip"],l=u.joints["thumb-tip"],h=d.position.distanceTo(l.position),f=.02,p=.005;u.inputState.pinching&&h>f+p?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&h<=f-p&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_w)))}return a!==null&&(a.visible=i!==null),c!==null&&(c.visible=s!==null),u!==null&&(u.visible=r!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Xi;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}const yw=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,xw=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class ww{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const i=new qt,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!=n.depthNear||t.depthFar!=n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}render(e,t){if(this.texture!==null){if(this.mesh===null){const n=t.cameras[0].viewport,i=new Mn({vertexShader:yw,fragmentShader:xw,uniforms:{depthColor:{value:this.texture},depthWidth:{value:n.z},depthHeight:{value:n.w}}});this.mesh=new Se(new ln(20,20),i)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class bw extends Qs{constructor(e,t){super();const n=this;let i=null,s=1,r=null,a="local-floor",c=1,u=null,d=null,l=null,h=null,f=null,p=null;const g=new ww,m=t.getContextAttributes();let v=null,_=null;const y=[],x=[],M=new Fe;let S=null;const A=new Tn;A.layers.enable(1),A.viewport=new At;const T=new Tn;T.layers.enable(2),T.viewport=new At;const b=[A,T],w=new vw;w.layers.enable(1),w.layers.enable(2);let P=null,N=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(L){let F=y[L];return F===void 0&&(F=new ic,y[L]=F),F.getTargetRaySpace()},this.getControllerGrip=function(L){let F=y[L];return F===void 0&&(F=new ic,y[L]=F),F.getGripSpace()},this.getHand=function(L){let F=y[L];return F===void 0&&(F=new ic,y[L]=F),F.getHandSpace()};function I(L){const F=x.indexOf(L.inputSource);if(F===-1)return;const X=y[F];X!==void 0&&(X.update(L.inputSource,L.frame,u||r),X.dispatchEvent({type:L.type,data:L.inputSource}))}function H(){i.removeEventListener("select",I),i.removeEventListener("selectstart",I),i.removeEventListener("selectend",I),i.removeEventListener("squeeze",I),i.removeEventListener("squeezestart",I),i.removeEventListener("squeezeend",I),i.removeEventListener("end",H),i.removeEventListener("inputsourceschange",G);for(let L=0;L<y.length;L++){const F=x[L];F!==null&&(x[L]=null,y[L].disconnect(F))}P=null,N=null,g.reset(),e.setRenderTarget(v),f=null,h=null,l=null,i=null,_=null,W.stop(),n.isPresenting=!1,e.setPixelRatio(S),e.setSize(M.width,M.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(L){s=L,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(L){a=L,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||r},this.setReferenceSpace=function(L){u=L},this.getBaseLayer=function(){return h!==null?h:f},this.getBinding=function(){return l},this.getFrame=function(){return p},this.getSession=function(){return i},this.setSession=async function(L){if(i=L,i!==null){if(v=e.getRenderTarget(),i.addEventListener("select",I),i.addEventListener("selectstart",I),i.addEventListener("selectend",I),i.addEventListener("squeeze",I),i.addEventListener("squeezestart",I),i.addEventListener("squeezeend",I),i.addEventListener("end",H),i.addEventListener("inputsourceschange",G),m.xrCompatible!==!0&&await t.makeXRCompatible(),S=e.getPixelRatio(),e.getSize(M),i.renderState.layers===void 0){const F={antialias:m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};f=new XRWebGLLayer(i,t,F),i.updateRenderState({baseLayer:f}),e.setPixelRatio(1),e.setSize(f.framebufferWidth,f.framebufferHeight,!1),_=new ys(f.framebufferWidth,f.framebufferHeight,{format:fi,type:_s,colorSpace:e.outputColorSpace,stencilBuffer:m.stencil})}else{let F=null,X=null,ee=null;m.depth&&(ee=m.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,F=m.stencil?Fo:Fr,X=m.stencil?Ko:Gr);const re={colorFormat:t.RGBA8,depthFormat:ee,scaleFactor:s};l=new XRWebGLBinding(i,t),h=l.createProjectionLayer(re),i.updateRenderState({layers:[h]}),e.setPixelRatio(1),e.setSize(h.textureWidth,h.textureHeight,!1),_=new ys(h.textureWidth,h.textureHeight,{format:fi,type:_s,depthTexture:new dp(h.textureWidth,h.textureHeight,X,void 0,void 0,void 0,void 0,void 0,void 0,F),stencilBuffer:m.stencil,colorSpace:e.outputColorSpace,samples:m.antialias?4:0,resolveDepthBuffer:h.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(c),u=null,r=await i.requestReferenceSpace(a),W.setContext(i),W.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function G(L){for(let F=0;F<L.removed.length;F++){const X=L.removed[F],ee=x.indexOf(X);ee>=0&&(x[ee]=null,y[ee].disconnect(X))}for(let F=0;F<L.added.length;F++){const X=L.added[F];let ee=x.indexOf(X);if(ee===-1){for(let K=0;K<y.length;K++)if(K>=x.length){x.push(X),ee=K;break}else if(x[K]===null){x[K]=X,ee=K;break}if(ee===-1)break}const re=y[ee];re&&re.connect(X)}}const J=new D,U=new D;function k(L,F,X){J.setFromMatrixPosition(F.matrixWorld),U.setFromMatrixPosition(X.matrixWorld);const ee=J.distanceTo(U),re=F.projectionMatrix.elements,K=X.projectionMatrix.elements,O=re[14]/(re[10]-1),de=re[14]/(re[10]+1),_e=(re[9]+1)/re[5],Me=(re[9]-1)/re[5],me=(re[8]-1)/re[0],le=(K[8]+1)/K[0],ue=O*me,We=O*le,Ge=ee/(-me+le),B=Ge*-me;F.matrixWorld.decompose(L.position,L.quaternion,L.scale),L.translateX(B),L.translateZ(Ge),L.matrixWorld.compose(L.position,L.quaternion,L.scale),L.matrixWorldInverse.copy(L.matrixWorld).invert();const C=O+Ge,ie=de+Ge,he=ue-B,fe=We+(ee-B),ge=_e*de/ie*C,Ie=Me*de/ie*C;L.projectionMatrix.makePerspective(he,fe,ge,Ie,C,ie),L.projectionMatrixInverse.copy(L.projectionMatrix).invert()}function q(L,F){F===null?L.matrixWorld.copy(L.matrix):L.matrixWorld.multiplyMatrices(F.matrixWorld,L.matrix),L.matrixWorldInverse.copy(L.matrixWorld).invert()}this.updateCamera=function(L){if(i===null)return;g.texture!==null&&(L.near=g.depthNear,L.far=g.depthFar),w.near=T.near=A.near=L.near,w.far=T.far=A.far=L.far,(P!==w.near||N!==w.far)&&(i.updateRenderState({depthNear:w.near,depthFar:w.far}),P=w.near,N=w.far,A.near=P,A.far=N,T.near=P,T.far=N,A.updateProjectionMatrix(),T.updateProjectionMatrix(),L.updateProjectionMatrix());const F=L.parent,X=w.cameras;q(w,F);for(let ee=0;ee<X.length;ee++)q(X[ee],F);X.length===2?k(w,A,T):w.projectionMatrix.copy(A.projectionMatrix),Y(L,w,F)};function Y(L,F,X){X===null?L.matrix.copy(F.matrixWorld):(L.matrix.copy(X.matrixWorld),L.matrix.invert(),L.matrix.multiply(F.matrixWorld)),L.matrix.decompose(L.position,L.quaternion,L.scale),L.updateMatrixWorld(!0),L.projectionMatrix.copy(F.projectionMatrix),L.projectionMatrixInverse.copy(F.projectionMatrixInverse),L.isPerspectiveCamera&&(L.fov=Xr*2*Math.atan(1/L.projectionMatrix.elements[5]),L.zoom=1)}this.getCamera=function(){return w},this.getFoveation=function(){if(!(h===null&&f===null))return c},this.setFoveation=function(L){c=L,h!==null&&(h.fixedFoveation=L),f!==null&&f.fixedFoveation!==void 0&&(f.fixedFoveation=L)},this.hasDepthSensing=function(){return g.texture!==null};let V=null;function Z(L,F){if(d=F.getViewerPose(u||r),p=F,d!==null){const X=d.views;f!==null&&(e.setRenderTargetFramebuffer(_,f.framebuffer),e.setRenderTarget(_));let ee=!1;X.length!==w.cameras.length&&(w.cameras.length=0,ee=!0);for(let K=0;K<X.length;K++){const O=X[K];let de=null;if(f!==null)de=f.getViewport(O);else{const Me=l.getViewSubImage(h,O);de=Me.viewport,K===0&&(e.setRenderTargetTextures(_,Me.colorTexture,h.ignoreDepthValues?void 0:Me.depthStencilTexture),e.setRenderTarget(_))}let _e=b[K];_e===void 0&&(_e=new Tn,_e.layers.enable(K),_e.viewport=new At,b[K]=_e),_e.matrix.fromArray(O.transform.matrix),_e.matrix.decompose(_e.position,_e.quaternion,_e.scale),_e.projectionMatrix.fromArray(O.projectionMatrix),_e.projectionMatrixInverse.copy(_e.projectionMatrix).invert(),_e.viewport.set(de.x,de.y,de.width,de.height),K===0&&(w.matrix.copy(_e.matrix),w.matrix.decompose(w.position,w.quaternion,w.scale)),ee===!0&&w.cameras.push(_e)}const re=i.enabledFeatures;if(re&&re.includes("depth-sensing")){const K=l.getDepthInformation(X[0]);K&&K.isValid&&K.texture&&g.init(e,K,i.renderState)}}for(let X=0;X<y.length;X++){const ee=x[X],re=y[X];ee!==null&&re!==void 0&&re.update(ee,F,u||r)}g.render(e,w),V&&V(L,F),F.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:F}),p=null}const W=new up;W.setAnimationLoop(Z),this.setAnimationLoop=function(L){V=L},this.dispose=function(){}}}const Ls=new ht,Mw=new Ye;function Sw(o,e){function t(m,v){m.matrixAutoUpdate===!0&&m.updateMatrix(),v.value.copy(m.matrix)}function n(m,v){v.color.getRGB(m.fogColor.value,ap(o)),v.isFog?(m.fogNear.value=v.near,m.fogFar.value=v.far):v.isFogExp2&&(m.fogDensity.value=v.density)}function i(m,v,_,y,x){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(m,v):v.isMeshToonMaterial?(s(m,v),l(m,v)):v.isMeshPhongMaterial?(s(m,v),d(m,v)):v.isMeshStandardMaterial?(s(m,v),h(m,v),v.isMeshPhysicalMaterial&&f(m,v,x)):v.isMeshMatcapMaterial?(s(m,v),p(m,v)):v.isMeshDepthMaterial?s(m,v):v.isMeshDistanceMaterial?(s(m,v),g(m,v)):v.isMeshNormalMaterial?s(m,v):v.isLineBasicMaterial?(r(m,v),v.isLineDashedMaterial&&a(m,v)):v.isPointsMaterial?c(m,v,_,y):v.isSpriteMaterial?u(m,v):v.isShadowMaterial?(m.color.value.copy(v.color),m.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(m,v){m.opacity.value=v.opacity,v.color&&m.diffuse.value.copy(v.color),v.emissive&&m.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(m.map.value=v.map,t(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.bumpMap&&(m.bumpMap.value=v.bumpMap,t(v.bumpMap,m.bumpMapTransform),m.bumpScale.value=v.bumpScale,v.side===Nn&&(m.bumpScale.value*=-1)),v.normalMap&&(m.normalMap.value=v.normalMap,t(v.normalMap,m.normalMapTransform),m.normalScale.value.copy(v.normalScale),v.side===Nn&&m.normalScale.value.negate()),v.displacementMap&&(m.displacementMap.value=v.displacementMap,t(v.displacementMap,m.displacementMapTransform),m.displacementScale.value=v.displacementScale,m.displacementBias.value=v.displacementBias),v.emissiveMap&&(m.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,m.emissiveMapTransform)),v.specularMap&&(m.specularMap.value=v.specularMap,t(v.specularMap,m.specularMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest);const _=e.get(v),y=_.envMap,x=_.envMapRotation;if(y&&(m.envMap.value=y,Ls.copy(x),Ls.x*=-1,Ls.y*=-1,Ls.z*=-1,y.isCubeTexture&&y.isRenderTargetTexture===!1&&(Ls.y*=-1,Ls.z*=-1),m.envMapRotation.value.setFromMatrix4(Mw.makeRotationFromEuler(Ls)),m.flipEnvMap.value=y.isCubeTexture&&y.isRenderTargetTexture===!1?-1:1,m.reflectivity.value=v.reflectivity,m.ior.value=v.ior,m.refractionRatio.value=v.refractionRatio),v.lightMap){m.lightMap.value=v.lightMap;const M=o._useLegacyLights===!0?Math.PI:1;m.lightMapIntensity.value=v.lightMapIntensity*M,t(v.lightMap,m.lightMapTransform)}v.aoMap&&(m.aoMap.value=v.aoMap,m.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,m.aoMapTransform))}function r(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,v.map&&(m.map.value=v.map,t(v.map,m.mapTransform))}function a(m,v){m.dashSize.value=v.dashSize,m.totalSize.value=v.dashSize+v.gapSize,m.scale.value=v.scale}function c(m,v,_,y){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.size.value=v.size*_,m.scale.value=y*.5,v.map&&(m.map.value=v.map,t(v.map,m.uvTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function u(m,v){m.diffuse.value.copy(v.color),m.opacity.value=v.opacity,m.rotation.value=v.rotation,v.map&&(m.map.value=v.map,t(v.map,m.mapTransform)),v.alphaMap&&(m.alphaMap.value=v.alphaMap,t(v.alphaMap,m.alphaMapTransform)),v.alphaTest>0&&(m.alphaTest.value=v.alphaTest)}function d(m,v){m.specular.value.copy(v.specular),m.shininess.value=Math.max(v.shininess,1e-4)}function l(m,v){v.gradientMap&&(m.gradientMap.value=v.gradientMap)}function h(m,v){m.metalness.value=v.metalness,v.metalnessMap&&(m.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,m.metalnessMapTransform)),m.roughness.value=v.roughness,v.roughnessMap&&(m.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,m.roughnessMapTransform)),v.envMap&&(m.envMapIntensity.value=v.envMapIntensity)}function f(m,v,_){m.ior.value=v.ior,v.sheen>0&&(m.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),m.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(m.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,m.sheenColorMapTransform)),v.sheenRoughnessMap&&(m.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,m.sheenRoughnessMapTransform))),v.clearcoat>0&&(m.clearcoat.value=v.clearcoat,m.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(m.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,m.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,m.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(m.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,m.clearcoatNormalMapTransform),m.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===Nn&&m.clearcoatNormalScale.value.negate())),v.dispersion>0&&(m.dispersion.value=v.dispersion),v.iridescence>0&&(m.iridescence.value=v.iridescence,m.iridescenceIOR.value=v.iridescenceIOR,m.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],m.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(m.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,m.iridescenceMapTransform)),v.iridescenceThicknessMap&&(m.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,m.iridescenceThicknessMapTransform))),v.transmission>0&&(m.transmission.value=v.transmission,m.transmissionSamplerMap.value=_.texture,m.transmissionSamplerSize.value.set(_.width,_.height),v.transmissionMap&&(m.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,m.transmissionMapTransform)),m.thickness.value=v.thickness,v.thicknessMap&&(m.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,m.thicknessMapTransform)),m.attenuationDistance.value=v.attenuationDistance,m.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(m.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(m.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,m.anisotropyMapTransform))),m.specularIntensity.value=v.specularIntensity,m.specularColor.value.copy(v.specularColor),v.specularColorMap&&(m.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,m.specularColorMapTransform)),v.specularIntensityMap&&(m.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,m.specularIntensityMapTransform))}function p(m,v){v.matcap&&(m.matcap.value=v.matcap)}function g(m,v){const _=e.get(v).light;m.referencePosition.value.setFromMatrixPosition(_.matrixWorld),m.nearDistance.value=_.shadow.camera.near,m.farDistance.value=_.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function Aw(o,e,t,n){let i={},s={},r=[];const a=o.getParameter(o.MAX_UNIFORM_BUFFER_BINDINGS);function c(_,y){const x=y.program;n.uniformBlockBinding(_,x)}function u(_,y){let x=i[_.id];x===void 0&&(p(_),x=d(_),i[_.id]=x,_.addEventListener("dispose",m));const M=y.program;n.updateUBOMapping(_,M);const S=e.render.frame;s[_.id]!==S&&(h(_),s[_.id]=S)}function d(_){const y=l();_.__bindingPointIndex=y;const x=o.createBuffer(),M=_.__size,S=_.usage;return o.bindBuffer(o.UNIFORM_BUFFER,x),o.bufferData(o.UNIFORM_BUFFER,M,S),o.bindBuffer(o.UNIFORM_BUFFER,null),o.bindBufferBase(o.UNIFORM_BUFFER,y,x),x}function l(){for(let _=0;_<a;_++)if(r.indexOf(_)===-1)return r.push(_),_;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function h(_){const y=i[_.id],x=_.uniforms,M=_.__cache;o.bindBuffer(o.UNIFORM_BUFFER,y);for(let S=0,A=x.length;S<A;S++){const T=Array.isArray(x[S])?x[S]:[x[S]];for(let b=0,w=T.length;b<w;b++){const P=T[b];if(f(P,S,b,M)===!0){const N=P.__offset,I=Array.isArray(P.value)?P.value:[P.value];let H=0;for(let G=0;G<I.length;G++){const J=I[G],U=g(J);typeof J=="number"||typeof J=="boolean"?(P.__data[0]=J,o.bufferSubData(o.UNIFORM_BUFFER,N+H,P.__data)):J.isMatrix3?(P.__data[0]=J.elements[0],P.__data[1]=J.elements[1],P.__data[2]=J.elements[2],P.__data[3]=0,P.__data[4]=J.elements[3],P.__data[5]=J.elements[4],P.__data[6]=J.elements[5],P.__data[7]=0,P.__data[8]=J.elements[6],P.__data[9]=J.elements[7],P.__data[10]=J.elements[8],P.__data[11]=0):(J.toArray(P.__data,H),H+=U.storage/Float32Array.BYTES_PER_ELEMENT)}o.bufferSubData(o.UNIFORM_BUFFER,N,P.__data)}}}o.bindBuffer(o.UNIFORM_BUFFER,null)}function f(_,y,x,M){const S=_.value,A=y+"_"+x;if(M[A]===void 0)return typeof S=="number"||typeof S=="boolean"?M[A]=S:M[A]=S.clone(),!0;{const T=M[A];if(typeof S=="number"||typeof S=="boolean"){if(T!==S)return M[A]=S,!0}else if(T.equals(S)===!1)return T.copy(S),!0}return!1}function p(_){const y=_.uniforms;let x=0;const M=16;for(let A=0,T=y.length;A<T;A++){const b=Array.isArray(y[A])?y[A]:[y[A]];for(let w=0,P=b.length;w<P;w++){const N=b[w],I=Array.isArray(N.value)?N.value:[N.value];for(let H=0,G=I.length;H<G;H++){const J=I[H],U=g(J),k=x%M;k!==0&&M-k<U.boundary&&(x+=M-k),N.__data=new Float32Array(U.storage/Float32Array.BYTES_PER_ELEMENT),N.__offset=x,x+=U.storage}}}const S=x%M;return S>0&&(x+=M-S),_.__size=x,_.__cache={},this}function g(_){const y={boundary:0,storage:0};return typeof _=="number"||typeof _=="boolean"?(y.boundary=4,y.storage=4):_.isVector2?(y.boundary=8,y.storage=8):_.isVector3||_.isColor?(y.boundary=16,y.storage=12):_.isVector4?(y.boundary=16,y.storage=16):_.isMatrix3?(y.boundary=48,y.storage=48):_.isMatrix4?(y.boundary=64,y.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),y}function m(_){const y=_.target;y.removeEventListener("dispose",m);const x=r.indexOf(y.__bindingPointIndex);r.splice(x,1),o.deleteBuffer(i[y.id]),delete i[y.id],delete s[y.id]}function v(){for(const _ in i)o.deleteBuffer(i[_]);r=[],i={},s={}}return{bind:c,update:u,dispose:v}}class Ew{constructor(e={}){const{canvas:t=xv(),context:n=null,depth:i=!0,stencil:s=!1,alpha:r=!1,antialias:a=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:u=!1,powerPreference:d="default",failIfMajorPerformanceCaveat:l=!1}=e;this.isWebGLRenderer=!0;let h;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");h=n.getContextAttributes().alpha}else h=r;const f=new Uint32Array(4),p=new Int32Array(4);let g=null,m=null;const v=[],_=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=sn,this._useLegacyLights=!1,this.toneMapping=ps,this.toneMappingExposure=1;const y=this;let x=!1,M=0,S=0,A=null,T=-1,b=null;const w=new At,P=new At;let N=null;const I=new He(0);let H=0,G=t.width,J=t.height,U=1,k=null,q=null;const Y=new At(0,0,G,J),V=new At(0,0,G,J);let Z=!1;const W=new xh;let L=!1,F=!1;const X=new Ye,ee=new D,re={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return A===null?U:1}let O=n;function de(R,z){return t.getContext(R,z)}try{const R={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:d,failIfMajorPerformanceCaveat:l};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${mh}`),t.addEventListener("webglcontextlost",E,!1),t.addEventListener("webglcontextrestored",te,!1),t.addEventListener("webglcontextcreationerror",se,!1),O===null){const z="webgl2";if(O=de(z,R),O===null)throw de(z)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let _e,Me,me,le,ue,We,Ge,B,C,ie,he,fe,ge,Ie,Ee,we,Ke,Ce,$e,at,Ze,ze,Je,rt;function vt(){_e=new Fy(O),_e.init(),ze=new gw(O,_e),Me=new Cy(O,_e,e,ze),me=new pw(O),le=new Oy(O),ue=new ew,We=new mw(O,_e,me,ue,Me,ze,le),Ge=new Py(y),B=new Dy(y),C=new Wv(O),Je=new Ey(O,C),ie=new ky(O,C,le,Je),he=new Uy(O,ie,C,le),$e=new By(O,Me,We),we=new Ry(ue),fe=new Jx(y,Ge,B,_e,Me,Je,we),ge=new Sw(y,ue),Ie=new nw,Ee=new lw(_e),Ce=new Ay(y,Ge,B,me,he,h,c),Ke=new fw(y,he,Me),rt=new Aw(O,le,Me,me),at=new Ty(O,_e,le),Ze=new Ny(O,_e,le),le.programs=fe.programs,y.capabilities=Me,y.extensions=_e,y.properties=ue,y.renderLists=Ie,y.shadowMap=Ke,y.state=me,y.info=le}vt();const tt=new bw(y,O);this.xr=tt,this.getContext=function(){return O},this.getContextAttributes=function(){return O.getContextAttributes()},this.forceContextLoss=function(){const R=_e.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=_e.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(R){R!==void 0&&(U=R,this.setSize(G,J,!1))},this.getSize=function(R){return R.set(G,J)},this.setSize=function(R,z,j=!0){if(tt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}G=R,J=z,t.width=Math.floor(R*U),t.height=Math.floor(z*U),j===!0&&(t.style.width=R+"px",t.style.height=z+"px"),this.setViewport(0,0,R,z)},this.getDrawingBufferSize=function(R){return R.set(G*U,J*U).floor()},this.setDrawingBufferSize=function(R,z,j){G=R,J=z,U=j,t.width=Math.floor(R*j),t.height=Math.floor(z*j),this.setViewport(0,0,R,z)},this.getCurrentViewport=function(R){return R.copy(w)},this.getViewport=function(R){return R.copy(Y)},this.setViewport=function(R,z,j,$){R.isVector4?Y.set(R.x,R.y,R.z,R.w):Y.set(R,z,j,$),me.viewport(w.copy(Y).multiplyScalar(U).round())},this.getScissor=function(R){return R.copy(V)},this.setScissor=function(R,z,j,$){R.isVector4?V.set(R.x,R.y,R.z,R.w):V.set(R,z,j,$),me.scissor(P.copy(V).multiplyScalar(U).round())},this.getScissorTest=function(){return Z},this.setScissorTest=function(R){me.setScissorTest(Z=R)},this.setOpaqueSort=function(R){k=R},this.setTransparentSort=function(R){q=R},this.getClearColor=function(R){return R.copy(Ce.getClearColor())},this.setClearColor=function(){Ce.setClearColor.apply(Ce,arguments)},this.getClearAlpha=function(){return Ce.getClearAlpha()},this.setClearAlpha=function(){Ce.setClearAlpha.apply(Ce,arguments)},this.clear=function(R=!0,z=!0,j=!0){let $=0;if(R){let Q=!1;if(A!==null){const ne=A.texture.format;Q=ne===Qf||ne===Zf||ne===Kf}if(Q){const ne=A.texture.type,Ae=ne===_s||ne===Gr||ne===Xf||ne===Ko||ne===qf||ne===Yf,Re=Ce.getClearColor(),Xe=Ce.getClearAlpha(),Ne=Re.r,Ve=Re.g,Le=Re.b;Ae?(f[0]=Ne,f[1]=Ve,f[2]=Le,f[3]=Xe,O.clearBufferuiv(O.COLOR,0,f)):(p[0]=Ne,p[1]=Ve,p[2]=Le,p[3]=Xe,O.clearBufferiv(O.COLOR,0,p))}else $|=O.COLOR_BUFFER_BIT}z&&($|=O.DEPTH_BUFFER_BIT),j&&($|=O.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),O.clear($)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",E,!1),t.removeEventListener("webglcontextrestored",te,!1),t.removeEventListener("webglcontextcreationerror",se,!1),Ie.dispose(),Ee.dispose(),ue.dispose(),Ge.dispose(),B.dispose(),he.dispose(),Je.dispose(),rt.dispose(),fe.dispose(),tt.dispose(),tt.removeEventListener("sessionstart",pt),tt.removeEventListener("sessionend",mt),oe.stop()};function E(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),x=!0}function te(){console.log("THREE.WebGLRenderer: Context Restored."),x=!1;const R=le.autoReset,z=Ke.enabled,j=Ke.autoUpdate,$=Ke.needsUpdate,Q=Ke.type;vt(),le.autoReset=R,Ke.enabled=z,Ke.autoUpdate=j,Ke.needsUpdate=$,Ke.type=Q}function se(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function ye(R){const z=R.target;z.removeEventListener("dispose",ye),Te(z)}function Te(R){nt(R),ue.remove(R)}function nt(R){const z=ue.get(R).programs;z!==void 0&&(z.forEach(function(j){fe.releaseProgram(j)}),R.isShaderMaterial&&fe.releaseShaderCache(R))}this.renderBufferDirect=function(R,z,j,$,Q,ne){z===null&&(z=re);const Ae=Q.isMesh&&Q.matrixWorld.determinant()<0,Re=De(R,z,j,$,Q);me.setMaterial($,Ae);let Xe=j.index,Ne=1;if($.wireframe===!0){if(Xe=ie.getWireframeAttribute(j),Xe===void 0)return;Ne=2}const Ve=j.drawRange,Le=j.attributes.position;let wt=Ve.start*Ne,Tt=(Ve.start+Ve.count)*Ne;ne!==null&&(wt=Math.max(wt,ne.start*Ne),Tt=Math.min(Tt,(ne.start+ne.count)*Ne)),Xe!==null?(wt=Math.max(wt,0),Tt=Math.min(Tt,Xe.count)):Le!=null&&(wt=Math.max(wt,0),Tt=Math.min(Tt,Le.count));const Pt=Tt-wt;if(Pt<0||Pt===1/0)return;Je.setup(Q,$,Re,j,Xe);let cn,lt=at;if(Xe!==null&&(cn=C.get(Xe),lt=Ze,lt.setIndex(cn)),Q.isMesh)$.wireframe===!0?(me.setLineWidth($.wireframeLinewidth*K()),lt.setMode(O.LINES)):lt.setMode(O.TRIANGLES);else if(Q.isLine){let je=$.linewidth;je===void 0&&(je=1),me.setLineWidth(je*K()),Q.isLineSegments?lt.setMode(O.LINES):Q.isLineLoop?lt.setMode(O.LINE_LOOP):lt.setMode(O.LINE_STRIP)}else Q.isPoints?lt.setMode(O.POINTS):Q.isSprite&&lt.setMode(O.TRIANGLES);if(Q.isBatchedMesh)Q._multiDrawInstances!==null?lt.renderMultiDrawInstances(Q._multiDrawStarts,Q._multiDrawCounts,Q._multiDrawCount,Q._multiDrawInstances):lt.renderMultiDraw(Q._multiDrawStarts,Q._multiDrawCounts,Q._multiDrawCount);else if(Q.isInstancedMesh)lt.renderInstances(wt,Pt,Q.count);else if(j.isInstancedBufferGeometry){const je=j._maxInstanceCount!==void 0?j._maxInstanceCount:1/0,Ln=Math.min(j.instanceCount,je);lt.renderInstances(wt,Pt,Ln)}else lt.render(wt,Pt)};function ot(R,z,j){R.transparent===!0&&R.side===qn&&R.forceSinglePass===!1?(R.side=Nn,R.needsUpdate=!0,Pe(R,z,j),R.side=qi,R.needsUpdate=!0,Pe(R,z,j),R.side=qn):Pe(R,z,j)}this.compile=function(R,z,j=null){j===null&&(j=R),m=Ee.get(j),m.init(z),_.push(m),j.traverseVisible(function(Q){Q.isLight&&Q.layers.test(z.layers)&&(m.pushLight(Q),Q.castShadow&&m.pushShadow(Q))}),R!==j&&R.traverseVisible(function(Q){Q.isLight&&Q.layers.test(z.layers)&&(m.pushLight(Q),Q.castShadow&&m.pushShadow(Q))}),m.setupLights(y._useLegacyLights);const $=new Set;return R.traverse(function(Q){const ne=Q.material;if(ne)if(Array.isArray(ne))for(let Ae=0;Ae<ne.length;Ae++){const Re=ne[Ae];ot(Re,j,Q),$.add(Re)}else ot(ne,j,Q),$.add(ne)}),_.pop(),m=null,$},this.compileAsync=function(R,z,j=null){const $=this.compile(R,z,j);return new Promise(Q=>{function ne(){if($.forEach(function(Ae){ue.get(Ae).currentProgram.isReady()&&$.delete(Ae)}),$.size===0){Q(R);return}setTimeout(ne,10)}_e.get("KHR_parallel_shader_compile")!==null?ne():setTimeout(ne,10)})};let St=null;function Ut(R){St&&St(R)}function pt(){oe.stop()}function mt(){oe.start()}const oe=new up;oe.setAnimationLoop(Ut),typeof self<"u"&&oe.setContext(self),this.setAnimationLoop=function(R){St=R,tt.setAnimationLoop(R),R===null?oe.stop():oe.start()},tt.addEventListener("sessionstart",pt),tt.addEventListener("sessionend",mt),this.render=function(R,z){if(z!==void 0&&z.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(x===!0)return;R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),z.parent===null&&z.matrixWorldAutoUpdate===!0&&z.updateMatrixWorld(),tt.enabled===!0&&tt.isPresenting===!0&&(tt.cameraAutoUpdate===!0&&tt.updateCamera(z),z=tt.getCamera()),R.isScene===!0&&R.onBeforeRender(y,R,z,A),m=Ee.get(R,_.length),m.init(z),_.push(m),X.multiplyMatrices(z.projectionMatrix,z.matrixWorldInverse),W.setFromProjectionMatrix(X),F=this.localClippingEnabled,L=we.init(this.clippingPlanes,F),g=Ie.get(R,v.length),g.init(),v.push(g),pe(R,z,0,y.sortObjects),g.finish(),y.sortObjects===!0&&g.sort(k,q);const j=tt.enabled===!1||tt.isPresenting===!1||tt.hasDepthSensing()===!1;j&&Ce.addToRenderList(g,R),this.info.render.frame++,L===!0&&we.beginShadows();const $=m.state.shadowsArray;Ke.render($,R,z),L===!0&&we.endShadows(),this.info.autoReset===!0&&this.info.reset();const Q=g.opaque,ne=g.transmissive;if(m.setupLights(y._useLegacyLights),z.isArrayCamera){const Ae=z.cameras;if(ne.length>0)for(let Re=0,Xe=Ae.length;Re<Xe;Re++){const Ne=Ae[Re];xe(Q,ne,R,Ne)}j&&Ce.render(R);for(let Re=0,Xe=Ae.length;Re<Xe;Re++){const Ne=Ae[Re];ve(g,R,Ne,Ne.viewport)}}else ne.length>0&&xe(Q,ne,R,z),j&&Ce.render(R),ve(g,R,z);A!==null&&(We.updateMultisampleRenderTarget(A),We.updateRenderTargetMipmap(A)),R.isScene===!0&&R.onAfterRender(y,R,z),Je.resetDefaultState(),T=-1,b=null,_.pop(),_.length>0?(m=_[_.length-1],L===!0&&we.setGlobalState(y.clippingPlanes,m.state.camera)):m=null,v.pop(),v.length>0?g=v[v.length-1]:g=null};function pe(R,z,j,$){if(R.visible===!1)return;if(R.layers.test(z.layers)){if(R.isGroup)j=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update(z);else if(R.isLight)m.pushLight(R),R.castShadow&&m.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||W.intersectsSprite(R)){$&&ee.setFromMatrixPosition(R.matrixWorld).applyMatrix4(X);const Ae=he.update(R),Re=R.material;Re.visible&&g.push(R,Ae,Re,j,ee.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||W.intersectsObject(R))){const Ae=he.update(R),Re=R.material;if($&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),ee.copy(R.boundingSphere.center)):(Ae.boundingSphere===null&&Ae.computeBoundingSphere(),ee.copy(Ae.boundingSphere.center)),ee.applyMatrix4(R.matrixWorld).applyMatrix4(X)),Array.isArray(Re)){const Xe=Ae.groups;for(let Ne=0,Ve=Xe.length;Ne<Ve;Ne++){const Le=Xe[Ne],wt=Re[Le.materialIndex];wt&&wt.visible&&g.push(R,Ae,wt,j,ee.z,Le)}}else Re.visible&&g.push(R,Ae,Re,j,ee.z,null)}}const ne=R.children;for(let Ae=0,Re=ne.length;Ae<Re;Ae++)pe(ne[Ae],z,j,$)}function ve(R,z,j,$){const Q=R.opaque,ne=R.transmissive,Ae=R.transparent;m.setupLightsView(j),L===!0&&we.setGlobalState(y.clippingPlanes,j),$&&me.viewport(w.copy($)),Q.length>0&&Qe(Q,z,j),ne.length>0&&Qe(ne,z,j),Ae.length>0&&Qe(Ae,z,j),me.buffers.depth.setTest(!0),me.buffers.depth.setMask(!0),me.buffers.color.setMask(!0),me.setPolygonOffset(!1)}function xe(R,z,j,$){if((j.isScene===!0?j.overrideMaterial:null)!==null)return;m.state.transmissionRenderTarget[$.id]===void 0&&(m.state.transmissionRenderTarget[$.id]=new ys(1,1,{generateMipmaps:!0,type:_e.has("EXT_color_buffer_half_float")||_e.has("EXT_color_buffer_float")?$o:_s,minFilter:Gi,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const ne=m.state.transmissionRenderTarget[$.id],Ae=$.viewport||w;ne.setSize(Ae.z,Ae.w);const Re=y.getRenderTarget();y.setRenderTarget(ne),y.getClearColor(I),H=y.getClearAlpha(),H<1&&y.setClearColor(16777215,.5),y.clear();const Xe=y.toneMapping;y.toneMapping=ps;const Ne=$.viewport;if($.viewport!==void 0&&($.viewport=void 0),m.setupLightsView($),L===!0&&we.setGlobalState(y.clippingPlanes,$),Qe(R,j,$),We.updateMultisampleRenderTarget(ne),We.updateRenderTargetMipmap(ne),_e.has("WEBGL_multisampled_render_to_texture")===!1){let Ve=!1;for(let Le=0,wt=z.length;Le<wt;Le++){const Tt=z[Le],Pt=Tt.object,cn=Tt.geometry,lt=Tt.material,je=Tt.group;if(lt.side===qn&&Pt.layers.test($.layers)){const Ln=lt.side;lt.side=Nn,lt.needsUpdate=!0,ke(Pt,j,$,cn,lt,je),lt.side=Ln,lt.needsUpdate=!0,Ve=!0}}Ve===!0&&(We.updateMultisampleRenderTarget(ne),We.updateRenderTargetMipmap(ne))}y.setRenderTarget(Re),y.setClearColor(I,H),Ne!==void 0&&($.viewport=Ne),y.toneMapping=Xe}function Qe(R,z,j){const $=z.isScene===!0?z.overrideMaterial:null;for(let Q=0,ne=R.length;Q<ne;Q++){const Ae=R[Q],Re=Ae.object,Xe=Ae.geometry,Ne=$===null?Ae.material:$,Ve=Ae.group;Re.layers.test(j.layers)&&ke(Re,z,j,Xe,Ne,Ve)}}function ke(R,z,j,$,Q,ne){R.onBeforeRender(y,z,j,$,Q,ne),R.modelViewMatrix.multiplyMatrices(j.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),Q.onBeforeRender(y,z,j,$,R,ne),Q.transparent===!0&&Q.side===qn&&Q.forceSinglePass===!1?(Q.side=Nn,Q.needsUpdate=!0,y.renderBufferDirect(j,z,$,Q,R,ne),Q.side=qi,Q.needsUpdate=!0,y.renderBufferDirect(j,z,$,Q,R,ne),Q.side=qn):y.renderBufferDirect(j,z,$,Q,R,ne),R.onAfterRender(y,z,j,$,Q,ne)}function Pe(R,z,j){z.isScene!==!0&&(z=re);const $=ue.get(R),Q=m.state.lights,ne=m.state.shadowsArray,Ae=Q.state.version,Re=fe.getParameters(R,Q.state,ne,z,j),Xe=fe.getProgramCacheKey(Re);let Ne=$.programs;$.environment=R.isMeshStandardMaterial?z.environment:null,$.fog=z.fog,$.envMap=(R.isMeshStandardMaterial?B:Ge).get(R.envMap||$.environment),$.envMapRotation=$.environment!==null&&R.envMap===null?z.environmentRotation:R.envMapRotation,Ne===void 0&&(R.addEventListener("dispose",ye),Ne=new Map,$.programs=Ne);let Ve=Ne.get(Xe);if(Ve!==void 0){if($.currentProgram===Ve&&$.lightsStateVersion===Ae)return ae(R,Re),Ve}else Re.uniforms=fe.getUniforms(R),R.onBuild(j,Re,y),R.onBeforeCompile(Re,y),Ve=fe.acquireProgram(Re,Xe),Ne.set(Xe,Ve),$.uniforms=Re.uniforms;const Le=$.uniforms;return(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(Le.clippingPlanes=we.uniform),ae(R,Re),$.needsLights=qe(R),$.lightsStateVersion=Ae,$.needsLights&&(Le.ambientLightColor.value=Q.state.ambient,Le.lightProbe.value=Q.state.probe,Le.directionalLights.value=Q.state.directional,Le.directionalLightShadows.value=Q.state.directionalShadow,Le.spotLights.value=Q.state.spot,Le.spotLightShadows.value=Q.state.spotShadow,Le.rectAreaLights.value=Q.state.rectArea,Le.ltc_1.value=Q.state.rectAreaLTC1,Le.ltc_2.value=Q.state.rectAreaLTC2,Le.pointLights.value=Q.state.point,Le.pointLightShadows.value=Q.state.pointShadow,Le.hemisphereLights.value=Q.state.hemi,Le.directionalShadowMap.value=Q.state.directionalShadowMap,Le.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,Le.spotShadowMap.value=Q.state.spotShadowMap,Le.spotLightMatrix.value=Q.state.spotLightMatrix,Le.spotLightMap.value=Q.state.spotLightMap,Le.pointShadowMap.value=Q.state.pointShadowMap,Le.pointShadowMatrix.value=Q.state.pointShadowMatrix),$.currentProgram=Ve,$.uniformsList=null,Ve}function Oe(R){if(R.uniformsList===null){const z=R.currentProgram.getUniforms();R.uniformsList=Ga.seqWithValue(z.seq,R.uniforms)}return R.uniformsList}function ae(R,z){const j=ue.get(R);j.outputColorSpace=z.outputColorSpace,j.batching=z.batching,j.instancing=z.instancing,j.instancingColor=z.instancingColor,j.instancingMorph=z.instancingMorph,j.skinning=z.skinning,j.morphTargets=z.morphTargets,j.morphNormals=z.morphNormals,j.morphColors=z.morphColors,j.morphTargetsCount=z.morphTargetsCount,j.numClippingPlanes=z.numClippingPlanes,j.numIntersection=z.numClipIntersection,j.vertexAlphas=z.vertexAlphas,j.vertexTangents=z.vertexTangents,j.toneMapping=z.toneMapping}function De(R,z,j,$,Q){z.isScene!==!0&&(z=re),We.resetTextureUnits();const ne=z.fog,Ae=$.isMeshStandardMaterial?z.environment:null,Re=A===null?y.outputColorSpace:A.isXRRenderTarget===!0?A.texture.colorSpace:_n,Xe=($.isMeshStandardMaterial?B:Ge).get($.envMap||Ae),Ne=$.vertexColors===!0&&!!j.attributes.color&&j.attributes.color.itemSize===4,Ve=!!j.attributes.tangent&&(!!$.normalMap||$.anisotropy>0),Le=!!j.morphAttributes.position,wt=!!j.morphAttributes.normal,Tt=!!j.morphAttributes.color;let Pt=ps;$.toneMapped&&(A===null||A.isXRRenderTarget===!0)&&(Pt=y.toneMapping);const cn=j.morphAttributes.position||j.morphAttributes.normal||j.morphAttributes.color,lt=cn!==void 0?cn.length:0,je=ue.get($),Ln=m.state.lights;if(L===!0&&(F===!0||R!==b)){const kt=R===b&&$.id===T;we.setState($,R,kt)}let it=!1;$.version===je.__version?(je.needsLights&&je.lightsStateVersion!==Ln.state.version||je.outputColorSpace!==Re||Q.isBatchedMesh&&je.batching===!1||!Q.isBatchedMesh&&je.batching===!0||Q.isInstancedMesh&&je.instancing===!1||!Q.isInstancedMesh&&je.instancing===!0||Q.isSkinnedMesh&&je.skinning===!1||!Q.isSkinnedMesh&&je.skinning===!0||Q.isInstancedMesh&&je.instancingColor===!0&&Q.instanceColor===null||Q.isInstancedMesh&&je.instancingColor===!1&&Q.instanceColor!==null||Q.isInstancedMesh&&je.instancingMorph===!0&&Q.morphTexture===null||Q.isInstancedMesh&&je.instancingMorph===!1&&Q.morphTexture!==null||je.envMap!==Xe||$.fog===!0&&je.fog!==ne||je.numClippingPlanes!==void 0&&(je.numClippingPlanes!==we.numPlanes||je.numIntersection!==we.numIntersection)||je.vertexAlphas!==Ne||je.vertexTangents!==Ve||je.morphTargets!==Le||je.morphNormals!==wt||je.morphColors!==Tt||je.toneMapping!==Pt||je.morphTargetsCount!==lt)&&(it=!0):(it=!0,je.__version=$.version);let xn=je.currentProgram;it===!0&&(xn=Pe($,z,Q));let wn=!1,Zt=!1,en=!1;const Ct=xn.getUniforms(),pn=je.uniforms;if(me.useProgram(xn.program)&&(wn=!0,Zt=!0,en=!0),$.id!==T&&(T=$.id,Zt=!0),wn||b!==R){Ct.setValue(O,"projectionMatrix",R.projectionMatrix),Ct.setValue(O,"viewMatrix",R.matrixWorldInverse);const kt=Ct.map.cameraPosition;kt!==void 0&&kt.setValue(O,ee.setFromMatrixPosition(R.matrixWorld)),Me.logarithmicDepthBuffer&&Ct.setValue(O,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),($.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshLambertMaterial||$.isMeshBasicMaterial||$.isMeshStandardMaterial||$.isShaderMaterial)&&Ct.setValue(O,"isOrthographic",R.isOrthographicCamera===!0),b!==R&&(b=R,Zt=!0,en=!0)}if(Q.isSkinnedMesh){Ct.setOptional(O,Q,"bindMatrix"),Ct.setOptional(O,Q,"bindMatrixInverse");const kt=Q.skeleton;kt&&(kt.boneTexture===null&&kt.computeBoneTexture(),Ct.setValue(O,"boneTexture",kt.boneTexture,We))}Q.isBatchedMesh&&(Ct.setOptional(O,Q,"batchingTexture"),Ct.setValue(O,"batchingTexture",Q._matricesTexture,We));const st=j.morphAttributes;if((st.position!==void 0||st.normal!==void 0||st.color!==void 0)&&$e.update(Q,j,xn),(Zt||je.receiveShadow!==Q.receiveShadow)&&(je.receiveShadow=Q.receiveShadow,Ct.setValue(O,"receiveShadow",Q.receiveShadow)),$.isMeshGouraudMaterial&&$.envMap!==null&&(pn.envMap.value=Xe,pn.flipEnvMap.value=Xe.isCubeTexture&&Xe.isRenderTargetTexture===!1?-1:1),$.isMeshStandardMaterial&&$.envMap===null&&z.environment!==null&&(pn.envMapIntensity.value=z.environmentIntensity),Zt&&(Ct.setValue(O,"toneMappingExposure",y.toneMappingExposure),je.needsLights&&Ue(pn,en),ne&&$.fog===!0&&ge.refreshFogUniforms(pn,ne),ge.refreshMaterialUniforms(pn,$,U,J,m.state.transmissionRenderTarget[R.id]),Ga.upload(O,Oe(je),pn,We)),$.isShaderMaterial&&$.uniformsNeedUpdate===!0&&(Ga.upload(O,Oe(je),pn,We),$.uniformsNeedUpdate=!1),$.isSpriteMaterial&&Ct.setValue(O,"center",Q.center),Ct.setValue(O,"modelViewMatrix",Q.modelViewMatrix),Ct.setValue(O,"normalMatrix",Q.normalMatrix),Ct.setValue(O,"modelMatrix",Q.matrixWorld),$.isShaderMaterial||$.isRawShaderMaterial){const kt=$.uniformsGroups;for(let Qt=0,Di=kt.length;Qt<Di;Qt++){const vi=kt[Qt];rt.update(vi,xn),rt.bind(vi,xn)}}return xn}function Ue(R,z){R.ambientLightColor.needsUpdate=z,R.lightProbe.needsUpdate=z,R.directionalLights.needsUpdate=z,R.directionalLightShadows.needsUpdate=z,R.pointLights.needsUpdate=z,R.pointLightShadows.needsUpdate=z,R.spotLights.needsUpdate=z,R.spotLightShadows.needsUpdate=z,R.rectAreaLights.needsUpdate=z,R.hemisphereLights.needsUpdate=z}function qe(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return S},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(R,z,j){ue.get(R.texture).__webglTexture=z,ue.get(R.depthTexture).__webglTexture=j;const $=ue.get(R);$.__hasExternalTextures=!0,$.__autoAllocateDepthBuffer=j===void 0,$.__autoAllocateDepthBuffer||_e.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),$.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(R,z){const j=ue.get(R);j.__webglFramebuffer=z,j.__useDefaultFramebuffer=z===void 0},this.setRenderTarget=function(R,z=0,j=0){A=R,M=z,S=j;let $=!0,Q=null,ne=!1,Ae=!1;if(R){const Xe=ue.get(R);Xe.__useDefaultFramebuffer!==void 0?(me.bindFramebuffer(O.FRAMEBUFFER,null),$=!1):Xe.__webglFramebuffer===void 0?We.setupRenderTarget(R):Xe.__hasExternalTextures&&We.rebindTextures(R,ue.get(R.texture).__webglTexture,ue.get(R.depthTexture).__webglTexture);const Ne=R.texture;(Ne.isData3DTexture||Ne.isDataArrayTexture||Ne.isCompressedArrayTexture)&&(Ae=!0);const Ve=ue.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(Ve[z])?Q=Ve[z][j]:Q=Ve[z],ne=!0):R.samples>0&&We.useMultisampledRTT(R)===!1?Q=ue.get(R).__webglMultisampledFramebuffer:Array.isArray(Ve)?Q=Ve[j]:Q=Ve,w.copy(R.viewport),P.copy(R.scissor),N=R.scissorTest}else w.copy(Y).multiplyScalar(U).floor(),P.copy(V).multiplyScalar(U).floor(),N=Z;if(me.bindFramebuffer(O.FRAMEBUFFER,Q)&&$&&me.drawBuffers(R,Q),me.viewport(w),me.scissor(P),me.setScissorTest(N),ne){const Xe=ue.get(R.texture);O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+z,Xe.__webglTexture,j)}else if(Ae){const Xe=ue.get(R.texture),Ne=z||0;O.framebufferTextureLayer(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,Xe.__webglTexture,j||0,Ne)}T=-1},this.readRenderTargetPixels=function(R,z,j,$,Q,ne,Ae){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Re=ue.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&Ae!==void 0&&(Re=Re[Ae]),Re){me.bindFramebuffer(O.FRAMEBUFFER,Re);try{const Xe=R.texture,Ne=Xe.format,Ve=Xe.type;if(!Me.textureFormatReadable(Ne)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Me.textureTypeReadable(Ve)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}z>=0&&z<=R.width-$&&j>=0&&j<=R.height-Q&&O.readPixels(z,j,$,Q,ze.convert(Ne),ze.convert(Ve),ne)}finally{const Xe=A!==null?ue.get(A).__webglFramebuffer:null;me.bindFramebuffer(O.FRAMEBUFFER,Xe)}}},this.copyFramebufferToTexture=function(R,z,j=0){const $=Math.pow(2,-j),Q=Math.floor(z.image.width*$),ne=Math.floor(z.image.height*$);We.setTexture2D(z,0),O.copyTexSubImage2D(O.TEXTURE_2D,j,0,0,R.x,R.y,Q,ne),me.unbindTexture()},this.copyTextureToTexture=function(R,z,j,$=0){const Q=z.image.width,ne=z.image.height,Ae=ze.convert(j.format),Re=ze.convert(j.type);We.setTexture2D(j,0),O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,j.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,j.unpackAlignment),z.isDataTexture?O.texSubImage2D(O.TEXTURE_2D,$,R.x,R.y,Q,ne,Ae,Re,z.image.data):z.isCompressedTexture?O.compressedTexSubImage2D(O.TEXTURE_2D,$,R.x,R.y,z.mipmaps[0].width,z.mipmaps[0].height,Ae,z.mipmaps[0].data):O.texSubImage2D(O.TEXTURE_2D,$,R.x,R.y,Ae,Re,z.image),$===0&&j.generateMipmaps&&O.generateMipmap(O.TEXTURE_2D),me.unbindTexture()},this.copyTextureToTexture3D=function(R,z,j,$,Q=0){const ne=R.max.x-R.min.x,Ae=R.max.y-R.min.y,Re=R.max.z-R.min.z,Xe=ze.convert($.format),Ne=ze.convert($.type);let Ve;if($.isData3DTexture)We.setTexture3D($,0),Ve=O.TEXTURE_3D;else if($.isDataArrayTexture||$.isCompressedArrayTexture)We.setTexture2DArray($,0),Ve=O.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}O.pixelStorei(O.UNPACK_FLIP_Y_WEBGL,$.flipY),O.pixelStorei(O.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$.premultiplyAlpha),O.pixelStorei(O.UNPACK_ALIGNMENT,$.unpackAlignment);const Le=O.getParameter(O.UNPACK_ROW_LENGTH),wt=O.getParameter(O.UNPACK_IMAGE_HEIGHT),Tt=O.getParameter(O.UNPACK_SKIP_PIXELS),Pt=O.getParameter(O.UNPACK_SKIP_ROWS),cn=O.getParameter(O.UNPACK_SKIP_IMAGES),lt=j.isCompressedTexture?j.mipmaps[Q]:j.image;O.pixelStorei(O.UNPACK_ROW_LENGTH,lt.width),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,lt.height),O.pixelStorei(O.UNPACK_SKIP_PIXELS,R.min.x),O.pixelStorei(O.UNPACK_SKIP_ROWS,R.min.y),O.pixelStorei(O.UNPACK_SKIP_IMAGES,R.min.z),j.isDataTexture||j.isData3DTexture?O.texSubImage3D(Ve,Q,z.x,z.y,z.z,ne,Ae,Re,Xe,Ne,lt.data):$.isCompressedArrayTexture?O.compressedTexSubImage3D(Ve,Q,z.x,z.y,z.z,ne,Ae,Re,Xe,lt.data):O.texSubImage3D(Ve,Q,z.x,z.y,z.z,ne,Ae,Re,Xe,Ne,lt),O.pixelStorei(O.UNPACK_ROW_LENGTH,Le),O.pixelStorei(O.UNPACK_IMAGE_HEIGHT,wt),O.pixelStorei(O.UNPACK_SKIP_PIXELS,Tt),O.pixelStorei(O.UNPACK_SKIP_ROWS,Pt),O.pixelStorei(O.UNPACK_SKIP_IMAGES,cn),Q===0&&$.generateMipmaps&&O.generateMipmap(Ve),me.unbindTexture()},this.initTexture=function(R){R.isCubeTexture?We.setTextureCube(R,0):R.isData3DTexture?We.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?We.setTexture2DArray(R,0):We.setTexture2D(R,0),me.unbindTexture()},this.resetState=function(){M=0,S=0,A=null,me.reset(),Je.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Wi}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===gh?"display-p3":"srgb",t.unpackColorSpace=Et.workingColorSpace===gl?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class Tw extends et{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new ht,this.environmentIntensity=1,this.environmentRotation=new ht,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Cw{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Nc,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=pi()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return np("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=pi()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const In=new D;class bh{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)In.fromBufferAttribute(this,t),In.applyMatrix4(e),this.setXYZ(t,In.x,In.y,In.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)In.fromBufferAttribute(this,t),In.applyNormalMatrix(e),this.setXYZ(t,In.x,In.y,In.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)In.fromBufferAttribute(this,t),In.transformDirection(e),this.setXYZ(t,In.x,In.y,In.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=di(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Rt(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Rt(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Rt(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Rt(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Rt(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=di(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=di(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=di(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=di(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array),i=Rt(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Rt(t,this.array),n=Rt(n,this.array),i=Rt(i,this.array),s=Rt(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new an(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new bh(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const xd=new D,wd=new At,bd=new At,Rw=new D,Md=new Ye,Ma=new D,sc=new Pi,Sd=new Ye,rc=new Qr;class _p extends Se{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=eu,this.bindMatrix=new Ye,this.bindMatrixInverse=new Ye,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Zi),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Ma),this.boundingBox.expandByPoint(Ma)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Pi),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,Ma),this.boundingSphere.expandByPoint(Ma)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),sc.copy(this.boundingSphere),sc.applyMatrix4(i),e.ray.intersectsSphere(sc)!==!1&&(Sd.copy(i).invert(),rc.copy(e.ray).applyMatrix4(Sd),!(this.boundingBox!==null&&rc.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,rc)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new At,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===eu?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Ng?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;wd.fromBufferAttribute(i.attributes.skinIndex,e),bd.fromBufferAttribute(i.attributes.skinWeight,e),xd.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const r=bd.getComponent(s);if(r!==0){const a=wd.getComponent(s);Md.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(Rw.copy(xd).applyMatrix4(Md),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}class nl extends et{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Mh extends qt{constructor(e=null,t=1,n=1,i,s,r,a,c,u=Bt,d=Bt,l,h){super(null,r,a,c,u,d,i,s,l,h),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ad=new Ye,Pw=new Ye;class _l{constructor(e=[],t=[]){this.uuid=pi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Ye)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Ye;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,r=e.length;s<r;s++){const a=e[s]?e[s].matrixWorld:Pw;Ad.multiplyMatrices(a,t[s]),Ad.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new _l(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Mh(t,e,e,fi,Ai);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let r=t[s];r===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),r=new nl),this.bones.push(r),this.boneInverses.push(new Ye().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const r=t[i];e.bones.push(r.uuid);const a=n[i];e.boneInverses.push(a.toArray())}return e}}class Bc extends an{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const wr=new Ye,Ed=new Ye,Sa=[],Td=new Zi,Lw=new Ye,ao=new Se,lo=new Pi;class Iw extends Se{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Bc(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,Lw)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Zi),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,wr),Td.copy(e.boundingBox).applyMatrix4(wr),this.boundingBox.union(Td)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Pi),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,wr),lo.copy(e.boundingSphere).applyMatrix4(wr),this.boundingSphere.union(lo)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,r=e*s+1;for(let a=0;a<n.length;a++)n[a]=i[r+a]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(ao.geometry=this.geometry,ao.material=this.material,ao.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),lo.copy(this.boundingSphere),lo.applyMatrix4(n),e.ray.intersectsSphere(lo)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,wr),Ed.multiplyMatrices(n,wr),ao.matrixWorld=Ed,ao.raycast(e,Sa);for(let r=0,a=Sa.length;r<a;r++){const c=Sa[r];c.instanceId=s,c.object=this,t.push(c)}Sa.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Bc(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new Mh(new Float32Array(i*this.count),i,this.count,$f,Ai));const s=this.morphTexture.source.data.data;let r=0;for(let u=0;u<n.length;u++)r+=n[u];const a=this.geometry.morphTargetsRelative?1:1-r,c=i*e;s[c]=a,s.set(n,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class eo extends Kn{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new He(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const il=new D,sl=new D,Cd=new Ye,co=new Qr,Aa=new Pi,oc=new D,Rd=new D;class Xn extends et{constructor(e=new Ft,t=new eo){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)il.fromBufferAttribute(t,i-1),sl.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=il.distanceTo(sl);e.setAttribute("lineDistance",new yt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,r=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Aa.copy(n.boundingSphere),Aa.applyMatrix4(i),Aa.radius+=s,e.ray.intersectsSphere(Aa)===!1)return;Cd.copy(i).invert(),co.copy(e.ray).applyMatrix4(Cd);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,u=this.isLineSegments?2:1,d=n.index,h=n.attributes.position;if(d!==null){const f=Math.max(0,r.start),p=Math.min(d.count,r.start+r.count);for(let g=f,m=p-1;g<m;g+=u){const v=d.getX(g),_=d.getX(g+1),y=Ea(this,e,co,c,v,_);y&&t.push(y)}if(this.isLineLoop){const g=d.getX(p-1),m=d.getX(f),v=Ea(this,e,co,c,g,m);v&&t.push(v)}}else{const f=Math.max(0,r.start),p=Math.min(h.count,r.start+r.count);for(let g=f,m=p-1;g<m;g+=u){const v=Ea(this,e,co,c,g,g+1);v&&t.push(v)}if(this.isLineLoop){const g=Ea(this,e,co,c,p-1,f);g&&t.push(g)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Ea(o,e,t,n,i,s){const r=o.geometry.attributes.position;if(il.fromBufferAttribute(r,i),sl.fromBufferAttribute(r,s),t.distanceSqToSegment(il,sl,oc,Rd)>n)return;oc.applyMatrix4(o.matrixWorld);const c=e.ray.origin.distanceTo(oc);if(!(c<e.near||c>e.far))return{distance:c,point:Rd.clone().applyMatrix4(o.matrixWorld),index:i,face:null,faceIndex:null,object:o}}const Pd=new D,Ld=new D;class yp extends Xn{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)Pd.fromBufferAttribute(t,i),Ld.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+Pd.distanceTo(Ld);e.setAttribute("lineDistance",new yt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Dw extends Xn{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class xp extends Kn{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new He(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const Id=new Ye,Uc=new Qr,Ta=new Pi,Ca=new D;class Fw extends et{constructor(e=new Ft,t=new xp){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,r=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Ta.copy(n.boundingSphere),Ta.applyMatrix4(i),Ta.radius+=s,e.ray.intersectsSphere(Ta)===!1)return;Id.copy(i).invert(),Uc.copy(e.ray).applyMatrix4(Id);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,u=n.index,l=n.attributes.position;if(u!==null){const h=Math.max(0,r.start),f=Math.min(u.count,r.start+r.count);for(let p=h,g=f;p<g;p++){const m=u.getX(p);Ca.fromBufferAttribute(l,m),Dd(Ca,m,c,i,e,t,this)}}else{const h=Math.max(0,r.start),f=Math.min(l.count,r.start+r.count);for(let p=h,g=f;p<g;p++)Ca.fromBufferAttribute(l,p),Dd(Ca,p,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,r=i.length;s<r;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function Dd(o,e,t,n,i,s,r){const a=Uc.distanceSqToPoint(o);if(a<t){const c=new D;Uc.closestPointToPoint(o,c),c.applyMatrix4(n);const u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;s.push({distance:u,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:r})}}class kw{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let i=0;const s=n.length;let r;t?r=t:r=e*n[s-1];let a=0,c=s-1,u;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),u=n[i]-r,u<0)a=i+1;else if(u>0)c=i-1;else{c=i;break}if(i=c,n[i]===r)return i/(s-1);const d=n[i],h=n[i+1]-d,f=(r-d)/h;return(i+f)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const r=this.getPoint(i),a=this.getPoint(s),c=t||(r.isVector2?new Fe:new D);return c.copy(a).sub(r).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new D,i=[],s=[],r=[],a=new D,c=new Ye;for(let f=0;f<=e;f++){const p=f/e;i[f]=this.getTangentAt(p,new D)}s[0]=new D,r[0]=new D;let u=Number.MAX_VALUE;const d=Math.abs(i[0].x),l=Math.abs(i[0].y),h=Math.abs(i[0].z);d<=u&&(u=d,n.set(1,0,0)),l<=u&&(u=l,n.set(0,1,0)),h<=u&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],a),r[0].crossVectors(i[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),r[f]=r[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(un(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(c.makeRotationAxis(a,p))}r[f].crossVectors(i[f],s[f])}if(t===!0){let f=Math.acos(un(s[0].dot(s[e]),-1,1));f/=e,i[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(c.makeRotationAxis(i[p],f*p)),r[p].crossVectors(i[p],s[p])}return{tangents:i,normals:s,binormals:r}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class hn extends Ft{constructor(e=1,t=1,n=1,i=32,s=1,r=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:r,thetaStart:a,thetaLength:c};const u=this;i=Math.floor(i),s=Math.floor(s);const d=[],l=[],h=[],f=[];let p=0;const g=[],m=n/2;let v=0;_(),r===!1&&(e>0&&y(!0),t>0&&y(!1)),this.setIndex(d),this.setAttribute("position",new yt(l,3)),this.setAttribute("normal",new yt(h,3)),this.setAttribute("uv",new yt(f,2));function _(){const x=new D,M=new D;let S=0;const A=(t-e)/n;for(let T=0;T<=s;T++){const b=[],w=T/s,P=w*(t-e)+e;for(let N=0;N<=i;N++){const I=N/i,H=I*c+a,G=Math.sin(H),J=Math.cos(H);M.x=P*G,M.y=-w*n+m,M.z=P*J,l.push(M.x,M.y,M.z),x.set(G,A,J).normalize(),h.push(x.x,x.y,x.z),f.push(I,1-w),b.push(p++)}g.push(b)}for(let T=0;T<i;T++)for(let b=0;b<s;b++){const w=g[b][T],P=g[b+1][T],N=g[b+1][T+1],I=g[b][T+1];d.push(w,P,I),d.push(P,N,I),S+=6}u.addGroup(v,S,0),v+=S}function y(x){const M=p,S=new Fe,A=new D;let T=0;const b=x===!0?e:t,w=x===!0?1:-1;for(let N=1;N<=i;N++)l.push(0,m*w,0),h.push(0,w,0),f.push(.5,.5),p++;const P=p;for(let N=0;N<=i;N++){const H=N/i*c+a,G=Math.cos(H),J=Math.sin(H);A.x=b*J,A.y=m*w,A.z=b*G,l.push(A.x,A.y,A.z),h.push(0,w,0),S.x=G*.5+.5,S.y=J*.5*w+.5,f.push(S.x,S.y),p++}for(let N=0;N<i;N++){const I=M+N,H=P+N;x===!0?d.push(H,H+1,I):d.push(H+1,H,I),T+=3}u.addGroup(v,T,x===!0?1:2),v+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new hn(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Sh extends Ft{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],r=[];a(i),u(n),d(),this.setAttribute("position",new yt(s,3)),this.setAttribute("normal",new yt(s.slice(),3)),this.setAttribute("uv",new yt(r,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(_){const y=new D,x=new D,M=new D;for(let S=0;S<t.length;S+=3)f(t[S+0],y),f(t[S+1],x),f(t[S+2],M),c(y,x,M,_)}function c(_,y,x,M){const S=M+1,A=[];for(let T=0;T<=S;T++){A[T]=[];const b=_.clone().lerp(x,T/S),w=y.clone().lerp(x,T/S),P=S-T;for(let N=0;N<=P;N++)N===0&&T===S?A[T][N]=b:A[T][N]=b.clone().lerp(w,N/P)}for(let T=0;T<S;T++)for(let b=0;b<2*(S-T)-1;b++){const w=Math.floor(b/2);b%2===0?(h(A[T][w+1]),h(A[T+1][w]),h(A[T][w])):(h(A[T][w+1]),h(A[T+1][w+1]),h(A[T+1][w]))}}function u(_){const y=new D;for(let x=0;x<s.length;x+=3)y.x=s[x+0],y.y=s[x+1],y.z=s[x+2],y.normalize().multiplyScalar(_),s[x+0]=y.x,s[x+1]=y.y,s[x+2]=y.z}function d(){const _=new D;for(let y=0;y<s.length;y+=3){_.x=s[y+0],_.y=s[y+1],_.z=s[y+2];const x=m(_)/2/Math.PI+.5,M=v(_)/Math.PI+.5;r.push(x,1-M)}p(),l()}function l(){for(let _=0;_<r.length;_+=6){const y=r[_+0],x=r[_+2],M=r[_+4],S=Math.max(y,x,M),A=Math.min(y,x,M);S>.9&&A<.1&&(y<.2&&(r[_+0]+=1),x<.2&&(r[_+2]+=1),M<.2&&(r[_+4]+=1))}}function h(_){s.push(_.x,_.y,_.z)}function f(_,y){const x=_*3;y.x=e[x+0],y.y=e[x+1],y.z=e[x+2]}function p(){const _=new D,y=new D,x=new D,M=new D,S=new Fe,A=new Fe,T=new Fe;for(let b=0,w=0;b<s.length;b+=9,w+=6){_.set(s[b+0],s[b+1],s[b+2]),y.set(s[b+3],s[b+4],s[b+5]),x.set(s[b+6],s[b+7],s[b+8]),S.set(r[w+0],r[w+1]),A.set(r[w+2],r[w+3]),T.set(r[w+4],r[w+5]),M.copy(_).add(y).add(x).divideScalar(3);const P=m(M);g(S,w+0,_,P),g(A,w+2,y,P),g(T,w+4,x,P)}}function g(_,y,x,M){M<0&&_.x===1&&(r[y]=_.x-1),x.x===0&&x.z===0&&(r[y]=M/2/Math.PI+.5)}function m(_){return Math.atan2(_.z,-_.x)}function v(_){return Math.atan2(-_.y,Math.sqrt(_.x*_.x+_.z*_.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sh(e.vertices,e.indices,e.radius,e.details)}}const Nw={triangulate:function(o,e,t=2){const n=e&&e.length,i=n?e[0]*t:o.length;let s=wp(o,0,i,t,!0);const r=[];if(!s||s.next===s.prev)return r;let a,c,u,d,l,h,f;if(n&&(s=Vw(o,e,s,t)),o.length>80*t){a=u=o[0],c=d=o[1];for(let p=t;p<i;p+=t)l=o[p],h=o[p+1],l<a&&(a=l),h<c&&(c=h),l>u&&(u=l),h>d&&(d=h);f=Math.max(u-a,d-c),f=f!==0?32767/f:0}return Oo(s,r,t,a,c,f,0),r}};function wp(o,e,t,n,i){let s,r;if(i===Qw(o,e,t,n)>0)for(s=e;s<t;s+=n)r=Fd(s,o[s],o[s+1],r);else for(s=t-n;s>=e;s-=n)r=Fd(s,o[s],o[s+1],r);return r&&yl(r,r.next)&&(Uo(r),r=r.next),r}function qs(o,e){if(!o)return o;e||(e=o);let t=o,n;do if(n=!1,!t.steiner&&(yl(t,t.next)||$t(t.prev,t,t.next)===0)){if(Uo(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function Oo(o,e,t,n,i,s,r){if(!o)return;!r&&s&&jw(o,n,i,s);let a=o,c,u;for(;o.prev!==o.next;){if(c=o.prev,u=o.next,s?Bw(o,n,i,s):Ow(o)){e.push(c.i/t|0),e.push(o.i/t|0),e.push(u.i/t|0),Uo(o),o=u.next,a=u.next;continue}if(o=u,o===a){r?r===1?(o=Uw(qs(o),e,t),Oo(o,e,t,n,i,s,2)):r===2&&zw(o,e,t,n,i,s):Oo(qs(o),e,t,n,i,s,1);break}}}function Ow(o){const e=o.prev,t=o,n=o.next;if($t(e,t,n)>=0)return!1;const i=e.x,s=t.x,r=n.x,a=e.y,c=t.y,u=n.y,d=i<s?i<r?i:r:s<r?s:r,l=a<c?a<u?a:u:c<u?c:u,h=i>s?i>r?i:r:s>r?s:r,f=a>c?a>u?a:u:c>u?c:u;let p=n.next;for(;p!==e;){if(p.x>=d&&p.x<=h&&p.y>=l&&p.y<=f&&Tr(i,a,s,c,r,u,p.x,p.y)&&$t(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Bw(o,e,t,n){const i=o.prev,s=o,r=o.next;if($t(i,s,r)>=0)return!1;const a=i.x,c=s.x,u=r.x,d=i.y,l=s.y,h=r.y,f=a<c?a<u?a:u:c<u?c:u,p=d<l?d<h?d:h:l<h?l:h,g=a>c?a>u?a:u:c>u?c:u,m=d>l?d>h?d:h:l>h?l:h,v=zc(f,p,e,t,n),_=zc(g,m,e,t,n);let y=o.prevZ,x=o.nextZ;for(;y&&y.z>=v&&x&&x.z<=_;){if(y.x>=f&&y.x<=g&&y.y>=p&&y.y<=m&&y!==i&&y!==r&&Tr(a,d,c,l,u,h,y.x,y.y)&&$t(y.prev,y,y.next)>=0||(y=y.prevZ,x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==i&&x!==r&&Tr(a,d,c,l,u,h,x.x,x.y)&&$t(x.prev,x,x.next)>=0))return!1;x=x.nextZ}for(;y&&y.z>=v;){if(y.x>=f&&y.x<=g&&y.y>=p&&y.y<=m&&y!==i&&y!==r&&Tr(a,d,c,l,u,h,y.x,y.y)&&$t(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;x&&x.z<=_;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=m&&x!==i&&x!==r&&Tr(a,d,c,l,u,h,x.x,x.y)&&$t(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Uw(o,e,t){let n=o;do{const i=n.prev,s=n.next.next;!yl(i,s)&&bp(i,n,n.next,s)&&Bo(i,s)&&Bo(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),Uo(n),Uo(n.next),n=o=s),n=n.next}while(n!==o);return qs(n)}function zw(o,e,t,n,i,s){let r=o;do{let a=r.next.next;for(;a!==r.prev;){if(r.i!==a.i&&$w(r,a)){let c=Mp(r,a);r=qs(r,r.next),c=qs(c,c.next),Oo(r,e,t,n,i,s,0),Oo(c,e,t,n,i,s,0);return}a=a.next}r=r.next}while(r!==o)}function Vw(o,e,t,n){const i=[];let s,r,a,c,u;for(s=0,r=e.length;s<r;s++)a=e[s]*n,c=s<r-1?e[s+1]*n:o.length,u=wp(o,a,c,n,!1),u===u.next&&(u.steiner=!0),i.push(Yw(u));for(i.sort(Hw),s=0;s<i.length;s++)t=Gw(i[s],t);return t}function Hw(o,e){return o.x-e.x}function Gw(o,e){const t=Ww(o,e);if(!t)return e;const n=Mp(t,o);return qs(n,n.next),qs(t,t.next)}function Ww(o,e){let t=e,n=-1/0,i;const s=o.x,r=o.y;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const h=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=s&&h>n&&(n=h,i=t.x<t.next.x?t:t.next,h===s))return i}t=t.next}while(t!==e);if(!i)return null;const a=i,c=i.x,u=i.y;let d=1/0,l;t=i;do s>=t.x&&t.x>=c&&s!==t.x&&Tr(r<u?s:n,r,c,u,r<u?n:s,r,t.x,t.y)&&(l=Math.abs(r-t.y)/(s-t.x),Bo(t,o)&&(l<d||l===d&&(t.x>i.x||t.x===i.x&&Xw(i,t)))&&(i=t,d=l)),t=t.next;while(t!==a);return i}function Xw(o,e){return $t(o.prev,o,e.prev)<0&&$t(e.next,o,o.next)<0}function jw(o,e,t,n){let i=o;do i.z===0&&(i.z=zc(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==o);i.prevZ.nextZ=null,i.prevZ=null,qw(i)}function qw(o){let e,t,n,i,s,r,a,c,u=1;do{for(t=o,o=null,s=null,r=0;t;){for(r++,n=t,a=0,e=0;e<u&&(a++,n=n.nextZ,!!n);e++);for(c=u;a>0||c>0&&n;)a!==0&&(c===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,a--):(i=n,n=n.nextZ,c--),s?s.nextZ=i:o=i,i.prevZ=s,s=i;t=n}s.nextZ=null,u*=2}while(r>1);return o}function zc(o,e,t,n,i){return o=(o-t)*i|0,e=(e-n)*i|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,o|e<<1}function Yw(o){let e=o,t=o;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==o);return t}function Tr(o,e,t,n,i,s,r,a){return(i-r)*(e-a)>=(o-r)*(s-a)&&(o-r)*(n-a)>=(t-r)*(e-a)&&(t-r)*(s-a)>=(i-r)*(n-a)}function $w(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!Kw(o,e)&&(Bo(o,e)&&Bo(e,o)&&Zw(o,e)&&($t(o.prev,o,e.prev)||$t(o,e.prev,e))||yl(o,e)&&$t(o.prev,o,o.next)>0&&$t(e.prev,e,e.next)>0)}function $t(o,e,t){return(e.y-o.y)*(t.x-e.x)-(e.x-o.x)*(t.y-e.y)}function yl(o,e){return o.x===e.x&&o.y===e.y}function bp(o,e,t,n){const i=Pa($t(o,e,t)),s=Pa($t(o,e,n)),r=Pa($t(t,n,o)),a=Pa($t(t,n,e));return!!(i!==s&&r!==a||i===0&&Ra(o,t,e)||s===0&&Ra(o,n,e)||r===0&&Ra(t,o,n)||a===0&&Ra(t,e,n))}function Ra(o,e,t){return e.x<=Math.max(o.x,t.x)&&e.x>=Math.min(o.x,t.x)&&e.y<=Math.max(o.y,t.y)&&e.y>=Math.min(o.y,t.y)}function Pa(o){return o>0?1:o<0?-1:0}function Kw(o,e){let t=o;do{if(t.i!==o.i&&t.next.i!==o.i&&t.i!==e.i&&t.next.i!==e.i&&bp(t,t.next,o,e))return!0;t=t.next}while(t!==o);return!1}function Bo(o,e){return $t(o.prev,o,o.next)<0?$t(o,e,o.next)>=0&&$t(o,o.prev,e)>=0:$t(o,e,o.prev)<0||$t(o,o.next,e)<0}function Zw(o,e){let t=o,n=!1;const i=(o.x+e.x)/2,s=(o.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==o);return n}function Mp(o,e){const t=new Vc(o.i,o.x,o.y),n=new Vc(e.i,e.x,e.y),i=o.next,s=e.prev;return o.next=e,e.prev=o,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function Fd(o,e,t,n){const i=new Vc(o,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Uo(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Vc(o,e,t){this.i=o,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qw(o,e,t,n){let i=0;for(let s=e,r=t-n;s<t;s+=n)i+=(o[r]-o[s])*(o[s+1]+o[r+1]),r=s;return i}class Ah{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return Ah.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];kd(e),Nd(n,e);let r=e.length;t.forEach(kd);for(let c=0;c<t.length;c++)i.push(r),r+=t[c].length,Nd(n,t[c]);const a=Nw.triangulate(n,i);for(let c=0;c<a.length;c+=3)s.push(a.slice(c,c+3));return s}}function kd(o){const e=o.length;e>2&&o[e-1].equals(o[0])&&o.pop()}function Nd(o,e){for(let t=0;t<e.length;t++)o.push(e[t].x),o.push(e[t].y)}class Cr extends Sh{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Cr(e.radius,e.detail)}}class xl extends Ft{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:r,thetaLength:a},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(r+a,Math.PI);let u=0;const d=[],l=new D,h=new D,f=[],p=[],g=[],m=[];for(let v=0;v<=n;v++){const _=[],y=v/n;let x=0;v===0&&r===0?x=.5/t:v===n&&c===Math.PI&&(x=-.5/t);for(let M=0;M<=t;M++){const S=M/t;l.x=-e*Math.cos(i+S*s)*Math.sin(r+y*a),l.y=e*Math.cos(r+y*a),l.z=e*Math.sin(i+S*s)*Math.sin(r+y*a),p.push(l.x,l.y,l.z),h.copy(l).normalize(),g.push(h.x,h.y,h.z),m.push(S+x,1-y),_.push(u++)}d.push(_)}for(let v=0;v<n;v++)for(let _=0;_<t;_++){const y=d[v][_+1],x=d[v][_],M=d[v+1][_],S=d[v+1][_+1];(v!==0||r>0)&&f.push(y,x,S),(v!==n-1||c<Math.PI)&&f.push(x,M,S)}this.setIndex(f),this.setAttribute("position",new yt(p,3)),this.setAttribute("normal",new yt(g,3)),this.setAttribute("uv",new yt(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xl(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Vs extends Ft{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const r=[],a=[],c=[],u=[],d=new D,l=new D,h=new D;for(let f=0;f<=n;f++)for(let p=0;p<=i;p++){const g=p/i*s,m=f/n*Math.PI*2;l.x=(e+t*Math.cos(m))*Math.cos(g),l.y=(e+t*Math.cos(m))*Math.sin(g),l.z=t*Math.sin(m),a.push(l.x,l.y,l.z),d.x=e*Math.cos(g),d.y=e*Math.sin(g),h.subVectors(l,d).normalize(),c.push(h.x,h.y,h.z),u.push(p/i),u.push(f/n)}for(let f=1;f<=n;f++)for(let p=1;p<=i;p++){const g=(i+1)*f+p-1,m=(i+1)*(f-1)+p-1,v=(i+1)*(f-1)+p,_=(i+1)*f+p;r.push(g,m,_),r.push(m,v,_)}this.setIndex(r),this.setAttribute("position",new yt(a,3)),this.setAttribute("normal",new yt(c,3)),this.setAttribute("uv",new yt(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Vs(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class wl extends Kn{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new He(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zo,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ht,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Li extends wl{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Fe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return un(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new He(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new He(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new He(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class ac extends Kn{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new He(16777215),this.specular=new He(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zo,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ht,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Hc extends Kn{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zo,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class Jw extends Kn{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new He(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new He(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Zo,this.normalScale=new Fe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new ht,this.combine=pl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}function La(o,e,t){return!o||!t&&o.constructor===e?o:typeof e.BYTES_PER_ELEMENT=="number"?new e(o):Array.prototype.slice.call(o)}function eb(o){return ArrayBuffer.isView(o)&&!(o instanceof DataView)}function tb(o){function e(i,s){return o[i]-o[s]}const t=o.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function Od(o,e,t){const n=o.length,i=new o.constructor(n);for(let s=0,r=0;r!==n;++s){const a=t[s]*e;for(let c=0;c!==e;++c)i[r++]=o[a+c]}return i}function Sp(o,e,t,n){let i=1,s=o[0];for(;s!==void 0&&s[n]===void 0;)s=o[i++];if(s===void 0)return;let r=s[n];if(r!==void 0)if(Array.isArray(r))do r=s[n],r!==void 0&&(e.push(s.time),t.push.apply(t,r)),s=o[i++];while(s!==void 0);else if(r.toArray!==void 0)do r=s[n],r!==void 0&&(e.push(s.time),r.toArray(t,t.length)),s=o[i++];while(s!==void 0);else do r=s[n],r!==void 0&&(e.push(s.time),t.push(r)),s=o[i++];while(s!==void 0)}class Jo{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];n:{e:{let r;t:{i:if(!(e<i)){for(let a=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(s=i,i=t[++n],e<i)break e}r=t.length;break t}if(!(e>=s)){const a=t[1];e<a&&(n=2,s=a);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=t[--n-1],e>=s)break e}r=n,n=0;break t}break n}for(;n<r;){const a=n+r>>>1;e<t[a]?r=a:n=a+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let r=0;r!==i;++r)t[r]=n[s+r];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class nb extends Jo{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Tu,endingEnd:Tu}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,r=e+1,a=i[s],c=i[r];if(a===void 0)switch(this.getSettings_().endingStart){case Cu:s=e,a=2*t-n;break;case Ru:s=i.length-2,a=t+i[s]-i[s+1];break;default:s=e,a=n}if(c===void 0)switch(this.getSettings_().endingEnd){case Cu:r=e,c=2*n-t;break;case Ru:r=1,c=n+i[1]-i[0];break;default:r=e-1,c=t}const u=(n-t)*.5,d=this.valueSize;this._weightPrev=u/(t-a),this._weightNext=u/(c-n),this._offsetPrev=s*d,this._offsetNext=r*d}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=e*a,u=c-a,d=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(i-t),g=p*p,m=g*p,v=-h*m+2*h*g-h*p,_=(1+h)*m+(-1.5-2*h)*g+(-.5+h)*p+1,y=(-1-f)*m+(1.5+f)*g+.5*p,x=f*m-f*g;for(let M=0;M!==a;++M)s[M]=v*r[d+M]+_*r[u+M]+y*r[c+M]+x*r[l+M];return s}}class ib extends Jo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=e*a,u=c-a,d=(n-t)/(i-t),l=1-d;for(let h=0;h!==a;++h)s[h]=r[u+h]*l+r[c+h]*d;return s}}class sb extends Jo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Ii{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=La(t,this.TimeBufferType),this.values=La(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:La(e.times,Array),values:La(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new sb(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ib(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new nb(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case ko:t=this.InterpolantFactoryMethodDiscrete;break;case Wr:t=this.InterpolantFactoryMethodLinear;break;case Il:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ko;case this.InterpolantFactoryMethodLinear:return Wr;case this.InterpolantFactoryMethodSmooth:return Il}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,r=i-1;for(;s!==i&&n[s]<e;)++s;for(;r!==-1&&n[r]>t;)--r;if(++r,s!==0||r!==i){s>=r&&(r=Math.max(r,1),s=r-1);const a=this.getValueSize();this.times=n.slice(s,r),this.values=this.values.slice(s*a,r*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let a=0;a!==s;a++){const c=n[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(r!==null&&r>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,r),e=!1;break}r=c}if(i!==void 0&&eb(i))for(let a=0,c=i.length;a!==c;++a){const u=i[a];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===Il,s=e.length-1;let r=1;for(let a=1;a<s;++a){let c=!1;const u=e[a],d=e[a+1];if(u!==d&&(a!==1||u!==e[0]))if(i)c=!0;else{const l=a*n,h=l-n,f=l+n;for(let p=0;p!==n;++p){const g=t[l+p];if(g!==t[h+p]||g!==t[f+p]){c=!0;break}}}if(c){if(a!==r){e[r]=e[a];const l=a*n,h=r*n;for(let f=0;f!==n;++f)t[h+f]=t[l+f]}++r}}if(s>0){e[r]=e[s];for(let a=s*n,c=r*n,u=0;u!==n;++u)t[c+u]=t[a+u];++r}return r!==e.length?(this.times=e.slice(0,r),this.values=t.slice(0,r*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Ii.prototype.TimeBufferType=Float32Array;Ii.prototype.ValueBufferType=Float32Array;Ii.prototype.DefaultInterpolation=Wr;class to extends Ii{}to.prototype.ValueTypeName="bool";to.prototype.ValueBufferType=Array;to.prototype.DefaultInterpolation=ko;to.prototype.InterpolantFactoryMethodLinear=void 0;to.prototype.InterpolantFactoryMethodSmooth=void 0;class Ap extends Ii{}Ap.prototype.ValueTypeName="color";class Ys extends Ii{}Ys.prototype.ValueTypeName="number";class rb extends Jo{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=(n-t)/(i-t);let u=e*a;for(let d=u+a;u!==d;u+=4)Lt.slerpFlat(s,0,r,u-a,r,u,c);return s}}class Yi extends Ii{InterpolantFactoryMethodLinear(e){return new rb(this.times,this.values,this.getValueSize(),e)}}Yi.prototype.ValueTypeName="quaternion";Yi.prototype.DefaultInterpolation=Wr;Yi.prototype.InterpolantFactoryMethodSmooth=void 0;class no extends Ii{}no.prototype.ValueTypeName="string";no.prototype.ValueBufferType=Array;no.prototype.DefaultInterpolation=ko;no.prototype.InterpolantFactoryMethodLinear=void 0;no.prototype.InterpolantFactoryMethodSmooth=void 0;class $s extends Ii{}$s.prototype.ValueTypeName="vector";class Ep{constructor(e="",t=-1,n=[],i=jg){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=pi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let r=0,a=n.length;r!==a;++r)t.push(ab(n[r]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,r=n.length;s!==r;++s)t.push(Ii.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,r=[];for(let a=0;a<s;a++){let c=[],u=[];c.push((a+s-1)%s,a,(a+1)%s),u.push(0,1,0);const d=tb(c);c=Od(c,1,d),u=Od(u,1,d),!i&&c[0]===0&&(c.push(s),u.push(u[0])),r.push(new Ys(".morphTargetInfluences["+t[a].name+"]",c,u).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){const u=e[a],d=u.name.match(s);if(d&&d.length>1){const l=d[1];let h=i[l];h||(i[l]=h=[]),h.push(u)}}const r=[];for(const a in i)r.push(this.CreateFromMorphTargetSequence(a,i[a],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(l,h,f,p,g){if(f.length!==0){const m=[],v=[];Sp(f,m,v,p),m.length!==0&&g.push(new l(h,m,v))}},i=[],s=e.name||"default",r=e.fps||30,a=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let l=0;l<u.length;l++){const h=u[l].keys;if(!(!h||h.length===0))if(h[0].morphTargets){const f={};let p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let g=0;g<h[p].morphTargets.length;g++)f[h[p].morphTargets[g]]=-1;for(const g in f){const m=[],v=[];for(let _=0;_!==h[p].morphTargets.length;++_){const y=h[p];m.push(y.time),v.push(y.morphTarget===g?1:0)}i.push(new Ys(".morphTargetInfluence["+g+"]",m,v))}c=f.length*r}else{const f=".bones["+t[l].name+"]";n($s,f+".position",h,"pos",i),n(Yi,f+".quaternion",h,"rot",i),n($s,f+".scale",h,"scl",i)}}return i.length===0?null:new this(s,c,i,a)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function ob(o){switch(o.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ys;case"vector":case"vector2":case"vector3":case"vector4":return $s;case"color":return Ap;case"quaternion":return Yi;case"bool":case"boolean":return to;case"string":return no}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+o)}function ab(o){if(o.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=ob(o.type);if(o.times===void 0){const t=[],n=[];Sp(o.keys,t,n,"value"),o.times=t,o.values=n}return e.parse!==void 0?e.parse(o):new e(o.name,o.times,o.values,o.interpolation)}const hs={enabled:!1,files:{},add:function(o,e){this.enabled!==!1&&(this.files[o]=e)},get:function(o){if(this.enabled!==!1)return this.files[o]},remove:function(o){delete this.files[o]},clear:function(){this.files={}}};class lb{constructor(e,t,n){const i=this;let s=!1,r=0,a=0,c;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(d){a++,s===!1&&i.onStart!==void 0&&i.onStart(d,r,a),s=!0},this.itemEnd=function(d){r++,i.onProgress!==void 0&&i.onProgress(d,r,a),r===a&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(d){i.onError!==void 0&&i.onError(d)},this.resolveURL=function(d){return c?c(d):d},this.setURLModifier=function(d){return c=d,this},this.addHandler=function(d,l){return u.push(d,l),this},this.removeHandler=function(d){const l=u.indexOf(d);return l!==-1&&u.splice(l,2),this},this.getHandler=function(d){for(let l=0,h=u.length;l<h;l+=2){const f=u[l],p=u[l+1];if(f.global&&(f.lastIndex=0),f.test(d))return p}return null}}}const cb=new lb;class Ci{constructor(e){this.manager=e!==void 0?e:cb,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Ci.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ui={};class hb extends Error{constructor(e,t){super(e),this.response=t}}class zo extends Ci{constructor(e){super(e)}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=hs.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Ui[e]!==void 0){Ui[e].push({onLoad:t,onProgress:n,onError:i});return}Ui[e]=[],Ui[e].push({onLoad:t,onProgress:n,onError:i});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(r).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const d=Ui[e],l=u.body.getReader(),h=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),f=h?parseInt(h):0,p=f!==0;let g=0;const m=new ReadableStream({start(v){_();function _(){l.read().then(({done:y,value:x})=>{if(y)v.close();else{g+=x.byteLength;const M=new ProgressEvent("progress",{lengthComputable:p,loaded:g,total:f});for(let S=0,A=d.length;S<A;S++){const T=d[S];T.onProgress&&T.onProgress(M)}v.enqueue(x),_()}})}}});return new Response(m)}else throw new hb(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(d=>new DOMParser().parseFromString(d,a));case"json":return u.json();default:if(a===void 0)return u.text();{const l=/charset="?([^;"\s]*)"?/i.exec(a),h=l&&l[1]?l[1].toLowerCase():void 0,f=new TextDecoder(h);return u.arrayBuffer().then(p=>f.decode(p))}}}).then(u=>{hs.add(e,u);const d=Ui[e];delete Ui[e];for(let l=0,h=d.length;l<h;l++){const f=d[l];f.onLoad&&f.onLoad(u)}}).catch(u=>{const d=Ui[e];if(d===void 0)throw this.manager.itemError(e),u;delete Ui[e];for(let l=0,h=d.length;l<h;l++){const f=d[l];f.onError&&f.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ub extends Ci{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=hs.get(e);if(r!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(r),s.manager.itemEnd(e)},0),r;const a=No("img");function c(){d(),hs.add(e,this),t&&t(this),s.manager.itemEnd(e)}function u(l){d(),i&&i(l),s.manager.itemError(e),s.manager.itemEnd(e)}function d(){a.removeEventListener("load",c,!1),a.removeEventListener("error",u,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class Tp extends Ci{constructor(e){super(e)}load(e,t,n,i){const s=new qt,r=new ub(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class bl extends et{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new He(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const lc=new Ye,Bd=new D,Ud=new D;class Eh{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Fe(512,512),this.map=null,this.mapPass=null,this.matrix=new Ye,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new xh,this._frameExtents=new Fe(1,1),this._viewportCount=1,this._viewports=[new At(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Bd.setFromMatrixPosition(e.matrixWorld),t.position.copy(Bd),Ud.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Ud),t.updateMatrixWorld(),lc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(lc)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class db extends Eh{constructor(){super(new Tn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=Xr*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class Cp extends bl{constructor(e,t,n=0,i=Math.PI/3,s=0,r=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(et.DEFAULT_UP),this.updateMatrix(),this.target=new et,this.distance=n,this.angle=i,this.penumbra=s,this.decay=r,this.map=null,this.shadow=new db}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const zd=new Ye,ho=new D,cc=new D;class fb extends Eh{constructor(){super(new Tn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Fe(4,2),this._viewportCount=6,this._viewports=[new At(2,1,1,1),new At(0,1,1,1),new At(3,1,1,1),new At(1,1,1,1),new At(3,0,1,1),new At(1,0,1,1)],this._cubeDirections=[new D(1,0,0),new D(-1,0,0),new D(0,0,1),new D(0,0,-1),new D(0,1,0),new D(0,-1,0)],this._cubeUps=[new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,1,0),new D(0,0,1),new D(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),ho.setFromMatrixPosition(e.matrixWorld),n.position.copy(ho),cc.copy(n.position),cc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(cc),n.updateMatrixWorld(),i.makeTranslation(-ho.x,-ho.y,-ho.z),zd.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(zd)}}class Gc extends bl{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new fb}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class pb extends Eh{constructor(){super(new Qo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Rp extends bl{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(et.DEFAULT_UP),this.updateMatrix(),this.target=new et,this.shadow=new pb}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class mb extends bl{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class Nr{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class gb extends Ci{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=hs.get(e);if(r!==void 0){if(s.manager.itemStart(e),r.then){r.then(u=>{t&&t(u),s.manager.itemEnd(e)}).catch(u=>{i&&i(u)});return}return setTimeout(function(){t&&t(r),s.manager.itemEnd(e)},0),r}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader;const c=fetch(e,a).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return hs.add(e,u),t&&t(u),s.manager.itemEnd(e),u}).catch(function(u){i&&i(u),hs.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});hs.add(e,c),s.manager.itemStart(e)}}class vb{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Vd(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Vd();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Vd(){return(typeof performance>"u"?Date:performance).now()}const Th="\\[\\]\\.:\\/",_b=new RegExp("["+Th+"]","g"),Ch="[^"+Th+"]",yb="[^"+Th.replace("\\.","")+"]",xb=/((?:WC+[\/:])*)/.source.replace("WC",Ch),wb=/(WCOD+)?/.source.replace("WCOD",yb),bb=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ch),Mb=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ch),Sb=new RegExp("^"+xb+wb+bb+Mb+"$"),Ab=["material","materials","bones","map"];class Eb{constructor(e,t,n){const i=n||bt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class bt{constructor(e,t,n){this.path=t,this.parsedPath=n||bt.parseTrackName(t),this.node=bt.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new bt.Composite(e,t,n):new bt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_b,"")}static parseTrackName(e){const t=Sb.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);Ab.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let r=0;r<s.length;r++){const a=s[r];if(a.name===t||a.uuid===t)return a;const c=n(a.children);if(c)return c}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=bt.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let d=0;d<e.length;d++)if(e[d].name===u){u=d;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const r=e[i];if(r===void 0){const u=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else r.fromArray!==void 0&&r.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(c=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}bt.Composite=Eb;bt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};bt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};bt.prototype.GetterByBindingType=[bt.prototype._getValue_direct,bt.prototype._getValue_array,bt.prototype._getValue_arrayElement,bt.prototype._getValue_toArray];bt.prototype.SetterByBindingTypeAndVersioning=[[bt.prototype._setValue_direct,bt.prototype._setValue_direct_setNeedsUpdate,bt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_array,bt.prototype._setValue_array_setNeedsUpdate,bt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_arrayElement,bt.prototype._setValue_arrayElement_setNeedsUpdate,bt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bt.prototype._setValue_fromArray,bt.prototype._setValue_fromArray_setNeedsUpdate,bt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];const Hd=new Ye;class Rh{constructor(e,t,n=0,i=1/0){this.ray=new Qr(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new _h,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Hd.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Hd),this}intersectObject(e,t=!0,n=[]){return Wc(e,this,n,t),n.sort(Gd),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)Wc(e[i],this,n,t);return n.sort(Gd),n}}function Gd(o,e){return o.distance-e.distance}function Wc(o,e,t,n){if(o.layers.test(e.layers)&&o.raycast(e,t),n===!0){const i=o.children;for(let s=0,r=i.length;s<r;s++)Wc(i[s],e,t,!0)}}class Wd{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(un(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}const Xd=new D;let Ia,hc;class Tb extends et{constructor(e=new D(0,0,1),t=new D(0,0,0),n=1,i=16776960,s=n*.2,r=s*.2){super(),this.type="ArrowHelper",Ia===void 0&&(Ia=new Ft,Ia.setAttribute("position",new yt([0,0,0,0,1,0],3)),hc=new hn(0,.5,1,5,1),hc.translate(0,-.5,0)),this.position.copy(t),this.line=new Xn(Ia,new eo({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Se(hc,new Mt({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Xd.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Xd,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class Cb extends yp{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Ft;i.setAttribute("position",new yt(t,3)),i.setAttribute("color",new yt(n,3));const s=new eo({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new He,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:mh}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=mh);function Rb(o){if(!(typeof window>"u")){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=o,document.head.appendChild(e),o}}function Rr(o,e){var t=o.__state.conversionName.toString(),n=Math.round(o.r),i=Math.round(o.g),s=Math.round(o.b),r=o.a,a=Math.round(o.h),c=o.s.toFixed(1),u=o.v.toFixed(1);if(e||t==="THREE_CHAR_HEX"||t==="SIX_CHAR_HEX"){for(var d=o.hex.toString(16);d.length<6;)d="0"+d;return"#"+d}else{if(t==="CSS_RGB")return"rgb("+n+","+i+","+s+")";if(t==="CSS_RGBA")return"rgba("+n+","+i+","+s+","+r+")";if(t==="HEX")return"0x"+o.hex.toString(16);if(t==="RGB_ARRAY")return"["+n+","+i+","+s+"]";if(t==="RGBA_ARRAY")return"["+n+","+i+","+s+","+r+"]";if(t==="RGB_OBJ")return"{r:"+n+",g:"+i+",b:"+s+"}";if(t==="RGBA_OBJ")return"{r:"+n+",g:"+i+",b:"+s+",a:"+r+"}";if(t==="HSV_OBJ")return"{h:"+a+",s:"+c+",v:"+u+"}";if(t==="HSVA_OBJ")return"{h:"+a+",s:"+c+",v:"+u+",a:"+r+"}"}return"unknown format"}var jd=Array.prototype.forEach,uo=Array.prototype.slice,be={BREAK:{},extend:function(e){return this.each(uo.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach((function(i){this.isUndefined(t[i])||(e[i]=t[i])}).bind(this))},this),e},defaults:function(e){return this.each(uo.call(arguments,1),function(t){var n=this.isObject(t)?Object.keys(t):[];n.forEach((function(i){this.isUndefined(e[i])&&(e[i]=t[i])}).bind(this))},this),e},compose:function(){var e=uo.call(arguments);return function(){for(var t=uo.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e){if(jd&&e.forEach&&e.forEach===jd)e.forEach(t,n);else if(e.length===e.length+0){var i=void 0,s=void 0;for(i=0,s=e.length;i<s;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return}},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var s=this,r=arguments;function a(){i=null,n||e.apply(s,r)}var c=n||!i;clearTimeout(i),i=setTimeout(a,t),c&&e.apply(s,r)}},toArray:function(e){return e.toArray?e.toArray():uo.call(e)},isUndefined:function(e){return e===void 0},isNull:function(e){return e===null},isNaN:function(o){function e(t){return o.apply(this,arguments)}return e.toString=function(){return o.toString()},e}(function(o){return isNaN(o)}),isArray:Array.isArray||function(o){return o.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return e===!1||e===!0},isFunction:function(e){return e instanceof Function}},Pb=[{litmus:be.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:Rr},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return t===null?!1:{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:Rr},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:Rr},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return t===null?!1:{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:Rr}}},{litmus:be.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:be.isArray,conversions:{RGB_ARRAY:{read:function(e){return e.length!==3?!1:{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return e.length!==4?!1:{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:be.isObject,conversions:{RGBA_OBJ:{read:function(e){return be.isNumber(e.r)&&be.isNumber(e.g)&&be.isNumber(e.b)&&be.isNumber(e.a)?{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return be.isNumber(e.r)&&be.isNumber(e.g)&&be.isNumber(e.b)?{space:"RGB",r:e.r,g:e.g,b:e.b}:!1},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return be.isNumber(e.h)&&be.isNumber(e.s)&&be.isNumber(e.v)&&be.isNumber(e.a)?{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return be.isNumber(e.h)&&be.isNumber(e.s)&&be.isNumber(e.v)?{space:"HSV",h:e.h,s:e.s,v:e.v}:!1},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],fo=void 0,Da=void 0,Xc=function(){Da=!1;var e=arguments.length>1?be.toArray(arguments):arguments[0];return be.each(Pb,function(t){if(t.litmus(e))return be.each(t.conversions,function(n,i){if(fo=n.read(e),Da===!1&&fo!==!1)return Da=fo,fo.conversionName=i,fo.conversion=n,be.BREAK}),be.BREAK}),Da},qd=void 0,rl={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,s=e/60-Math.floor(e/60),r=n*(1-t),a=n*(1-s*t),c=n*(1-(1-s)*t),u=[[n,c,r],[a,n,r],[r,n,c],[r,a,n],[c,r,n],[n,r,a]][i];return{r:u[0]*255,g:u[1]*255,b:u[2]*255}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),s=Math.max(e,t,n),r=s-i,a=void 0,c=void 0;if(s!==0)c=r/s;else return{h:NaN,s:0,v:0};return e===s?a=(t-n)/r:t===s?a=2+(n-e)/r:a=4+(e-t)/r,a/=6,a<0&&(a+=1),{h:a*360,s:c,v:s/255}},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n),i},component_from_hex:function(e,t){return e>>t*8&255},hex_with_component:function(e,t,n){return n<<(qd=t*8)|e&~(255<<qd)}},Lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},mi=function(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")},gi=function(){function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),xs=function o(e,t,n){e===null&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===void 0){var s=Object.getPrototypeOf(e);return s===null?void 0:o(s,t,n)}else{if("value"in i)return i.value;var r=i.get;return r===void 0?void 0:r.call(n)}},Ms=function(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);o.prototype=Object.create(e&&e.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(o,e):o.__proto__=e)},Ss=function(o,e){if(!o)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:o},vn=function(){function o(){if(mi(this,o),this.__state=Xc.apply(this,arguments),this.__state===!1)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return gi(o,[{key:"toString",value:function(){return Rr(this)}},{key:"toHexString",value:function(){return Rr(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),o}();function Ph(o,e,t){Object.defineProperty(o,e,{get:function(){return this.__state.space==="RGB"?this.__state[e]:(vn.recalculateRGB(this,e,t),this.__state[e])},set:function(i){this.__state.space!=="RGB"&&(vn.recalculateRGB(this,e,t),this.__state.space="RGB"),this.__state[e]=i}})}function Lh(o,e){Object.defineProperty(o,e,{get:function(){return this.__state.space==="HSV"?this.__state[e]:(vn.recalculateHSV(this),this.__state[e])},set:function(n){this.__state.space!=="HSV"&&(vn.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=n}})}vn.recalculateRGB=function(o,e,t){if(o.__state.space==="HEX")o.__state[e]=rl.component_from_hex(o.__state.hex,t);else if(o.__state.space==="HSV")be.extend(o.__state,rl.hsv_to_rgb(o.__state.h,o.__state.s,o.__state.v));else throw new Error("Corrupted color state")};vn.recalculateHSV=function(o){var e=rl.rgb_to_hsv(o.r,o.g,o.b);be.extend(o.__state,{s:e.s,v:e.v}),be.isNaN(e.h)?be.isUndefined(o.__state.h)&&(o.__state.h=0):o.__state.h=e.h};vn.COMPONENTS=["r","g","b","h","s","v","hex","a"];Ph(vn.prototype,"r",2);Ph(vn.prototype,"g",1);Ph(vn.prototype,"b",0);Lh(vn.prototype,"h");Lh(vn.prototype,"s");Lh(vn.prototype,"v");Object.defineProperty(vn.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}});Object.defineProperty(vn.prototype,"hex",{get:function(){return this.__state.space!=="HEX"&&(this.__state.hex=rl.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var Js=function(){function o(e,t){mi(this,o),this.initialValue=e[t],this.domElement=document.createElement("div"),this.object=e,this.property=t,this.__onChange=void 0,this.__onFinishChange=void 0}return gi(o,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),o}(),Ib={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},Pp={};be.each(Ib,function(o,e){be.each(o,function(t){Pp[t]=e})});var Db=/(\d+(\.\d+)?)px/;function _i(o){if(o==="0"||be.isUndefined(o))return 0;var e=o.match(Db);return be.isNull(e)?0:parseFloat(e[1])}var ce={makeSelectable:function(e,t){e===void 0||e.style===void 0||(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,s=t;be.isUndefined(s)&&(s=!0),be.isUndefined(i)&&(i=!0),e.style.position="absolute",s&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var s=n||{},r=Pp[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":{var c=s.x||s.clientX||0,u=s.y||s.clientY||0;a.initMouseEvent(t,s.bubbles||!1,s.cancelable||!0,window,s.clickCount||1,0,0,c,u,!1,!1,!1,!1,0,null);break}case"KeyboardEvents":{var d=a.initKeyboardEvent||a.initKeyEvent;be.defaults(s,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),d(t,s.bubbles||!1,s.cancelable,window,s.ctrlKey,s.altKey,s.shiftKey,s.metaKey,s.keyCode,s.charCode);break}default:{a.initEvent(t,s.bubbles||!1,s.cancelable||!0);break}}be.defaults(a,i),e.dispatchEvent(a)},bind:function(e,t,n,i){var s=i||!1;return e.addEventListener?e.addEventListener(t,n,s):e.attachEvent&&e.attachEvent("on"+t,n),ce},unbind:function(e,t,n,i){var s=i||!1;return e.removeEventListener?e.removeEventListener(t,n,s):e.detachEvent&&e.detachEvent("on"+t,n),ce},addClass:function(e,t){if(e.className===void 0)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);n.indexOf(t)===-1&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return ce},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);i!==-1&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return ce},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return _i(t["border-left-width"])+_i(t["border-right-width"])+_i(t["padding-left"])+_i(t["padding-right"])+_i(t.width)},getHeight:function(e){var t=getComputedStyle(e);return _i(t["border-top-width"])+_i(t["border-bottom-width"])+_i(t["padding-top"])+_i(t["padding-bottom"])+_i(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent;while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},Lp=function(o){Ms(e,o);function e(t,n){mi(this,e);var i=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=i;i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox");function r(){s.setValue(!s.__prev)}return ce.bind(i.__checkbox,"change",r,!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return gi(e,[{key:"setValue",value:function(n){var i=xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),i}},{key:"updateDisplay",value:function(){return this.getValue()===!0?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Js),Fb=function(o){Ms(e,o);function e(t,n,i){mi(this,e);var s=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i,a=s;if(s.__select=document.createElement("select"),be.isArray(r)){var c={};be.each(r,function(u){c[u]=u}),r=c}return be.each(r,function(u,d){var l=document.createElement("option");l.innerHTML=d,l.setAttribute("value",u),a.__select.appendChild(l)}),s.updateDisplay(),ce.bind(s.__select,"change",function(){var u=this.options[this.selectedIndex].value;a.setValue(u)}),s.domElement.appendChild(s.__select),s}return gi(e,[{key:"setValue",value:function(n){var i=xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),i}},{key:"updateDisplay",value:function(){return ce.isActive(this.__select)?this:(this.__select.value=this.getValue(),xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(Js),kb=function(o){Ms(e,o);function e(t,n){mi(this,e);var i=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),s=i;function r(){s.setValue(s.__input.value)}function a(){s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),ce.bind(i.__input,"keyup",r),ce.bind(i.__input,"change",r),ce.bind(i.__input,"blur",a),ce.bind(i.__input,"keydown",function(c){c.keyCode===13&&this.blur()}),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return gi(e,[{key:"updateDisplay",value:function(){return ce.isActive(this.__input)||(this.__input.value=this.getValue()),xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Js);function Yd(o){var e=o.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Ip=function(o){Ms(e,o);function e(t,n,i){mi(this,e);var s=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i||{};return s.__min=r.min,s.__max=r.max,s.__step=r.step,be.isUndefined(s.__step)?s.initialValue===0?s.__impliedStep=1:s.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(s.initialValue))/Math.LN10))/10:s.__impliedStep=s.__step,s.__precision=Yd(s.__impliedStep),s}return gi(e,[{key:"setValue",value:function(n){var i=n;return this.__min!==void 0&&i<this.__min?i=this.__min:this.__max!==void 0&&i>this.__max&&(i=this.__max),this.__step!==void 0&&i%this.__step!==0&&(i=Math.round(i/this.__step)*this.__step),xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,i)}},{key:"min",value:function(n){return this.__min=n,this}},{key:"max",value:function(n){return this.__max=n,this}},{key:"step",value:function(n){return this.__step=n,this.__impliedStep=n,this.__precision=Yd(n),this}}]),e}(Js);function Nb(o,e){var t=Math.pow(10,e);return Math.round(o*t)/t}var ol=function(o){Ms(e,o);function e(t,n,i){mi(this,e);var s=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i));s.__truncationSuspended=!1;var r=s,a=void 0;function c(){var p=parseFloat(r.__input.value);be.isNaN(p)||r.setValue(p)}function u(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function d(){u()}function l(p){var g=a-p.clientY;r.setValue(r.getValue()+g*r.__impliedStep),a=p.clientY}function h(){ce.unbind(window,"mousemove",l),ce.unbind(window,"mouseup",h),u()}function f(p){ce.bind(window,"mousemove",l),ce.bind(window,"mouseup",h),a=p.clientY}return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),ce.bind(s.__input,"change",c),ce.bind(s.__input,"blur",d),ce.bind(s.__input,"mousedown",f),ce.bind(s.__input,"keydown",function(p){p.keyCode===13&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,u())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return gi(e,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():Nb(this.getValue(),this.__precision),xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ip);function $d(o,e,t,n,i){return n+(i-n)*((o-e)/(t-e))}var jc=function(o){Ms(e,o);function e(t,n,i,s,r){mi(this,e);var a=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:i,max:s,step:r})),c=a;a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),ce.bind(a.__background,"mousedown",u),ce.bind(a.__background,"touchstart",h),ce.addClass(a.__background,"slider"),ce.addClass(a.__foreground,"slider-fg");function u(g){document.activeElement.blur(),ce.bind(window,"mousemove",d),ce.bind(window,"mouseup",l),d(g)}function d(g){g.preventDefault();var m=c.__background.getBoundingClientRect();return c.setValue($d(g.clientX,m.left,m.right,c.__min,c.__max)),!1}function l(){ce.unbind(window,"mousemove",d),ce.unbind(window,"mouseup",l),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function h(g){g.touches.length===1&&(ce.bind(window,"touchmove",f),ce.bind(window,"touchend",p),f(g))}function f(g){var m=g.touches[0].clientX,v=c.__background.getBoundingClientRect();c.setValue($d(m,v.left,v.right,c.__min,c.__max))}function p(){ce.unbind(window,"touchmove",f),ce.unbind(window,"touchend",p),c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}return a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return gi(e,[{key:"updateDisplay",value:function(){var n=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=n*100+"%",xs(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ip),Dp=function(o){Ms(e,o);function e(t,n,i){mi(this,e);var s=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=s;return s.__button=document.createElement("div"),s.__button.innerHTML=i===void 0?"Fire":i,ce.bind(s.__button,"click",function(a){return a.preventDefault(),r.fire(),!1}),ce.addClass(s.__button,"button"),s.domElement.appendChild(s.__button),s}return gi(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(Js),qc=function(o){Ms(e,o);function e(t,n){mi(this,e);var i=Ss(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));i.__color=new vn(i.getValue()),i.__temp=new vn(0);var s=i;i.domElement=document.createElement("div"),ce.makeSelectable(i.domElement,!1),i.__selector=document.createElement("div"),i.__selector.className="selector",i.__saturation_field=document.createElement("div"),i.__saturation_field.className="saturation-field",i.__field_knob=document.createElement("div"),i.__field_knob.className="field-knob",i.__field_knob_border="2px solid ",i.__hue_knob=document.createElement("div"),i.__hue_knob.className="hue-knob",i.__hue_field=document.createElement("div"),i.__hue_field.className="hue-field",i.__input=document.createElement("input"),i.__input.type="text",i.__input_textShadow="0 1px 1px ",ce.bind(i.__input,"keydown",function(g){g.keyCode===13&&l.call(this)}),ce.bind(i.__input,"blur",l),ce.bind(i.__selector,"mousedown",function(){ce.addClass(this,"drag").bind(window,"mouseup",function(){ce.removeClass(s.__selector,"drag")})}),ce.bind(i.__selector,"touchstart",function(){ce.addClass(this,"drag").bind(window,"touchend",function(){ce.removeClass(s.__selector,"drag")})});var r=document.createElement("div");be.extend(i.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),be.extend(i.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:i.__field_knob_border+(i.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),be.extend(i.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),be.extend(i.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),be.extend(r.style,{width:"100%",height:"100%",background:"none"}),Kd(r,"top","rgba(0,0,0,0)","#000"),be.extend(i.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),Bb(i.__hue_field),be.extend(i.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:i.__input_textShadow+"rgba(0,0,0,0.7)"}),ce.bind(i.__saturation_field,"mousedown",a),ce.bind(i.__saturation_field,"touchstart",a),ce.bind(i.__field_knob,"mousedown",a),ce.bind(i.__field_knob,"touchstart",a),ce.bind(i.__hue_field,"mousedown",c),ce.bind(i.__hue_field,"touchstart",c);function a(g){f(g),ce.bind(window,"mousemove",f),ce.bind(window,"touchmove",f),ce.bind(window,"mouseup",u),ce.bind(window,"touchend",u)}function c(g){p(g),ce.bind(window,"mousemove",p),ce.bind(window,"touchmove",p),ce.bind(window,"mouseup",d),ce.bind(window,"touchend",d)}function u(){ce.unbind(window,"mousemove",f),ce.unbind(window,"touchmove",f),ce.unbind(window,"mouseup",u),ce.unbind(window,"touchend",u),h()}function d(){ce.unbind(window,"mousemove",p),ce.unbind(window,"touchmove",p),ce.unbind(window,"mouseup",d),ce.unbind(window,"touchend",d),h()}function l(){var g=Xc(this.value);g!==!1?(s.__color.__state=g,s.setValue(s.__color.toOriginal())):this.value=s.__color.toString()}function h(){s.__onFinishChange&&s.__onFinishChange.call(s,s.__color.toOriginal())}i.__saturation_field.appendChild(r),i.__selector.appendChild(i.__field_knob),i.__selector.appendChild(i.__saturation_field),i.__selector.appendChild(i.__hue_field),i.__hue_field.appendChild(i.__hue_knob),i.domElement.appendChild(i.__input),i.domElement.appendChild(i.__selector),i.updateDisplay();function f(g){g.type.indexOf("touch")===-1&&g.preventDefault();var m=s.__saturation_field.getBoundingClientRect(),v=g.touches&&g.touches[0]||g,_=v.clientX,y=v.clientY,x=(_-m.left)/(m.right-m.left),M=1-(y-m.top)/(m.bottom-m.top);return M>1?M=1:M<0&&(M=0),x>1?x=1:x<0&&(x=0),s.__color.v=M,s.__color.s=x,s.setValue(s.__color.toOriginal()),!1}function p(g){g.type.indexOf("touch")===-1&&g.preventDefault();var m=s.__hue_field.getBoundingClientRect(),v=g.touches&&g.touches[0]||g,_=v.clientY,y=1-(_-m.top)/(m.bottom-m.top);return y>1?y=1:y<0&&(y=0),s.__color.h=y*360,s.setValue(s.__color.toOriginal()),!1}return i}return gi(e,[{key:"updateDisplay",value:function(){var n=Xc(this.getValue());if(n!==!1){var i=!1;be.each(vn.COMPONENTS,function(a){if(!be.isUndefined(n[a])&&!be.isUndefined(this.__color.__state[a])&&n[a]!==this.__color.__state[a])return i=!0,{}},this),i&&be.extend(this.__color.__state,n)}be.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var s=this.__color.v<.5||this.__color.s>.5?255:0,r=255-s;be.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+s+","+s+","+s+")"}),this.__hue_knob.style.marginTop=(1-this.__color.h/360)*100+"px",this.__temp.s=1,this.__temp.v=1,Kd(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),be.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+s+","+s+","+s+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),e}(Js),Ob=["-moz-","-o-","-webkit-","-ms-",""];function Kd(o,e,t,n){o.style.background="",be.each(Ob,function(i){o.style.cssText+="background: "+i+"linear-gradient("+e+", "+t+" 0%, "+n+" 100%); "})}function Bb(o){o.style.background="",o.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",o.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",o.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var Ub={load:function(e,t){var n=t||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var s=n.getElementsByTagName("head")[0];try{s.appendChild(i)}catch{}}},zb=`<div id="dg-save" class="dg dialogue">

  Here's the new load parameter for your <code>GUI</code>'s constructor:

  <textarea id="dg-new-constructor"></textarea>

  <div id="dg-save-locally">

    <input id="dg-local-storage" type="checkbox"/> Automatically save
    values to <code>localStorage</code> on exit.

    <div id="dg-local-explain">The values saved to <code>localStorage</code> will
      override those passed to <code>dat.GUI</code>'s constructor. This makes it
      easier to work incrementally, but <code>localStorage</code> is fragile,
      and your friends may not see the same values you do.

    </div>

  </div>

</div>`,Vb=function(e,t){var n=e[t];return be.isArray(arguments[2])||be.isObject(arguments[2])?new Fb(e,t,arguments[2]):be.isNumber(n)?be.isNumber(arguments[2])&&be.isNumber(arguments[3])?be.isNumber(arguments[4])?new jc(e,t,arguments[2],arguments[3],arguments[4]):new jc(e,t,arguments[2],arguments[3]):be.isNumber(arguments[4])?new ol(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new ol(e,t,{min:arguments[2],max:arguments[3]}):be.isString(n)?new kb(e,t):be.isFunction(n)?new Dp(e,t,""):be.isBoolean(n)?new Lp(e,t):null};function Hb(o){setTimeout(o,1e3/60)}var Gb=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||Hb,Wb=function(){function o(){mi(this,o),this.backgroundElement=document.createElement("div"),be.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),ce.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),be.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;ce.bind(this.backgroundElement,"click",function(){e.hide()})}return gi(o,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),be.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var t=this,n=function i(){t.domElement.style.display="none",t.backgroundElement.style.display="none",ce.unbind(t.domElement,"webkitTransitionEnd",i),ce.unbind(t.domElement,"transitionend",i),ce.unbind(t.domElement,"oTransitionEnd",i)};ce.bind(this.domElement,"webkitTransitionEnd",n),ce.bind(this.domElement,"transitionend",n),ce.bind(this.domElement,"oTransitionEnd",n),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-ce.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-ce.getHeight(this.domElement)/2+"px"}}]),o}(),Xb=Rb(`.dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}
`);Ub.inject(Xb);var Zd="dg",Qd=72,Jd=20,Vo="Default",wo=function(){try{return!!window.localStorage}catch{return!1}}(),Co=void 0,ef=!0,Sr=void 0,uc=!1,Fp=[],Ot=function o(e){var t=this,n=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),ce.addClass(this.domElement,Zd),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],n=be.defaults(n,{closeOnTop:!1,autoPlace:!0,width:o.DEFAULT_WIDTH}),n=be.defaults(n,{resizable:n.autoPlace,hideable:n.autoPlace}),be.isUndefined(n.load)?n.load={preset:Vo}:n.preset&&(n.load.preset=n.preset),be.isUndefined(n.parent)&&n.hideable&&Fp.push(this),n.resizable=be.isUndefined(n.parent)&&n.resizable,n.autoPlace&&be.isUndefined(n.scrollable)&&(n.scrollable=!0);var i=wo&&localStorage.getItem(Ar(this,"isLocal"))==="true",s=void 0,r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return n.parent}},scrollable:{get:function(){return n.scrollable}},autoPlace:{get:function(){return n.autoPlace}},closeOnTop:{get:function(){return n.closeOnTop}},preset:{get:function(){return t.parent?t.getRoot().preset:n.load.preset},set:function(h){t.parent?t.getRoot().preset=h:n.load.preset=h,$b(this),t.revert()}},width:{get:function(){return n.width},set:function(h){n.width=h,Kc(t,h)}},name:{get:function(){return n.name},set:function(h){n.name=h,r&&(r.innerHTML=n.name)}},closed:{get:function(){return n.closed},set:function(h){n.closed=h,n.closed?ce.addClass(t.__ul,o.CLASS_CLOSED):ce.removeClass(t.__ul,o.CLASS_CLOSED),this.onResize(),t.__closeButton&&(t.__closeButton.innerHTML=h?o.TEXT_OPEN:o.TEXT_CLOSED)}},load:{get:function(){return n.load}},useLocalStorage:{get:function(){return i},set:function(h){wo&&(i=h,h?ce.bind(window,"unload",s):ce.unbind(window,"unload",s),localStorage.setItem(Ar(t,"isLocal"),h))}}}),be.isUndefined(n.parent)){if(this.closed=n.closed||!1,ce.addClass(this.domElement,o.CLASS_MAIN),ce.makeSelectable(this.domElement,!1),wo&&i){t.useLocalStorage=!0;var a=localStorage.getItem(Ar(this,"gui"));a&&(n.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=o.TEXT_CLOSED,ce.addClass(this.__closeButton,o.CLASS_CLOSE_BUTTON),n.closeOnTop?(ce.addClass(this.__closeButton,o.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(ce.addClass(this.__closeButton,o.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),ce.bind(this.__closeButton,"click",function(){t.closed=!t.closed})}else{n.closed===void 0&&(n.closed=!0);var c=document.createTextNode(n.name);ce.addClass(c,"controller-name"),r=Ih(t,c);var u=function(h){return h.preventDefault(),t.closed=!t.closed,!1};ce.addClass(this.__ul,o.CLASS_CLOSED),ce.addClass(r,"title"),ce.bind(r,"click",u),n.closed||(this.closed=!1)}n.autoPlace&&(be.isUndefined(n.parent)&&(ef&&(Sr=document.createElement("div"),ce.addClass(Sr,Zd),ce.addClass(Sr,o.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(Sr),ef=!1),Sr.appendChild(this.domElement),ce.addClass(this.domElement,o.CLASS_AUTO_PLACE)),this.parent||Kc(t,n.width)),this.__resizeHandler=function(){t.onResizeDebounced()},ce.bind(window,"resize",this.__resizeHandler),ce.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),ce.bind(this.__ul,"transitionend",this.__resizeHandler),ce.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),n.resizable&&Yb(this),s=function(){wo&&localStorage.getItem(Ar(t,"isLocal"))==="true"&&localStorage.setItem(Ar(t,"gui"),JSON.stringify(t.getSaveObject()))},this.saveToLocalStorageIfPossible=s;function d(){var l=t.getRoot();l.width+=1,be.defer(function(){l.width-=1})}n.parent||d()};Ot.toggleHide=function(){uc=!uc,be.each(Fp,function(o){o.domElement.style.display=uc?"none":""})};Ot.CLASS_AUTO_PLACE="a";Ot.CLASS_AUTO_PLACE_CONTAINER="ac";Ot.CLASS_MAIN="main";Ot.CLASS_CONTROLLER_ROW="cr";Ot.CLASS_TOO_TALL="taller-than-window";Ot.CLASS_CLOSED="closed";Ot.CLASS_CLOSE_BUTTON="close-button";Ot.CLASS_CLOSE_TOP="close-top";Ot.CLASS_CLOSE_BOTTOM="close-bottom";Ot.CLASS_DRAG="drag";Ot.DEFAULT_WIDTH=245;Ot.TEXT_CLOSED="Close Controls";Ot.TEXT_OPEN="Open Controls";Ot._keydownHandler=function(o){document.activeElement.type!=="text"&&(o.which===Qd||o.keyCode===Qd)&&Ot.toggleHide()};ce.bind(window,"keydown",Ot._keydownHandler,!1);be.extend(Ot.prototype,{add:function(e,t){return Ro(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return Ro(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;be.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&Sr.removeChild(this.domElement);var e=this;be.each(this.__folders,function(t){e.removeFolder(t)}),ce.unbind(window,"keydown",Ot._keydownHandler,!1),tf(this)},addFolder:function(e){if(this.__folders[e]!==void 0)throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Ot(t);this.__folders[e]=n;var i=Ih(this,n.domElement);return ce.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],tf(e);var t=this;be.each(e.__folders,function(n){e.removeFolder(n)}),be.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=ce.getOffset(e.__ul).top,n=0;be.each(e.__ul.childNodes,function(i){e.autoPlace&&i===e.__save_row||(n+=ce.getHeight(i))}),window.innerHeight-t-Jd<n?(ce.addClass(e.domElement,Ot.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-Jd+"px"):(ce.removeClass(e.domElement,Ot.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&be.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:be.debounce(function(){this.onResize()},50),remember:function(){if(be.isUndefined(Co)&&(Co=new Wb,Co.domElement.innerHTML=zb),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;be.each(Array.prototype.slice.call(arguments),function(t){e.__rememberedObjects.length===0&&qb(e),e.__rememberedObjects.indexOf(t)===-1&&e.__rememberedObjects.push(t)}),this.autoPlace&&Kc(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=Fa(this)),e.folders={},be.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=Fa(this),Yc(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[Vo]=Fa(this,!0)),this.load.remembered[e]=Fa(this),this.preset=e,$c(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){be.each(this.__controllers,function(t){this.getRoot().load.remembered?kp(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),be.each(this.__folders,function(t){t.revert(t)}),e||Yc(this.getRoot(),!1)},listen:function(e){var t=this.__listening.length===0;this.__listening.push(e),t&&Np(this.__listening)},updateDisplay:function(){be.each(this.__controllers,function(e){e.updateDisplay()}),be.each(this.__folders,function(e){e.updateDisplay()})}});function Ih(o,e,t){var n=document.createElement("li");return e&&n.appendChild(e),t?o.__ul.insertBefore(n,t):o.__ul.appendChild(n),o.onResize(),n}function tf(o){ce.unbind(window,"resize",o.__resizeHandler),o.saveToLocalStorageIfPossible&&ce.unbind(window,"unload",o.saveToLocalStorageIfPossible)}function Yc(o,e){var t=o.__preset_select[o.__preset_select.selectedIndex];e?t.innerHTML=t.value+"*":t.innerHTML=t.value}function jb(o,e,t){if(t.__li=e,t.__gui=o,be.extend(t,{options:function(r){if(arguments.length>1){var a=t.__li.nextElementSibling;return t.remove(),Ro(o,t.object,t.property,{before:a,factoryArgs:[be.toArray(arguments)]})}if(be.isArray(r)||be.isObject(r)){var c=t.__li.nextElementSibling;return t.remove(),Ro(o,t.object,t.property,{before:c,factoryArgs:[r]})}},name:function(r){return t.__li.firstElementChild.firstElementChild.innerHTML=r,t},listen:function(){return t.__gui.listen(t),t},remove:function(){return t.__gui.remove(t),t}}),t instanceof jc){var n=new ol(t.object,t.property,{min:t.__min,max:t.__max,step:t.__step});be.each(["updateDisplay","onChange","onFinishChange","step","min","max"],function(s){var r=t[s],a=n[s];t[s]=n[s]=function(){var c=Array.prototype.slice.call(arguments);return a.apply(n,c),r.apply(t,c)}}),ce.addClass(e,"has-slider"),t.domElement.insertBefore(n.domElement,t.domElement.firstElementChild)}else if(t instanceof ol){var i=function(r){if(be.isNumber(t.__min)&&be.isNumber(t.__max)){var a=t.__li.firstElementChild.firstElementChild.innerHTML,c=t.__gui.__listening.indexOf(t)>-1;t.remove();var u=Ro(o,t.object,t.property,{before:t.__li.nextElementSibling,factoryArgs:[t.__min,t.__max,t.__step]});return u.name(a),c&&u.listen(),u}return r};t.min=be.compose(i,t.min),t.max=be.compose(i,t.max)}else t instanceof Lp?(ce.bind(e,"click",function(){ce.fakeEvent(t.__checkbox,"click")}),ce.bind(t.__checkbox,"click",function(s){s.stopPropagation()})):t instanceof Dp?(ce.bind(e,"click",function(){ce.fakeEvent(t.__button,"click")}),ce.bind(e,"mouseover",function(){ce.addClass(t.__button,"hover")}),ce.bind(e,"mouseout",function(){ce.removeClass(t.__button,"hover")})):t instanceof qc&&(ce.addClass(e,"color"),t.updateDisplay=be.compose(function(s){return e.style.borderLeftColor=t.__color.toString(),s},t.updateDisplay),t.updateDisplay());t.setValue=be.compose(function(s){return o.getRoot().__preset_select&&t.isModified()&&Yc(o.getRoot(),!0),s},t.setValue)}function kp(o,e){var t=o.getRoot(),n=t.__rememberedObjects.indexOf(e.object);if(n!==-1){var i=t.__rememberedObjectIndecesToControllers[n];if(i===void 0&&(i={},t.__rememberedObjectIndecesToControllers[n]=i),i[e.property]=e,t.load&&t.load.remembered){var s=t.load.remembered,r=void 0;if(s[o.preset])r=s[o.preset];else if(s[Vo])r=s[Vo];else return;if(r[n]&&r[n][e.property]!==void 0){var a=r[n][e.property];e.initialValue=a,e.setValue(a)}}}}function Ro(o,e,t,n){if(e[t]===void 0)throw new Error('Object "'+e+'" has no property "'+t+'"');var i=void 0;if(n.color)i=new qc(e,t);else{var s=[e,t].concat(n.factoryArgs);i=Vb.apply(o,s)}n.before instanceof Js&&(n.before=n.before.__li),kp(o,i),ce.addClass(i.domElement,"c");var r=document.createElement("span");ce.addClass(r,"property-name"),r.innerHTML=i.property;var a=document.createElement("div");a.appendChild(r),a.appendChild(i.domElement);var c=Ih(o,a,n.before);return ce.addClass(c,Ot.CLASS_CONTROLLER_ROW),i instanceof qc?ce.addClass(c,"color"):ce.addClass(c,Lb(i.getValue())),jb(o,c,i),o.__controllers.push(i),i}function Ar(o,e){return document.location.href+"."+e}function $c(o,e,t){var n=document.createElement("option");n.innerHTML=e,n.value=e,o.__preset_select.appendChild(n),t&&(o.__preset_select.selectedIndex=o.__preset_select.length-1)}function nf(o,e){e.style.display=o.useLocalStorage?"block":"none"}function qb(o){var e=o.__save_row=document.createElement("li");ce.addClass(o.domElement,"has-save"),o.__ul.insertBefore(e,o.__ul.firstChild),ce.addClass(e,"save-row");var t=document.createElement("span");t.innerHTML="&nbsp;",ce.addClass(t,"button gears");var n=document.createElement("span");n.innerHTML="Save",ce.addClass(n,"button"),ce.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",ce.addClass(i,"button"),ce.addClass(i,"save-as");var s=document.createElement("span");s.innerHTML="Revert",ce.addClass(s,"button"),ce.addClass(s,"revert");var r=o.__preset_select=document.createElement("select");if(o.load&&o.load.remembered?be.each(o.load.remembered,function(l,h){$c(o,h,h===o.preset)}):$c(o,Vo,!1),ce.bind(r,"change",function(){for(var l=0;l<o.__preset_select.length;l++)o.__preset_select[l].innerHTML=o.__preset_select[l].value;o.preset=this.value}),e.appendChild(r),e.appendChild(t),e.appendChild(n),e.appendChild(i),e.appendChild(s),wo){var a=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage"),u=document.getElementById("dg-save-locally");u.style.display="block",localStorage.getItem(Ar(o,"isLocal"))==="true"&&c.setAttribute("checked","checked"),nf(o,a),ce.bind(c,"change",function(){o.useLocalStorage=!o.useLocalStorage,nf(o,a)})}var d=document.getElementById("dg-new-constructor");ce.bind(d,"keydown",function(l){l.metaKey&&(l.which===67||l.keyCode===67)&&Co.hide()}),ce.bind(t,"click",function(){d.innerHTML=JSON.stringify(o.getSaveObject(),void 0,2),Co.show(),d.focus(),d.select()}),ce.bind(n,"click",function(){o.save()}),ce.bind(i,"click",function(){var l=prompt("Enter a new preset name.");l&&o.saveAs(l)}),ce.bind(s,"click",function(){o.revert()})}function Yb(o){var e=void 0;o.__resize_handle=document.createElement("div"),be.extend(o.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});function t(s){return s.preventDefault(),o.width+=e-s.clientX,o.onResize(),e=s.clientX,!1}function n(){ce.removeClass(o.__closeButton,Ot.CLASS_DRAG),ce.unbind(window,"mousemove",t),ce.unbind(window,"mouseup",n)}function i(s){return s.preventDefault(),e=s.clientX,ce.addClass(o.__closeButton,Ot.CLASS_DRAG),ce.bind(window,"mousemove",t),ce.bind(window,"mouseup",n),!1}ce.bind(o.__resize_handle,"mousedown",i),ce.bind(o.__closeButton,"mousedown",i),o.domElement.insertBefore(o.__resize_handle,o.domElement.firstElementChild)}function Kc(o,e){o.domElement.style.width=e+"px",o.__save_row&&o.autoPlace&&(o.__save_row.style.width=e+"px"),o.__closeButton&&(o.__closeButton.style.width=e+"px")}function Fa(o,e){var t={};return be.each(o.__rememberedObjects,function(n,i){var s={},r=o.__rememberedObjectIndecesToControllers[i];be.each(r,function(a,c){s[c]=e?a.initialValue:a.getValue()}),t[i]=s}),t}function $b(o){for(var e=0;e<o.__preset_select.length;e++)o.__preset_select[e].value===o.preset&&(o.__preset_select.selectedIndex=e)}function Np(o){o.length!==0&&Gb.call(window,function(){Np(o)}),be.each(o,function(e){e.updateDisplay()})}var Kb=Ot;class er{constructor(){this.callbacks={},this.callbacks.base={}}on(e,t){const n=this;return typeof e>"u"||e===""?(console.warn("wrong names"),!1):typeof t>"u"?(console.warn("wrong callback"),!1):(this.resolveNames(e).forEach(function(s){const r=n.resolveName(s);n.callbacks[r.namespace]instanceof Object||(n.callbacks[r.namespace]={}),n.callbacks[r.namespace][r.value]instanceof Array||(n.callbacks[r.namespace][r.value]=[]),n.callbacks[r.namespace][r.value].push(t)}),this)}off(e){const t=this;return typeof e>"u"||e===""?(console.warn("wrong name"),!1):(this.resolveNames(e).forEach(function(i){const s=t.resolveName(i);if(s.namespace!=="base"&&s.value==="")delete t.callbacks[s.namespace];else if(s.namespace==="base")for(const r in t.callbacks)t.callbacks[r]instanceof Object&&t.callbacks[r][s.value]instanceof Array&&(delete t.callbacks[r][s.value],Object.keys(t.callbacks[r]).length===0&&delete t.callbacks[r]);else t.callbacks[s.namespace]instanceof Object&&t.callbacks[s.namespace][s.value]instanceof Array&&(delete t.callbacks[s.namespace][s.value],Object.keys(t.callbacks[s.namespace]).length===0&&delete t.callbacks[s.namespace])}),this)}trigger(e,t){if(typeof e>"u"||e==="")return console.warn("wrong name"),!1;const n=this;let i=null;const s=t instanceof Array?t:[];let r=this.resolveNames(e);if(r=this.resolveName(r[0]),r.namespace==="base")for(const a in n.callbacks)n.callbacks[a]instanceof Object&&n.callbacks[a][r.value]instanceof Array&&n.callbacks[a][r.value].forEach(function(c){c.apply(n,s)});else if(this.callbacks[r.namespace]instanceof Object){if(r.value==="")return console.warn("wrong name"),this;n.callbacks[r.namespace][r.value].forEach(function(a){a.apply(n,s)})}return i}resolveNames(e){let t=e;return t=t.replace(/[^a-zA-Z0-9 ,/.]/g,""),t=t.replace(/[,/]+/g," "),t=t.split(" "),t}resolveName(e){const t={},n=e.split(".");return t.original=e,t.value=n[0],t.namespace="base",n.length>1&&n[1]!==""&&(t.namespace=n[1]),t}}class Zb extends er{constructor(){super(),this.viewport={},this.$sizeViewport=document.createElement("div"),this.$sizeViewport.style.width="100vw",this.$sizeViewport.style.height="100vh",this.$sizeViewport.style.position="absolute",this.$sizeViewport.style.top=0,this.$sizeViewport.style.left=0,this.$sizeViewport.style.pointerEvents="none",this.resize=this.resize.bind(this),window.addEventListener("resize",this.resize),this.resize()}resize(){document.body.appendChild(this.$sizeViewport),this.viewport.width=this.$sizeViewport.offsetWidth,this.viewport.height=this.$sizeViewport.offsetHeight,document.body.removeChild(this.$sizeViewport),this.width=window.innerWidth,this.height=window.innerHeight,this.trigger("resize")}}class Qb extends er{constructor(){super(),this.start=Date.now(),this.current=this.start,this.elapsed=0,this.delta=16,this.tick=this.tick.bind(this),this.tick()}tick(){this.ticker=window.requestAnimationFrame(this.tick);const e=Date.now();this.delta=e-this.current,this.elapsed=e-this.start,this.current=e,this.delta>60&&(this.delta=60),this.trigger("tick")}stop(){window.cancelAnimationFrame(this.ticker)}}var Jb=`uniform sampler2D tShadow;\r
uniform vec3 uShadowColor;\r
uniform float uAlpha;

varying vec2 vUv;

void main()\r
{\r
    float shadowAlpha = 1.0 - texture2D(tShadow, vUv).r;\r
    shadowAlpha *= uAlpha;

    gl_FragColor = vec4(uShadowColor, shadowAlpha);\r
}`,eM=`varying vec2 vUv;

void main()\r
{\r
    vUv = uv;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`;function tM(){const o={tShadow:{value:null},uShadowColor:{value:null},uAlpha:{value:null}};return new Mn({wireframe:!1,transparent:!0,uniforms:o,vertexShader:eM,fragmentShader:Jb})}var nM=`#define TOTO\r
#define MATCAP\r
#define USE_MATCAP

uniform vec3 diffuse;\r
uniform float opacity;\r
uniform sampler2D matcap;

varying vec3 vViewPosition;

uniform mat3 normalMatrix;\r
uniform float uIndirectDistanceAmplitude;\r
uniform float uIndirectDistanceStrength;\r
uniform float uIndirectDistancePower;\r
uniform float uIndirectAngleStrength;\r
uniform float uIndirectAngleOffset;\r
uniform float uIndirectAnglePower;\r
uniform vec3 uIndirectColor;

varying vec3 vWorldPosition;\r

#ifndef FLAT_SHADED

    varying vec3 vNormal;

#endif

#include <common>\r
#include <uv_pars_fragment>\r
#include <map_pars_fragment>\r
#include <alphamap_pars_fragment>

#include <fog_pars_fragment>\r
#include <bumpmap_pars_fragment>\r
#include <normalmap_pars_fragment>\r
#include <logdepthbuf_pars_fragment>\r
#include <clipping_planes_pars_fragment>

void main() {

    if(vWorldPosition.z < 0.0)\r
    {\r
        discard;\r
    }

    #include <clipping_planes_fragment>

    vec4 diffuseColor = vec4( diffuse, opacity );

    #include <logdepthbuf_fragment>\r
    #include <map_fragment>\r
    #include <alphamap_fragment>\r
    #include <alphatest_fragment>\r
    #include <normal_fragment_begin>\r
    #include <normal_fragment_maps>

    vec3 viewDir = normalize( vViewPosition );\r
    vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\r
    vec3 y = cross( viewDir, x );\r
    vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; 

    #ifdef USE_MATCAP

        vec4 matcapColor = texture2D( matcap, uv );\r

    #else

        vec4 matcapColor = vec4( 1.0 );

    #endif

    vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;

    float indirectDistanceStrength = clamp(1.0 - vWorldPosition.z / uIndirectDistanceAmplitude, 0.0, 1.0) * uIndirectDistanceStrength;\r
    indirectDistanceStrength = pow(indirectDistanceStrength, uIndirectDistancePower);\r
    indirectDistanceStrength = clamp(indirectDistanceStrength, 0.0, 1.0);

    vec3 worldNormal = inverseTransformDirection(vNormal, viewMatrix);

    float indirectAngleStrength = dot(normalize(worldNormal), vec3(0.0, 0.0, - 1.0)) + uIndirectAngleOffset;\r
    indirectAngleStrength = clamp(indirectAngleStrength * uIndirectAngleStrength, 0.0, 1.0);\r
    indirectAngleStrength = pow(indirectAngleStrength, uIndirectAnglePower);

    float indirectStrength = indirectDistanceStrength * indirectAngleStrength;\r

    gl_FragColor = vec4(mix(outgoingLight, uIndirectColor, indirectStrength), diffuseColor.a);\r

	#include <opaque_fragment>\r
	#include <tonemapping_fragment>\r
	#include <colorspace_fragment>\r
	#include <fog_fragment>\r
	#include <premultiplied_alpha_fragment>\r
	#include <dithering_fragment>\r
}`,iM=`#define TOTO\r
#define MATCAP\r
#define USE_MATCAP

varying vec3 vViewPosition;

#ifndef FLAT_SHADED

    varying vec3 vNormal;

#endif

#include <common>\r
#include <uv_pars_vertex>\r
#include <displacementmap_pars_vertex>\r
#include <fog_pars_vertex>\r
#include <morphtarget_pars_vertex>\r
#include <skinning_pars_vertex>

#include <logdepthbuf_pars_vertex>\r
#include <clipping_planes_pars_vertex>

uniform float uRevealProgress;

varying vec3 vWorldPosition;

#define M_PI 3.1415926535897932384626433832795

float easeSin(float _value)\r
{\r
    return sin((_value - 0.5) * M_PI) * 0.5 + 0.5;\r
}\r

void main() {

    #include <uv_vertex>

    #include <beginnormal_vertex>\r
    #include <morphnormal_vertex>\r
    #include <skinbase_vertex>\r
    #include <skinnormal_vertex>\r
    #include <defaultnormal_vertex>

    #ifndef FLAT_SHADED 

        vNormal = normalize( transformedNormal );

    #endif

    #include <begin_vertex>\r
    #include <morphtarget_vertex>\r
    #include <skinning_vertex>\r
    #include <displacementmap_vertex>

    vec4 worldNormal = modelMatrix * vec4(normal, 1.0);

    vec4 worldPosition = modelMatrix * vec4(transformed, 1.0);

    float distanceToCenter = length(worldPosition);\r
    float zAmplitude = 3.2;\r
    float revealProgress = (uRevealProgress - distanceToCenter / 30.0) * 5.0;\r
    revealProgress = 1.0 - clamp(revealProgress, - 0.1, 1.0);\r
    revealProgress = pow(revealProgress, 2.0);\r
    if(uRevealProgress > 0.9)\r
    {\r
        revealProgress = 0.0;\r
    }\r
    worldPosition.z -= revealProgress * zAmplitude;

    vWorldPosition = worldPosition.xyz;

    vec4 mvPosition = viewMatrix * worldPosition;\r
    gl_Position = projectionMatrix * mvPosition;\r

    #include <logdepthbuf_vertex>\r
    #include <clipping_planes_vertex>\r
    #include <fog_vertex>

    vViewPosition = - mvPosition.xyz;

}`;function Wn(){const o={...Be.common,...Be.bumpmap,...Be.normalmap,...Be.displacementmap,...Be.fog,matcap:{value:null},uRevealProgress:{value:null},uIndirectDistanceAmplitude:{value:null},uIndirectDistanceStrength:{value:null},uIndirectDistancePower:{value:null},uIndirectAngleStrength:{value:null},uIndirectAngleOffset:{value:null},uIndirectAnglePower:{value:null},uIndirectColor:{value:null}},e={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},t={MATCAP:""};return new Mn({wireframe:!1,transparent:!1,uniforms:o,extensions:e,defines:t,lights:!1,vertexShader:iM,fragmentShader:nM})}class sM{constructor(e){this.resources=e.resources,this.debug=e.debug,this.debug&&(this.debugFolder=this.debug.addFolder("materials"),this.debugFolder.open()),this.items={},this.setPures(),this.setShades(),this.setFloorShadow()}setPures(){this.pures={},this.pures.items={},this.pures.items.red=new Mt({color:16776960}),this.pures.items.red.name="pureYellow",this.pures.items.white=new Mt({color:16777215}),this.pures.items.white.name="pureWhite",this.pures.items.yellow=new Mt({color:16777062}),this.pures.items.yellow.name="pureLightYellow"}setShades(){if(this.shades={},this.shades.items={},this.shades.indirectColor="#ffffff",this.shades.uniforms={uRevealProgress:0,uIndirectDistanceAmplitude:1.75,uIndirectDistanceStrength:.5,uIndirectDistancePower:2,uIndirectAngleStrength:1.5,uIndirectAngleOffset:.6,uIndirectAnglePower:1,uIndirectColor:null},this.shades.items.white=new Wn,this.shades.items.white.name="shadeWhite",this.shades.items.white.uniforms.matcap.value=this.resources.items.matcapWhiteTexture,this.items.white=this.shades.items.white,this.shades.items.orange=new Wn,this.shades.items.orange.name="shadeOrange",this.shades.items.orange.uniforms.matcap.value=this.resources.items.matcapOrangeTexture,this.items.orange=this.shades.items.orange,this.shades.items.green=new Wn,this.shades.items.green.name="shadeGreen",this.shades.items.green.uniforms.matcap.value=this.resources.items.matcapGreenTexture,this.items.green=this.shades.items.green,this.shades.items.brown=new Wn,this.shades.items.brown.name="shadeBrown",this.shades.items.brown.uniforms.matcap.value=this.resources.items.matcapBrownTexture,this.items.brown=this.shades.items.brown,this.shades.items.gray=new Wn,this.shades.items.gray.name="shadeGray",this.shades.items.gray.uniforms.matcap.value=this.resources.items.matcapGrayTexture,this.items.gray=this.shades.items.gray,this.shades.items.beige=new Wn,this.shades.items.beige.name="shadeBeige",this.shades.items.beige.uniforms.matcap.value=this.resources.items.matcapBeigeTexture,this.items.beige=this.shades.items.beige,this.shades.items.red=new Wn,this.shades.items.red.name="shadeRed",this.shades.items.red.uniforms.matcap.value=this.resources.items.matcapRedTexture,this.items.red=this.shades.items.red,this.shades.items.black=new Wn,this.shades.items.black.name="shadeBlack",this.shades.items.black.uniforms.matcap.value=this.resources.items.matcapBlackTexture,this.items.black=this.shades.items.black,this.shades.items.emeraldGreen=new Wn,this.shades.items.emeraldGreen.name="shadeEmeraldGreen",this.shades.items.emeraldGreen.uniforms.matcap.value=this.resources.items.matcapEmeraldGreenTexture,this.items.emeraldGreen=this.shades.items.emeraldGreen,this.shades.items.purple=new Wn,this.shades.items.purple.name="shadePurple",this.shades.items.purple.uniforms.matcap.value=this.resources.items.matcapPurpleTexture,this.items.purple=this.shades.items.purple,this.shades.items.blue=new Wn,this.shades.items.blue.name="shadeBlue",this.shades.items.blue.uniforms.matcap.value=this.resources.items.matcapBlueTexture,this.items.blue=this.shades.items.blue,this.shades.items.yellow=new Wn,this.shades.items.yellow.name="shadeYellow",this.shades.items.yellow.uniforms.matcap.value=this.resources.items.matcapYellowTexture,this.items.yellow=this.shades.items.yellow,this.shades.items.metal=new Wn,this.shades.items.metal.name="shadeMetal",this.shades.items.metal.uniforms.matcap.value=this.resources.items.matcapMetalTexture,this.items.metal=this.shades.items.metal,this.shades.updateMaterials=()=>{this.shades.uniforms.uIndirectColor=new He(this.shades.indirectColor);for(const e in this.shades.uniforms){const t=this.shades.uniforms[e];for(const n in this.shades.items){const i=this.shades.items[n];i.uniforms[e].value=t}}},this.shades.updateMaterials(),this.debug){const e=this.debugFolder.addFolder("shades");e.open(),e.add(this.shades.uniforms,"uIndirectDistanceAmplitude").step(.001).min(0).max(3).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectDistanceStrength").step(.001).min(0).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectDistancePower").step(.001).min(0).max(5).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAngleStrength").step(.001).min(0).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAngleOffset").step(.001).min(-2).max(2).onChange(this.shades.updateMaterials),e.add(this.shades.uniforms,"uIndirectAnglePower").step(.001).min(0).max(5).onChange(this.shades.updateMaterials),e.addColor(this.shades,"indirectColor").onChange(this.shades.updateMaterials)}}setFloorShadow(){if(this.items.floorShadow=new tM,this.items.floorShadow.depthWrite=!1,this.items.floorShadow.shadowColor="#111111",this.items.floorShadow.uniforms.uShadowColor.value=new He(this.items.floorShadow.shadowColor),this.items.floorShadow.uniforms.uAlpha.value=0,this.items.floorShadow.updateMaterials=()=>{this.items.floorShadow.uniforms.uShadowColor.value=new He(this.items.floorShadow.shadowColor);for(const e of this.objects.items)for(const t of e.container.children)t.material instanceof Mn&&t.material.uniforms.uShadowColor&&(t.material.uniforms.uShadowColor.value=new He(this.items.floorShadow.shadowColor))},this.debug){const e=this.debugFolder.addFolder("floorShadow");e.open(),e.addColor(this.items.floorShadow,"shadowColor").onChange(this.items.floorShadow.updateMaterials)}}}var rM=`uniform sampler2D tBackground;

varying vec2 vUv;

void main()\r
{\r
    vec4 backgroundColor = texture(tBackground, vUv);\r
    gl_FragColor = backgroundColor;\r
}`,oM=`varying vec2 vUv;

void main()\r
{\r
    vUv = uv;

    vec3 newPosition = position;\r
    newPosition.z = 1.0;\r
    gl_Position = vec4(newPosition, 1.0);\r
}`;function aM(){const o={tBackground:{value:null}};return new Mn({wireframe:!1,transparent:!1,uniforms:o,vertexShader:oM,fragmentShader:rM})}class lM{constructor(e){if(this.debug=e.debug,this.container=new et,this.container.matrixAutoUpdate=!1,this.geometry=new ln(2,2,10,10),this.colors={},this.colors.topLeft="#2d2d2d",this.colors.topRight="#3d3d3d",this.colors.bottomRight="#1c1c1c",this.colors.bottomLeft="#111111",this.material=new aM,this.updateMaterial=()=>{const t=new He(this.colors.topLeft),n=new He(this.colors.topRight),i=new He(this.colors.bottomRight),s=new He(this.colors.bottomLeft);t.convertLinearToSRGB(),n.convertLinearToSRGB(),i.convertLinearToSRGB(),s.convertLinearToSRGB();const r=new Uint8Array([Math.round(s.r*255),Math.round(s.g*255),Math.round(s.b*255),255,Math.round(i.r*255),Math.round(i.g*255),Math.round(i.b*255),255,Math.round(t.r*255),Math.round(t.g*255),Math.round(t.b*255),255,Math.round(n.r*255),Math.round(n.g*255),Math.round(n.b*255),255]);this.backgroundTexture=new Mh(r,2,2),this.backgroundTexture.magFilter=Vt,this.backgroundTexture.needsUpdate=!0,this.material.uniforms.tBackground.value=this.backgroundTexture},this.updateMaterial(),this.mesh=new Se(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix(),this.container.add(this.mesh),this.debug){const t=this.debug.addFolder("floor");t.addColor(this.colors,"topLeft").onChange(this.updateMaterial),t.addColor(this.colors,"topRight").onChange(this.updateMaterial),t.addColor(this.colors,"bottomRight").onChange(this.updateMaterial),t.addColor(this.colors,"bottomLeft").onChange(this.updateMaterial)}}}var cM=`#define PI 3.141592653589793

uniform vec3 uColor;\r
uniform float uAlpha;\r
uniform float uFadeRadius;

varying vec2 vUv;

float sineInOut(float t)\r
{\r
    return - 0.5 * (cos(PI * t) - 1.0);\r
}

void main()\r
{\r
    float strength = 0.0;

    if(vUv.x < uFadeRadius && vUv.y < uFadeRadius)\r
    {\r
        strength = clamp(1.0 - distance(vUv, vec2(uFadeRadius)) / uFadeRadius, 0.0, 1.0);\r
    }

    else if(vUv.x > 1.0 - uFadeRadius && vUv.y < uFadeRadius)\r
    {\r
        strength = clamp(1.0 - distance(vUv, vec2(1.0 - uFadeRadius, uFadeRadius)) / uFadeRadius, 0.0, 1.0);\r
    }

    else if(vUv.x > 1.0 - uFadeRadius && vUv.y > 1.0 - uFadeRadius)\r
    {\r
        strength = clamp(1.0 - distance(vUv, vec2(1.0 - uFadeRadius, 1.0 - uFadeRadius)) / uFadeRadius, 0.0, 1.0);\r
    }

    else if(vUv.x < uFadeRadius && vUv.y > 1.0 - uFadeRadius)\r
    {\r
        strength = clamp(1.0 - distance(vUv, vec2(uFadeRadius, 1.0 - uFadeRadius)) / uFadeRadius, 0.0, 1.0);\r
    }

    else\r
    {\r
        float xNeg = clamp(vUv.x / uFadeRadius, 0.0, 1.0);\r
        float xPos = clamp((1.0 - vUv.x) / uFadeRadius, 0.0, 1.0);\r
        float yNeg = clamp(vUv.y / uFadeRadius, 0.0, 1.0);\r
        float yPos = clamp((1.0 - vUv.y) / uFadeRadius, 0.0, 1.0);

        strength = xNeg * xPos * yNeg * yPos;\r
    }

    strength = sineInOut(strength);\r
    strength *= uAlpha;

    gl_FragColor = vec4(uColor, strength);\r
	#include <colorspace_fragment>\r
}`,hM=`varying vec2 vUv;

void main()\r
{\r
    vUv = uv;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`;function uM(){const o={uColor:{value:null},uAlpha:{value:null},uFadeRadius:{value:null}};return new Mn({wireframe:!1,transparent:!0,uniforms:o,vertexShader:hM,fragmentShader:cM})}const Is=new Rh,En=new D,ss=new D,Wt=new Lt,sf={X:new D(1,0,0),Y:new D(0,1,0),Z:new D(0,0,1)},dc={type:"change"},rf={type:"mouseDown"},of={type:"mouseUp",mode:null},af={type:"objectChange"};class Op extends et{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new vM;this._gizmo=n,this.add(n);const i=new _M;this._plane=i,this.add(i);const s=this;function r(_,y){let x=y;Object.defineProperty(s,_,{get:function(){return x!==void 0?x:y},set:function(M){x!==M&&(x=M,i[_]=M,n[_]=M,s.dispatchEvent({type:_+"-changed",value:M}),s.dispatchEvent(dc))}}),s[_]=y,i[_]=y,n[_]=y}r("camera",e),r("object",void 0),r("enabled",!0),r("axis",null),r("mode","translate"),r("translationSnap",null),r("rotationSnap",null),r("scaleSnap",null),r("space","world"),r("size",1),r("dragging",!1),r("showX",!0),r("showY",!0),r("showZ",!0);const a=new D,c=new D,u=new Lt,d=new Lt,l=new D,h=new Lt,f=new D,p=new D,g=new D,m=0,v=new D;r("worldPosition",a),r("worldPositionStart",c),r("worldQuaternion",u),r("worldQuaternionStart",d),r("cameraPosition",l),r("cameraQuaternion",h),r("pointStart",f),r("pointEnd",p),r("rotationAxis",g),r("rotationAngle",m),r("eye",v),this._offset=new D,this._startNorm=new D,this._endNorm=new D,this._cameraScale=new D,this._parentPosition=new D,this._parentQuaternion=new Lt,this._parentQuaternionInv=new Lt,this._parentScale=new D,this._worldScaleStart=new D,this._worldQuaternionInv=new Lt,this._worldScale=new D,this._positionStart=new D,this._quaternionStart=new Lt,this._scaleStart=new D,this._getPointer=dM.bind(this),this._onPointerDown=pM.bind(this),this._onPointerHover=fM.bind(this),this._onPointerMove=mM.bind(this),this._onPointerUp=gM.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(e){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye).negate():this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(e)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;e!==null&&Is.setFromCamera(e,this.camera);const t=fc(this._gizmo.picker[this.mode],Is);t?this.axis=t.object.name:this.axis=null}pointerDown(e){if(!(this.object===void 0||this.dragging===!0||e!=null&&e.button!==0)&&this.axis!==null){e!==null&&Is.setFromCamera(e,this.camera);const t=fc(this._plane,Is,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,rf.mode=this.mode,this.dispatchEvent(rf)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let s=this.space;if(n==="scale"?s="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(s="world"),i===void 0||t===null||this.dragging===!1||e!==null&&e.button!==-1)return;e!==null&&Is.setFromCamera(e,this.camera);const r=fc(this._plane,Is,!0);if(r){if(this.pointEnd.copy(r.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),s==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),s==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(s==="local"&&(i.position.applyQuaternion(Wt.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),s==="world"&&(i.parent&&i.position.add(En.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(En.setFromMatrixPosition(i.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let a=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(a*=-1),ss.set(a,a,a)}else En.copy(this.pointStart),ss.copy(this.pointEnd),En.applyQuaternion(this._worldQuaternionInv),ss.applyQuaternion(this._worldQuaternionInv),ss.divide(En),t.search("X")===-1&&(ss.x=1),t.search("Y")===-1&&(ss.y=1),t.search("Z")===-1&&(ss.z=1);i.scale.copy(this._scaleStart).multiply(ss),this.scaleSnap&&(t.search("X")!==-1&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const a=20/this.worldPosition.distanceTo(En.setFromMatrixPosition(this.camera.matrixWorld));let c=!1;t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(En.copy(this.rotationAxis).cross(this.eye))*a):(t==="X"||t==="Y"||t==="Z")&&(this.rotationAxis.copy(sf[t]),En.copy(sf[t]),s==="local"&&En.applyQuaternion(this.worldQuaternion),En.cross(this.eye),En.length()===0?c=!0:this.rotationAngle=this._offset.dot(En.normalize())*a),(t==="E"||c)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),s==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(Wt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(Wt.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(dc),this.dispatchEvent(af)}}pointerUp(e){e!==null&&e.button!==0||(this.dragging&&this.axis!==null&&(of.mode=this.mode,this.dispatchEvent(of)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(dc),this.dispatchEvent(af),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Is}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function dM(o){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:o.button};{const e=this.domElement.getBoundingClientRect();return{x:(o.clientX-e.left)/e.width*2-1,y:-(o.clientY-e.top)/e.height*2+1,button:o.button}}}function fM(o){if(this.enabled)switch(o.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(o));break}}function pM(o){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(o.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(o)),this.pointerDown(this._getPointer(o)))}function mM(o){this.enabled&&this.pointerMove(this._getPointer(o))}function gM(o){this.enabled&&(this.domElement.releasePointerCapture(o.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(o)))}function fc(o,e,t){const n=e.intersectObject(o,!0);for(let i=0;i<n.length;i++)if(n[i].object.visible||t)return n[i];return!1}const ka=new ht,It=new D(0,1,0),lf=new D(0,0,0),cf=new Ye,Na=new Lt,Wa=new Lt,yi=new D,hf=new Ye,bo=new D(1,0,0),Os=new D(0,1,0),Mo=new D(0,0,1),Oa=new D,po=new D,mo=new D;class vM extends et{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new Mt({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new eo({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const s=e.clone();s.color.setHex(16711680);const r=e.clone();r.color.setHex(65280);const a=e.clone();a.color.setHex(255);const c=e.clone();c.color.setHex(16711680),c.opacity=.5;const u=e.clone();u.color.setHex(65280),u.opacity=.5;const d=e.clone();d.color.setHex(255),d.opacity=.5;const l=e.clone();l.opacity=.25;const h=e.clone();h.color.setHex(16776960),h.opacity=.25,e.clone().color.setHex(16776960);const p=e.clone();p.color.setHex(7895160);const g=new hn(0,.04,.1,12);g.translate(0,.05,0);const m=new Xt(.08,.08,.08);m.translate(0,.04,0);const v=new Ft;v.setAttribute("position",new yt([0,0,0,1,0,0],3));const _=new hn(.0075,.0075,.5,3);_.translate(0,.25,0);function y(G,J){const U=new Vs(G,.0075,3,64,J*Math.PI*2);return U.rotateY(Math.PI/2),U.rotateX(Math.PI/2),U}function x(){const G=new Ft;return G.setAttribute("position",new yt([0,0,0,1,1,1],3)),G}const M={X:[[new Se(g,s),[.5,0,0],[0,0,-Math.PI/2]],[new Se(g,s),[-.5,0,0],[0,0,Math.PI/2]],[new Se(_,s),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Se(g,r),[0,.5,0]],[new Se(g,r),[0,-.5,0],[Math.PI,0,0]],[new Se(_,r)]],Z:[[new Se(g,a),[0,0,.5],[Math.PI/2,0,0]],[new Se(g,a),[0,0,-.5],[-Math.PI/2,0,0]],[new Se(_,a),null,[Math.PI/2,0,0]]],XYZ:[[new Se(new Cr(.1,0),l.clone()),[0,0,0]]],XY:[[new Se(new Xt(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new Se(new Xt(.15,.15,.01),c.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Se(new Xt(.15,.15,.01),u.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},S={X:[[new Se(new hn(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Se(new hn(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Se(new hn(.2,0,.6,4),n),[0,.3,0]],[new Se(new hn(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Se(new hn(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Se(new hn(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Se(new Cr(.2,0),n)]],XY:[[new Se(new Xt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Se(new Xt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Se(new Xt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},A={START:[[new Se(new Cr(.01,2),i),null,null,null,"helper"]],END:[[new Se(new Cr(.01,2),i),null,null,null,"helper"]],DELTA:[[new Xn(x(),i),null,null,null,"helper"]],X:[[new Xn(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xn(v,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xn(v,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},T={XYZE:[[new Se(y(.5,1),p),null,[0,Math.PI/2,0]]],X:[[new Se(y(.5,.5),s)]],Y:[[new Se(y(.5,.5),r),null,[0,0,-Math.PI/2]]],Z:[[new Se(y(.5,.5),a),null,[0,Math.PI/2,0]]],E:[[new Se(y(.75,1),h),null,[0,Math.PI/2,0]]]},b={AXIS:[[new Xn(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},w={XYZE:[[new Se(new xl(.25,10,8),n)]],X:[[new Se(new Vs(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Se(new Vs(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Se(new Vs(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Se(new Vs(.75,.1,2,24),n)]]},P={X:[[new Se(m,s),[.5,0,0],[0,0,-Math.PI/2]],[new Se(_,s),[0,0,0],[0,0,-Math.PI/2]],[new Se(m,s),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Se(m,r),[0,.5,0]],[new Se(_,r)],[new Se(m,r),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Se(m,a),[0,0,.5],[Math.PI/2,0,0]],[new Se(_,a),[0,0,0],[Math.PI/2,0,0]],[new Se(m,a),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Se(new Xt(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new Se(new Xt(.15,.15,.01),c),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Se(new Xt(.15,.15,.01),u),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Se(new Xt(.1,.1,.1),l.clone())]]},N={X:[[new Se(new hn(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new Se(new hn(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Se(new hn(.2,0,.6,4),n),[0,.3,0]],[new Se(new hn(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Se(new hn(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new Se(new hn(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Se(new Xt(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new Se(new Xt(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Se(new Xt(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Se(new Xt(.2,.2,.2),n),[0,0,0]]]},I={X:[[new Xn(v,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Xn(v,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Xn(v,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function H(G){const J=new et;for(const U in G)for(let k=G[U].length;k--;){const q=G[U][k][0].clone(),Y=G[U][k][1],V=G[U][k][2],Z=G[U][k][3],W=G[U][k][4];q.name=U,q.tag=W,Y&&q.position.set(Y[0],Y[1],Y[2]),V&&q.rotation.set(V[0],V[1],V[2]),Z&&q.scale.set(Z[0],Z[1],Z[2]),q.updateMatrix();const L=q.geometry.clone();L.applyMatrix4(q.matrix),q.geometry=L,q.renderOrder=1/0,q.position.set(0,0,0),q.rotation.set(0,0,0),q.scale.set(1,1,1),J.add(q)}return J}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(M)),this.add(this.gizmo.rotate=H(T)),this.add(this.gizmo.scale=H(P)),this.add(this.picker.translate=H(S)),this.add(this.picker.rotate=H(w)),this.add(this.picker.scale=H(N)),this.add(this.helper.translate=H(A)),this.add(this.helper.rotate=H(b)),this.add(this.helper.scale=H(I)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const n=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Wa;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let i=[];i=i.concat(this.picker[this.mode].children),i=i.concat(this.gizmo[this.mode].children),i=i.concat(this.helper[this.mode].children);for(let s=0;s<i.length;s++){const r=i[s];r.visible=!0,r.rotation.set(0,0,0),r.position.copy(this.worldPosition);let a;if(this.camera.isOrthographicCamera?a=(this.camera.top-this.camera.bottom)/this.camera.zoom:a=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),r.scale.set(1,1,1).multiplyScalar(a*this.size/4),r.tag==="helper"){r.visible=!1,r.name==="AXIS"?(r.visible=!!this.axis,this.axis==="X"&&(Wt.setFromEuler(ka.set(0,0,0)),r.quaternion.copy(n).multiply(Wt),Math.abs(It.copy(bo).applyQuaternion(n).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Y"&&(Wt.setFromEuler(ka.set(0,0,Math.PI/2)),r.quaternion.copy(n).multiply(Wt),Math.abs(It.copy(Os).applyQuaternion(n).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="Z"&&(Wt.setFromEuler(ka.set(0,Math.PI/2,0)),r.quaternion.copy(n).multiply(Wt),Math.abs(It.copy(Mo).applyQuaternion(n).dot(this.eye))>.9&&(r.visible=!1)),this.axis==="XYZE"&&(Wt.setFromEuler(ka.set(0,Math.PI/2,0)),It.copy(this.rotationAxis),r.quaternion.setFromRotationMatrix(cf.lookAt(lf,It,Os)),r.quaternion.multiply(Wt),r.visible=this.dragging),this.axis==="E"&&(r.visible=!1)):r.name==="START"?(r.position.copy(this.worldPositionStart),r.visible=this.dragging):r.name==="END"?(r.position.copy(this.worldPosition),r.visible=this.dragging):r.name==="DELTA"?(r.position.copy(this.worldPositionStart),r.quaternion.copy(this.worldQuaternionStart),En.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),En.applyQuaternion(this.worldQuaternionStart.clone().invert()),r.scale.copy(En),r.visible=this.dragging):(r.quaternion.copy(n),this.dragging?r.position.copy(this.worldPositionStart):r.position.copy(this.worldPosition),this.axis&&(r.visible=this.axis.search(r.name)!==-1));continue}r.quaternion.copy(n),this.mode==="translate"||this.mode==="scale"?(r.name==="X"&&Math.abs(It.copy(bo).applyQuaternion(n).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Y"&&Math.abs(It.copy(Os).applyQuaternion(n).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="Z"&&Math.abs(It.copy(Mo).applyQuaternion(n).dot(this.eye))>.99&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XY"&&Math.abs(It.copy(Mo).applyQuaternion(n).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="YZ"&&Math.abs(It.copy(bo).applyQuaternion(n).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1),r.name==="XZ"&&Math.abs(It.copy(Os).applyQuaternion(n).dot(this.eye))<.2&&(r.scale.set(1e-10,1e-10,1e-10),r.visible=!1)):this.mode==="rotate"&&(Na.copy(n),It.copy(this.eye).applyQuaternion(Wt.copy(n).invert()),r.name.search("E")!==-1&&r.quaternion.setFromRotationMatrix(cf.lookAt(this.eye,lf,Os)),r.name==="X"&&(Wt.setFromAxisAngle(bo,Math.atan2(-It.y,It.z)),Wt.multiplyQuaternions(Na,Wt),r.quaternion.copy(Wt)),r.name==="Y"&&(Wt.setFromAxisAngle(Os,Math.atan2(It.x,It.z)),Wt.multiplyQuaternions(Na,Wt),r.quaternion.copy(Wt)),r.name==="Z"&&(Wt.setFromAxisAngle(Mo,Math.atan2(It.y,It.x)),Wt.multiplyQuaternions(Na,Wt),r.quaternion.copy(Wt))),r.visible=r.visible&&(r.name.indexOf("X")===-1||this.showX),r.visible=r.visible&&(r.name.indexOf("Y")===-1||this.showY),r.visible=r.visible&&(r.name.indexOf("Z")===-1||this.showZ),r.visible=r.visible&&(r.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),r.material._color=r.material._color||r.material.color.clone(),r.material._opacity=r.material._opacity||r.material.opacity,r.material.color.copy(r.material._color),r.material.opacity=r.material._opacity,this.enabled&&this.axis&&(r.name===this.axis||this.axis.split("").some(function(c){return r.name===c}))&&(r.material.color.setHex(16776960),r.material.opacity=1)}super.updateMatrixWorld(e)}}class _M extends Se{constructor(){super(new ln(1e5,1e5,2,2),new Mt({visible:!1,wireframe:!0,side:qn,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),Oa.copy(bo).applyQuaternion(t==="local"?this.worldQuaternion:Wa),po.copy(Os).applyQuaternion(t==="local"?this.worldQuaternion:Wa),mo.copy(Mo).applyQuaternion(t==="local"?this.worldQuaternion:Wa),It.copy(po),this.mode){case"translate":case"scale":switch(this.axis){case"X":It.copy(this.eye).cross(Oa),yi.copy(Oa).cross(It);break;case"Y":It.copy(this.eye).cross(po),yi.copy(po).cross(It);break;case"Z":It.copy(this.eye).cross(mo),yi.copy(mo).cross(It);break;case"XY":yi.copy(mo);break;case"YZ":yi.copy(Oa);break;case"XZ":It.copy(mo),yi.copy(po);break;case"XYZ":case"E":yi.set(0,0,0);break}break;case"rotate":default:yi.set(0,0,0)}yi.length()===0?this.quaternion.copy(this.cameraQuaternion):(hf.lookAt(En.set(0,0,0),yi,It),this.quaternion.setFromRotationMatrix(hf)),super.updateMatrixWorld(e)}}class yM{constructor(e){this.time=e.time,this.debug=e.debug,this.renderer=e.renderer,this.camera=e.camera,this.alpha=0,this.maxDistance=3,this.distancePower=2,this.zFightingDistance=.001,this.color="#111111",this.wireframeVisible=!1,this.items=[],this.container=new et,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.debug&&(this.debugFolder=this.debug.addFolder("shadows"),this.debugFolder.add(this,"alpha").step(.01).min(0).max(1),this.debugFolder.add(this,"maxDistance").step(.01).min(0).max(10),this.debugFolder.add(this,"distancePower").step(.01).min(1).max(5),this.debugFolder.add(this,"wireframeVisible").name("wireframeVisible").onChange(()=>{for(const t of this.items)t.mesh.material=this.wireframeVisible?this.materials.wireframe:t.material}),this.debugFolder.addColor(this,"color").onChange(()=>{this.materials.base.uniforms.uColor.value=new He(this.color);for(const t of this.items)t.material.uniforms.uColor.value=new He(this.color)})),this.setSun(),this.setMaterials(),this.setGeometry(),this.setHelper(),this.time.on("tick",()=>{for(const t of this.items){const n=Math.max(t.reference.position.z+t.offsetZ,0),i=this.sun.vector.clone().multiplyScalar(n);t.mesh.position.x=t.reference.position.x+i.x,t.mesh.position.y=t.reference.position.y+i.y;const s=new D(1,0,0);s.applyQuaternion(t.reference.quaternion);const r=s.clone().projectOnPlane(new D(0,0,1));let a=Math.abs(s.angleTo(new D(0,0,1))-Math.PI*.5)/(Math.PI*.5);a/=.5,a-=1/.5,a=Math.abs(a),a=Math.min(Math.max(a,0),1);const c=Math.atan2(r.y,r.x);t.mesh.rotation.z=c;let u=(this.maxDistance-n)/this.maxDistance;u=Math.min(Math.max(u,0),1),u=Math.pow(u,this.distancePower),t.material.uniforms.uAlpha.value=this.alpha*t.alpha*a*u}})}setSun(){if(this.sun={},this.sun.position=new D(-2.5,-2.65,3.75),this.sun.vector=new D,this.sun.helper=new Tb(new D(0,0,1),new D(0,0,0),1,16777215,.1,.4),this.sun.helper.visible=!1,this.container.add(this.sun.helper),this.sun.update=()=>{this.sun.vector.copy(this.sun.position).multiplyScalar(1/this.sun.position.z).negate(),this.sun.helper.position.copy(this.sun.position);const e=this.sun.position.clone().negate().normalize();this.sun.helper.setDirection(e),this.sun.helper.setLength(this.sun.helper.position.length())},this.sun.update(),this.debug){const e=this.debugFolder.addFolder("sun");e.open(),e.add(this.sun.position,"x").step(.01).min(-10).max(10).name("sunX").onChange(this.sun.update),e.add(this.sun.position,"y").step(.01).min(-10).max(10).name("sunY").onChange(this.sun.update),e.add(this.sun.position,"z").step(.01).min(0).max(10).name("sunZ").onChange(this.sun.update),e.add(this.sun.helper,"visible").name("sunHelperVisible")}}setMaterials(){this.materials={},this.materials.wireframe=new Mt({color:16777215,wireframe:!0}),this.materials.base=new uM,this.materials.base.depthWrite=!1,this.materials.base.uniforms.uColor.value=new He(this.color),this.materials.base.uniforms.uAlpha.value=0,this.materials.base.uniforms.uFadeRadius.value=.35}setGeometry(){this.geometry=new ln(1,1,1,1)}setHelper(){if(this.debug&&(this.helper={},this.helper.active=!1,this.helper.mesh=new Se(new Xt(3,1,1,1),new Hc),this.helper.mesh.position.z=1.5,this.helper.mesh.position.y=-3,this.helper.mesh.visible=this.helper.active,this.container.add(this.helper.mesh),this.helper.transformControls=new Op(this.camera.instance,this.renderer.domElement),this.helper.transformControls.size=.5,this.helper.transformControls.attach(this.helper.mesh),this.helper.transformControls.visible=this.helper.active,this.helper.transformControls.enabled=this.helper.active,this.helper.shadow=this.add(this.helper.mesh,{sizeX:6,sizeY:2,offsetZ:-.35,alpha:.99}),this.helper.shadow.mesh.visible=this.helper.active,document.addEventListener("keydown",e=>{e.key==="r"?this.helper.transformControls.setMode("rotate"):e.key==="g"&&this.helper.transformControls.setMode("translate")}),this.helper.transformControls.addEventListener("dragging-changed",e=>{this.camera.orbitControls.enabled=!e.value}),this.container.add(this.helper.transformControls),this.debug)){const e=this.debugFolder.addFolder("helper");e.open(),e.add(this.helper,"active").name("visible").onChange(()=>{this.helper.mesh.visible=this.helper.active,this.helper.transformControls.visible=this.helper.active,this.helper.transformControls.enabled=this.helper.active,this.helper.shadow.mesh.visible=this.helper.active})}}add(e,t={}){const n={};return n.offsetZ=typeof t.offsetZ>"u"?0:t.offsetZ,n.alpha=typeof t.alpha>"u"?1:t.alpha,n.reference=e,n.material=this.materials.base.clone(),n.mesh=new Se(this.geometry,this.wireframeVisible?this.materials.wireframe:n.material),n.mesh.position.z=this.zFightingDistance,n.mesh.scale.set(t.sizeX,t.sizeY,2.4),this.container.add(n.mesh),this.items.push(n),n}}var go=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xM(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Ba(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bp={exports:{}};(function(o,e){(function(t){o.exports=t()})(function(){return function t(n,i,s){function r(u,d){if(!i[u]){if(!n[u]){var l=typeof Ba=="function"&&Ba;if(!d&&l)return l(u,!0);if(a)return a(u,!0);throw new Error("Cannot find module '"+u+"'")}var h=i[u]={exports:{}};n[u][0].call(h.exports,function(f){var p=n[u][1][f];return r(p||f)},h,h.exports,t,n,i,s)}return i[u].exports}for(var a=typeof Ba=="function"&&Ba,c=0;c<s.length;c++)r(s[c]);return r}({1:[function(t,n,i){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,n,i){n.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,n,i){var s=t("../math/Vec3");t("../utils/Utils"),n.exports=r;function r(u){u=u||{},this.lowerBound=new s,u.lowerBound&&this.lowerBound.copy(u.lowerBound),this.upperBound=new s,u.upperBound&&this.upperBound.copy(u.upperBound)}var a=new s;r.prototype.setFromPoints=function(u,d,l,h){var f=this.lowerBound,p=this.upperBound,g=l;f.copy(u[0]),g&&g.vmult(f,f),p.copy(f);for(var m=1;m<u.length;m++){var v=u[m];g&&(g.vmult(v,a),v=a),v.x>p.x&&(p.x=v.x),v.x<f.x&&(f.x=v.x),v.y>p.y&&(p.y=v.y),v.y<f.y&&(f.y=v.y),v.z>p.z&&(p.z=v.z),v.z<f.z&&(f.z=v.z)}return d&&(d.vadd(f,f),d.vadd(p,p)),h&&(f.x-=h,f.y-=h,f.z-=h,p.x+=h,p.y+=h,p.z+=h),this},r.prototype.copy=function(u){return this.lowerBound.copy(u.lowerBound),this.upperBound.copy(u.upperBound),this},r.prototype.clone=function(){return new r().copy(this)},r.prototype.extend=function(u){var d=u.lowerBound.x;this.lowerBound.x>d&&(this.lowerBound.x=d);var l=u.upperBound.x;this.upperBound.x<l&&(this.upperBound.x=l);var d=u.lowerBound.y;this.lowerBound.y>d&&(this.lowerBound.y=d);var l=u.upperBound.y;this.upperBound.y<l&&(this.upperBound.y=l);var d=u.lowerBound.z;this.lowerBound.z>d&&(this.lowerBound.z=d);var l=u.upperBound.z;this.upperBound.z<l&&(this.upperBound.z=l)},r.prototype.overlaps=function(u){var d=this.lowerBound,l=this.upperBound,h=u.lowerBound,f=u.upperBound;return(h.x<=l.x&&l.x<=f.x||d.x<=f.x&&f.x<=l.x)&&(h.y<=l.y&&l.y<=f.y||d.y<=f.y&&f.y<=l.y)&&(h.z<=l.z&&l.z<=f.z||d.z<=f.z&&f.z<=l.z)},r.prototype.contains=function(u){var d=this.lowerBound,l=this.upperBound,h=u.lowerBound,f=u.upperBound;return d.x<=h.x&&l.x>=f.x&&d.y<=h.y&&l.y>=f.y&&d.z<=h.z&&l.z>=f.z},r.prototype.getCorners=function(u,d,l,h,f,p,g,m){var v=this.lowerBound,_=this.upperBound;u.copy(v),d.set(_.x,v.y,v.z),l.set(_.x,_.y,v.z),h.set(v.x,_.y,_.z),f.set(_.x,v.y,v.z),p.set(v.x,_.y,v.z),g.set(v.x,v.y,_.z),m.copy(_)};var c=[new s,new s,new s,new s,new s,new s,new s,new s];r.prototype.toLocalFrame=function(u,d){var l=c,h=l[0],f=l[1],p=l[2],g=l[3],m=l[4],v=l[5],_=l[6],y=l[7];this.getCorners(h,f,p,g,m,v,_,y);for(var x=0;x!==8;x++){var M=l[x];u.pointToLocal(M,M)}return d.setFromPoints(l)},r.prototype.toWorldFrame=function(u,d){var l=c,h=l[0],f=l[1],p=l[2],g=l[3],m=l[4],v=l[5],_=l[6],y=l[7];this.getCorners(h,f,p,g,m,v,_,y);for(var x=0;x!==8;x++){var M=l[x];u.pointToWorld(M,M)}return d.setFromPoints(l)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,n,i){n.exports=s;function s(){this.matrix=[]}s.prototype.get=function(r,a){if(r=r.index,a=a.index,a>r){var c=a;a=r,r=c}return this.matrix[(r*(r+1)>>1)+a-1]},s.prototype.set=function(r,a,c){if(r=r.index,a=a.index,a>r){var u=a;a=r,r=u}this.matrix[(r*(r+1)>>1)+a-1]=c?1:0},s.prototype.reset=function(){for(var r=0,a=this.matrix.length;r!==a;r++)this.matrix[r]=0},s.prototype.setNumObjects=function(r){this.matrix.length=r*(r-1)>>1}},{}],5:[function(t,n,i){var s=t("../objects/Body"),r=t("../math/Vec3"),a=t("../math/Quaternion");t("../shapes/Shape"),t("../shapes/Plane"),n.exports=c;function c(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}c.prototype.collisionPairs=function(g,m,v){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var u=s.STATIC|s.KINEMATIC;c.prototype.needBroadphaseCollision=function(g,m){return!(!(g.collisionFilterGroup&m.collisionFilterMask)||!(m.collisionFilterGroup&g.collisionFilterMask)||(g.type&u||g.sleepState===s.SLEEPING)&&(m.type&u||m.sleepState===s.SLEEPING))},c.prototype.intersectionTest=function(g,m,v,_){this.useBoundingBoxes?this.doBoundingBoxBroadphase(g,m,v,_):this.doBoundingSphereBroadphase(g,m,v,_)};var d=new r;new r,new a,new r,c.prototype.doBoundingSphereBroadphase=function(g,m,v,_){var y=d;m.position.vsub(g.position,y);var x=Math.pow(g.boundingRadius+m.boundingRadius,2),M=y.norm2();M<x&&(v.push(g),_.push(m))},c.prototype.doBoundingBoxBroadphase=function(g,m,v,_){g.aabbNeedsUpdate&&g.computeAABB(),m.aabbNeedsUpdate&&m.computeAABB(),g.aabb.overlaps(m.aabb)&&(v.push(g),_.push(m))};var l={keys:[]},h=[],f=[];c.prototype.makePairsUnique=function(g,m){for(var v=l,_=h,y=f,x=g.length,M=0;M!==x;M++)_[M]=g[M],y[M]=m[M];g.length=0,m.length=0;for(var M=0;M!==x;M++){var S=_[M].id,A=y[M].id,T=S<A?S+","+A:A+","+S;v[T]=M,v.keys.push(T)}for(var M=0;M!==v.keys.length;M++){var T=v.keys.pop(),b=v[T];g.push(_[b]),m.push(y[b]),delete v[T]}},c.prototype.setWorld=function(g){};var p=new r;c.boundingSphereCheck=function(g,m){var v=p;return g.position.vsub(m.position,v),Math.pow(g.shape.boundingSphereRadius+m.shape.boundingSphereRadius,2)>v.norm2()},c.prototype.aabbQuery=function(g,m,v){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,n,i){n.exports=c;var s=t("./Broadphase"),r=t("../math/Vec3"),a=t("../shapes/Shape");function c(d,l,h,f,p){s.apply(this),this.nx=h||10,this.ny=f||10,this.nz=p||10,this.aabbMin=d||new r(100,100,100),this.aabbMax=l||new r(-100,-100,-100);var g=this.nx*this.ny*this.nz;if(g<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=g,this.binLengths.length=g;for(var m=0;m<g;m++)this.bins[m]=[],this.binLengths[m]=0}c.prototype=new s,c.prototype.constructor=c;var u=new r;new r,c.prototype.collisionPairs=function(d,l,h){var f=d.numObjects(),p=d.bodies,ee=this.aabbMax,X=this.aabbMin,g=this.nx,m=this.ny,v=this.nz,_=m*v,y=v,x=1,M=ee.x,S=ee.y,A=ee.z,T=X.x,b=X.y,w=X.z,P=g/(M-T),N=m/(S-b),I=v/(A-w),H=(M-T)/g,G=(S-b)/m,J=(A-w)/v,U=Math.sqrt(H*H+G*G+J*J)*.5,k=a.types,q=k.SPHERE,Y=k.PLANE;k.BOX,k.COMPOUND,k.CONVEXPOLYHEDRON;for(var V=this.bins,Z=this.binLengths,W=this.bins.length,L=0;L!==W;L++)Z[L]=0;var F=Math.ceil,X=Math.min,ee=Math.max;function re($e,at,Ze,ze,Je,rt,vt){var tt=($e-T)*P|0,E=(at-b)*N|0,te=(Ze-w)*I|0,se=F((ze-T)*P),ye=F((Je-b)*N),Te=F((rt-w)*I);tt<0?tt=0:tt>=g&&(tt=g-1),E<0?E=0:E>=m&&(E=m-1),te<0?te=0:te>=v&&(te=v-1),se<0?se=0:se>=g&&(se=g-1),ye<0?ye=0:ye>=m&&(ye=m-1),Te<0?Te=0:Te>=v&&(Te=v-1),tt*=_,E*=y,te*=x,se*=_,ye*=y,Te*=x;for(var nt=tt;nt<=se;nt+=_)for(var ot=E;ot<=ye;ot+=y)for(var St=te;St<=Te;St+=x){var Ut=nt+ot+St;V[Ut][Z[Ut]++]=vt}}for(var L=0;L!==f;L++){var K=p[L],O=K.shape;switch(O.type){case q:var de=K.position.x,_e=K.position.y,Me=K.position.z,me=O.radius;re(de-me,_e-me,Me-me,de+me,_e+me,Me+me,K);break;case Y:O.worldNormalNeedsUpdate&&O.computeWorldNormal(K.quaternion);var le=O.worldNormal,ue=T+H*.5-K.position.x,We=b+G*.5-K.position.y,Ge=w+J*.5-K.position.z,B=u;B.set(ue,We,Ge);for(var C=0,ie=0;C!==g;C++,ie+=_,B.y=We,B.x+=H)for(var he=0,fe=0;he!==m;he++,fe+=y,B.z=Ge,B.y+=G)for(var ge=0,Ie=0;ge!==v;ge++,Ie+=x,B.z+=J)if(B.dot(le)<U){var Ee=ie+fe+Ie;V[Ee][Z[Ee]++]=K}break;default:K.aabbNeedsUpdate&&K.computeAABB(),re(K.aabb.lowerBound.x,K.aabb.lowerBound.y,K.aabb.lowerBound.z,K.aabb.upperBound.x,K.aabb.upperBound.y,K.aabb.upperBound.z,K);break}}for(var L=0;L!==W;L++){var we=Z[L];if(we>1)for(var Ke=V[L],C=0;C!==we;C++)for(var K=Ke[C],he=0;he!==C;he++){var Ce=Ke[he];this.needBroadphaseCollision(K,Ce)&&this.intersectionTest(K,Ce,l,h)}}this.makePairsUnique(l,h)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,n,i){n.exports=a;var s=t("./Broadphase"),r=t("./AABB");function a(){s.apply(this)}a.prototype=new s,a.prototype.constructor=a,a.prototype.collisionPairs=function(c,u,d){var l=c.bodies,h=l.length,f,p,g,m;for(f=0;f!==h;f++)for(p=0;p!==f;p++)g=l[f],m=l[p],this.needBroadphaseCollision(g,m)&&this.intersectionTest(g,m,u,d)},new r,a.prototype.aabbQuery=function(c,u,d){d=d||[];for(var l=0;l<c.bodies.length;l++){var h=c.bodies[l];h.aabbNeedsUpdate&&h.computeAABB(),h.aabb.overlaps(u)&&d.push(h)}return d}},{"./AABB":3,"./Broadphase":5}],8:[function(t,n,i){n.exports=s;function s(){this.matrix={}}s.prototype.get=function(r,a){if(r=r.id,a=a.id,a>r){var c=a;a=r,r=c}return r+"-"+a in this.matrix},s.prototype.set=function(r,a,c){if(r=r.id,a=a.id,a>r){var u=a;a=r,r=u}c?this.matrix[r+"-"+a]=!0:delete this.matrix[r+"-"+a]},s.prototype.reset=function(){this.matrix={}},s.prototype.setNumObjects=function(r){}},{}],9:[function(t,n,i){n.exports=l;var s=t("../math/Vec3"),r=t("../math/Quaternion"),a=t("../math/Transform");t("../shapes/ConvexPolyhedron"),t("../shapes/Box");var c=t("../collision/RaycastResult"),u=t("../shapes/Shape"),d=t("../collision/AABB");function l(W,L){this.from=W?W.clone():new s,this.to=L?L.clone():new s,this._direction=new s,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=l.ANY,this.result=new c,this.hasHit=!1,this.callback=function(F){}}l.prototype.constructor=l,l.CLOSEST=1,l.ANY=2,l.ALL=4;var h=new d,f=[];l.prototype.intersectWorld=function(W,L){return this.mode=L.mode||l.ANY,this.result=L.result||new c,this.skipBackfaces=!!L.skipBackfaces,this.collisionFilterMask=typeof L.collisionFilterMask<"u"?L.collisionFilterMask:-1,this.collisionFilterGroup=typeof L.collisionFilterGroup<"u"?L.collisionFilterGroup:-1,L.from&&this.from.copy(L.from),L.to&&this.to.copy(L.to),this.callback=L.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),f.length=0,W.broadphase.aabbQuery(W,h,f),this.intersectBodies(f),this.hasHit};var p=new s,g=new s;l.pointInTriangle=m;function m(W,L,F,X){X.vsub(L,Y),F.vsub(L,p),W.vsub(L,g);var ee=Y.dot(Y),re=Y.dot(p),K=Y.dot(g),O=p.dot(p),de=p.dot(g),_e,Me;return(_e=O*K-re*de)>=0&&(Me=ee*de-re*K)>=0&&_e+Me<ee*O-re*re}var v=new s,_=new r;l.prototype.intersectBody=function(W,L){L&&(this.result=L,this._updateDirection());var F=this.checkCollisionResponse;if(!(F&&!W.collisionResponse)&&!(!(this.collisionFilterGroup&W.collisionFilterMask)||!(W.collisionFilterGroup&this.collisionFilterMask)))for(var X=v,ee=_,re=0,K=W.shapes.length;re<K;re++){var O=W.shapes[re];if(!(F&&!O.collisionResponse)&&(W.quaternion.mult(W.shapeOrientations[re],ee),W.quaternion.vmult(W.shapeOffsets[re],X),X.vadd(W.position,X),this.intersectShape(O,ee,X,W),this.result._shouldStop))break}},l.prototype.intersectBodies=function(W,L){L&&(this.result=L,this._updateDirection());for(var F=0,X=W.length;!this.result._shouldStop&&F<X;F++)this.intersectBody(W[F])},l.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},l.prototype.intersectShape=function(W,L,F,X){var ee=this.from,re=Z(ee,this._direction,F);if(!(re>W.boundingSphereRadius)){var K=this[W.type];K&&K.call(this,W,L,F,X)}},new s,new s;var y=new s,x=new s,M=new s,S=new s;new s,new c,l.prototype.intersectBox=function(W,L,F,X){return this.intersectConvex(W.convexPolyhedronRepresentation,L,F,X)},l.prototype[u.types.BOX]=l.prototype.intersectBox,l.prototype.intersectPlane=function(W,L,F,X){var ee=this.from,re=this.to,K=this._direction,O=new s(0,0,1);L.vmult(O,O);var de=new s;ee.vsub(F,de);var _e=de.dot(O);re.vsub(F,de);var Me=de.dot(O);if(!(_e*Me>0)&&!(ee.distanceTo(re)<_e)){var me=O.dot(K);if(!(Math.abs(me)<this.precision)){var le=new s,ue=new s,We=new s;ee.vsub(F,le);var Ge=-O.dot(le)/me;K.scale(Ge,ue),ee.vadd(ue,We),this.reportIntersection(O,We,W,X,-1)}}},l.prototype[u.types.PLANE]=l.prototype.intersectPlane,l.prototype.getAABB=function(W){var L=this.to,F=this.from;W.lowerBound.x=Math.min(L.x,F.x),W.lowerBound.y=Math.min(L.y,F.y),W.lowerBound.z=Math.min(L.z,F.z),W.upperBound.x=Math.max(L.x,F.x),W.upperBound.y=Math.max(L.y,F.y),W.upperBound.z=Math.max(L.z,F.z)};var A={faceList:[0]};l.prototype.intersectHeightfield=function(W,L,F,X){W.data,W.elementSize;var ee=new s,re=new l(this.from,this.to);a.pointToLocalFrame(F,L,re.from,re.from),a.pointToLocalFrame(F,L,re.to,re.to);var K=[],O=null,de=null,_e=null,Me=null,me=W.getIndexOfPosition(re.from.x,re.from.y,K,!1);if(me&&(O=K[0],de=K[1],_e=K[0],Me=K[1]),me=W.getIndexOfPosition(re.to.x,re.to.y,K,!1),me&&((O===null||K[0]<O)&&(O=K[0]),(_e===null||K[0]>_e)&&(_e=K[0]),(de===null||K[1]<de)&&(de=K[1]),(Me===null||K[1]>Me)&&(Me=K[1])),O!==null){var le=[];W.getRectMinMax(O,de,_e,Me,le),le[0],le[1];for(var ue=O;ue<=_e;ue++)for(var We=de;We<=Me;We++){if(this.result._shouldStop||(W.getConvexTrianglePillar(ue,We,!1),a.pointToWorldFrame(F,L,W.pillarOffset,ee),this.intersectConvex(W.pillarConvex,L,ee,X,A),this.result._shouldStop))return;W.getConvexTrianglePillar(ue,We,!0),a.pointToWorldFrame(F,L,W.pillarOffset,ee),this.intersectConvex(W.pillarConvex,L,ee,X,A)}}},l.prototype[u.types.HEIGHTFIELD]=l.prototype.intersectHeightfield;var T=new s,b=new s;l.prototype.intersectSphere=function(W,L,F,X){var ee=this.from,re=this.to,K=W.radius,O=Math.pow(re.x-ee.x,2)+Math.pow(re.y-ee.y,2)+Math.pow(re.z-ee.z,2),de=2*((re.x-ee.x)*(ee.x-F.x)+(re.y-ee.y)*(ee.y-F.y)+(re.z-ee.z)*(ee.z-F.z)),_e=Math.pow(ee.x-F.x,2)+Math.pow(ee.y-F.y,2)+Math.pow(ee.z-F.z,2)-Math.pow(K,2),Me=Math.pow(de,2)-4*O*_e,me=T,le=b;if(!(Me<0))if(Me===0)ee.lerp(re,Me,me),me.vsub(F,le),le.normalize(),this.reportIntersection(le,me,W,X,-1);else{var ue=(-de-Math.sqrt(Me))/(2*O),We=(-de+Math.sqrt(Me))/(2*O);if(ue>=0&&ue<=1&&(ee.lerp(re,ue,me),me.vsub(F,le),le.normalize(),this.reportIntersection(le,me,W,X,-1)),this.result._shouldStop)return;We>=0&&We<=1&&(ee.lerp(re,We,me),me.vsub(F,le),le.normalize(),this.reportIntersection(le,me,W,X,-1))}},l.prototype[u.types.SPHERE]=l.prototype.intersectSphere;var w=new s;new s,new s;var P=new s;l.prototype.intersectConvex=function(L,F,X,ee,re){for(var K=w,O=P,de=re&&re.faceList||null,_e=L.faces,Me=L.vertices,me=L.faceNormals,le=this._direction,ue=this.from,We=this.to,Ge=ue.distanceTo(We),B=de?de.length:_e.length,C=this.result,ie=0;!C._shouldStop&&ie<B;ie++){var he=de?de[ie]:ie,fe=_e[he],ge=me[he],Ie=F,Ee=X;O.copy(Me[fe[0]]),Ie.vmult(O,O),O.vadd(Ee,O),O.vsub(ue,O),Ie.vmult(ge,K);var we=le.dot(K);if(!(Math.abs(we)<this.precision)){var Ke=K.dot(O)/we;if(!(Ke<0)){le.mult(Ke,y),y.vadd(ue,y),x.copy(Me[fe[0]]),Ie.vmult(x,x),Ee.vadd(x,x);for(var Ce=1;!C._shouldStop&&Ce<fe.length-1;Ce++){M.copy(Me[fe[Ce]]),S.copy(Me[fe[Ce+1]]),Ie.vmult(M,M),Ie.vmult(S,S),Ee.vadd(M,M),Ee.vadd(S,S);var $e=y.distanceTo(ue);!(m(y,x,M,S)||m(y,M,x,S))||$e>Ge||this.reportIntersection(K,y,L,ee,he)}}}}},l.prototype[u.types.CONVEXPOLYHEDRON]=l.prototype.intersectConvex;var N=new s,I=new s,H=new s,G=new s,J=new s,U=new s;new d;var k=[],q=new a;l.prototype.intersectTrimesh=function(L,F,X,ee,re){var K=N,O=k,de=q,_e=P,Me=I,me=H,le=G,ue=U,We=J;re&&re.faceList;var Ge=L.indices;L.vertices,L.faceNormals;var B=this.from,C=this.to,ie=this._direction;de.position.copy(X),de.quaternion.copy(F),a.vectorToLocalFrame(X,F,ie,Me),a.pointToLocalFrame(X,F,B,me),a.pointToLocalFrame(X,F,C,le);var he=me.distanceSquared(le);L.tree.rayQuery(this,de,O);for(var fe=0,ge=O.length;!this.result._shouldStop&&fe!==ge;fe++){var Ie=O[fe];L.getNormal(Ie,K),L.getVertex(Ge[Ie*3],x),x.vsub(me,_e);var Ee=Me.dot(K),we=K.dot(_e)/Ee;if(!(we<0)){Me.scale(we,y),y.vadd(me,y),L.getVertex(Ge[Ie*3+1],M),L.getVertex(Ge[Ie*3+2],S);var Ke=y.distanceSquared(me);!(m(y,M,x,S)||m(y,x,M,S))||Ke>he||(a.vectorToWorldFrame(F,K,We),a.pointToWorldFrame(X,F,y,ue),this.reportIntersection(We,ue,L,ee,Ie))}}O.length=0},l.prototype[u.types.TRIMESH]=l.prototype.intersectTrimesh,l.prototype.reportIntersection=function(W,L,F,X,ee){var re=this.from,K=this.to,O=re.distanceTo(L),de=this.result;if(!(this.skipBackfaces&&W.dot(this._direction)>0))switch(de.hitFaceIndex=typeof ee<"u"?ee:-1,this.mode){case l.ALL:this.hasHit=!0,de.set(re,K,W,L,F,X,O),de.hasHit=!0,this.callback(de);break;case l.CLOSEST:(O<de.distance||!de.hasHit)&&(this.hasHit=!0,de.hasHit=!0,de.set(re,K,W,L,F,X,O));break;case l.ANY:this.hasHit=!0,de.hasHit=!0,de.set(re,K,W,L,F,X,O),de._shouldStop=!0;break}};var Y=new s,V=new s;function Z(W,L,F){F.vsub(W,Y);var X=Y.dot(L);L.mult(X,V),V.vadd(W,V);var ee=F.distanceTo(V);return ee}},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,n,i){var s=t("../math/Vec3");n.exports=r;function r(){this.rayFromWorld=new s,this.rayToWorld=new s,this.hitNormalWorld=new s,this.hitPointWorld=new s,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}r.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},r.prototype.abort=function(){this._shouldStop=!0},r.prototype.set=function(a,c,u,d,l,h,f){this.rayFromWorld.copy(a),this.rayToWorld.copy(c),this.hitNormalWorld.copy(u),this.hitPointWorld.copy(d),this.shape=l,this.body=h,this.distance=f}},{"../math/Vec3":30}],11:[function(t,n,i){t("../shapes/Shape");var s=t("../collision/Broadphase");n.exports=r;function r(a){s.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var c=this.axisList;this._addBodyHandler=function(u){c.push(u.body)},this._removeBodyHandler=function(u){var d=c.indexOf(u.body);d!==-1&&c.splice(d,1)},a&&this.setWorld(a)}r.prototype=new s,r.prototype.setWorld=function(a){this.axisList.length=0;for(var c=0;c<a.bodies.length;c++)this.axisList.push(a.bodies[c]);a.removeEventListener("addBody",this._addBodyHandler),a.removeEventListener("removeBody",this._removeBodyHandler),a.addEventListener("addBody",this._addBodyHandler),a.addEventListener("removeBody",this._removeBodyHandler),this.world=a,this.dirty=!0},r.insertionSortX=function(a){for(var c=1,u=a.length;c<u;c++){for(var d=a[c],l=c-1;l>=0&&!(a[l].aabb.lowerBound.x<=d.aabb.lowerBound.x);l--)a[l+1]=a[l];a[l+1]=d}return a},r.insertionSortY=function(a){for(var c=1,u=a.length;c<u;c++){for(var d=a[c],l=c-1;l>=0&&!(a[l].aabb.lowerBound.y<=d.aabb.lowerBound.y);l--)a[l+1]=a[l];a[l+1]=d}return a},r.insertionSortZ=function(a){for(var c=1,u=a.length;c<u;c++){for(var d=a[c],l=c-1;l>=0&&!(a[l].aabb.lowerBound.z<=d.aabb.lowerBound.z);l--)a[l+1]=a[l];a[l+1]=d}return a},r.prototype.collisionPairs=function(a,c,u){var d=this.axisList,l=d.length,h=this.axisIndex,f,p;for(this.dirty&&(this.sortList(),this.dirty=!1),f=0;f!==l;f++){var g=d[f];for(p=f+1;p<l;p++){var m=d[p];if(this.needBroadphaseCollision(g,m)){if(!r.checkBounds(g,m,h))break;this.intersectionTest(g,m,c,u)}}}},r.prototype.sortList=function(){for(var a=this.axisList,c=this.axisIndex,u=a.length,d=0;d!==u;d++){var l=a[d];l.aabbNeedsUpdate&&l.computeAABB()}c===0?r.insertionSortX(a):c===1?r.insertionSortY(a):c===2&&r.insertionSortZ(a)},r.checkBounds=function(a,c,u){var d,l;u===0?(d=a.position.x,l=c.position.x):u===1?(d=a.position.y,l=c.position.y):u===2&&(d=a.position.z,l=c.position.z);var h=a.boundingRadius,f=c.boundingRadius,p=d+h,g=l-f;return g<p},r.prototype.autoDetectAxis=function(){for(var a=0,c=0,u=0,d=0,l=0,h=0,f=this.axisList,p=f.length,g=1/p,m=0;m!==p;m++){var v=f[m],_=v.position.x;a+=_,c+=_*_;var y=v.position.y;u+=y,d+=y*y;var x=v.position.z;l+=x,h+=x*x}var M=c-a*a*g,S=d-u*u*g,A=h-l*l*g;M>S?M>A?this.axisIndex=0:this.axisIndex=2:S>A?this.axisIndex=1:this.axisIndex=2},r.prototype.aabbQuery=function(a,c,u){u=u||[],this.dirty&&(this.sortList(),this.dirty=!1);var d=this.axisIndex,l="x";d===1&&(l="y"),d===2&&(l="z");var h=this.axisList;c.lowerBound[l],c.upperBound[l];for(var f=0;f<h.length;f++){var p=h[f];p.aabbNeedsUpdate&&p.computeAABB(),p.aabb.overlaps(c)&&u.push(p)}return u}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,n,i){n.exports=u,t("./Constraint");var s=t("./PointToPointConstraint"),r=t("../equations/ConeEquation"),a=t("../equations/RotationalEquation");t("../equations/ContactEquation");var c=t("../math/Vec3");function u(d,l,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6,p=h.pivotA?h.pivotA.clone():new c,g=h.pivotB?h.pivotB.clone():new c;this.axisA=h.axisA?h.axisA.clone():new c,this.axisB=h.axisB?h.axisB.clone():new c,s.call(this,d,p,l,g,f),this.collideConnected=!!h.collideConnected,this.angle=typeof h.angle<"u"?h.angle:0;var m=this.coneEquation=new r(d,l,h),v=this.twistEquation=new a(d,l,h);this.twistAngle=typeof h.twistAngle<"u"?h.twistAngle:0,m.maxForce=0,m.minForce=-f,v.maxForce=0,v.minForce=-f,this.equations.push(m,v)}u.prototype=new s,u.constructor=u,new c,new c,u.prototype.update=function(){var d=this.bodyA,l=this.bodyB,h=this.coneEquation,f=this.twistEquation;s.prototype.update.call(this),d.vectorToWorldFrame(this.axisA,h.axisA),l.vectorToWorldFrame(this.axisB,h.axisB),this.axisA.tangents(f.axisA,f.axisA),d.vectorToWorldFrame(f.axisA,f.axisA),this.axisB.tangents(f.axisB,f.axisB),l.vectorToWorldFrame(f.axisB,f.axisB),h.angle=this.angle,f.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,n,i){n.exports=r;var s=t("../utils/Utils");function r(a,c,u){u=s.defaults(u,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=c,this.id=r.idCounter++,this.collideConnected=u.collideConnected,u.wakeUpBodies&&(a&&a.wakeUp(),c&&c.wakeUp())}r.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},r.prototype.enable=function(){for(var a=this.equations,c=0;c<a.length;c++)a[c].enabled=!0},r.prototype.disable=function(){for(var a=this.equations,c=0;c<a.length;c++)a[c].enabled=!1},r.idCounter=0},{"../utils/Utils":53}],14:[function(t,n,i){n.exports=a;var s=t("./Constraint"),r=t("../equations/ContactEquation");function a(c,u,d,l){s.call(this,c,u),typeof d>"u"&&(d=c.position.distanceTo(u.position)),typeof l>"u"&&(l=1e6),this.distance=d;var h=this.distanceEquation=new r(c,u);this.equations.push(h),h.minForce=-l,h.maxForce=l}a.prototype=new s,a.prototype.update=function(){var c=this.bodyA,u=this.bodyB,d=this.distanceEquation,l=this.distance*.5,h=d.ni;u.position.vsub(c.position,h),h.normalize(),h.mult(l,d.ri),h.mult(-l,d.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,n,i){n.exports=u,t("./Constraint");var s=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation"),a=t("../equations/RotationalMotorEquation");t("../equations/ContactEquation");var c=t("../math/Vec3");function u(h,f,p){p=p||{};var g=typeof p.maxForce<"u"?p.maxForce:1e6,m=p.pivotA?p.pivotA.clone():new c,v=p.pivotB?p.pivotB.clone():new c;s.call(this,h,m,f,v,g);var _=this.axisA=p.axisA?p.axisA.clone():new c(1,0,0);_.normalize();var y=this.axisB=p.axisB?p.axisB.clone():new c(1,0,0);y.normalize();var x=this.rotationalEquation1=new r(h,f,p),M=this.rotationalEquation2=new r(h,f,p),S=this.motorEquation=new a(h,f,g);S.enabled=!1,this.equations.push(x,M,S)}u.prototype=new s,u.constructor=u,u.prototype.enableMotor=function(){this.motorEquation.enabled=!0},u.prototype.disableMotor=function(){this.motorEquation.enabled=!1},u.prototype.setMotorSpeed=function(h){this.motorEquation.targetVelocity=h},u.prototype.setMotorMaxForce=function(h){this.motorEquation.maxForce=h,this.motorEquation.minForce=-h};var d=new c,l=new c;u.prototype.update=function(){var h=this.bodyA,f=this.bodyB,p=this.motorEquation,g=this.rotationalEquation1,m=this.rotationalEquation2,v=d,_=l,y=this.axisA,x=this.axisB;s.prototype.update.call(this),h.quaternion.vmult(y,v),f.quaternion.vmult(x,_),v.tangents(g.axisA,m.axisA),g.axisB.copy(_),m.axisB.copy(_),this.motorEquation.enabled&&(h.quaternion.vmult(this.axisA,p.axisA),f.quaternion.vmult(this.axisB,p.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,n,i){n.exports=c,t("./Constraint");var s=t("./PointToPointConstraint"),r=t("../equations/RotationalEquation");t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation");var a=t("../math/Vec3");function c(u,d,l){l=l||{};var h=typeof l.maxForce<"u"?l.maxForce:1e6,f=new a,p=new a,g=new a;u.position.vadd(d.position,g),g.scale(.5,g),d.pointToLocalFrame(g,p),u.pointToLocalFrame(g,f),s.call(this,u,f,d,p,h);var m=this.rotationalEquation1=new r(u,d,l),v=this.rotationalEquation2=new r(u,d,l),_=this.rotationalEquation3=new r(u,d,l);this.equations.push(m,v,_)}c.prototype=new s,c.constructor=c,new a,new a,c.prototype.update=function(){var u=this.bodyA,d=this.bodyB;this.motorEquation;var l=this.rotationalEquation1,h=this.rotationalEquation2,f=this.rotationalEquation3;s.prototype.update.call(this),u.vectorToWorldFrame(a.UNIT_X,l.axisA),d.vectorToWorldFrame(a.UNIT_Y,l.axisB),u.vectorToWorldFrame(a.UNIT_Y,h.axisA),d.vectorToWorldFrame(a.UNIT_Z,h.axisB),u.vectorToWorldFrame(a.UNIT_Z,f.axisA),d.vectorToWorldFrame(a.UNIT_X,f.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,n,i){n.exports=c;var s=t("./Constraint"),r=t("../equations/ContactEquation"),a=t("../math/Vec3");function c(u,d,l,h,f){s.call(this,u,l),f=typeof f<"u"?f:1e6,this.pivotA=d?d.clone():new a,this.pivotB=h?h.clone():new a;var p=this.equationX=new r(u,l),g=this.equationY=new r(u,l),m=this.equationZ=new r(u,l);this.equations.push(p,g,m),p.minForce=g.minForce=m.minForce=-f,p.maxForce=g.maxForce=m.maxForce=f,p.ni.set(1,0,0),g.ni.set(0,1,0),m.ni.set(0,0,1)}c.prototype=new s,c.prototype.update=function(){var u=this.bodyA,d=this.bodyB,l=this.equationX,h=this.equationY,f=this.equationZ;u.quaternion.vmult(this.pivotA,l.ri),d.quaternion.vmult(this.pivotB,l.rj),h.ri.copy(l.ri),h.rj.copy(l.rj),f.ri.copy(l.ri),f.rj.copy(l.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,n,i){n.exports=a;var s=t("../math/Vec3");t("../math/Mat3");var r=t("./Equation");function a(d,l,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6;r.call(this,d,l,-f,f),this.axisA=h.axisA?h.axisA.clone():new s(1,0,0),this.axisB=h.axisB?h.axisB.clone():new s(0,1,0),this.angle=typeof h.angle<"u"?h.angle:0}a.prototype=new r,a.prototype.constructor=a;var c=new s,u=new s;a.prototype.computeB=function(d){var l=this.a,h=this.b,f=this.axisA,p=this.axisB,g=c,m=u,v=this.jacobianElementA,_=this.jacobianElementB;f.cross(p,g),p.cross(f,m),v.rotational.copy(m),_.rotational.copy(g);var y=Math.cos(this.angle)-f.dot(p),x=this.computeGW(),M=this.computeGiMf(),S=-y*l-x*h-d*M;return S}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,n,i){n.exports=a;var s=t("./Equation"),r=t("../math/Vec3");t("../math/Mat3");function a(m,v,_){_=typeof _<"u"?_:1e6,s.call(this,m,v,0,_),this.restitution=0,this.ri=new r,this.rj=new r,this.ni=new r}a.prototype=new s,a.prototype.constructor=a;var c=new r,u=new r,d=new r;a.prototype.computeB=function(m){var v=this.a,_=this.b,y=this.bi,x=this.bj,M=this.ri,S=this.rj,A=c,T=u,b=y.velocity,w=y.angularVelocity;y.force,y.torque;var P=x.velocity,N=x.angularVelocity;x.force,x.torque;var I=d,H=this.jacobianElementA,G=this.jacobianElementB,J=this.ni;M.cross(J,A),S.cross(J,T),J.negate(H.spatial),A.negate(H.rotational),G.spatial.copy(J),G.rotational.copy(T),I.copy(x.position),I.vadd(S,I),I.vsub(y.position,I),I.vsub(M,I);var U=J.dot(I),k=this.restitution+1,q=k*P.dot(J)-k*b.dot(J)+N.dot(T)-w.dot(A),Y=this.computeGiMf(),V=-U*v-q*_-m*Y;return V};var l=new r,h=new r,f=new r,p=new r,g=new r;a.prototype.getImpactVelocityAlongNormal=function(){var m=l,v=h,_=f,y=p,x=g;return this.bi.position.vadd(this.ri,_),this.bj.position.vadd(this.rj,y),this.bi.getVelocityAtWorldPoint(_,m),this.bj.getVelocityAtWorldPoint(y,v),m.vsub(v,x),this.ni.dot(x)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,n,i){n.exports=a;var s=t("../math/JacobianElement"),r=t("../math/Vec3");function a(g,m,v,_){this.id=a.id++,this.minForce=typeof v>"u"?-1e6:v,this.maxForce=typeof _>"u"?1e6:_,this.bi=g,this.bj=m,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new s,this.jacobianElementB=new s,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}a.prototype.constructor=a,a.id=0,a.prototype.setSpookParams=function(g,m,v){var _=m,y=g,x=v;this.a=4/(x*(1+4*_)),this.b=4*_/(1+4*_),this.eps=4/(x*x*y*(1+4*_))},a.prototype.computeB=function(g,m,v){var _=this.computeGW(),y=this.computeGq(),x=this.computeGiMf();return-y*g-_*m-x*v},a.prototype.computeGq=function(){var g=this.jacobianElementA,m=this.jacobianElementB,v=this.bi,_=this.bj,y=v.position,x=_.position;return g.spatial.dot(y)+m.spatial.dot(x)};var c=new r;a.prototype.computeGW=function(){var g=this.jacobianElementA,m=this.jacobianElementB,v=this.bi,_=this.bj,y=v.velocity,x=_.velocity,M=v.angularVelocity||c,S=_.angularVelocity||c;return g.multiplyVectors(y,M)+m.multiplyVectors(x,S)},a.prototype.computeGWlambda=function(){var g=this.jacobianElementA,m=this.jacobianElementB,v=this.bi,_=this.bj,y=v.vlambda,x=_.vlambda,M=v.wlambda||c,S=_.wlambda||c;return g.multiplyVectors(y,M)+m.multiplyVectors(x,S)};var u=new r,d=new r,l=new r,h=new r;a.prototype.computeGiMf=function(){var g=this.jacobianElementA,m=this.jacobianElementB,v=this.bi,_=this.bj,y=v.force,x=v.torque,M=_.force,S=_.torque,A=v.invMassSolve,T=_.invMassSolve;return v.invInertiaWorldSolve?v.invInertiaWorldSolve.vmult(x,l):l.set(0,0,0),_.invInertiaWorldSolve?_.invInertiaWorldSolve.vmult(S,h):h.set(0,0,0),y.mult(A,u),M.mult(T,d),g.multiplyVectors(u,l)+m.multiplyVectors(d,h)};var f=new r;a.prototype.computeGiMGt=function(){var g=this.jacobianElementA,m=this.jacobianElementB,v=this.bi,_=this.bj,y=v.invMassSolve,x=_.invMassSolve,M=v.invInertiaWorldSolve,S=_.invInertiaWorldSolve,A=y+x;return M&&(M.vmult(g.rotational,f),A+=f.dot(g.rotational)),S&&(S.vmult(m.rotational,f),A+=f.dot(m.rotational)),A};var p=new r;new r,new r,new r,new r,new r,a.prototype.addToWlambda=function(g){var m=this.jacobianElementA,v=this.jacobianElementB,_=this.bi,y=this.bj,x=p;m.spatial.mult(_.invMassSolve*g,x),_.vlambda.vadd(x,_.vlambda),v.spatial.mult(y.invMassSolve*g,x),y.vlambda.vadd(x,y.vlambda),_.invInertiaWorldSolve&&(_.invInertiaWorldSolve.vmult(m.rotational,x),x.mult(g,x),_.wlambda.vadd(x,_.wlambda)),y.invInertiaWorldSolve&&(y.invInertiaWorldSolve.vmult(v.rotational,x),x.mult(g,x),y.wlambda.vadd(x,y.wlambda))},a.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,n,i){n.exports=a;var s=t("./Equation"),r=t("../math/Vec3");t("../math/Mat3");function a(d,l,h){s.call(this,d,l,-h,h),this.ri=new r,this.rj=new r,this.t=new r}a.prototype=new s,a.prototype.constructor=a;var c=new r,u=new r;a.prototype.computeB=function(d){this.a;var l=this.b;this.bi,this.bj;var h=this.ri,f=this.rj,p=c,g=u,m=this.t;h.cross(m,p),f.cross(m,g);var v=this.jacobianElementA,_=this.jacobianElementB;m.negate(v.spatial),p.negate(v.rotational),_.spatial.copy(m),_.rotational.copy(g);var y=this.computeGW(),x=this.computeGiMf(),M=-y*l-d*x;return M}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,n,i){n.exports=a;var s=t("../math/Vec3");t("../math/Mat3");var r=t("./Equation");function a(d,l,h){h=h||{};var f=typeof h.maxForce<"u"?h.maxForce:1e6;r.call(this,d,l,-f,f),this.axisA=h.axisA?h.axisA.clone():new s(1,0,0),this.axisB=h.axisB?h.axisB.clone():new s(0,1,0),this.maxAngle=Math.PI/2}a.prototype=new r,a.prototype.constructor=a;var c=new s,u=new s;a.prototype.computeB=function(d){var l=this.a,h=this.b,f=this.axisA,p=this.axisB,g=c,m=u,v=this.jacobianElementA,_=this.jacobianElementB;f.cross(p,g),p.cross(f,m),v.rotational.copy(m),_.rotational.copy(g);var y=Math.cos(this.maxAngle)-f.dot(p),x=this.computeGW(),M=this.computeGiMf(),S=-y*l-x*h-d*M;return S}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,n,i){n.exports=a;var s=t("../math/Vec3");t("../math/Mat3");var r=t("./Equation");function a(c,u,d){d=typeof d<"u"?d:1e6,r.call(this,c,u,-d,d),this.axisA=new s,this.axisB=new s,this.targetVelocity=0}a.prototype=new r,a.prototype.constructor=a,a.prototype.computeB=function(c){this.a;var u=this.b;this.bi,this.bj;var d=this.axisA,l=this.axisB,h=this.jacobianElementA,f=this.jacobianElementB;h.rotational.copy(d),l.negate(f.rotational);var p=this.computeGW()-this.targetVelocity,g=this.computeGiMf(),m=-p*u-c*g;return m}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,n,i){var s=t("../utils/Utils");n.exports=r;function r(a,c,u){u=s.defaults(u,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=r.idCounter++,this.materials=[a,c],this.friction=u.friction,this.restitution=u.restitution,this.contactEquationStiffness=u.contactEquationStiffness,this.contactEquationRelaxation=u.contactEquationRelaxation,this.frictionEquationStiffness=u.frictionEquationStiffness,this.frictionEquationRelaxation=u.frictionEquationRelaxation}r.idCounter=0},{"../utils/Utils":53}],25:[function(t,n,i){n.exports=s;function s(r){var a="";r=r||{},typeof r=="string"?(a=r,r={}):typeof r=="object"&&(a=""),this.name=a,this.id=s.idCounter++,this.friction=typeof r.friction<"u"?r.friction:-1,this.restitution=typeof r.restitution<"u"?r.restitution:-1}s.idCounter=0},{}],26:[function(t,n,i){n.exports=r;var s=t("./Vec3");function r(){this.spatial=new s,this.rotational=new s}r.prototype.multiplyElement=function(a){return a.spatial.dot(this.spatial)+a.rotational.dot(this.rotational)},r.prototype.multiplyVectors=function(a,c){return a.dot(this.spatial)+c.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,n,i){n.exports=r;var s=t("./Vec3");function r(a){a?this.elements=a:this.elements=[0,0,0,0,0,0,0,0,0]}r.prototype.identity=function(){var a=this.elements;a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1},r.prototype.setZero=function(){var a=this.elements;a[0]=0,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0,a[8]=0},r.prototype.setTrace=function(a){var c=this.elements;c[0]=a.x,c[4]=a.y,c[8]=a.z},r.prototype.getTrace=function(c){var c=c||new s,u=this.elements;c.x=u[0],c.y=u[4],c.z=u[8]},r.prototype.vmult=function(a,c){c=c||new s;var u=this.elements,d=a.x,l=a.y,h=a.z;return c.x=u[0]*d+u[1]*l+u[2]*h,c.y=u[3]*d+u[4]*l+u[5]*h,c.z=u[6]*d+u[7]*l+u[8]*h,c},r.prototype.smult=function(a){for(var c=0;c<this.elements.length;c++)this.elements[c]*=a},r.prototype.mmult=function(a,c){for(var u=c||new r,d=0;d<3;d++)for(var l=0;l<3;l++){for(var h=0,f=0;f<3;f++)h+=a.elements[d+f*3]*this.elements[f+l*3];u.elements[d+l*3]=h}return u},r.prototype.scale=function(a,c){c=c||new r;for(var u=this.elements,d=c.elements,l=0;l!==3;l++)d[3*l+0]=a.x*u[3*l+0],d[3*l+1]=a.y*u[3*l+1],d[3*l+2]=a.z*u[3*l+2];return c},r.prototype.solve=function(a,c){c=c||new s;for(var u=3,d=4,l=[],h=0;h<u*d;h++)l.push(0);var h,f;for(h=0;h<3;h++)for(f=0;f<3;f++)l[h+d*f]=this.elements[h+3*f];l[3+4*0]=a.x,l[3+4*1]=a.y,l[3+4*2]=a.z;var p=3,g=p,m,v=4,_;do{if(h=g-p,l[h+d*h]===0){for(f=h+1;f<g;f++)if(l[h+d*f]!==0){m=v;do _=v-m,l[_+d*h]+=l[_+d*f];while(--m);break}}if(l[h+d*h]!==0)for(f=h+1;f<g;f++){var y=l[h+d*f]/l[h+d*h];m=v;do _=v-m,l[_+d*f]=_<=h?0:l[_+d*f]-l[_+d*h]*y;while(--m)}}while(--p);if(c.z=l[2*d+3]/l[2*d+2],c.y=(l[1*d+3]-l[1*d+2]*c.z)/l[1*d+1],c.x=(l[0*d+3]-l[0*d+2]*c.z-l[0*d+1]*c.y)/l[0*d+0],isNaN(c.x)||isNaN(c.y)||isNaN(c.z)||c.x===1/0||c.y===1/0||c.z===1/0)throw"Could not solve equation! Got x=["+c.toString()+"], b=["+a.toString()+"], A=["+this.toString()+"]";return c},r.prototype.e=function(a,c,u){if(u===void 0)return this.elements[c+3*a];this.elements[c+3*a]=u},r.prototype.copy=function(a){for(var c=0;c<a.elements.length;c++)this.elements[c]=a.elements[c];return this},r.prototype.toString=function(){for(var a="",c=",",u=0;u<9;u++)a+=this.elements[u]+c;return a},r.prototype.reverse=function(a){a=a||new r;for(var c=3,u=6,d=[],l=0;l<c*u;l++)d.push(0);var l,h;for(l=0;l<3;l++)for(h=0;h<3;h++)d[l+u*h]=this.elements[l+3*h];d[3+6*0]=1,d[3+6*1]=0,d[3+6*2]=0,d[4+6*0]=0,d[4+6*1]=1,d[4+6*2]=0,d[5+6*0]=0,d[5+6*1]=0,d[5+6*2]=1;var f=3,p=f,g,m=u,v;do{if(l=p-f,d[l+u*l]===0){for(h=l+1;h<p;h++)if(d[l+u*h]!==0){g=m;do v=m-g,d[v+u*l]+=d[v+u*h];while(--g);break}}if(d[l+u*l]!==0)for(h=l+1;h<p;h++){var _=d[l+u*h]/d[l+u*l];g=m;do v=m-g,d[v+u*h]=v<=l?0:d[v+u*h]-d[v+u*l]*_;while(--g)}}while(--f);l=2;do{h=l-1;do{var _=d[l+u*h]/d[l+u*l];g=u;do v=u-g,d[v+u*h]=d[v+u*h]-d[v+u*l]*_;while(--g)}while(h--)}while(--l);l=2;do{var _=1/d[l+u*l];g=u;do v=u-g,d[v+u*l]=d[v+u*l]*_;while(--g)}while(l--);l=2;do{h=2;do{if(v=d[c+h+u*l],isNaN(v)||v===1/0)throw"Could not reverse! A=["+this.toString()+"]";a.e(l,h,v)}while(h--)}while(l--);return a},r.prototype.setRotationFromQuaternion=function(a){var c=a.x,u=a.y,d=a.z,l=a.w,h=c+c,f=u+u,p=d+d,g=c*h,m=c*f,v=c*p,_=u*f,y=u*p,x=d*p,M=l*h,S=l*f,A=l*p,T=this.elements;return T[3*0+0]=1-(_+x),T[3*0+1]=m-A,T[3*0+2]=v+S,T[3*1+0]=m+A,T[3*1+1]=1-(g+x),T[3*1+2]=y-M,T[3*2+0]=v-S,T[3*2+1]=y+M,T[3*2+2]=1-(g+_),this},r.prototype.transpose=function(a){a=a||new r;for(var c=a.elements,u=this.elements,d=0;d!==3;d++)for(var l=0;l!==3;l++)c[3*d+l]=u[3*l+d];return a}},{"./Vec3":30}],28:[function(t,n,i){n.exports=r;var s=t("./Vec3");function r(h,f,p,g){this.x=h!==void 0?h:0,this.y=f!==void 0?f:0,this.z=p!==void 0?p:0,this.w=g!==void 0?g:1}r.prototype.set=function(h,f,p,g){this.x=h,this.y=f,this.z=p,this.w=g},r.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},r.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},r.prototype.setFromAxisAngle=function(h,f){var p=Math.sin(f*.5);this.x=h.x*p,this.y=h.y*p,this.z=h.z*p,this.w=Math.cos(f*.5)},r.prototype.toAxisAngle=function(h){h=h||new s,this.normalize();var f=2*Math.acos(this.w),p=Math.sqrt(1-this.w*this.w);return p<.001?(h.x=this.x,h.y=this.y,h.z=this.z):(h.x=this.x/p,h.y=this.y/p,h.z=this.z/p),[h,f]};var a=new s,c=new s;r.prototype.setFromVectors=function(h,f){if(h.isAntiparallelTo(f)){var p=a,g=c;h.tangents(p,g),this.setFromAxisAngle(p,Math.PI)}else{var m=h.cross(f);this.x=m.x,this.y=m.y,this.z=m.z,this.w=Math.sqrt(Math.pow(h.norm(),2)*Math.pow(f.norm(),2))+h.dot(f),this.normalize()}};var u=new s,d=new s,l=new s;r.prototype.mult=function(h,f){f=f||new r;var p=this.w,g=u,m=d,v=l;return g.set(this.x,this.y,this.z),m.set(h.x,h.y,h.z),f.w=p*h.w-g.dot(m),g.cross(m,v),f.x=p*m.x+h.w*g.x+v.x,f.y=p*m.y+h.w*g.y+v.y,f.z=p*m.z+h.w*g.z+v.z,f},r.prototype.inverse=function(h){var f=this.x,p=this.y,g=this.z,m=this.w;h=h||new r,this.conjugate(h);var v=1/(f*f+p*p+g*g+m*m);return h.x*=v,h.y*=v,h.z*=v,h.w*=v,h},r.prototype.conjugate=function(h){return h=h||new r,h.x=-this.x,h.y=-this.y,h.z=-this.z,h.w=this.w,h},r.prototype.normalize=function(){var h=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(h=1/h,this.x*=h,this.y*=h,this.z*=h,this.w*=h)},r.prototype.normalizeFast=function(){var h=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;h===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=h,this.y*=h,this.z*=h,this.w*=h)},r.prototype.vmult=function(h,f){f=f||new s;var p=h.x,g=h.y,m=h.z,v=this.x,_=this.y,y=this.z,x=this.w,M=x*p+_*m-y*g,S=x*g+y*p-v*m,A=x*m+v*g-_*p,T=-v*p-_*g-y*m;return f.x=M*x+T*-v+S*-y-A*-_,f.y=S*x+T*-_+A*-v-M*-y,f.z=A*x+T*-y+M*-_-S*-v,f},r.prototype.copy=function(h){return this.x=h.x,this.y=h.y,this.z=h.z,this.w=h.w,this},r.prototype.toEuler=function(h,f){f=f||"YZX";var p,g,m,v=this.x,_=this.y,y=this.z,x=this.w;switch(f){case"YZX":var M=v*_+y*x;if(M>.499&&(p=2*Math.atan2(v,x),g=Math.PI/2,m=0),M<-.499&&(p=-2*Math.atan2(v,x),g=-Math.PI/2,m=0),isNaN(p)){var S=v*v,A=_*_,T=y*y;p=Math.atan2(2*_*x-2*v*y,1-2*A-2*T),g=Math.asin(2*M),m=Math.atan2(2*v*x-2*_*y,1-2*S-2*T)}break;default:throw new Error("Euler order "+f+" not supported yet.")}h.y=p,h.z=g,h.x=m},r.prototype.setFromEuler=function(h,f,p,g){g=g||"XYZ";var m=Math.cos(h/2),v=Math.cos(f/2),_=Math.cos(p/2),y=Math.sin(h/2),x=Math.sin(f/2),M=Math.sin(p/2);return g==="XYZ"?(this.x=y*v*_+m*x*M,this.y=m*x*_-y*v*M,this.z=m*v*M+y*x*_,this.w=m*v*_-y*x*M):g==="YXZ"?(this.x=y*v*_+m*x*M,this.y=m*x*_-y*v*M,this.z=m*v*M-y*x*_,this.w=m*v*_+y*x*M):g==="ZXY"?(this.x=y*v*_-m*x*M,this.y=m*x*_+y*v*M,this.z=m*v*M+y*x*_,this.w=m*v*_-y*x*M):g==="ZYX"?(this.x=y*v*_-m*x*M,this.y=m*x*_+y*v*M,this.z=m*v*M-y*x*_,this.w=m*v*_+y*x*M):g==="YZX"?(this.x=y*v*_+m*x*M,this.y=m*x*_+y*v*M,this.z=m*v*M-y*x*_,this.w=m*v*_-y*x*M):g==="XZY"&&(this.x=y*v*_-m*x*M,this.y=m*x*_-y*v*M,this.z=m*v*M+y*x*_,this.w=m*v*_+y*x*M),this},r.prototype.clone=function(){return new r(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,n,i){var s=t("./Vec3"),r=t("./Quaternion");n.exports=a;function a(u){u=u||{},this.position=new s,u.position&&this.position.copy(u.position),this.quaternion=new r,u.quaternion&&this.quaternion.copy(u.quaternion)}var c=new r;a.pointToLocalFrame=function(u,d,l,f){var f=f||new s;return l.vsub(u,f),d.conjugate(c),c.vmult(f,f),f},a.prototype.pointToLocal=function(u,d){return a.pointToLocalFrame(this.position,this.quaternion,u,d)},a.pointToWorldFrame=function(u,d,l,f){var f=f||new s;return d.vmult(l,f),f.vadd(u,f),f},a.prototype.pointToWorld=function(u,d){return a.pointToWorldFrame(this.position,this.quaternion,u,d)},a.prototype.vectorToWorldFrame=function(u,l){var l=l||new s;return this.quaternion.vmult(u,l),l},a.vectorToWorldFrame=function(u,d,l){return u.vmult(d,l),l},a.vectorToLocalFrame=function(u,d,l,f){var f=f||new s;return d.w*=-1,d.vmult(l,f),d.w*=-1,f}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,n,i){n.exports=r;var s=t("./Mat3");function r(d,l,h){this.x=d||0,this.y=l||0,this.z=h||0}r.ZERO=new r(0,0,0),r.UNIT_X=new r(1,0,0),r.UNIT_Y=new r(0,1,0),r.UNIT_Z=new r(0,0,1),r.prototype.cross=function(d,l){var h=d.x,f=d.y,p=d.z,g=this.x,m=this.y,v=this.z;return l=l||new r,l.x=m*p-v*f,l.y=v*h-g*p,l.z=g*f-m*h,l},r.prototype.set=function(d,l,h){return this.x=d,this.y=l,this.z=h,this},r.prototype.setZero=function(){this.x=this.y=this.z=0},r.prototype.vadd=function(d,l){if(l)l.x=d.x+this.x,l.y=d.y+this.y,l.z=d.z+this.z;else return new r(this.x+d.x,this.y+d.y,this.z+d.z)},r.prototype.vsub=function(d,l){if(l)l.x=this.x-d.x,l.y=this.y-d.y,l.z=this.z-d.z;else return new r(this.x-d.x,this.y-d.y,this.z-d.z)},r.prototype.crossmat=function(){return new s([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},r.prototype.normalize=function(){var d=this.x,l=this.y,h=this.z,f=Math.sqrt(d*d+l*l+h*h);if(f>0){var p=1/f;this.x*=p,this.y*=p,this.z*=p}else this.x=0,this.y=0,this.z=0;return f},r.prototype.unit=function(d){d=d||new r;var l=this.x,h=this.y,f=this.z,p=Math.sqrt(l*l+h*h+f*f);return p>0?(p=1/p,d.x=l*p,d.y=h*p,d.z=f*p):(d.x=1,d.y=0,d.z=0),d},r.prototype.norm=function(){var d=this.x,l=this.y,h=this.z;return Math.sqrt(d*d+l*l+h*h)},r.prototype.length=r.prototype.norm,r.prototype.norm2=function(){return this.dot(this)},r.prototype.lengthSquared=r.prototype.norm2,r.prototype.distanceTo=function(d){var l=this.x,h=this.y,f=this.z,p=d.x,g=d.y,m=d.z;return Math.sqrt((p-l)*(p-l)+(g-h)*(g-h)+(m-f)*(m-f))},r.prototype.distanceSquared=function(d){var l=this.x,h=this.y,f=this.z,p=d.x,g=d.y,m=d.z;return(p-l)*(p-l)+(g-h)*(g-h)+(m-f)*(m-f)},r.prototype.mult=function(d,l){l=l||new r;var h=this.x,f=this.y,p=this.z;return l.x=d*h,l.y=d*f,l.z=d*p,l},r.prototype.scale=r.prototype.mult,r.prototype.dot=function(d){return this.x*d.x+this.y*d.y+this.z*d.z},r.prototype.isZero=function(){return this.x===0&&this.y===0&&this.z===0},r.prototype.negate=function(d){return d=d||new r,d.x=-this.x,d.y=-this.y,d.z=-this.z,d};var a=new r,c=new r;r.prototype.tangents=function(d,l){var h=this.norm();if(h>0){var f=a,p=1/h;f.set(this.x*p,this.y*p,this.z*p);var g=c;Math.abs(f.x)<.9?(g.set(1,0,0),f.cross(g,d)):(g.set(0,1,0),f.cross(g,d)),f.cross(d,l)}else d.set(1,0,0),l.set(0,1,0)},r.prototype.toString=function(){return this.x+","+this.y+","+this.z},r.prototype.toArray=function(){return[this.x,this.y,this.z]},r.prototype.copy=function(d){return this.x=d.x,this.y=d.y,this.z=d.z,this},r.prototype.lerp=function(d,l,h){var f=this.x,p=this.y,g=this.z;h.x=f+(d.x-f)*l,h.y=p+(d.y-p)*l,h.z=g+(d.z-g)*l},r.prototype.almostEquals=function(d,l){return l===void 0&&(l=1e-6),!(Math.abs(this.x-d.x)>l||Math.abs(this.y-d.y)>l||Math.abs(this.z-d.z)>l)},r.prototype.almostZero=function(d){return d===void 0&&(d=1e-6),!(Math.abs(this.x)>d||Math.abs(this.y)>d||Math.abs(this.z)>d)};var u=new r;r.prototype.isAntiparallelTo=function(d,l){return this.negate(u),u.almostEquals(d,l)},r.prototype.clone=function(){return new r(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,n,i){n.exports=l;var s=t("../utils/EventTarget");t("../shapes/Shape");var r=t("../math/Vec3"),a=t("../math/Mat3"),c=t("../math/Quaternion");t("../material/Material");var u=t("../collision/AABB"),d=t("../shapes/Box");function l(P){P=P||{},s.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new r,this.collisionFilterGroup=typeof P.collisionFilterGroup=="number"?P.collisionFilterGroup:1,this.collisionFilterMask=typeof P.collisionFilterMask=="number"?P.collisionFilterMask:1,this.collisionResponse=!0,this.position=new r,P.position&&this.position.copy(P.position),this.previousPosition=new r,this.initPosition=new r,this.velocity=new r,P.velocity&&this.velocity.copy(P.velocity),this.initVelocity=new r,this.force=new r;var N=typeof P.mass=="number"?P.mass:0;this.mass=N,this.invMass=N>0?1/N:0,this.material=P.material||null,this.linearDamping=typeof P.linearDamping=="number"?P.linearDamping:.01,this.type=N<=0?l.STATIC:l.DYNAMIC,typeof P.type==typeof l.STATIC&&(this.type=P.type),this.allowSleep=typeof P.allowSleep<"u"?P.allowSleep:!0,this.sleepState=0,this.sleepSpeedLimit=typeof P.sleepSpeedLimit<"u"?P.sleepSpeedLimit:.1,this.sleepTimeLimit=typeof P.sleepTimeLimit<"u"?P.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new r,this.quaternion=new c,P.quaternion&&this.quaternion.copy(P.quaternion),this.initQuaternion=new c,this.angularVelocity=new r,P.angularVelocity&&this.angularVelocity.copy(P.angularVelocity),this.initAngularVelocity=new r,this.interpolatedPosition=new r,this.interpolatedQuaternion=new c,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new r,this.invInertia=new r,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new r,this.invInertiaWorldSolve=new a,this.fixedRotation=typeof P.fixedRotation<"u"?P.fixedRotation:!1,this.angularDamping=typeof P.angularDamping<"u"?P.angularDamping:.01,this.aabb=new u,this.aabbNeedsUpdate=!0,this.wlambda=new r,P.shape&&this.addShape(P.shape),this.updateMassProperties()}l.prototype=new s,l.prototype.constructor=l,l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.prototype.wakeUp=function(){var P=this.sleepState;this.sleepState=0,P===l.SLEEPING&&this.dispatchEvent({type:"wakeup"})},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(P){if(this.allowSleep){var N=this.sleepState,I=this.velocity.norm2()+this.angularVelocity.norm2(),H=Math.pow(this.sleepSpeedLimit,2);N===l.AWAKE&&I<H?(this.sleepState=l.SLEEPY,this.timeLastSleepy=P,this.dispatchEvent(l.sleepyEvent)):N===l.SLEEPY&&I>H?this.wakeUp():N===l.SLEEPY&&P-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(P,I){var I=I||new r;return P.vsub(this.position,I),this.quaternion.conjugate().vmult(I,I),I},l.prototype.vectorToLocalFrame=function(P,I){var I=I||new r;return this.quaternion.conjugate().vmult(P,I),I},l.prototype.pointToWorldFrame=function(P,I){var I=I||new r;return this.quaternion.vmult(P,I),I.vadd(this.position,I),I},l.prototype.vectorToWorldFrame=function(P,I){var I=I||new r;return this.quaternion.vmult(P,I),I};var h=new r,f=new c;l.prototype.addShape=function(P,N,I){var H=new r,G=new c;return N&&H.copy(N),I&&G.copy(I),this.shapes.push(P),this.shapeOffsets.push(H),this.shapeOrientations.push(G),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},l.prototype.updateBoundingRadius=function(){for(var P=this.shapes,N=this.shapeOffsets,I=P.length,H=0,G=0;G!==I;G++){var J=P[G];J.updateBoundingSphereRadius();var U=N[G].norm(),k=J.boundingSphereRadius;U+k>H&&(H=U+k)}this.boundingRadius=H};var p=new u;l.prototype.computeAABB=function(){for(var P=this.shapes,N=this.shapeOffsets,I=this.shapeOrientations,H=P.length,G=h,J=f,U=this.quaternion,k=this.aabb,q=p,Y=0;Y!==H;Y++){var V=P[Y];I[Y].mult(U,J),J.vmult(N[Y],G),G.vadd(this.position,G),V.calculateWorldAABB(G,J,q.lowerBound,q.upperBound),Y===0?k.copy(q):k.extend(q)}this.aabbNeedsUpdate=!1};var g=new a,m=new a;new a,l.prototype.updateInertiaWorld=function(P){var N=this.invInertia;if(!(N.x===N.y&&N.y===N.z&&!P)){var I=g,H=m;I.setRotationFromQuaternion(this.quaternion),I.transpose(H),I.scale(N,I),I.mmult(H,this.invInertiaWorld)}};var v=new r,_=new r;l.prototype.applyForce=function(P,N){if(this.type===l.DYNAMIC){var I=v;N.vsub(this.position,I);var H=_;I.cross(P,H),this.force.vadd(P,this.force),this.torque.vadd(H,this.torque)}};var y=new r,x=new r;l.prototype.applyLocalForce=function(P,N){if(this.type===l.DYNAMIC){var I=y,H=x;this.vectorToWorldFrame(P,I),this.pointToWorldFrame(N,H),this.applyForce(I,H)}};var M=new r,S=new r,A=new r;l.prototype.applyImpulse=function(P,N){if(this.type===l.DYNAMIC){var I=M;N.vsub(this.position,I);var H=S;H.copy(P),H.mult(this.invMass,H),this.velocity.vadd(H,this.velocity);var G=A;I.cross(P,G),this.invInertiaWorld.vmult(G,G),this.angularVelocity.vadd(G,this.angularVelocity)}};var T=new r,b=new r;l.prototype.applyLocalImpulse=function(P,N){if(this.type===l.DYNAMIC){var I=T,H=b;this.vectorToWorldFrame(P,I),this.pointToWorldFrame(N,H),this.applyImpulse(I,H)}};var w=new r;l.prototype.updateMassProperties=function(){var P=w;this.invMass=this.mass>0?1/this.mass:0;var N=this.inertia,I=this.fixedRotation;this.computeAABB(),P.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),d.calculateInertia(P,this.mass,N),this.invInertia.set(N.x>0&&!I?1/N.x:0,N.y>0&&!I?1/N.y:0,N.z>0&&!I?1/N.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(P,N){var I=new r;return P.vsub(this.position,I),this.angularVelocity.cross(I,N),this.velocity.vadd(N,N),N}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,n,i){t("./Body");var s=t("../math/Vec3"),r=t("../math/Quaternion");t("../collision/RaycastResult");var a=t("../collision/Ray"),c=t("../objects/WheelInfo");n.exports=u;function u(U){this.chassisBody=U.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=typeof U.indexRightAxis<"u"?U.indexRightAxis:1,this.indexForwardAxis=typeof U.indexForwardAxis<"u"?U.indexForwardAxis:0,this.indexUpAxis=typeof U.indexUpAxis<"u"?U.indexUpAxis:2}new s,new s,new s;var d=new s,l=new s,h=new s;new a,u.prototype.addWheel=function(U){U=U||{};var k=new c(U),q=this.wheelInfos.length;return this.wheelInfos.push(k),q},u.prototype.setSteeringValue=function(U,k){var q=this.wheelInfos[k];q.steering=U},new s,u.prototype.applyEngineForce=function(U,k){this.wheelInfos[k].engineForce=U},u.prototype.setBrake=function(U,k){this.wheelInfos[k].brake=U},u.prototype.addToWorld=function(U){this.constraints,U.add(this.chassisBody);var k=this;this.preStepCallback=function(){k.updateVehicle(U.dt)},U.addEventListener("preStep",this.preStepCallback),this.world=U},u.prototype.getVehicleAxisWorld=function(U,k){k.set(U===0?1:0,U===1?1:0,U===2?1:0),this.chassisBody.vectorToWorldFrame(k,k)},u.prototype.updateVehicle=function(U){for(var k=this.wheelInfos,q=k.length,Y=this.chassisBody,V=0;V<q;V++)this.updateWheelTransform(V);this.currentVehicleSpeedKmHour=3.6*Y.velocity.norm();var Z=new s;this.getVehicleAxisWorld(this.indexForwardAxis,Z),Z.dot(Y.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var V=0;V<q;V++)this.castRay(k[V]);this.updateSuspension(U);for(var W=new s,L=new s,V=0;V<q;V++){var F=k[V],X=F.suspensionForce;X>F.maxSuspensionForce&&(X=F.maxSuspensionForce),F.raycastResult.hitNormalWorld.scale(X*U,W),F.raycastResult.hitPointWorld.vsub(Y.position,L),Y.applyImpulse(W,F.raycastResult.hitPointWorld)}this.updateFriction(U);var ee=new s,re=new s,K=new s;for(V=0;V<q;V++){var F=k[V];Y.getVelocityAtWorldPoint(F.chassisConnectionPointWorld,K);var O=1;switch(this.indexUpAxis){case 1:O=-1;break}if(F.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,re);var de=re.dot(F.raycastResult.hitNormalWorld);F.raycastResult.hitNormalWorld.scale(de,ee),re.vsub(ee,re);var _e=re.dot(K);F.deltaRotation=O*_e*U/F.radius}(F.sliding||!F.isInContact)&&F.engineForce!==0&&F.useCustomSlidingRotationalSpeed&&(F.deltaRotation=(F.engineForce>0?1:-1)*F.customSlidingRotationalSpeed*U),Math.abs(F.brake)>Math.abs(F.engineForce)&&(F.deltaRotation=0),F.rotation+=F.deltaRotation,F.deltaRotation*=.99}},u.prototype.updateSuspension=function(U){for(var k=this.chassisBody,q=k.mass,Y=this.wheelInfos,V=Y.length,Z=0;Z<V;Z++){var W=Y[Z];if(W.isInContact){var L,F=W.suspensionRestLength,X=W.suspensionLength,ee=F-X;L=W.suspensionStiffness*ee*W.clippedInvContactDotSuspension;var re=W.suspensionRelativeVelocity,K;re<0?K=W.dampingCompression:K=W.dampingRelaxation,L-=K*re,W.suspensionForce=L*q,W.suspensionForce<0&&(W.suspensionForce=0)}else W.suspensionForce=0}},u.prototype.removeFromWorld=function(U){this.constraints,U.remove(this.chassisBody),U.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new s,p=new s;u.prototype.castRay=function(U){var k=f,q=p;this.updateWheelTransformWorld(U);var Y=this.chassisBody,V=-1,Z=U.suspensionRestLength+U.radius;U.directionWorld.scale(Z,k);var W=U.chassisConnectionPointWorld;W.vadd(k,q);var L=U.raycastResult;L.reset();var F=Y.collisionResponse;Y.collisionResponse=!1,this.world.rayTest(W,q,L),Y.collisionResponse=F;var X=L.body;if(U.raycastResult.groundObject=0,X){V=L.distance,U.raycastResult.hitNormalWorld=L.hitNormalWorld,U.isInContact=!0;var ee=L.distance;U.suspensionLength=ee-U.radius;var re=U.suspensionRestLength-U.maxSuspensionTravel,K=U.suspensionRestLength+U.maxSuspensionTravel;U.suspensionLength<re&&(U.suspensionLength=re),U.suspensionLength>K&&(U.suspensionLength=K,U.raycastResult.reset());var O=U.raycastResult.hitNormalWorld.dot(U.directionWorld),de=new s;Y.getVelocityAtWorldPoint(U.raycastResult.hitPointWorld,de);var _e=U.raycastResult.hitNormalWorld.dot(de);if(O>=-.1)U.suspensionRelativeVelocity=0,U.clippedInvContactDotSuspension=1/.1;else{var Me=-1/O;U.suspensionRelativeVelocity=_e*Me,U.clippedInvContactDotSuspension=Me}}else U.suspensionLength=U.suspensionRestLength+0*U.maxSuspensionTravel,U.suspensionRelativeVelocity=0,U.directionWorld.scale(-1,U.raycastResult.hitNormalWorld),U.clippedInvContactDotSuspension=1;return V},u.prototype.updateWheelTransformWorld=function(U){U.isInContact=!1;var k=this.chassisBody;k.pointToWorldFrame(U.chassisConnectionPointLocal,U.chassisConnectionPointWorld),k.vectorToWorldFrame(U.directionLocal,U.directionWorld),k.vectorToWorldFrame(U.axleLocal,U.axleWorld)},u.prototype.updateWheelTransform=function(U){var k=d,q=l,Y=h,V=this.wheelInfos[U];this.updateWheelTransformWorld(V),V.directionLocal.scale(-1,k),q.copy(V.axleLocal),k.cross(q,Y),Y.normalize(),q.normalize();var Z=V.steering,W=new r;W.setFromAxisAngle(k,Z);var L=new r;L.setFromAxisAngle(q,V.rotation);var F=V.worldTransform.quaternion;this.chassisBody.quaternion.mult(W,F),F.mult(L,F),F.normalize();var X=V.worldTransform.position;X.copy(V.directionWorld),X.scale(V.suspensionLength,X),X.vadd(V.chassisConnectionPointWorld,X)};var g=[new s(1,0,0),new s(0,1,0),new s(0,0,1)];u.prototype.getWheelTransformWorld=function(U){return this.wheelInfos[U].worldTransform};var m=new s,v=[],_=[],y=1;u.prototype.updateFriction=function(U){for(var k=m,q=this.wheelInfos,Y=q.length,V=this.chassisBody,Z=_,W=v,L=0;L<Y;L++){var F=q[L],X=F.raycastResult.body;F.sideImpulse=0,F.forwardImpulse=0,Z[L]||(Z[L]=new s),W[L]||(W[L]=new s)}for(var L=0;L<Y;L++){var F=q[L],X=F.raycastResult.body;if(X){var ee=W[L],re=this.getWheelTransformWorld(L);re.vectorToWorldFrame(g[this.indexRightAxis],ee);var K=F.raycastResult.hitNormalWorld,O=ee.dot(K);K.scale(O,k),ee.vsub(k,ee),ee.normalize(),K.cross(ee,Z[L]),Z[L].normalize(),F.sideImpulse=J(V,F.raycastResult.hitPointWorld,X,F.raycastResult.hitPointWorld,ee),F.sideImpulse*=y}}var de=1,_e=.5;this.sliding=!1;for(var L=0;L<Y;L++){var F=q[L],X=F.raycastResult.body,Me=0;if(F.slipInfo=1,X){var me=0,le=F.brake?F.brake:me;Me=A(V,X,F.raycastResult.hitPointWorld,Z[L],le),Me+=F.engineForce*U;var ue=le/Me;F.slipInfo*=ue}if(F.forwardImpulse=0,F.skidInfo=1,X){F.skidInfo=1;var We=F.suspensionForce*U*F.frictionSlip,Ge=We,B=We*Ge;F.forwardImpulse=Me;var C=F.forwardImpulse*_e,ie=F.sideImpulse*de,he=C*C+ie*ie;if(F.sliding=!1,he>B){this.sliding=!0,F.sliding=!0;var ue=We/Math.sqrt(he);F.skidInfo*=ue}}}if(this.sliding)for(var L=0;L<Y;L++){var F=q[L];F.sideImpulse!==0&&F.skidInfo<1&&(F.forwardImpulse*=F.skidInfo,F.sideImpulse*=F.skidInfo)}for(var L=0;L<Y;L++){var F=q[L],fe=new s;if(fe.copy(F.raycastResult.hitPointWorld),F.forwardImpulse!==0){var ge=new s;Z[L].scale(F.forwardImpulse,ge),V.applyImpulse(ge,fe)}if(F.sideImpulse!==0){var X=F.raycastResult.body,Ie=new s;Ie.copy(F.raycastResult.hitPointWorld);var Ee=new s;W[L].scale(F.sideImpulse,Ee),V.pointToLocalFrame(fe,fe),fe["xyz"[this.indexUpAxis]]*=F.rollInfluence,V.pointToWorldFrame(fe,fe),V.applyImpulse(Ee,fe),Ee.scale(-1,Ee),X.applyImpulse(Ee,Ie)}}};var x=new s,M=new s,S=new s;function A(U,k,q,Y,V){var Z=0,W=q,L=x,F=M,X=S;U.getVelocityAtWorldPoint(W,L),k.getVelocityAtWorldPoint(W,F),L.vsub(F,X);var ee=Y.dot(X),re=N(U,q,Y),K=N(k,q,Y),O=1,de=O/(re+K);return Z=-ee*de,V<Z&&(Z=V),Z<-V&&(Z=-V),Z}var T=new s,b=new s,w=new s,P=new s;function N(U,k,q){var Y=T,V=b,Z=w,W=P;return k.vsub(U.position,Y),Y.cross(q,V),U.invInertiaWorld.vmult(V,W),W.cross(Y,Z),U.invMass+q.dot(Z)}var I=new s,H=new s,G=new s;function J(U,k,q,Y,V,O){var W=V.norm2();if(W>1.1)return 0;var L=I,F=H,X=G;U.getVelocityAtWorldPoint(k,L),q.getVelocityAtWorldPoint(Y,F),L.vsub(F,X);var ee=V.dot(X),re=.2,K=1/(U.invMass+q.invMass),O=-re*ee*K;return O}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,n,i){var s=t("./Body"),r=t("../shapes/Sphere"),a=t("../shapes/Box"),c=t("../math/Vec3"),u=t("../constraints/HingeConstraint");n.exports=d;function d(f){if(this.wheelBodies=[],this.coordinateSystem=typeof f.coordinateSystem>"u"?new c(1,2,3):f.coordinateSystem.clone(),this.chassisBody=f.chassisBody,!this.chassisBody){var p=new a(new c(5,2,.5));this.chassisBody=new s(1,p)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}d.prototype.addWheel=function(f){f=f||{};var p=f.body;p||(p=new s(1,new r(1.2))),this.wheelBodies.push(p),this.wheelForces.push(0),new c;var g=typeof f.position<"u"?f.position.clone():new c,m=new c;this.chassisBody.pointToWorldFrame(g,m),p.position.set(m.x,m.y,m.z);var v=typeof f.axis<"u"?f.axis.clone():new c(0,1,0);this.wheelAxes.push(v);var _=new u(this.chassisBody,p,{pivotA:g,axisA:v,pivotB:c.ZERO,axisB:v,collideConnected:!1});return this.constraints.push(_),this.wheelBodies.length-1},d.prototype.setSteeringValue=function(f,p){var g=this.wheelAxes[p],m=Math.cos(f),v=Math.sin(f),_=g.x,y=g.y;this.constraints[p].axisA.set(m*_-v*y,v*_+m*y,0)},d.prototype.setMotorSpeed=function(f,p){var g=this.constraints[p];g.enableMotor(),g.motorTargetVelocity=f},d.prototype.disableMotor=function(f){var p=this.constraints[f];p.disableMotor()};var l=new c;d.prototype.setWheelForce=function(f,p){this.wheelForces[p]=f},d.prototype.applyWheelForce=function(f,p){var g=this.wheelAxes[p],m=this.wheelBodies[p],v=m.torque;g.scale(f,l),m.vectorToWorldFrame(l,l),v.vadd(l,v)},d.prototype.addToWorld=function(f){for(var p=this.constraints,g=this.wheelBodies.concat([this.chassisBody]),m=0;m<g.length;m++)f.add(g[m]);for(var m=0;m<p.length;m++)f.addConstraint(p[m]);f.addEventListener("preStep",this._update.bind(this))},d.prototype._update=function(){for(var f=this.wheelForces,p=0;p<f.length;p++)this.applyWheelForce(f[p],p)},d.prototype.removeFromWorld=function(f){for(var p=this.constraints,g=this.wheelBodies.concat([this.chassisBody]),m=0;m<g.length;m++)f.remove(g[m]);for(var m=0;m<p.length;m++)f.removeConstraint(p[m])};var h=new c;d.prototype.getWheelSpeed=function(f){var p=this.wheelAxes[f],g=this.wheelBodies[f],m=g.angularVelocity;return this.chassisBody.vectorToWorldFrame(p,h),m.dot(h)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,n,i){n.exports=r,t("../shapes/Shape");var s=t("../math/Vec3");t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material");function r(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}r.prototype.add=function(p){this.particles.push(p),this.neighbors.length<this.particles.length&&this.neighbors.push([])},r.prototype.remove=function(p){var g=this.particles.indexOf(p);g!==-1&&(this.particles.splice(g,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var a=new s;r.prototype.getNeighbors=function(p,g){for(var m=this.particles.length,v=p.id,_=this.smoothingRadius*this.smoothingRadius,y=a,x=0;x!==m;x++){var M=this.particles[x];M.position.vsub(p.position,y),v!==M.id&&y.norm2()<_&&g.push(M)}};var c=new s,u=new s,d=new s,l=new s,h=new s,f=new s;r.prototype.update=function(){for(var p=this.particles.length,g=c,m=this.speedOfSound,v=this.eps,_=0;_!==p;_++){var y=this.particles[_],x=this.neighbors[_];x.length=0,this.getNeighbors(y,x),x.push(this.particles[_]);for(var M=x.length,S=0,A=0;A!==M;A++){y.position.vsub(x[A].position,g);var T=g.norm(),b=this.w(T);S+=x[A].mass*b}this.densities[_]=S,this.pressures[_]=m*m*(this.densities[_]-this.density)}for(var w=u,P=d,N=l,I=h,H=f,_=0;_!==p;_++){var G=this.particles[_];w.set(0,0,0),P.set(0,0,0);for(var J,U,x=this.neighbors[_],M=x.length,A=0;A!==M;A++){var k=x[A];G.position.vsub(k.position,I);var q=I.norm();J=-k.mass*(this.pressures[_]/(this.densities[_]*this.densities[_]+v)+this.pressures[A]/(this.densities[A]*this.densities[A]+v)),this.gradw(I,N),N.mult(J,N),w.vadd(N,w),k.velocity.vsub(G.velocity,H),H.mult(1/(1e-4+this.densities[_]*this.densities[A])*this.viscosity*k.mass,H),U=this.nablaw(q),H.mult(U,H),P.vadd(H,P)}P.mult(G.mass,P),w.mult(G.mass,w),G.force.vadd(P,G.force),G.force.vadd(w,G.force)}},r.prototype.w=function(p){var g=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(g,9))*Math.pow(g*g-p*p,3)},r.prototype.gradw=function(p,g){var m=p.norm(),v=this.smoothingRadius;p.mult(945/(32*Math.PI*Math.pow(v,9))*Math.pow(v*v-m*m,2),g)},r.prototype.nablaw=function(p){var g=this.smoothingRadius,m=945/(32*Math.PI*Math.pow(g,9))*(g*g-p*p)*(7*p*p-3*g*g);return m}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,n,i){var s=t("../math/Vec3");n.exports=r;function r(_,y,x){x=x||{},this.restLength=typeof x.restLength=="number"?x.restLength:1,this.stiffness=x.stiffness||100,this.damping=x.damping||1,this.bodyA=_,this.bodyB=y,this.localAnchorA=new s,this.localAnchorB=new s,x.localAnchorA&&this.localAnchorA.copy(x.localAnchorA),x.localAnchorB&&this.localAnchorB.copy(x.localAnchorB),x.worldAnchorA&&this.setWorldAnchorA(x.worldAnchorA),x.worldAnchorB&&this.setWorldAnchorB(x.worldAnchorB)}r.prototype.setWorldAnchorA=function(_){this.bodyA.pointToLocalFrame(_,this.localAnchorA)},r.prototype.setWorldAnchorB=function(_){this.bodyB.pointToLocalFrame(_,this.localAnchorB)},r.prototype.getWorldAnchorA=function(_){this.bodyA.pointToWorldFrame(this.localAnchorA,_)},r.prototype.getWorldAnchorB=function(_){this.bodyB.pointToWorldFrame(this.localAnchorB,_)};var a=new s,c=new s,u=new s,d=new s,l=new s,h=new s,f=new s,p=new s,g=new s,m=new s,v=new s;r.prototype.applyForce=function(){var _=this.stiffness,y=this.damping,x=this.restLength,M=this.bodyA,S=this.bodyB,A=a,T=c,b=u,w=d,P=v,N=l,I=h,H=f,G=p,J=g,U=m;this.getWorldAnchorA(N),this.getWorldAnchorB(I),N.vsub(M.position,H),I.vsub(S.position,G),I.vsub(N,A);var k=A.norm();T.copy(A),T.normalize(),S.velocity.vsub(M.velocity,b),S.angularVelocity.cross(G,P),b.vadd(P,b),M.angularVelocity.cross(H,P),b.vsub(P,b),T.mult(-_*(k-x)-y*b.dot(T),w),M.force.vsub(w,M.force),S.force.vadd(w,S.force),H.cross(w,J),G.cross(w,U),M.torque.vsub(J,M.torque),S.torque.vadd(U,S.torque)}},{"../math/Vec3":30}],36:[function(t,n,i){var s=t("../math/Vec3"),r=t("../math/Transform"),a=t("../collision/RaycastResult"),c=t("../utils/Utils");n.exports=u;function u(h){h=c.defaults(h,{chassisConnectionPointLocal:new s,chassisConnectionPointWorld:new s,directionLocal:new s,directionWorld:new s,axleLocal:new s,axleWorld:new s,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=h.maxSuspensionTravel,this.customSlidingRotationalSpeed=h.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=h.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=h.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=h.chassisConnectionPointWorld.clone(),this.directionLocal=h.directionLocal.clone(),this.directionWorld=h.directionWorld.clone(),this.axleLocal=h.axleLocal.clone(),this.axleWorld=h.axleWorld.clone(),this.suspensionRestLength=h.suspensionRestLength,this.suspensionMaxLength=h.suspensionMaxLength,this.radius=h.radius,this.suspensionStiffness=h.suspensionStiffness,this.dampingCompression=h.dampingCompression,this.dampingRelaxation=h.dampingRelaxation,this.frictionSlip=h.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=h.rollInfluence,this.maxSuspensionForce=h.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=h.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new r,this.isInContact=!1}var l=new s,d=new s,l=new s;u.prototype.updateWheel=function(h){var f=this.raycastResult;if(this.isInContact){var p=f.hitNormalWorld.dot(f.directionWorld);f.hitPointWorld.vsub(h.position,d),h.getVelocityAtWorldPoint(d,l);var g=f.hitNormalWorld.dot(l);if(p>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=1/.1;else{var m=-1/p;this.suspensionRelativeVelocity=g*m,this.clippedInvContactDotSuspension=m}}else f.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,f.directionWorld.scale(-1,f.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,n,i){n.exports=c;var s=t("./Shape"),r=t("../math/Vec3"),a=t("./ConvexPolyhedron");function c(l){s.call(this),this.type=s.types.BOX,this.halfExtents=l,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}c.prototype=new s,c.prototype.constructor=c,c.prototype.updateConvexPolyhedronRepresentation=function(){var l=this.halfExtents.x,h=this.halfExtents.y,f=this.halfExtents.z,p=r,g=[new p(-l,-h,-f),new p(l,-h,-f),new p(l,h,-f),new p(-l,h,-f),new p(-l,-h,f),new p(l,-h,f),new p(l,h,f),new p(-l,h,f)],m=[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]];new p(0,0,1),new p(0,1,0),new p(1,0,0);var v=new a(g,m);this.convexPolyhedronRepresentation=v,v.material=this.material},c.prototype.calculateLocalInertia=function(l,h){return h=h||new r,c.calculateInertia(this.halfExtents,l,h),h},c.calculateInertia=function(l,h,f){var p=l;f.x=1/12*h*(2*p.y*2*p.y+2*p.z*2*p.z),f.y=1/12*h*(2*p.x*2*p.x+2*p.z*2*p.z),f.z=1/12*h*(2*p.y*2*p.y+2*p.x*2*p.x)},c.prototype.getSideNormals=function(l,h){var f=l,p=this.halfExtents;if(f[0].set(p.x,0,0),f[1].set(0,p.y,0),f[2].set(0,0,p.z),f[3].set(-p.x,0,0),f[4].set(0,-p.y,0),f[5].set(0,0,-p.z),h!==void 0)for(var g=0;g!==f.length;g++)h.vmult(f[g],f[g]);return f},c.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},c.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var u=new r;new r,c.prototype.forEachWorldCorner=function(l,h,f){for(var p=this.halfExtents,g=[[p.x,p.y,p.z],[-p.x,p.y,p.z],[-p.x,-p.y,p.z],[-p.x,-p.y,-p.z],[p.x,-p.y,-p.z],[p.x,p.y,-p.z],[-p.x,p.y,-p.z],[p.x,-p.y,p.z]],m=0;m<g.length;m++)u.set(g[m][0],g[m][1],g[m][2]),h.vmult(u,u),l.vadd(u,u),f(u.x,u.y,u.z)};var d=[new r,new r,new r,new r,new r,new r,new r,new r];c.prototype.calculateWorldAABB=function(l,h,f,p){var g=this.halfExtents;d[0].set(g.x,g.y,g.z),d[1].set(-g.x,g.y,g.z),d[2].set(-g.x,-g.y,g.z),d[3].set(-g.x,-g.y,-g.z),d[4].set(g.x,-g.y,-g.z),d[5].set(g.x,g.y,-g.z),d[6].set(-g.x,g.y,-g.z),d[7].set(g.x,-g.y,g.z);var m=d[0];h.vmult(m,m),l.vadd(m,m),p.copy(m),f.copy(m);for(var v=1;v<8;v++){var m=d[v];h.vmult(m,m),l.vadd(m,m);var _=m.x,y=m.y,x=m.z;_>p.x&&(p.x=_),y>p.y&&(p.y=y),x>p.z&&(p.z=x),_<f.x&&(f.x=_),y<f.y&&(f.y=y),x<f.z&&(f.z=x)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,n,i){n.exports=c;var s=t("./Shape"),r=t("../math/Vec3");t("../math/Quaternion");var a=t("../math/Transform");function c(V,Z,W){s.call(this),this.type=s.types.CONVEXPOLYHEDRON,this.vertices=V||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=Z||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=W?W.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}c.prototype=new s,c.prototype.constructor=c;var u=new r;c.prototype.computeEdges=function(){var V=this.faces,Z=this.vertices;Z.length;var W=this.uniqueEdges;W.length=0;for(var L=u,F=0;F!==V.length;F++)for(var X=V[F],ee=X.length,re=0;re!==ee;re++){var K=(re+1)%ee;Z[X[re]].vsub(Z[X[K]],L),L.normalize();for(var O=!1,de=0;de!==W.length;de++)if(W[de].almostEquals(L)||W[de].almostEquals(L)){O=!0;break}O||W.push(L.clone())}},c.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var V=0;V<this.faces.length;V++){for(var Z=0;Z<this.faces[V].length;Z++)if(!this.vertices[this.faces[V][Z]])throw new Error("Vertex "+this.faces[V][Z]+" not found!");var W=this.faceNormals[V]||new r;this.getFaceNormal(V,W),W.negate(W),this.faceNormals[V]=W;var L=this.vertices[this.faces[V][0]];if(W.dot(L)<0){console.error(".faceNormals["+V+"] = Vec3("+W.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var Z=0;Z<this.faces[V].length;Z++)console.warn(".vertices["+this.faces[V][Z]+"] = Vec3("+this.vertices[this.faces[V][Z]].toString()+")")}}};var d=new r,l=new r;c.computeNormal=function(V,Z,W,L){Z.vsub(V,l),W.vsub(Z,d),d.cross(l,L),L.isZero()||L.normalize()},c.prototype.getFaceNormal=function(V,Z){var W=this.faces[V],L=this.vertices[W[0]],F=this.vertices[W[1]],X=this.vertices[W[2]];return c.computeNormal(L,F,X,Z)};var h=new r;c.prototype.clipAgainstHull=function(V,Z,W,L,F,X,ee,re,K){for(var O=h,de=-1,_e=-Number.MAX_VALUE,Me=0;Me<W.faces.length;Me++){O.copy(W.faceNormals[Me]),F.vmult(O,O);var me=O.dot(X);me>_e&&(_e=me,de=Me)}for(var le=[],ue=W.faces[de],We=ue.length,Ge=0;Ge<We;Ge++){var B=W.vertices[ue[Ge]],C=new r;C.copy(B),F.vmult(C,C),L.vadd(C,C),le.push(C)}de>=0&&this.clipFaceAgainstHull(X,V,Z,le,ee,re,K)};var f=new r,p=new r,g=new r,m=new r,v=new r,_=new r;c.prototype.findSeparatingAxis=function(V,Z,W,L,F,X,ee,re){var K=f,O=p,de=g,_e=m,Me=v,me=_,le=Number.MAX_VALUE,ue=this;if(ue.uniqueAxes)for(var Ge=0;Ge!==ue.uniqueAxes.length;Ge++){W.vmult(ue.uniqueAxes[Ge],K);var C=ue.testSepAxis(K,V,Z,W,L,F);if(C===!1)return!1;C<le&&(le=C,X.copy(K))}else for(var We=ee?ee.length:ue.faces.length,Ge=0;Ge<We;Ge++){var B=ee?ee[Ge]:Ge;K.copy(ue.faceNormals[B]),W.vmult(K,K);var C=ue.testSepAxis(K,V,Z,W,L,F);if(C===!1)return!1;C<le&&(le=C,X.copy(K))}if(V.uniqueAxes)for(var Ge=0;Ge!==V.uniqueAxes.length;Ge++){F.vmult(V.uniqueAxes[Ge],O);var C=ue.testSepAxis(O,V,Z,W,L,F);if(C===!1)return!1;C<le&&(le=C,X.copy(O))}else for(var ie=re?re.length:V.faces.length,Ge=0;Ge<ie;Ge++){var B=re?re[Ge]:Ge;O.copy(V.faceNormals[B]),F.vmult(O,O);var C=ue.testSepAxis(O,V,Z,W,L,F);if(C===!1)return!1;C<le&&(le=C,X.copy(O))}for(var he=0;he!==ue.uniqueEdges.length;he++){W.vmult(ue.uniqueEdges[he],_e);for(var fe=0;fe!==V.uniqueEdges.length;fe++)if(F.vmult(V.uniqueEdges[fe],Me),_e.cross(Me,me),!me.almostZero()){me.normalize();var ge=ue.testSepAxis(me,V,Z,W,L,F);if(ge===!1)return!1;ge<le&&(le=ge,X.copy(me))}}return L.vsub(Z,de),de.dot(X)>0&&X.negate(X),!0};var y=[],x=[];c.prototype.testSepAxis=function(V,Z,W,L,F,X){var ee=this;c.project(ee,V,W,L,y),c.project(Z,V,F,X,x);var re=y[0],K=y[1],O=x[0],de=x[1],_e=re-de,Me=O-K,me=_e<Me?_e:Me;return me};var M=new r,S=new r;c.prototype.calculateLocalInertia=function(V,Z){this.computeLocalAABB(M,S);var W=S.x-M.x,L=S.y-M.y,F=S.z-M.z;Z.x=1/12*V*(2*L*2*L+2*F*2*F),Z.y=1/12*V*(2*W*2*W+2*F*2*F),Z.z=1/12*V*(2*L*2*L+2*W*2*W)},c.prototype.getPlaneConstantOfFace=function(V){var Z=this.faces[V],W=this.faceNormals[V],L=this.vertices[Z[0]],F=-W.dot(L);return F};var A=new r,T=new r,b=new r,w=new r,P=new r,N=new r,I=new r,H=new r;c.prototype.clipFaceAgainstHull=function(V,Z,W,L,F,X,ee){for(var re=A,K=T,O=b,de=w,_e=P,Me=N,me=I,le=H,ue=this,We=[],Ge=L,B=We,C=-1,ie=Number.MAX_VALUE,he=0;he<ue.faces.length;he++){re.copy(ue.faceNormals[he]),W.vmult(re,re);var fe=re.dot(V);fe<ie&&(ie=fe,C=he)}if(!(C<0)){var ge=ue.faces[C];ge.connectedFaces=[];for(var Ie=0;Ie<ue.faces.length;Ie++)for(var Ee=0;Ee<ue.faces[Ie].length;Ee++)ge.indexOf(ue.faces[Ie][Ee])!==-1&&Ie!==C&&ge.connectedFaces.indexOf(Ie)===-1&&ge.connectedFaces.push(Ie);Ge.length;for(var we=ge.length,Ke=0;Ke<we;Ke++){var Ce=ue.vertices[ge[Ke]],$e=ue.vertices[ge[(Ke+1)%we]];Ce.vsub($e,K),O.copy(K),W.vmult(O,O),Z.vadd(O,O),de.copy(this.faceNormals[C]),W.vmult(de,de),Z.vadd(de,de),O.cross(de,_e),_e.negate(_e),Me.copy(Ce),W.vmult(Me,Me),Z.vadd(Me,Me),-Me.dot(_e);var ze;{var at=ge.connectedFaces[Ke];me.copy(this.faceNormals[at]);var Ze=this.getPlaneConstantOfFace(at);le.copy(me),W.vmult(le,le);var ze=Ze-le.dot(Z)}for(this.clipFaceAgainstPlane(Ge,B,le,ze);Ge.length;)Ge.shift();for(;B.length;)Ge.push(B.shift())}me.copy(this.faceNormals[C]);var Ze=this.getPlaneConstantOfFace(C);le.copy(me),W.vmult(le,le);for(var ze=Ze-le.dot(Z),Ie=0;Ie<Ge.length;Ie++){var Je=le.dot(Ge[Ie])+ze;if(Je<=F&&(console.log("clamped: depth="+Je+" to minDist="+(F+"")),Je=F),Je<=X){var rt=Ge[Ie];if(Je<=0){var vt={point:rt,normal:le,depth:Je};ee.push(vt)}}}}},c.prototype.clipFaceAgainstPlane=function(V,Z,W,L){var F,X,ee=V.length;if(ee<2)return Z;var re=V[V.length-1],K=V[0];F=W.dot(re)+L;for(var O=0;O<ee;O++){if(K=V[O],X=W.dot(K)+L,F<0)if(X<0){var de=new r;de.copy(K),Z.push(de)}else{var de=new r;re.lerp(K,F/(F-X),de),Z.push(de)}else if(X<0){var de=new r;re.lerp(K,F/(F-X),de),Z.push(de),Z.push(K)}re=K,F=X}return Z},c.prototype.computeWorldVertices=function(V,Z){for(var W=this.vertices.length;this.worldVertices.length<W;)this.worldVertices.push(new r);for(var L=this.vertices,F=this.worldVertices,X=0;X!==W;X++)Z.vmult(L[X],F[X]),V.vadd(F[X],F[X]);this.worldVerticesNeedsUpdate=!1},new r,c.prototype.computeLocalAABB=function(V,Z){var W=this.vertices.length,L=this.vertices;V.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),Z.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var F=0;F<W;F++){var X=L[F];X.x<V.x?V.x=X.x:X.x>Z.x&&(Z.x=X.x),X.y<V.y?V.y=X.y:X.y>Z.y&&(Z.y=X.y),X.z<V.z?V.z=X.z:X.z>Z.z&&(Z.z=X.z)}},c.prototype.computeWorldFaceNormals=function(V){for(var Z=this.faceNormals.length;this.worldFaceNormals.length<Z;)this.worldFaceNormals.push(new r);for(var W=this.faceNormals,L=this.worldFaceNormals,F=0;F!==Z;F++)V.vmult(W[F],L[F]);this.worldFaceNormalsNeedsUpdate=!1},c.prototype.updateBoundingSphereRadius=function(){for(var V=0,Z=this.vertices,W=0,L=Z.length;W!==L;W++){var F=Z[W].norm2();F>V&&(V=F)}this.boundingSphereRadius=Math.sqrt(V)};var G=new r;c.prototype.calculateWorldAABB=function(V,Z,W,L){for(var F=this.vertices.length,X=this.vertices,ee,re,K,O,de,_e,Me=0;Me<F;Me++){G.copy(X[Me]),Z.vmult(G,G),V.vadd(G,G);var me=G;me.x<ee||ee===void 0?ee=me.x:(me.x>O||O===void 0)&&(O=me.x),me.y<re||re===void 0?re=me.y:(me.y>de||de===void 0)&&(de=me.y),me.z<K||K===void 0?K=me.z:(me.z>_e||_e===void 0)&&(_e=me.z)}W.set(ee,re,K),L.set(O,de,_e)},c.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},c.prototype.getAveragePointLocal=function(V){V=V||new r;for(var Z=this.vertices.length,W=this.vertices,L=0;L<Z;L++)V.vadd(W[L],V);return V.mult(1/Z,V),V},c.prototype.transformAllPoints=function(V,Z){var W=this.vertices.length,L=this.vertices;if(Z){for(var F=0;F<W;F++){var X=L[F];Z.vmult(X,X)}for(var F=0;F<this.faceNormals.length;F++){var X=this.faceNormals[F];Z.vmult(X,X)}}if(V)for(var F=0;F<W;F++){var X=L[F];X.vadd(V,X)}};var J=new r,U=new r,k=new r;c.prototype.pointIsInside=function(V){var Z=this.vertices.length,W=this.vertices,L=this.faces,F=this.faceNormals,X=null,ee=this.faces.length,re=J;this.getAveragePointLocal(re);for(var K=0;K<ee;K++){this.faces[K].length;var Z=F[K],O=W[L[K][0]],de=U;V.vsub(O,de);var _e=Z.dot(de),Me=k;re.vsub(O,Me);var me=Z.dot(Me);if(_e<0&&me>0||_e>0&&me<0)return!1}return X?1:-1},new r;var q=new r,Y=new r;c.project=function(V,Z,W,L,F){var X=V.vertices.length,ee=q,re=0,K=0,O=Y,de=V.vertices;O.setZero(),a.vectorToLocalFrame(W,L,Z,ee),a.pointToLocalFrame(W,L,O,O);var _e=O.dot(ee);K=re=de[0].dot(ee);for(var Me=1;Me<X;Me++){var me=de[Me].dot(ee);me>re&&(re=me),me<K&&(K=me)}if(K-=_e,re-=_e,K>re){var le=K;K=re,re=le}F[0]=re,F[1]=K}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,n,i){n.exports=c;var s=t("./Shape"),r=t("../math/Vec3");t("../math/Quaternion");var a=t("./ConvexPolyhedron");function c(u,d,l,h){var f=h,p=[],g=[],m=[],v=[],_=[],y=Math.cos,x=Math.sin;p.push(new r(d*y(0),d*x(0),-l*.5)),v.push(0),p.push(new r(u*y(0),u*x(0),l*.5)),_.push(1);for(var M=0;M<f;M++){var S=2*Math.PI/f*(M+1),A=2*Math.PI/f*(M+.5);M<f-1?(p.push(new r(d*y(S),d*x(S),-l*.5)),v.push(2*M+2),p.push(new r(u*y(S),u*x(S),l*.5)),_.push(2*M+3),m.push([2*M+2,2*M+3,2*M+1,2*M])):m.push([0,1,2*M+1,2*M]),(f%2===1||M<f/2)&&g.push(new r(y(A),x(A),0))}m.push(_),g.push(new r(0,0,1));for(var T=[],M=0;M<v.length;M++)T.push(v[v.length-M-1]);m.push(T),this.type=s.types.CONVEXPOLYHEDRON,a.call(this,p,m,g)}c.prototype=new a},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,n,i){var s=t("./Shape"),r=t("./ConvexPolyhedron"),a=t("../math/Vec3"),c=t("../utils/Utils");n.exports=u;function u(d,l){l=c.defaults(l,{maxValue:null,minValue:null,elementSize:1}),this.data=d,this.maxValue=l.maxValue,this.minValue=l.minValue,this.elementSize=l.elementSize,l.minValue===null&&this.updateMinValue(),l.maxValue===null&&this.updateMaxValue(),this.cacheEnabled=!0,s.call(this),this.pillarConvex=new r,this.pillarOffset=new a,this.type=s.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}u.prototype=new s,u.prototype.update=function(){this._cachedPillars={}},u.prototype.updateMinValue=function(){for(var d=this.data,l=d[0][0],h=0;h!==d.length;h++)for(var f=0;f!==d[h].length;f++){var p=d[h][f];p<l&&(l=p)}this.minValue=l},u.prototype.updateMaxValue=function(){for(var d=this.data,l=d[0][0],h=0;h!==d.length;h++)for(var f=0;f!==d[h].length;f++){var p=d[h][f];p>l&&(l=p)}this.maxValue=l},u.prototype.setHeightValueAtIndex=function(d,l,h){var f=this.data;f[d][l]=h,this.clearCachedConvexTrianglePillar(d,l,!1),d>0&&(this.clearCachedConvexTrianglePillar(d-1,l,!0),this.clearCachedConvexTrianglePillar(d-1,l,!1)),l>0&&(this.clearCachedConvexTrianglePillar(d,l-1,!0),this.clearCachedConvexTrianglePillar(d,l-1,!1)),l>0&&d>0&&this.clearCachedConvexTrianglePillar(d-1,l-1,!0)},u.prototype.getRectMinMax=function(d,l,h,f,p){p=p||[];for(var g=this.data,m=this.minValue,v=d;v<=h;v++)for(var _=l;_<=f;_++){var y=g[v][_];y>m&&(m=y)}p[0]=this.minValue,p[1]=m},u.prototype.getIndexOfPosition=function(d,l,h,f){var p=this.elementSize,g=this.data,m=Math.floor(d/p),v=Math.floor(l/p);return h[0]=m,h[1]=v,f&&(m<0&&(m=0),v<0&&(v=0),m>=g.length-1&&(m=g.length-1),v>=g[0].length-1&&(v=g[0].length-1)),!(m<0||v<0||m>=g.length-1||v>=g[0].length-1)},u.prototype.getHeightAt=function(d,l,h){var f=[];this.getIndexOfPosition(d,l,f,h);var p=[];return this.getRectMinMax(f[0],f[1]+1,f[0],f[1]+1,p),(p[0]+p[1])/2},u.prototype.getCacheConvexTrianglePillarKey=function(d,l,h){return d+"_"+l+"_"+(h?1:0)},u.prototype.getCachedConvexTrianglePillar=function(d,l,h){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,l,h)]},u.prototype.setCachedConvexTrianglePillar=function(d,l,h,f,p){this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,l,h)]={convex:f,offset:p}},u.prototype.clearCachedConvexTrianglePillar=function(d,l,h){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(d,l,h)]},u.prototype.getConvexTrianglePillar=function(d,l,h){var f=this.pillarConvex,p=this.pillarOffset;if(this.cacheEnabled){var g=this.getCachedConvexTrianglePillar(d,l,h);if(g){this.pillarConvex=g.convex,this.pillarOffset=g.offset;return}f=new r,p=new a,this.pillarConvex=f,this.pillarOffset=p}var g=this.data,m=this.elementSize,v=f.faces;f.vertices.length=6;for(var _=0;_<6;_++)f.vertices[_]||(f.vertices[_]=new a);v.length=5;for(var _=0;_<5;_++)v[_]||(v[_]=[]);var y=f.vertices,x=(Math.min(g[d][l],g[d+1][l],g[d][l+1],g[d+1][l+1])-this.minValue)/2+this.minValue;h?(p.set((d+.75)*m,(l+.75)*m,x),y[0].set(.25*m,.25*m,g[d+1][l+1]-x),y[1].set(-.75*m,.25*m,g[d][l+1]-x),y[2].set(.25*m,-.75*m,g[d+1][l]-x),y[3].set(.25*m,.25*m,-x-1),y[4].set(-.75*m,.25*m,-x-1),y[5].set(.25*m,-.75*m,-x-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=2,v[2][1]=5,v[2][2]=3,v[2][3]=0,v[3][0]=3,v[3][1]=4,v[3][2]=1,v[3][3]=0,v[4][0]=1,v[4][1]=4,v[4][2]=5,v[4][3]=2):(p.set((d+.25)*m,(l+.25)*m,x),y[0].set(-.25*m,-.25*m,g[d][l]-x),y[1].set(.75*m,-.25*m,g[d+1][l]-x),y[2].set(-.25*m,.75*m,g[d][l+1]-x),y[3].set(-.25*m,-.25*m,-x-1),y[4].set(.75*m,-.25*m,-x-1),y[5].set(-.25*m,.75*m,-x-1),v[0][0]=0,v[0][1]=1,v[0][2]=2,v[1][0]=5,v[1][1]=4,v[1][2]=3,v[2][0]=0,v[2][1]=2,v[2][2]=5,v[2][3]=3,v[3][0]=1,v[3][1]=0,v[3][2]=3,v[3][3]=4,v[4][0]=4,v[4][1]=5,v[4][2]=2,v[4][3]=1),f.computeNormals(),f.computeEdges(),f.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(d,l,h,f,p)},u.prototype.calculateLocalInertia=function(d,l){return l=l||new a,l.set(0,0,0),l},u.prototype.volume=function(){return Number.MAX_VALUE},u.prototype.calculateWorldAABB=function(d,l,h,f){h.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),f.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},u.prototype.updateBoundingSphereRadius=function(){var d=this.data,l=this.elementSize;this.boundingSphereRadius=new a(d.length*l,d[0].length*l,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,n,i){n.exports=a;var s=t("./Shape"),r=t("../math/Vec3");function a(){s.call(this),this.type=s.types.PARTICLE}a.prototype=new s,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(c,u){return u=u||new r,u.set(0,0,0),u},a.prototype.volume=function(){return 0},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},a.prototype.calculateWorldAABB=function(c,u,d,l){d.copy(c),l.copy(c)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,n,i){n.exports=a;var s=t("./Shape"),r=t("../math/Vec3");function a(){s.call(this),this.type=s.types.PLANE,this.worldNormal=new r,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}a.prototype=new s,a.prototype.constructor=a,a.prototype.computeWorldNormal=function(u){var d=this.worldNormal;d.set(0,0,1),u.vmult(d,d),this.worldNormalNeedsUpdate=!1},a.prototype.calculateLocalInertia=function(u,d){return d=d||new r,d},a.prototype.volume=function(){return Number.MAX_VALUE};var c=new r;a.prototype.calculateWorldAABB=function(u,d,l,h){c.set(0,0,1),d.vmult(c,c);var f=Number.MAX_VALUE;l.set(-f,-f,-f),h.set(f,f,f),c.x===1&&(h.x=u.x),c.y===1&&(h.y=u.y),c.z===1&&(h.z=u.z),c.x===-1&&(l.x=u.x),c.y===-1&&(l.y=u.y),c.z===-1&&(l.z=u.z)},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,n,i){n.exports=s;var s=t("./Shape");t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material");function s(){this.id=s.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}s.prototype.constructor=s,s.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},s.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},s.prototype.calculateLocalInertia=function(r,a){throw"calculateLocalInertia() not implemented for shape type "+this.type},s.idCounter=0,s.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,n,i){n.exports=a;var s=t("./Shape"),r=t("../math/Vec3");function a(c){if(s.call(this),this.radius=c!==void 0?Number(c):1,this.type=s.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}a.prototype=new s,a.prototype.constructor=a,a.prototype.calculateLocalInertia=function(c,u){u=u||new r;var d=2*c*this.radius*this.radius/5;return u.x=d,u.y=d,u.z=d,u},a.prototype.volume=function(){return 4*Math.PI*this.radius/3},a.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},a.prototype.calculateWorldAABB=function(c,u,d,l){for(var h=this.radius,f=["x","y","z"],p=0;p<f.length;p++){var g=f[p];d[g]=c[g]-h,l[g]=c[g]+h}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,n,i){n.exports=d;var s=t("./Shape"),r=t("../math/Vec3");t("../math/Quaternion");var a=t("../math/Transform"),c=t("../collision/AABB"),u=t("../utils/Octree");function d(T,b){s.call(this),this.type=s.types.TRIMESH,this.vertices=new Float32Array(T),this.indices=new Int16Array(b),this.normals=new Float32Array(b.length),this.aabb=new c,this.edges=null,this.scale=new r(1,1,1),this.tree=new u,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}d.prototype=new s,d.prototype.constructor=d;var l=new r;d.prototype.updateTree=function(){var T=this.tree;T.reset(),T.aabb.copy(this.aabb);var b=this.scale;T.aabb.lowerBound.x*=1/b.x,T.aabb.lowerBound.y*=1/b.y,T.aabb.lowerBound.z*=1/b.z,T.aabb.upperBound.x*=1/b.x,T.aabb.upperBound.y*=1/b.y,T.aabb.upperBound.z*=1/b.z;for(var w=new c,P=new r,N=new r,I=new r,H=[P,N,I],G=0;G<this.indices.length/3;G++){var J=G*3;this._getUnscaledVertex(this.indices[J],P),this._getUnscaledVertex(this.indices[J+1],N),this._getUnscaledVertex(this.indices[J+2],I),w.setFromPoints(H),T.insert(w,G)}T.removeEmptyNodes()};var h=new c;d.prototype.getTrianglesInAABB=function(T,b){h.copy(T);var w=this.scale,P=w.x,N=w.y,I=w.z,H=h.lowerBound,G=h.upperBound;return H.x/=P,H.y/=N,H.z/=I,G.x/=P,G.y/=N,G.z/=I,this.tree.aabbQuery(h,b)},d.prototype.setScale=function(T){var b=this.scale.x===this.scale.y===this.scale.z,w=T.x===T.y===T.z;b&&w||this.updateNormals(),this.scale.copy(T),this.updateAABB(),this.updateBoundingSphereRadius()},d.prototype.updateNormals=function(){for(var T=l,b=this.normals,w=0;w<this.indices.length/3;w++){var P=w*3,N=this.indices[P],I=this.indices[P+1],H=this.indices[P+2];this.getVertex(N,v),this.getVertex(I,_),this.getVertex(H,y),d.computeNormal(_,v,y,T),b[P]=T.x,b[P+1]=T.y,b[P+2]=T.z}},d.prototype.updateEdges=function(){for(var T={},b=function(J,U){var k=N<I?N+"_"+I:I+"_"+N;T[k]=!0},w=0;w<this.indices.length/3;w++){var P=w*3,N=this.indices[P],I=this.indices[P+1];this.indices[P+2],b(),b(),b()}var H=Object.keys(T);this.edges=new Int16Array(H.length*2);for(var w=0;w<H.length;w++){var G=H[w].split("_");this.edges[2*w]=parseInt(G[0],10),this.edges[2*w+1]=parseInt(G[1],10)}},d.prototype.getEdgeVertex=function(T,b,w){var P=this.edges[T*2+(b?1:0)];this.getVertex(P,w)};var f=new r,p=new r;d.prototype.getEdgeVector=function(T,b){var w=f,P=p;this.getEdgeVertex(T,0,w),this.getEdgeVertex(T,1,P),P.vsub(w,b)};var g=new r,m=new r;d.computeNormal=function(T,b,w,P){b.vsub(T,m),w.vsub(b,g),g.cross(m,P),P.isZero()||P.normalize()};var v=new r,_=new r,y=new r;d.prototype.getVertex=function(T,b){var w=this.scale;return this._getUnscaledVertex(T,b),b.x*=w.x,b.y*=w.y,b.z*=w.z,b},d.prototype._getUnscaledVertex=function(T,b){var w=T*3,P=this.vertices;return b.set(P[w],P[w+1],P[w+2])},d.prototype.getWorldVertex=function(T,b,w,P){return this.getVertex(T,P),a.pointToWorldFrame(b,w,P,P),P},d.prototype.getTriangleVertices=function(T,b,w,P){var N=T*3;this.getVertex(this.indices[N],b),this.getVertex(this.indices[N+1],w),this.getVertex(this.indices[N+2],P)},d.prototype.getNormal=function(T,b){var w=T*3;return b.set(this.normals[w],this.normals[w+1],this.normals[w+2])};var x=new c;d.prototype.calculateLocalInertia=function(T,b){this.computeLocalAABB(x);var w=x.upperBound.x-x.lowerBound.x,P=x.upperBound.y-x.lowerBound.y,N=x.upperBound.z-x.lowerBound.z;return b.set(1/12*T*(2*P*2*P+2*N*2*N),1/12*T*(2*w*2*w+2*N*2*N),1/12*T*(2*P*2*P+2*w*2*w))};var M=new r;d.prototype.computeLocalAABB=function(T){var b=T.lowerBound,w=T.upperBound,P=this.vertices.length;this.vertices;var N=M;this.getVertex(0,N),b.copy(N),w.copy(N);for(var I=0;I!==P;I++)this.getVertex(I,N),N.x<b.x?b.x=N.x:N.x>w.x&&(w.x=N.x),N.y<b.y?b.y=N.y:N.y>w.y&&(w.y=N.y),N.z<b.z?b.z=N.z:N.z>w.z&&(w.z=N.z)},d.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},d.prototype.updateBoundingSphereRadius=function(){for(var T=0,b=this.vertices,w=new r,P=0,N=b.length/3;P!==N;P++){this.getVertex(P,w);var I=w.norm2();I>T&&(T=I)}this.boundingSphereRadius=Math.sqrt(T)},new r;var S=new a,A=new c;d.prototype.calculateWorldAABB=function(T,b,w,P){var N=S,I=A;N.position=T,N.quaternion=b,this.aabb.toWorldFrame(N,I),w.copy(I.lowerBound),P.copy(I.upperBound)},d.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},d.createTorus=function(T,b,w,P,N){T=T||1,b=b||.5,w=w||8,P=P||6,N=N||Math.PI*2;for(var I=[],H=[],G=0;G<=w;G++)for(var J=0;J<=P;J++){var U=J/P*N,k=G/w*Math.PI*2,q=(T+b*Math.cos(k))*Math.cos(U),Y=(T+b*Math.cos(k))*Math.sin(U),V=b*Math.sin(k);I.push(q,Y,V)}for(var G=1;G<=w;G++)for(var J=1;J<=P;J++){var Z=(P+1)*G+J-1,W=(P+1)*(G-1)+J-1,L=(P+1)*(G-1)+J,F=(P+1)*G+J;H.push(Z,W,F),H.push(W,L,F)}return new d(I,H)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,n,i){n.exports=r,t("../math/Vec3"),t("../math/Quaternion");var s=t("./Solver");function r(){s.call(this),this.iterations=10,this.tolerance=1e-7}r.prototype=new s;var a=[],c=[],u=[];r.prototype.solve=function(d,l){var h=0,f=this.iterations,p=this.tolerance*this.tolerance,g=this.equations,m=g.length,v=l.bodies,_=v.length,y=d,x,M,S,A,T,b;if(m!==0)for(var w=0;w!==_;w++)v[w].updateSolveMassProperties();var P=c,N=u,I=a;P.length=m,N.length=m,I.length=m;for(var w=0;w!==m;w++){var H=g[w];I[w]=0,N[w]=H.computeB(y),P[w]=1/H.computeC()}if(m!==0){for(var w=0;w!==_;w++){var G=v[w],J=G.vlambda,U=G.wlambda;J.set(0,0,0),U&&U.set(0,0,0)}for(h=0;h!==f;h++){A=0;for(var k=0;k!==m;k++){var H=g[k];x=N[k],M=P[k],b=I[k],T=H.computeGWlambda(),S=M*(x-T-H.eps*b),b+S<H.minForce?S=H.minForce-b:b+S>H.maxForce&&(S=H.maxForce-b),I[k]+=S,A+=S>0?S:-S,H.addToWlambda(S)}if(A*A<p)break}for(var w=0;w!==_;w++){var G=v[w],q=G.velocity,Y=G.angularVelocity;q.vadd(G.vlambda,q),Y&&Y.vadd(G.wlambda,Y)}}return h}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,n,i){n.exports=s;function s(){this.equations=[]}s.prototype.solve=function(r,a){return 0},s.prototype.addEquation=function(r){r.enabled&&this.equations.push(r)},s.prototype.removeEquation=function(r){var a=this.equations,c=a.indexOf(r);c!==-1&&a.splice(c,1)},s.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,n,i){n.exports=a,t("../math/Vec3"),t("../math/Quaternion");var s=t("./Solver"),r=t("../objects/Body");function a(v){for(s.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=v,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}a.prototype=new s;var c=[],u=[],d={bodies:[]},l=r.STATIC;function h(v){for(var _=v.length,y=0;y!==_;y++){var x=v[y];if(!x.visited&&!(x.body.type&l))return x}return!1}var f=[];function p(v,_,y,x){for(f.push(v),v.visited=!0,_(v,y,x);f.length;)for(var M=f.pop(),S;S=h(M.children);)S.visited=!0,_(S,y,x),f.push(S)}function g(v,_,y){_.push(v.body);for(var x=v.eqs.length,M=0;M!==x;M++){var S=v.eqs[M];y.indexOf(S)===-1&&y.push(S)}}a.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},a.prototype.solve=function(v,_){for(var y=c,x=this.nodePool,M=_.bodies,S=this.equations,A=S.length,T=M.length,b=this.subsolver;x.length<T;)x.push(this.createNode());y.length=T;for(var w=0;w<T;w++)y[w]=x[w];for(var w=0;w!==T;w++){var P=y[w];P.body=M[w],P.children.length=0,P.eqs.length=0,P.visited=!1}for(var N=0;N!==A;N++){var I=S[N],w=M.indexOf(I.bi),H=M.indexOf(I.bj),G=y[w],J=y[H];G.children.push(J),G.eqs.push(I),J.children.push(G),J.eqs.push(I)}var U,k=0,q=u;b.tolerance=this.tolerance,b.iterations=this.iterations;for(var Y=d;U=h(y);){q.length=0,Y.bodies.length=0,p(U,g,Y.bodies,q);var V=q.length;q=q.sort(m);for(var w=0;w!==V;w++)b.addEquation(q[w]);b.solve(v,Y),b.removeAllEquations(),k++}return k};function m(v,_){return _.id-v.id}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,n,i){var s=function(){};n.exports=s,s.prototype={constructor:s,addEventListener:function(r,a){this._listeners===void 0&&(this._listeners={});var c=this._listeners;return c[r]===void 0&&(c[r]=[]),c[r].indexOf(a)===-1&&c[r].push(a),this},hasEventListener:function(r,a){if(this._listeners===void 0)return!1;var c=this._listeners;return c[r]!==void 0&&c[r].indexOf(a)!==-1},removeEventListener:function(r,a){if(this._listeners===void 0)return this;var c=this._listeners;if(c[r]===void 0)return this;var u=c[r].indexOf(a);return u!==-1&&c[r].splice(u,1),this},dispatchEvent:function(r){if(this._listeners===void 0)return this;var a=this._listeners,c=a[r.type];if(c!==void 0){r.target=this;for(var u=0,d=c.length;u<d;u++)c[u].call(this,r)}return this}}},{}],50:[function(t,n,i){var s=t("../collision/AABB"),r=t("../math/Vec3");n.exports=c;function a(l){l=l||{},this.root=l.root||null,this.aabb=l.aabb?l.aabb.clone():new s,this.data=[],this.children=[]}function c(l,h){h=h||{},h.root=null,h.aabb=l,a.call(this,h),this.maxDepth=typeof h.maxDepth<"u"?h.maxDepth:8}c.prototype=new a,a.prototype.reset=function(l,h){this.children.length=this.data.length=0},a.prototype.insert=function(l,h,f){var p=this.data;if(f=f||0,!this.aabb.contains(l))return!1;var g=this.children;if(f<(this.maxDepth||this.root.maxDepth)){var m=!1;g.length||(this.subdivide(),m=!0);for(var v=0;v!==8;v++)if(g[v].insert(l,h,f+1))return!0;m&&(g.length=0)}return p.push(h),!0};var u=new r;a.prototype.subdivide=function(){var l=this.aabb,h=l.lowerBound,f=l.upperBound,p=this.children;p.push(new a({aabb:new s({lowerBound:new r(0,0,0)})}),new a({aabb:new s({lowerBound:new r(1,0,0)})}),new a({aabb:new s({lowerBound:new r(1,1,0)})}),new a({aabb:new s({lowerBound:new r(1,1,1)})}),new a({aabb:new s({lowerBound:new r(0,1,1)})}),new a({aabb:new s({lowerBound:new r(0,0,1)})}),new a({aabb:new s({lowerBound:new r(1,0,1)})}),new a({aabb:new s({lowerBound:new r(0,1,0)})})),f.vsub(h,u),u.scale(.5,u);for(var g=this.root||this,m=0;m!==8;m++){var v=p[m];v.root=g;var _=v.aabb.lowerBound;_.x*=u.x,_.y*=u.y,_.z*=u.z,_.vadd(h,_),_.vadd(u,v.aabb.upperBound)}},a.prototype.aabbQuery=function(l,h){this.data,this.children;for(var f=[this];f.length;){var p=f.pop();p.aabb.overlaps(l)&&Array.prototype.push.apply(h,p.data),Array.prototype.push.apply(f,p.children)}return h};var d=new s;a.prototype.rayQuery=function(l,h,f){return l.getAABB(d),d.toLocalFrame(h,d),this.aabbQuery(d,f),f},a.prototype.removeEmptyNodes=function(){for(var l=[this];l.length;){for(var h=l.pop(),f=h.children.length-1;f>=0;f--)h.children[f].data.length||h.children.splice(f,1);Array.prototype.push.apply(l,h.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,n,i){n.exports=s;function s(){this.objects=[],this.type=Object}s.prototype.release=function(){for(var r=arguments.length,a=0;a!==r;a++)this.objects.push(arguments[a])},s.prototype.get=function(){return this.objects.length===0?this.constructObject():this.objects.pop()},s.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,n,i){n.exports=s;function s(){this.data={keys:[]}}s.prototype.get=function(r,a){if(r>a){var c=a;a=r,r=c}return this.data[r+"-"+a]},s.prototype.set=function(r,a,c){if(r>a){var u=a;a=r,r=u}var d=r+"-"+a;this.get(r,a)||this.data.keys.push(d),this.data[d]=c},s.prototype.reset=function(){for(var r=this.data,a=r.keys;a.length>0;){var c=a.pop();delete r[c]}}},{}],53:[function(t,n,i){function s(){}n.exports=s,s.defaults=function(r,a){r=r||{};for(var c in a)c in r||(r[c]=a[c]);return r}},{}],54:[function(t,n,i){n.exports=a;var s=t("../math/Vec3"),r=t("./Pool");function a(){r.call(this),this.type=s}a.prototype=new r,a.prototype.constructObject=function(){return new s}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,n,i){n.exports=p;var s=t("../collision/AABB"),r=t("../shapes/Shape"),a=t("../collision/Ray"),c=t("../math/Vec3"),u=t("../math/Transform");t("../shapes/ConvexPolyhedron");var d=t("../math/Quaternion");t("../solver/Solver");var l=t("../utils/Vec3Pool"),h=t("../equations/ContactEquation"),f=t("../equations/FrictionEquation");function p(oe){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=oe,this.currentContactMaterial=null,this.enableFrictionReduction=!1}p.prototype.createContactEquation=function(oe,pe,ve,xe,Qe,ke){var Pe;this.contactPointPool.length?(Pe=this.contactPointPool.pop(),Pe.bi=oe,Pe.bj=pe):Pe=new h(oe,pe),Pe.enabled=oe.collisionResponse&&pe.collisionResponse&&ve.collisionResponse&&xe.collisionResponse;var Oe=this.currentContactMaterial;Pe.restitution=Oe.restitution,Pe.setSpookParams(Oe.contactEquationStiffness,Oe.contactEquationRelaxation,this.world.dt);var ae=ve.material||oe.material,De=xe.material||pe.material;return ae&&De&&ae.restitution>=0&&De.restitution>=0&&(Pe.restitution=ae.restitution*De.restitution),Pe.si=Qe||ve,Pe.sj=ke||xe,Pe},p.prototype.createFrictionEquationsFromContact=function(oe,pe){var ve=oe.bi,xe=oe.bj,Qe=oe.si,ke=oe.sj,Pe=this.world,Oe=this.currentContactMaterial,ae=Oe.friction,De=Qe.material||ve.material,Ue=ke.material||xe.material;if(De&&Ue&&De.friction>=0&&Ue.friction>=0&&(ae=De.friction*Ue.friction),ae>0){var qe=ae*Pe.gravity.length(),R=ve.invMass+xe.invMass;R>0&&(R=1/R);var z=this.frictionEquationPool,j=z.length?z.pop():new f(ve,xe,qe*R),$=z.length?z.pop():new f(ve,xe,qe*R);return j.bi=$.bi=ve,j.bj=$.bj=xe,j.minForce=$.minForce=-qe*R,j.maxForce=$.maxForce=qe*R,j.ri.copy(oe.ri),j.rj.copy(oe.rj),$.ri.copy(oe.ri),$.rj.copy(oe.rj),oe.ni.tangents(j.t,$.t),j.setSpookParams(Oe.frictionEquationStiffness,Oe.frictionEquationRelaxation,Pe.dt),$.setSpookParams(Oe.frictionEquationStiffness,Oe.frictionEquationRelaxation,Pe.dt),j.enabled=$.enabled=oe.enabled,pe.push(j,$),!0}return!1};var g=new c,m=new c,v=new c;p.prototype.createFrictionFromAverage=function(oe){var pe=this.result[this.result.length-1];if(!(!this.createFrictionEquationsFromContact(pe,this.frictionResult)||oe===1)){var ve=this.frictionResult[this.frictionResult.length-2],xe=this.frictionResult[this.frictionResult.length-1];g.setZero(),m.setZero(),v.setZero();var Qe=pe.bi;pe.bj;for(var ke=0;ke!==oe;ke++)pe=this.result[this.result.length-1-ke],pe.bodyA!==Qe?(g.vadd(pe.ni,g),m.vadd(pe.ri,m),v.vadd(pe.rj,v)):(g.vsub(pe.ni,g),m.vadd(pe.rj,m),v.vadd(pe.ri,v));var Pe=1/oe;m.scale(Pe,ve.ri),v.scale(Pe,ve.rj),xe.ri.copy(ve.ri),xe.rj.copy(ve.rj),g.normalize(),g.tangents(ve.t,xe.t)}};var _=new c,y=new c,x=new d,M=new d;p.prototype.getContacts=function(oe,pe,ve,xe,Qe,ke,Pe){this.contactPointPool=Qe,this.frictionEquationPool=Pe,this.result=xe,this.frictionResult=ke;for(var Oe=x,ae=M,De=_,Ue=y,qe=0,R=oe.length;qe!==R;qe++){var z=oe[qe],j=pe[qe],$=null;z.material&&j.material&&($=ve.getContactMaterial(z.material,j.material)||null);for(var Q=0;Q<z.shapes.length;Q++){z.quaternion.mult(z.shapeOrientations[Q],Oe),z.quaternion.vmult(z.shapeOffsets[Q],De),De.vadd(z.position,De);for(var ne=z.shapes[Q],Ae=0;Ae<j.shapes.length;Ae++){j.quaternion.mult(j.shapeOrientations[Ae],ae),j.quaternion.vmult(j.shapeOffsets[Ae],Ue),Ue.vadd(j.position,Ue);var Re=j.shapes[Ae];if(!(De.distanceTo(Ue)>ne.boundingSphereRadius+Re.boundingSphereRadius)){var Xe=null;ne.material&&Re.material&&(Xe=ve.getContactMaterial(ne.material,Re.material)||null),this.currentContactMaterial=Xe||$||ve.defaultContactMaterial;var Ne=this[ne.type|Re.type];Ne&&(ne.type<Re.type?Ne.call(this,ne,Re,De,Ue,Oe,ae,z,j,ne,Re):Ne.call(this,Re,ne,Ue,De,ae,Oe,j,z,ne,Re))}}}}},p.prototype[r.types.BOX|r.types.BOX]=p.prototype.boxBox=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){oe.convexPolyhedronRepresentation.material=oe.material,pe.convexPolyhedronRepresentation.material=pe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,pe.convexPolyhedronRepresentation.collisionResponse=pe.collisionResponse,this.convexConvex(oe.convexPolyhedronRepresentation,pe.convexPolyhedronRepresentation,ve,xe,Qe,ke,Pe,Oe,oe,pe)},p.prototype[r.types.BOX|r.types.CONVEXPOLYHEDRON]=p.prototype.boxConvex=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexConvex(oe.convexPolyhedronRepresentation,pe,ve,xe,Qe,ke,Pe,Oe,oe,pe)},p.prototype[r.types.BOX|r.types.PARTICLE]=p.prototype.boxParticle=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexParticle(oe.convexPolyhedronRepresentation,pe,ve,xe,Qe,ke,Pe,Oe,oe,pe)},p.prototype[r.types.SPHERE]=p.prototype.sphereSphere=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=this.createContactEquation(Pe,Oe,oe,pe);xe.vsub(ve,ae.ni),ae.ni.normalize(),ae.ri.copy(ae.ni),ae.rj.copy(ae.ni),ae.ri.mult(oe.radius,ae.ri),ae.rj.mult(-pe.radius,ae.rj),ae.ri.vadd(ve,ae.ri),ae.ri.vsub(Pe.position,ae.ri),ae.rj.vadd(xe,ae.rj),ae.rj.vsub(Oe.position,ae.rj),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)};var S=new c,A=new c,T=new c;p.prototype[r.types.PLANE|r.types.TRIMESH]=p.prototype.planeTrimesh=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=new c,De=S;De.set(0,0,1),Qe.vmult(De,De);for(var Ue=0;Ue<pe.vertices.length/3;Ue++){pe.getVertex(Ue,ae);var qe=new c;qe.copy(ae),u.pointToWorldFrame(xe,ke,qe,ae);var R=A;ae.vsub(ve,R);var z=De.dot(R);if(z<=0){var j=this.createContactEquation(Pe,Oe,oe,pe);j.ni.copy(De);var $=T;De.scale(R.dot(De),$),ae.vsub($,$),j.ri.copy($),j.ri.vsub(Pe.position,j.ri),j.rj.copy(ae),j.rj.vsub(Oe.position,j.rj),this.result.push(j),this.createFrictionEquationsFromContact(j,this.frictionResult)}}};var b=new c,w=new c;new c;var P=new c,N=new c,I=new c,H=new c,G=new c,J=new c,U=new c,k=new c,q=new c,Y=new c,V=new c,Z=new s,W=[];p.prototype[r.types.SPHERE|r.types.TRIMESH]=p.prototype.sphereTrimesh=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=I,De=H,Ue=G,qe=J,R=U,z=k,j=Z,$=N,Q=w,ne=W;u.pointToLocalFrame(xe,ke,ve,R);var Ae=oe.radius;j.lowerBound.set(R.x-Ae,R.y-Ae,R.z-Ae),j.upperBound.set(R.x+Ae,R.y+Ae,R.z+Ae),pe.getTrianglesInAABB(j,ne);for(var Re=P,Xe=oe.radius*oe.radius,Ne=0;Ne<ne.length;Ne++)for(var Ve=0;Ve<3;Ve++)if(pe.getVertex(pe.indices[ne[Ne]*3+Ve],Re),Re.vsub(R,Q),Q.norm2()<=Xe){$.copy(Re),u.pointToWorldFrame(xe,ke,$,Re),Re.vsub(ve,Q);var Le=this.createContactEquation(Pe,Oe,oe,pe);Le.ni.copy(Q),Le.ni.normalize(),Le.ri.copy(Le.ni),Le.ri.scale(oe.radius,Le.ri),Le.ri.vadd(ve,Le.ri),Le.ri.vsub(Pe.position,Le.ri),Le.rj.copy(Re),Le.rj.vsub(Oe.position,Le.rj),this.result.push(Le),this.createFrictionEquationsFromContact(Le,this.frictionResult)}for(var Ne=0;Ne<ne.length;Ne++)for(var Ve=0;Ve<3;Ve++){pe.getVertex(pe.indices[ne[Ne]*3+Ve],ae),pe.getVertex(pe.indices[ne[Ne]*3+(Ve+1)%3],De),De.vsub(ae,Ue),R.vsub(De,z);var wt=z.dot(Ue);R.vsub(ae,z);var Tt=z.dot(Ue);if(Tt>0&&wt<0){R.vsub(ae,z),qe.copy(Ue),qe.normalize(),Tt=z.dot(qe),qe.scale(Tt,z),z.vadd(ae,z);var Pt=z.distanceTo(R);if(Pt<oe.radius){var Le=this.createContactEquation(Pe,Oe,oe,pe);z.vsub(R,Le.ni),Le.ni.normalize(),Le.ni.scale(oe.radius,Le.ri),u.pointToWorldFrame(xe,ke,z,z),z.vsub(Oe.position,Le.rj),u.vectorToWorldFrame(ke,Le.ni,Le.ni),u.vectorToWorldFrame(ke,Le.ri,Le.ri),this.result.push(Le),this.createFrictionEquationsFromContact(Le,this.frictionResult)}}}for(var cn=q,lt=Y,je=V,Ln=b,Ne=0,it=ne.length;Ne!==it;Ne++){pe.getTriangleVertices(ne[Ne],cn,lt,je),pe.getNormal(ne[Ne],Ln),R.vsub(cn,z);var Pt=z.dot(Ln);if(Ln.scale(Pt,z),R.vsub(z,z),Pt=z.distanceTo(R),a.pointInTriangle(z,cn,lt,je)&&Pt<oe.radius){var Le=this.createContactEquation(Pe,Oe,oe,pe);z.vsub(R,Le.ni),Le.ni.normalize(),Le.ni.scale(oe.radius,Le.ri),u.pointToWorldFrame(xe,ke,z,z),z.vsub(Oe.position,Le.rj),u.vectorToWorldFrame(ke,Le.ni,Le.ni),u.vectorToWorldFrame(ke,Le.ri,Le.ri),this.result.push(Le),this.createFrictionEquationsFromContact(Le,this.frictionResult)}}ne.length=0};var L=new c,F=new c;p.prototype[r.types.SPHERE|r.types.PLANE]=p.prototype.spherePlane=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=this.createContactEquation(Pe,Oe,oe,pe);if(ae.ni.set(0,0,1),ke.vmult(ae.ni,ae.ni),ae.ni.negate(ae.ni),ae.ni.normalize(),ae.ni.mult(oe.radius,ae.ri),ve.vsub(xe,L),ae.ni.mult(ae.ni.dot(L),F),L.vsub(F,ae.rj),-L.dot(ae.ni)<=oe.radius){var De=ae.ri,Ue=ae.rj;De.vadd(ve,De),De.vsub(Pe.position,De),Ue.vadd(xe,Ue),Ue.vsub(Oe.position,Ue),this.result.push(ae),this.createFrictionEquationsFromContact(ae,this.frictionResult)}};var X=new c,ee=new c,re=new c;function K(oe,pe,ve){for(var xe=null,Qe=oe.length,ke=0;ke!==Qe;ke++){var Pe=oe[ke],Oe=X;oe[(ke+1)%Qe].vsub(Pe,Oe);var ae=ee;Oe.cross(pe,ae);var De=re;ve.vsub(Pe,De);var Ue=ae.dot(De);if(xe===null||Ue>0&&xe===!0||Ue<=0&&xe===!1){xe===null&&(xe=Ue>0);continue}else return!1}return!0}var O=new c,de=new c,_e=new c,Me=new c,me=[new c,new c,new c,new c,new c,new c],le=new c,ue=new c,We=new c,Ge=new c;p.prototype[r.types.SPHERE|r.types.BOX]=p.prototype.sphereBox=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=this.v3pool,De=me;ve.vsub(xe,O),pe.getSideNormals(De,ke);for(var Ue=oe.radius,qe=!1,R=ue,z=We,j=Ge,$=null,Q=0,ne=0,Ae=0,Re=null,Xe=0,Ne=De.length;Xe!==Ne&&qe===!1;Xe++){var Ve=de;Ve.copy(De[Xe]);var Le=Ve.norm();Ve.normalize();var wt=O.dot(Ve);if(wt<Le+Ue&&wt>0){var Tt=_e,Pt=Me;Tt.copy(De[(Xe+1)%3]),Pt.copy(De[(Xe+2)%3]);var cn=Tt.norm(),lt=Pt.norm();Tt.normalize(),Pt.normalize();var je=O.dot(Tt),Ln=O.dot(Pt);if(je<cn&&je>-cn&&Ln<lt&&Ln>-lt){var Qt=Math.abs(wt-Le-Ue);(Re===null||Qt<Re)&&(Re=Qt,ne=je,Ae=Ln,$=Le,R.copy(Ve),z.copy(Tt),j.copy(Pt),Q++)}}}if(Q){qe=!0;var st=this.createContactEquation(Pe,Oe,oe,pe);R.mult(-Ue,st.ri),st.ni.copy(R),st.ni.negate(st.ni),R.mult($,R),z.mult(ne,z),R.vadd(z,R),j.mult(Ae,j),R.vadd(j,st.rj),st.ri.vadd(ve,st.ri),st.ri.vsub(Pe.position,st.ri),st.rj.vadd(xe,st.rj),st.rj.vsub(Oe.position,st.rj),this.result.push(st),this.createFrictionEquationsFromContact(st,this.frictionResult)}for(var it=ae.get(),xn=le,wn=0;wn!==2&&!qe;wn++)for(var Zt=0;Zt!==2&&!qe;Zt++)for(var en=0;en!==2&&!qe;en++)if(it.set(0,0,0),wn?it.vadd(De[0],it):it.vsub(De[0],it),Zt?it.vadd(De[1],it):it.vsub(De[1],it),en?it.vadd(De[2],it):it.vsub(De[2],it),xe.vadd(it,xn),xn.vsub(ve,xn),xn.norm2()<Ue*Ue){qe=!0;var st=this.createContactEquation(Pe,Oe,oe,pe);st.ri.copy(xn),st.ri.normalize(),st.ni.copy(st.ri),st.ri.mult(Ue,st.ri),st.rj.copy(it),st.ri.vadd(ve,st.ri),st.ri.vsub(Pe.position,st.ri),st.rj.vadd(xe,st.rj),st.rj.vsub(Oe.position,st.rj),this.result.push(st),this.createFrictionEquationsFromContact(st,this.frictionResult)}ae.release(it),it=null;for(var Ct=ae.get(),pn=ae.get(),st=ae.get(),kt=ae.get(),Qt=ae.get(),Di=De.length,wn=0;wn!==Di&&!qe;wn++)for(var Zt=0;Zt!==Di&&!qe;Zt++)if(wn%3!==Zt%3){De[Zt].cross(De[wn],Ct),Ct.normalize(),De[wn].vadd(De[Zt],pn),st.copy(ve),st.vsub(pn,st),st.vsub(xe,st);var vi=st.dot(Ct);Ct.mult(vi,kt);for(var en=0;en===wn%3||en===Zt%3;)en++;Qt.copy(ve),Qt.vsub(kt,Qt),Qt.vsub(pn,Qt),Qt.vsub(xe,Qt);var Zm=Math.abs(vi),Qm=Qt.norm();if(Zm<De[en].norm()&&Qm<Ue){qe=!0;var Gt=this.createContactEquation(Pe,Oe,oe,pe);pn.vadd(kt,Gt.rj),Gt.rj.copy(Gt.rj),Qt.negate(Gt.ni),Gt.ni.normalize(),Gt.ri.copy(Gt.rj),Gt.ri.vadd(xe,Gt.ri),Gt.ri.vsub(ve,Gt.ri),Gt.ri.normalize(),Gt.ri.mult(Ue,Gt.ri),Gt.ri.vadd(ve,Gt.ri),Gt.ri.vsub(Pe.position,Gt.ri),Gt.rj.vadd(xe,Gt.rj),Gt.rj.vsub(Oe.position,Gt.rj),this.result.push(Gt),this.createFrictionEquationsFromContact(Gt,this.frictionResult)}}ae.release(Ct,pn,st,kt,Qt)};var B=new c,C=new c,ie=new c,he=new c,fe=new c,ge=new c,Ie=new c,Ee=new c,we=new c,Ke=new c;p.prototype[r.types.SPHERE|r.types.CONVEXPOLYHEDRON]=p.prototype.sphereConvex=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=this.v3pool;ve.vsub(xe,B);for(var De=pe.faceNormals,Ue=pe.faces,qe=pe.vertices,R=oe.radius,z=0;z!==qe.length;z++){var j=qe[z],$=fe;ke.vmult(j,$),xe.vadd($,$);var Q=he;if($.vsub(ve,Q),Q.norm2()<R*R){Ae=!0;var ne=this.createContactEquation(Pe,Oe,oe,pe);ne.ri.copy(Q),ne.ri.normalize(),ne.ni.copy(ne.ri),ne.ri.mult(R,ne.ri),$.vsub(xe,ne.rj),ne.ri.vadd(ve,ne.ri),ne.ri.vsub(Pe.position,ne.ri),ne.rj.vadd(xe,ne.rj),ne.rj.vsub(Oe.position,ne.rj),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult);return}}for(var Ae=!1,z=0,Re=Ue.length;z!==Re&&Ae===!1;z++){var Xe=De[z],Ne=Ue[z],Ve=ge;ke.vmult(Xe,Ve);var Le=Ie;ke.vmult(qe[Ne[0]],Le),Le.vadd(xe,Le);var wt=Ee;Ve.mult(-R,wt),ve.vadd(wt,wt);var Tt=we;wt.vsub(Le,Tt);var Pt=Tt.dot(Ve),cn=Ke;if(ve.vsub(Le,cn),Pt<0&&cn.dot(Ve)>0){for(var lt=[],je=0,Ln=Ne.length;je!==Ln;je++){var it=ae.get();ke.vmult(qe[Ne[je]],it),xe.vadd(it,it),lt.push(it)}if(K(lt,Ve,ve)){Ae=!0;var ne=this.createContactEquation(Pe,Oe,oe,pe);Ve.mult(-R,ne.ri),Ve.negate(ne.ni);var xn=ae.get();Ve.mult(-Pt,xn);var wn=ae.get();Ve.mult(-R,wn),ve.vsub(xe,ne.rj),ne.rj.vadd(wn,ne.rj),ne.rj.vadd(xn,ne.rj),ne.rj.vadd(xe,ne.rj),ne.rj.vsub(Oe.position,ne.rj),ne.ri.vadd(ve,ne.ri),ne.ri.vsub(Pe.position,ne.ri),ae.release(xn),ae.release(wn),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult);for(var je=0,Zt=lt.length;je!==Zt;je++)ae.release(lt[je]);return}else for(var je=0;je!==Ne.length;je++){var en=ae.get(),Ct=ae.get();ke.vmult(qe[Ne[(je+1)%Ne.length]],en),ke.vmult(qe[Ne[(je+2)%Ne.length]],Ct),xe.vadd(en,en),xe.vadd(Ct,Ct);var pn=C;Ct.vsub(en,pn);var st=ie;pn.unit(st);var kt=ae.get(),Qt=ae.get();ve.vsub(en,Qt);var Di=Qt.dot(st);st.mult(Di,kt),kt.vadd(en,kt);var vi=ae.get();if(kt.vsub(ve,vi),Di>0&&Di*Di<pn.norm2()&&vi.norm2()<R*R){var ne=this.createContactEquation(Pe,Oe,oe,pe);kt.vsub(xe,ne.rj),kt.vsub(ve,ne.ni),ne.ni.normalize(),ne.ni.mult(R,ne.ri),ne.rj.vadd(xe,ne.rj),ne.rj.vsub(Oe.position,ne.rj),ne.ri.vadd(ve,ne.ri),ne.ri.vsub(Pe.position,ne.ri),this.result.push(ne),this.createFrictionEquationsFromContact(ne,this.frictionResult);for(var je=0,Zt=lt.length;je!==Zt;je++)ae.release(lt[je]);ae.release(en),ae.release(Ct),ae.release(kt),ae.release(vi),ae.release(Qt);return}ae.release(en),ae.release(Ct),ae.release(kt),ae.release(vi),ae.release(Qt)}for(var je=0,Zt=lt.length;je!==Zt;je++)ae.release(lt[je])}}},new c,new c,p.prototype[r.types.PLANE|r.types.BOX]=p.prototype.planeBox=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){pe.convexPolyhedronRepresentation.material=pe.material,pe.convexPolyhedronRepresentation.collisionResponse=pe.collisionResponse,this.planeConvex(oe,pe.convexPolyhedronRepresentation,ve,xe,Qe,ke,Pe,Oe)};var Ce=new c,$e=new c,at=new c,Ze=new c;p.prototype[r.types.PLANE|r.types.CONVEXPOLYHEDRON]=p.prototype.planeConvex=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=Ce,De=$e;De.set(0,0,1),Qe.vmult(De,De);for(var Ue=0,qe=at,R=0;R!==pe.vertices.length;R++){ae.copy(pe.vertices[R]),ke.vmult(ae,ae),xe.vadd(ae,ae),ae.vsub(ve,qe);var z=De.dot(qe);if(z<=0){var j=this.createContactEquation(Pe,Oe,oe,pe),$=Ze;De.mult(De.dot(qe),$),ae.vsub($,$),$.vsub(ve,j.ri),j.ni.copy(De),ae.vsub(xe,j.rj),j.ri.vadd(ve,j.ri),j.ri.vsub(Pe.position,j.ri),j.rj.vadd(xe,j.rj),j.rj.vsub(Oe.position,j.rj),this.result.push(j),Ue++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(j,this.frictionResult)}}this.enableFrictionReduction&&Ue&&this.createFrictionFromAverage(Ue)};var ze=new c,Je=new c;p.prototype[r.types.CONVEXPOLYHEDRON]=p.prototype.convexConvex=function(oe,pe,ve,xe,Qe,ke,Pe,Oe,ae,De,Ue,qe){var R=ze;if(!(ve.distanceTo(xe)>oe.boundingSphereRadius+pe.boundingSphereRadius)&&oe.findSeparatingAxis(pe,ve,Qe,xe,ke,R,Ue,qe)){var z=[],j=Je;oe.clipAgainstHull(ve,Qe,pe,xe,ke,R,-100,100,z);for(var $=0,Q=0;Q!==z.length;Q++){var ne=this.createContactEquation(Pe,Oe,oe,pe,ae,De),Ae=ne.ri,Re=ne.rj;R.negate(ne.ni),z[Q].normal.negate(j),j.mult(z[Q].depth,j),z[Q].point.vadd(j,Ae),Re.copy(z[Q].point),Ae.vsub(ve,Ae),Re.vsub(xe,Re),Ae.vadd(ve,Ae),Ae.vsub(Pe.position,Ae),Re.vadd(xe,Re),Re.vsub(Oe.position,Re),this.result.push(ne),$++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(ne,this.frictionResult)}this.enableFrictionReduction&&$&&this.createFrictionFromAverage($)}};var rt=new c,vt=new c,tt=new c;p.prototype[r.types.PLANE|r.types.PARTICLE]=p.prototype.planeParticle=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=rt;ae.set(0,0,1),Pe.quaternion.vmult(ae,ae);var De=vt;xe.vsub(Pe.position,De);var Ue=ae.dot(De);if(Ue<=0){var qe=this.createContactEquation(Oe,Pe,pe,oe);qe.ni.copy(ae),qe.ni.negate(qe.ni),qe.ri.set(0,0,0);var R=tt;ae.mult(ae.dot(xe),R),xe.vsub(R,R),qe.rj.copy(R),this.result.push(qe),this.createFrictionEquationsFromContact(qe,this.frictionResult)}};var E=new c;p.prototype[r.types.PARTICLE|r.types.SPHERE]=p.prototype.sphereParticle=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=E;ae.set(0,0,1),xe.vsub(ve,ae);var De=ae.norm2();if(De<=oe.radius*oe.radius){var Ue=this.createContactEquation(Oe,Pe,pe,oe);ae.normalize(),Ue.rj.copy(ae),Ue.rj.mult(oe.radius,Ue.rj),Ue.ni.copy(ae),Ue.ni.negate(Ue.ni),Ue.ri.set(0,0,0),this.result.push(Ue),this.createFrictionEquationsFromContact(Ue,this.frictionResult)}};var te=new d,se=new c;new c;var ye=new c,Te=new c,nt=new c;p.prototype[r.types.PARTICLE|r.types.CONVEXPOLYHEDRON]=p.prototype.convexParticle=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=-1,De=ye,Ue=nt,qe=null,R=se;if(R.copy(xe),R.vsub(ve,R),Qe.conjugate(te),te.vmult(R,R),oe.pointIsInside(R)){oe.worldVerticesNeedsUpdate&&oe.computeWorldVertices(ve,Qe),oe.worldFaceNormalsNeedsUpdate&&oe.computeWorldFaceNormals(Qe);for(var z=0,j=oe.faces.length;z!==j;z++){var $=[oe.worldVertices[oe.faces[z][0]]],Q=oe.worldFaceNormals[z];xe.vsub($[0],Te);var ne=-Q.dot(Te);(qe===null||Math.abs(ne)<Math.abs(qe))&&(qe=ne,ae=z,De.copy(Q))}if(ae!==-1){var Ae=this.createContactEquation(Oe,Pe,pe,oe);De.mult(qe,Ue),Ue.vadd(xe,Ue),Ue.vsub(ve,Ue),Ae.rj.copy(Ue),De.negate(Ae.ni),Ae.ri.set(0,0,0);var Re=Ae.ri,Xe=Ae.rj;Re.vadd(xe,Re),Re.vsub(Oe.position,Re),Xe.vadd(ve,Xe),Xe.vsub(Pe.position,Xe),this.result.push(Ae),this.createFrictionEquationsFromContact(Ae,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},p.prototype[r.types.BOX|r.types.HEIGHTFIELD]=p.prototype.boxHeightfield=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){oe.convexPolyhedronRepresentation.material=oe.material,oe.convexPolyhedronRepresentation.collisionResponse=oe.collisionResponse,this.convexHeightfield(oe.convexPolyhedronRepresentation,pe,ve,xe,Qe,ke,Pe,Oe)};var ot=new c,St=new c,Ut=[0];p.prototype[r.types.CONVEXPOLYHEDRON|r.types.HEIGHTFIELD]=p.prototype.convexHeightfield=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=pe.data,De=pe.elementSize,Ue=oe.boundingSphereRadius,qe=St,R=Ut,z=ot;u.pointToLocalFrame(xe,ke,ve,z);var j=Math.floor((z.x-Ue)/De)-1,$=Math.ceil((z.x+Ue)/De)+1,Q=Math.floor((z.y-Ue)/De)-1,ne=Math.ceil((z.y+Ue)/De)+1;if(!($<0||ne<0||j>ae.length||Q>ae[0].length)){j<0&&(j=0),$<0&&($=0),Q<0&&(Q=0),ne<0&&(ne=0),j>=ae.length&&(j=ae.length-1),$>=ae.length&&($=ae.length-1),ne>=ae[0].length&&(ne=ae[0].length-1),Q>=ae[0].length&&(Q=ae[0].length-1);var Ae=[];pe.getRectMinMax(j,Q,$,ne,Ae);var Re=Ae[0],Xe=Ae[1];if(!(z.z-Ue>Xe||z.z+Ue<Re))for(var Ne=j;Ne<$;Ne++)for(var Ve=Q;Ve<ne;Ve++)pe.getConvexTrianglePillar(Ne,Ve,!1),u.pointToWorldFrame(xe,ke,pe.pillarOffset,qe),ve.distanceTo(qe)<pe.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.convexConvex(oe,pe.pillarConvex,ve,qe,Qe,ke,Pe,Oe,null,null,R,null),pe.getConvexTrianglePillar(Ne,Ve,!0),u.pointToWorldFrame(xe,ke,pe.pillarOffset,qe),ve.distanceTo(qe)<pe.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.convexConvex(oe,pe.pillarConvex,ve,qe,Qe,ke,Pe,Oe,null,null,R,null)}};var pt=new c,mt=new c;p.prototype[r.types.SPHERE|r.types.HEIGHTFIELD]=p.prototype.sphereHeightfield=function(oe,pe,ve,xe,Qe,ke,Pe,Oe){var ae=pe.data,De=oe.radius,Ue=pe.elementSize,qe=mt,R=pt;u.pointToLocalFrame(xe,ke,ve,R);var z=Math.floor((R.x-De)/Ue)-1,j=Math.ceil((R.x+De)/Ue)+1,$=Math.floor((R.y-De)/Ue)-1,Q=Math.ceil((R.y+De)/Ue)+1;if(!(j<0||Q<0||z>ae.length||Q>ae[0].length)){z<0&&(z=0),j<0&&(j=0),$<0&&($=0),Q<0&&(Q=0),z>=ae.length&&(z=ae.length-1),j>=ae.length&&(j=ae.length-1),Q>=ae[0].length&&(Q=ae[0].length-1),$>=ae[0].length&&($=ae[0].length-1);var ne=[];pe.getRectMinMax(z,$,j,Q,ne);var Ae=ne[0],Re=ne[1];if(!(R.z-De>Re||R.z+De<Ae))for(var Xe=this.result,Ne=z;Ne<j;Ne++)for(var Ve=$;Ve<Q;Ve++){var Le=Xe.length;pe.getConvexTrianglePillar(Ne,Ve,!1),u.pointToWorldFrame(xe,ke,pe.pillarOffset,qe),ve.distanceTo(qe)<pe.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.sphereConvex(oe,pe.pillarConvex,ve,qe,Qe,ke,Pe,Oe),pe.getConvexTrianglePillar(Ne,Ve,!0),u.pointToWorldFrame(xe,ke,pe.pillarOffset,qe),ve.distanceTo(qe)<pe.pillarConvex.boundingSphereRadius+oe.boundingSphereRadius&&this.sphereConvex(oe,pe.pillarConvex,ve,qe,Qe,ke,Pe,Oe);var wt=Xe.length-Le;if(wt>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,n,i){n.exports=x;var s=t("../shapes/Shape"),r=t("../math/Vec3"),a=t("../math/Quaternion"),c=t("../solver/GSSolver");t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation");var u=t("./Narrowphase"),d=t("../utils/EventTarget"),l=t("../collision/ArrayCollisionMatrix"),h=t("../material/Material"),f=t("../material/ContactMaterial"),p=t("../objects/Body"),g=t("../utils/TupleDictionary"),m=t("../collision/RaycastResult"),v=t("../collision/AABB"),_=t("../collision/Ray"),y=t("../collision/NaiveBroadphase");function x(){d.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new r,this.broadphase=new y,this.bodies=[],this.solver=new c,this.constraints=[],this.narrowphase=new u(this),this.collisionMatrix=new l,this.collisionMatrixPrevious=new l,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new g,this.defaultMaterial=new h("default"),this.defaultContactMaterial=new f(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}x.prototype=new d,new v;var M=new _;if(x.prototype.getContactMaterial=function(k,q){return this.contactMaterialTable.get(k.id,q.id)},x.prototype.numObjects=function(){return this.bodies.length},x.prototype.collisionMatrixTick=function(){var k=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=k,this.collisionMatrix.reset()},x.prototype.add=x.prototype.addBody=function(k){this.bodies.indexOf(k)===-1&&(k.index=this.bodies.length,this.bodies.push(k),k.world=this,k.initPosition.copy(k.position),k.initVelocity.copy(k.velocity),k.timeLastSleepy=this.time,k instanceof p&&(k.initAngularVelocity.copy(k.angularVelocity),k.initQuaternion.copy(k.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=k,this.dispatchEvent(this.addBodyEvent))},x.prototype.addConstraint=function(k){this.constraints.push(k)},x.prototype.removeConstraint=function(k){var q=this.constraints.indexOf(k);q!==-1&&this.constraints.splice(q,1)},x.prototype.rayTest=function(k,q,Y){Y instanceof m?this.raycastClosest(k,q,{skipBackfaces:!0},Y):this.raycastAll(k,q,{skipBackfaces:!0},Y)},x.prototype.raycastAll=function(k,q,Y,V){return Y.mode=_.ALL,Y.from=k,Y.to=q,Y.callback=V,M.intersectWorld(this,Y)},x.prototype.raycastAny=function(k,q,Y,V){return Y.mode=_.ANY,Y.from=k,Y.to=q,Y.result=V,M.intersectWorld(this,Y)},x.prototype.raycastClosest=function(k,q,Y,V){return Y.mode=_.CLOSEST,Y.from=k,Y.to=q,Y.result=V,M.intersectWorld(this,Y)},x.prototype.remove=function(k){k.world=null;var q=this.bodies.length-1,Y=this.bodies,V=Y.indexOf(k);if(V!==-1){Y.splice(V,1);for(var Z=0;Z!==Y.length;Z++)Y[Z].index=Z;this.collisionMatrix.setNumObjects(q),this.removeBodyEvent.body=k,this.dispatchEvent(this.removeBodyEvent)}},x.prototype.removeBody=x.prototype.remove,x.prototype.addMaterial=function(k){this.materials.push(k)},x.prototype.addContactMaterial=function(k){this.contactmaterials.push(k),this.contactMaterialTable.set(k.materials[0].id,k.materials[1].id,k)},typeof performance>"u"&&(performance={}),!performance.now){var S=Date.now();performance.timing&&performance.timing.navigationStart&&(S=performance.timing.navigationStart),performance.now=function(){return Date.now()-S}}var A=new r;x.prototype.step=function(k,q,Y){if(Y=Y||10,q=q||0,q===0)this.internalStep(k),this.time+=k;else{var V=Math.floor((this.time+q)/k)-Math.floor(this.time/k);V=Math.min(V,Y);for(var Z=performance.now(),W=0;W!==V&&(this.internalStep(k),!(performance.now()-Z>k*1e3));W++);this.time+=q;for(var L=this.time%k,F=L/k,X=A,ee=this.bodies,re=0;re!==ee.length;re++){var K=ee[re];K.type!==p.STATIC&&K.sleepState!==p.SLEEPING?(K.position.vsub(K.previousPosition,X),X.scale(F,X),K.position.vadd(X,K.interpolatedPosition)):(K.interpolatedPosition.copy(K.position),K.interpolatedQuaternion.copy(K.quaternion))}}};var T={type:"postStep"},b={type:"preStep"},w={type:"collide",body:null,contact:null},P=[],N=[],I=[],H=[];new r,new r,new r,new r,new r,new r,new r,new r,new r,new a;var G=new a,J=new a,U=new r;x.prototype.internalStep=function(k){this.dt=k;var q=this.contacts,Y=I,V=H,Z=this.numObjects(),W=this.bodies,L=this.solver,F=this.gravity,X=this.doProfiling,ee=this.profile,re=p.DYNAMIC,K,O=this.constraints,de=N;F.norm();var _e=F.x,Me=F.y,me=F.z,le=0;for(X&&(K=performance.now()),le=0;le!==Z;le++){var ue=W[le];if(ue.type&re){var We=ue.force,Ge=ue.mass;We.x+=Ge*_e,We.y+=Ge*Me,We.z+=Ge*me}}for(var le=0,B=this.subsystems.length;le!==B;le++)this.subsystems[le].update();X&&(K=performance.now()),Y.length=0,V.length=0,this.broadphase.collisionPairs(this,Y,V),X&&(ee.broadphase=performance.now()-K);var ze=O.length;for(le=0;le!==ze;le++){var C=O[le];if(!C.collideConnected)for(var ie=Y.length-1;ie>=0;ie-=1)(C.bodyA===Y[ie]&&C.bodyB===V[ie]||C.bodyB===Y[ie]&&C.bodyA===V[ie])&&(Y.splice(ie,1),V.splice(ie,1))}this.collisionMatrixTick(),X&&(K=performance.now());var he=P,fe=q.length;for(le=0;le!==fe;le++)he.push(q[le]);q.length=0;var ge=this.frictionEquations.length;for(le=0;le!==ge;le++)de.push(this.frictionEquations[le]);this.frictionEquations.length=0,this.narrowphase.getContacts(Y,V,this,q,he,this.frictionEquations,de),X&&(ee.narrowphase=performance.now()-K),X&&(K=performance.now());for(var le=0;le<this.frictionEquations.length;le++)L.addEquation(this.frictionEquations[le]);for(var Ie=q.length,Ee=0;Ee!==Ie;Ee++){var C=q[Ee],ue=C.bi,we=C.bj;C.si,C.sj;var Ke;if(ue.material&&we.material?Ke=this.getContactMaterial(ue.material,we.material)||this.defaultContactMaterial:Ke=this.defaultContactMaterial,Ke.friction,ue.material&&we.material&&(ue.material.friction>=0&&we.material.friction>=0&&ue.material.friction*we.material.friction,ue.material.restitution>=0&&we.material.restitution>=0&&(C.restitution=ue.material.restitution*we.material.restitution)),L.addEquation(C),ue.allowSleep&&ue.type===p.DYNAMIC&&ue.sleepState===p.SLEEPING&&we.sleepState===p.AWAKE&&we.type!==p.STATIC){var Ce=we.velocity.norm2()+we.angularVelocity.norm2(),$e=Math.pow(we.sleepSpeedLimit,2);Ce>=$e*2&&(ue._wakeUpAfterNarrowphase=!0)}if(we.allowSleep&&we.type===p.DYNAMIC&&we.sleepState===p.SLEEPING&&ue.sleepState===p.AWAKE&&ue.type!==p.STATIC){var at=ue.velocity.norm2()+ue.angularVelocity.norm2(),Ze=Math.pow(ue.sleepSpeedLimit,2);at>=Ze*2&&(we._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(ue,we,!0),this.collisionMatrixPrevious.get(ue,we)||(w.body=we,w.contact=C,ue.dispatchEvent(w),w.body=ue,we.dispatchEvent(w))}for(X&&(ee.makeContactConstraints=performance.now()-K,K=performance.now()),le=0;le!==Z;le++){var ue=W[le];ue._wakeUpAfterNarrowphase&&(ue.wakeUp(),ue._wakeUpAfterNarrowphase=!1)}var ze=O.length;for(le=0;le!==ze;le++){var C=O[le];C.update();for(var ie=0,Je=C.equations.length;ie!==Je;ie++){var rt=C.equations[ie];L.addEquation(rt)}}L.solve(k,this),X&&(ee.solve=performance.now()-K),L.removeAllEquations();var vt=Math.pow;for(le=0;le!==Z;le++){var ue=W[le];if(ue.type&re){var tt=vt(1-ue.linearDamping,k),E=ue.velocity;E.mult(tt,E);var te=ue.angularVelocity;if(te){var se=vt(1-ue.angularDamping,k);te.mult(se,te)}}}for(this.dispatchEvent(b),le=0;le!==Z;le++){var ue=W[le];ue.preStep&&ue.preStep.call(ue)}X&&(K=performance.now());var ye=G,Te=J,nt=this.stepnumber,ot=p.DYNAMIC|p.KINEMATIC,St=nt%(this.quatNormalizeSkip+1)===0,Ut=this.quatNormalizeFast,pt=k*.5;for(s.types.PLANE,s.types.CONVEXPOLYHEDRON,le=0;le!==Z;le++){var mt=W[le],oe=mt.force,pe=mt.torque;if(mt.type&ot&&mt.sleepState!==p.SLEEPING){var ve=mt.velocity,xe=mt.angularVelocity,Qe=mt.position,ke=mt.quaternion,Pe=mt.invMass,Oe=mt.invInertiaWorld;ve.x+=oe.x*Pe*k,ve.y+=oe.y*Pe*k,ve.z+=oe.z*Pe*k,mt.angularVelocity&&(Oe.vmult(pe,U),U.mult(k,U),U.vadd(xe,xe)),Qe.x+=ve.x*k,Qe.y+=ve.y*k,Qe.z+=ve.z*k,mt.angularVelocity&&(ye.set(xe.x,xe.y,xe.z,0),ye.mult(ke,Te),ke.x+=pt*Te.x,ke.y+=pt*Te.y,ke.z+=pt*Te.z,ke.w+=pt*Te.w,St&&(Ut?ke.normalizeFast():ke.normalize())),mt.aabb&&(mt.aabbNeedsUpdate=!0),mt.updateInertiaWorld&&mt.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,X&&(ee.integrate=performance.now()-K),this.time+=k,this.stepnumber+=1,this.dispatchEvent(T),le=0;le!==Z;le++){var ue=W[le],ae=ue.postStep;ae&&ae.call(ue)}if(this.allowSleep)for(le=0;le!==Z;le++)W[le].sleepTick(this.time)},x.prototype.clearForces=function(){for(var k=this.bodies,q=k.length,Y=0;Y!==q;Y++){var V=k[Y];V.force,V.torque,V.force.set(0,0,0),V.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)})})(Bp);var wM=Bp.exports;const ct=xM(wM);class bM{constructor(e){this.config=e.config,this.debug=e.debug,this.time=e.time,this.sizes=e.sizes,this.controls=e.controls,this.sounds=e.sounds,this.debug&&(this.debugFolder=this.debug.addFolder("physics")),this.setWorld(),this.setModels(),this.setMaterials(),this.setFloor(),this.setCar(),this.time.on("tick",()=>{this.world.step(this.time.delta/1e3)})}setWorld(){this.world=new ct.World,this.world.gravity.set(0,0,-3.25*4),this.world.allowSleep=!0,this.world.defaultContactMaterial.friction=0,this.world.defaultContactMaterial.restitution=.2,this.debug&&this.debugFolder.add(this.world.gravity,"z").step(.001).min(-20).max(20).name("gravity")}setModels(){this.models={},this.models.container=new et,this.models.container.visible=!1,this.models.materials={},this.models.materials.static=new Mt({color:255,wireframe:!0}),this.models.materials.dynamic=new Mt({color:16711680,wireframe:!0}),this.models.materials.dynamicSleeping=new Mt({color:16776960,wireframe:!0}),this.debug&&this.debugFolder.add(this.models.container,"visible").name("modelsVisible")}setMaterials(){this.materials={},this.materials.items={},this.materials.items.floor=new ct.Material("floorMaterial"),this.materials.items.dummy=new ct.Material("dummyMaterial"),this.materials.items.wheel=new ct.Material("wheelMaterial"),this.materials.contacts={},this.materials.contacts.floorDummy=new ct.ContactMaterial(this.materials.items.floor,this.materials.items.dummy,{friction:.05,restitution:.3,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.floorDummy),this.materials.contacts.dummyDummy=new ct.ContactMaterial(this.materials.items.dummy,this.materials.items.dummy,{friction:.5,restitution:.3,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.dummyDummy),this.materials.contacts.floorWheel=new ct.ContactMaterial(this.materials.items.floor,this.materials.items.wheel,{friction:.3,restitution:0,contactEquationStiffness:1e3}),this.world.addContactMaterial(this.materials.contacts.floorWheel)}setFloor(){this.floor={},this.floor.body=new ct.Body({mass:0,shape:new ct.Plane,material:this.materials.items.floor}),this.world.addBody(this.floor.body)}setCar(){this.car={},this.car.steering=0,this.car.accelerating=0,this.car.speed=0,this.car.worldForward=new ct.Vec3,this.car.angle=0,this.car.forwardSpeed=0,this.car.oldPosition=new ct.Vec3,this.car.goingForward=!0,this.car.options={},this.car.options.chassisWidth=1.02,this.car.options.chassisHeight=1.16,this.car.options.chassisDepth=2.03,this.car.options.chassisOffset=new ct.Vec3(0,0,.41),this.car.options.chassisMass=40,this.car.options.wheelFrontOffsetDepth=.635,this.car.options.wheelBackOffsetDepth=-.475,this.car.options.wheelOffsetWidth=.39,this.car.options.wheelRadius=.25,this.car.options.wheelHeight=.24,this.car.options.wheelSuspensionStiffness=50,this.car.options.wheelSuspensionRestLength=.1,this.car.options.wheelFrictionSlip=10,this.car.options.wheelDampingRelaxation=1.8,this.car.options.wheelDampingCompression=1.5,this.car.options.wheelMaxSuspensionForce=1e5,this.car.options.wheelRollInfluence=.01,this.car.options.wheelMaxSuspensionTravel=.3,this.car.options.wheelCustomSlidingRotationalSpeed=-30,this.car.options.wheelMass=5,this.car.options.controlsSteeringSpeed=.005*3,this.car.options.controlsSteeringMax=Math.PI*.17,this.car.options.controlsSteeringQuad=!1,this.car.options.controlsAcceleratinMaxSpeed=.055*3/17,this.car.options.controlsAcceleratinMaxSpeedBoost=.11*3/17,this.car.options.controlsAcceleratingSpeed=2*4*2,this.car.options.controlsAcceleratingSpeedBoost=3.5*4*2,this.car.options.controlsAcceleratingQuad=!0,this.car.options.controlsBrakeStrength=.45*3,this.car.upsideDown={},this.car.upsideDown.state="watching",this.car.upsideDown.pendingTimeout=null,this.car.upsideDown.turningTimeout=null,this.car.jump=(e=!0,t=150)=>{let n=this.car.chassis.body.position;n=n.vadd(new ct.Vec3(e?.1:0,0,0)),this.car.chassis.body.applyImpulse(new ct.Vec3(0,0,t),n)},this.car.create=()=>{this.car.chassis={},this.car.chassis.shape=new ct.Box(new ct.Vec3(this.car.options.chassisDepth*.5,this.car.options.chassisWidth*.5,this.car.options.chassisHeight*.5)),this.car.chassis.body=new ct.Body({mass:this.car.options.chassisMass}),this.car.chassis.body.allowSleep=!1,this.car.chassis.body.position.set(0,0,12),this.car.chassis.body.sleep(),this.car.chassis.body.addShape(this.car.chassis.shape,this.car.options.chassisOffset),this.car.chassis.body.quaternion.setFromAxisAngle(new ct.Vec3(0,0,1),-Math.PI*.5),this.car.chassis.body.addEventListener("collide",t=>{if(t.body.mass===0){const n=t.contact.getImpactVelocityAlongNormal();this.sounds.play("carHit",n)}}),this.car.vehicle=new ct.RaycastVehicle({chassisBody:this.car.chassis.body}),this.car.wheels={},this.car.wheels.options={radius:this.car.options.wheelRadius,height:this.car.options.wheelHeight,suspensionStiffness:this.car.options.wheelSuspensionStiffness,suspensionRestLength:this.car.options.wheelSuspensionRestLength,frictionSlip:this.car.options.wheelFrictionSlip,dampingRelaxation:this.car.options.wheelDampingRelaxation,dampingCompression:this.car.options.wheelDampingCompression,maxSuspensionForce:this.car.options.wheelMaxSuspensionForce,rollInfluence:this.car.options.wheelRollInfluence,maxSuspensionTravel:this.car.options.wheelMaxSuspensionTravel,customSlidingRotationalSpeed:this.car.options.wheelCustomSlidingRotationalSpeed,useCustomSlidingRotationalSpeed:!0,directionLocal:new ct.Vec3(0,0,-1),axleLocal:new ct.Vec3(0,1,0),chassisConnectionPointLocal:new ct.Vec3(1,1,0)},this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelFrontOffsetDepth,this.car.options.wheelOffsetWidth,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelFrontOffsetDepth,-this.car.options.wheelOffsetWidth,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelBackOffsetDepth,this.car.options.wheelOffsetWidth,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.wheels.options.chassisConnectionPointLocal.set(this.car.options.wheelBackOffsetDepth,-this.car.options.wheelOffsetWidth,0),this.car.vehicle.addWheel(this.car.wheels.options),this.car.vehicle.addToWorld(this.world),this.car.wheels.indexes={},this.car.wheels.indexes.frontLeft=0,this.car.wheels.indexes.frontRight=1,this.car.wheels.indexes.backLeft=2,this.car.wheels.indexes.backRight=3,this.car.wheels.bodies=[];for(const t of this.car.vehicle.wheelInfos){const n=new ct.Cylinder(t.radius,t.radius,this.car.wheels.options.height,20),i=new ct.Body({mass:this.car.options.wheelMass,material:this.materials.items.wheel}),s=new ct.Quaternion;s.setFromAxisAngle(new ct.Vec3(1,0,0),Math.PI/2),i.type=ct.Body.KINEMATIC,i.addShape(n,new ct.Vec3,s),this.car.wheels.bodies.push(i)}this.car.model={},this.car.model.container=new et,this.models.container.add(this.car.model.container),this.car.model.material=new Mt({color:16777215,wireframe:!0}),this.car.model.chassis=new Se(new Xt(this.car.options.chassisDepth,this.car.options.chassisWidth,this.car.options.chassisHeight),this.car.model.material),this.car.model.container.add(this.car.model.chassis),this.car.model.wheels=[];const e=new hn(this.car.options.wheelRadius,this.car.options.wheelRadius,this.car.options.wheelHeight,8,1);for(let t=0;t<4;t++){const n=new Se(e,this.car.model.material);this.car.model.container.add(n),this.car.model.wheels.push(n)}},this.car.destroy=()=>{this.car.vehicle.removeFromWorld(this.world),this.models.container.remove(this.car.model.container)},this.car.recreate=()=>{this.car.destroy(),this.car.create(),this.car.chassis.body.wakeUp()},this.car.brake=()=>{this.car.vehicle.setBrake(1,0),this.car.vehicle.setBrake(1,1),this.car.vehicle.setBrake(1,2),this.car.vehicle.setBrake(1,3)},this.car.unbrake=()=>{this.car.vehicle.setBrake(0,0),this.car.vehicle.setBrake(0,1),this.car.vehicle.setBrake(0,2),this.car.vehicle.setBrake(0,3)},this.controls.on("action",e=>{switch(e){case"reset":this.car.recreate();break}}),this.world.addEventListener("postStep",()=>{let e=new ct.Vec3;e=e.copy(this.car.chassis.body.position),e=e.vsub(this.car.oldPosition),this.car.oldPosition.copy(this.car.chassis.body.position),this.car.speed=e.length()/this.time.delta;const t=new ct.Vec3(1,0,0);this.car.chassis.body.vectorToWorldFrame(t,this.car.worldForward),this.car.angle=Math.atan2(this.car.worldForward.y,this.car.worldForward.x),this.car.forwardSpeed=this.car.worldForward.dot(e),this.car.goingForward=this.car.forwardSpeed>0;const n=new ct.Vec3(0,0,1),i=new ct.Vec3;this.car.chassis.body.vectorToWorldFrame(n,i),i.dot(n)<.5?this.car.upsideDown.state==="watching"&&(this.car.upsideDown.state="pending",this.car.upsideDown.pendingTimeout=window.setTimeout(()=>{this.car.upsideDown.state="turning",this.car.jump(!0),this.car.upsideDown.turningTimeout=window.setTimeout(()=>{this.car.upsideDown.state="watching"},1e3)},1e3)):this.car.upsideDown.state==="pending"&&(this.car.upsideDown.state="watching",window.clearTimeout(this.car.upsideDown.pendingTimeout));for(let s=0;s<this.car.vehicle.wheelInfos.length;s++){this.car.vehicle.updateWheelTransform(s);const r=this.car.vehicle.wheelInfos[s].worldTransform;if(this.car.wheels.bodies[s].position.copy(r.position),this.car.wheels.bodies[s].quaternion.copy(r.quaternion),s===1||s===3){const a=new ct.Quaternion(0,0,0,1);a.setFromAxisAngle(new ct.Vec3(0,0,1),Math.PI),this.car.wheels.bodies[s].quaternion=this.car.wheels.bodies[s].quaternion.mult(a)}}if(!this.controls.actions.up&&!this.controls.actions.down){let s=this.car.worldForward.clone();this.car.goingForward&&(s=s.negate()),s=s.scale(this.car.chassis.body.velocity.length()*.1),this.car.chassis.body.applyImpulse(s,this.car.chassis.body.position)}}),this.time.on("tick",()=>{this.car.model.chassis.position.copy(this.car.chassis.body.position).add(this.car.options.chassisOffset),this.car.model.chassis.quaternion.copy(this.car.chassis.body.quaternion);for(const i in this.car.wheels.bodies){const s=this.car.wheels.bodies[i],r=this.car.model.wheels[i];r.position.copy(s.position),r.quaternion.copy(s.quaternion)}if(this.controls.touch){let i=0;this.controls.touch.joystick.active&&(i=(this.controls.touch.joystick.angle.value-this.car.angle+Math.PI)%(Math.PI*2)-Math.PI,i=i<-Math.PI?i+Math.PI*2:i);const s=Math.abs(this.car.forwardSpeed)<.01?!0:this.car.goingForward;this.car.steering=i*(s?-1:1),Math.abs(this.car.steering)>this.car.options.controlsSteeringMax&&(this.car.steering=Math.sign(this.car.steering)*this.car.options.controlsSteeringMax)}if(!this.controls.touch||!this.controls.touch.joystick.active){const i=this.time.delta*this.car.options.controlsSteeringSpeed;this.controls.actions.right?this.car.steering+=i:this.controls.actions.left?this.car.steering-=i:Math.abs(this.car.steering)>i?this.car.steering-=i*Math.sign(this.car.steering):this.car.steering=0,Math.abs(this.car.steering)>this.car.options.controlsSteeringMax&&(this.car.steering=Math.sign(this.car.steering)*this.car.options.controlsSteeringMax)}this.car.vehicle.setSteeringValue(-this.car.steering,this.car.wheels.indexes.frontLeft),this.car.vehicle.setSteeringValue(-this.car.steering,this.car.wheels.indexes.frontRight),this.car.options.controlsSteeringQuad&&(this.car.vehicle.setSteeringValue(this.car.steering,this.car.wheels.indexes.backLeft),this.car.vehicle.setSteeringValue(this.car.steering,this.car.wheels.indexes.backRight));const t=17*(this.controls.actions.boost?this.car.options.controlsAcceleratingSpeedBoost:this.car.options.controlsAcceleratingSpeed),n=this.controls.actions.boost?this.car.options.controlsAcceleratinMaxSpeedBoost:this.car.options.controlsAcceleratinMaxSpeed;this.controls.actions.up?this.car.speed<n||!this.car.goingForward?this.car.accelerating=t:this.car.accelerating=0:this.controls.actions.down?this.car.speed<n||this.car.goingForward?this.car.accelerating=-t:this.car.accelerating=0:this.car.accelerating=0,this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.backLeft),this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.backRight),this.car.options.controlsSteeringQuad&&(this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.frontLeft),this.car.vehicle.applyEngineForce(-this.car.accelerating,this.car.wheels.indexes.frontRight)),this.controls.actions.brake?(this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,0),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,1),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,2),this.car.vehicle.setBrake(this.car.options.controlsBrakeStrength,3)):(this.car.vehicle.setBrake(0,0),this.car.vehicle.setBrake(0,1),this.car.vehicle.setBrake(0,2),this.car.vehicle.setBrake(0,3))}),this.car.create(),this.debug&&(this.car.debugFolder=this.debugFolder.addFolder("car"),this.car.debugFolder.open(),this.car.debugFolder.add(this.car.options,"chassisWidth").step(.001).min(0).max(5).name("chassisWidth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisHeight").step(.001).min(0).max(5).name("chassisHeight").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisDepth").step(.001).min(0).max(5).name("chassisDepth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options.chassisOffset,"z").step(.001).min(0).max(5).name("chassisOffset").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"chassisMass").step(.001).min(0).max(1e3).name("chassisMass").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelFrontOffsetDepth").step(.001).min(0).max(5).name("wheelFrontOffsetDepth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelBackOffsetDepth").step(.001).min(-5).max(0).name("wheelBackOffsetDepth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelOffsetWidth").step(.001).min(0).max(5).name("wheelOffsetWidth").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelRadius").step(.001).min(0).max(2).name("wheelRadius").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelHeight").step(.001).min(0).max(2).name("wheelHeight").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelSuspensionStiffness").step(.001).min(0).max(300).name("wheelSuspensionStiffness").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelSuspensionRestLength").step(.001).min(0).max(5).name("wheelSuspensionRestLength").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelFrictionSlip").step(.001).min(0).max(30).name("wheelFrictionSlip").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelDampingRelaxation").step(.001).min(0).max(30).name("wheelDampingRelaxation").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelDampingCompression").step(.001).min(0).max(30).name("wheelDampingCompression").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMaxSuspensionForce").step(.001).min(0).max(1e6).name("wheelMaxSuspensionForce").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelRollInfluence").step(.001).min(0).max(1).name("wheelRollInfluence").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMaxSuspensionTravel").step(.001).min(0).max(5).name("wheelMaxSuspensionTravel").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelCustomSlidingRotationalSpeed").step(.001).min(-45).max(45).name("wheelCustomSlidingRotationalSpeed").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"wheelMass").step(.001).min(0).max(1e3).name("wheelMass").onFinishChange(this.car.recreate),this.car.debugFolder.add(this.car.options,"controlsSteeringSpeed").step(.001).min(0).max(.1).name("controlsSteeringSpeed"),this.car.debugFolder.add(this.car.options,"controlsSteeringMax").step(.001).min(0).max(Math.PI*.5).name("controlsSteeringMax"),this.car.debugFolder.add(this.car.options,"controlsSteeringQuad").name("controlsSteeringQuad"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingSpeed").step(.001).min(0).max(30).name("controlsAcceleratingSpeed"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingSpeedBoost").step(.001).min(0).max(30).name("controlsAcceleratingSpeedBoost"),this.car.debugFolder.add(this.car.options,"controlsAcceleratingQuad").name("controlsAcceleratingQuad"),this.car.debugFolder.add(this.car.options,"controlsBrakeStrength").step(.001).min(0).max(5).name("controlsBrakeStrength"),this.car.debugFolder.add(this.car,"recreate"),this.car.debugFolder.add(this.car,"jump"))}addObjectFromThree(e){const t={};t.model={},t.model.meshes=[],t.model.container=new et,this.models.container.add(t.model.container),t.children=[];const n=this.materials.items.dummy;if(t.body=new ct.Body({position:new ct.Vec3(e.offset.x,e.offset.y,e.offset.z),mass:e.mass,material:n}),t.body.allowSleep=!0,t.body.sleepSpeedLimit=.01,e.sleep&&t.body.sleep(),this.world.addBody(t.body),e.rotation){const s=new ct.Quaternion;s.setFromEuler(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.order),t.body.quaternion=t.body.quaternion.mult(s)}t.center=new ct.Vec3(0,0,0);const i=[];for(let s=0;s<e.meshes.length;s++){const r=e.meshes[s];let a=null;if(r.name.match(/^cube_?[0-9]{0,3}?|box[0-9]{0,3}?$/i)?a="box":r.name.match(/^cylinder_?[0-9]{0,3}?$/i)?a="cylinder":r.name.match(/^sphere_?[0-9]{0,3}?$/i)?a="sphere":r.name.match(/^center_?[0-9]{0,3}?$/i)&&(a="center"),a==="center")t.center.set(r.position.x,r.position.y,r.position.z);else if(a){let c=null;if(a==="cylinder")c=new ct.Cylinder(r.scale.x,r.scale.x,r.scale.z,8);else if(a==="box"){const f=new ct.Vec3(r.scale.x*.5,r.scale.y*.5,r.scale.z*.5);c=new ct.Box(f)}else a==="sphere"&&(c=new ct.Sphere(r.scale.x));const u=new ct.Vec3(r.position.x,r.position.y,r.position.z),d=new ct.Quaternion(r.quaternion.x,r.quaternion.y,r.quaternion.z,r.quaternion.w);i.push({shapeGeometry:c,shapePosition:u,shapeQuaternion:d});let l=null;a==="cylinder"?(l=new hn(1,1,1,8,1),l.rotateX(Math.PI*.5)):a==="box"?l=new Xt(1,1,1):a==="sphere"&&(l=new xl(1,8,8));const h=new Se(l,this.models.materials[e.mass===0?"static":"dynamic"]);h.position.copy(r.position),h.scale.copy(r.scale),h.quaternion.copy(r.quaternion),t.model.meshes.push(h)}}for(const s of t.model.meshes)s.position.x-=t.center.x,s.position.y-=t.center.y,s.position.z-=t.center.z,t.model.container.add(s);for(const s of i)s.shapePosition.x-=t.center.x,s.shapePosition.y-=t.center.y,s.shapePosition.z-=t.center.z,t.body.addShape(s.shapeGeometry,s.shapePosition,s.shapeQuaternion);return t.body.position.x+=t.center.x,t.body.position.y+=t.center.y,t.body.position.z+=t.center.z,t.origin={},t.origin.position=t.body.position.clone(),t.origin.quaternion=t.body.quaternion.clone(),t.origin.sleep=e.sleep,this.time.on("tick",()=>{if(t.model.container.position.set(t.body.position.x,t.body.position.y,t.body.position.z),t.model.container.quaternion.set(t.body.quaternion.x,t.body.quaternion.y,t.body.quaternion.z,t.body.quaternion.w),this.models.container.visible&&e.mass>0)for(const s of t.model.container.children)s.material=t.body.sleepState===2?this.models.materials.dynamicSleeping:this.models.materials.dynamic}),t.reset=()=>{t.body.position.copy(t.origin.position),t.body.quaternion.copy(t.origin.quaternion),t.origin.sleep&&t.body.sleep()},t}}class MM extends er{constructor(e){super(),this.position=e.position,this.halfExtents=e.halfExtents,this.data=e.data,this.isIn=!1,this.mesh=new Se(new Xt(e.halfExtents.x*2,e.halfExtents.y*2,3,1,1,1),new Mt({color:16711935,wireframe:!0})),this.mesh.position.x=e.position.x,this.mesh.position.y=e.position.y,this.mesh.position.z=1.5}}class SM{constructor(e){this.time=e.time,this.sizes=e.sizes,this.physics=e.physics,this.debug=e.debug,this.container=new et,this.container.visible=!1,this.container.matrixAutoUpdate=!1,this.debug&&(this.debugFolder=this.debug.addFolder("zones"),this.debugFolder.open(),this.debugFolder.add(this.container,"visible").name("visible")),this.setTester(),this.setItems()}setTester(){this.tester={},this.tester.x=0,this.tester.y=0,this.time.on("tick",()=>{this.tester.x=this.physics.car.chassis.body.position.x,this.tester.y=this.physics.car.chassis.body.position.y})}setItems(){this.items=[],this.time.on("tick",()=>{for(const e of this.items){const t=this.tester.x<e.position.x+e.halfExtents.x&&this.tester.x>e.position.x-e.halfExtents.x&&this.tester.y<e.position.y+e.halfExtents.y&&this.tester.y>e.position.y-e.halfExtents.y;t&&!e.isIn?e.trigger("in",[e.data]):!t&&e.isIn&&e.trigger("out",[e.data]),e.isIn=t}})}add(e){const t=new MM(e);return this.container.add(t.mesh),this.items.push(t),t}}function AM(o,e=!1){const t=o[0].index!==null,n=new Set(Object.keys(o[0].attributes)),i=new Set(Object.keys(o[0].morphAttributes)),s={},r={},a=o[0].morphTargetsRelative,c=new Ft;let u=0;for(let d=0;d<o.length;++d){const l=o[d];let h=0;if(t!==(l.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const f in l.attributes){if(!n.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+f+'" attribute exists among all geometries, or in none of them.'),null;s[f]===void 0&&(s[f]=[]),s[f].push(l.attributes[f]),h++}if(h!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(a!==l.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const f in l.morphAttributes){if(!i.has(f))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;r[f]===void 0&&(r[f]=[]),r[f].push(l.morphAttributes[f])}if(e){let f;if(t)f=l.index.count;else if(l.attributes.position!==void 0)f=l.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;c.addGroup(u,f,d),u+=f}}if(t){let d=0;const l=[];for(let h=0;h<o.length;++h){const f=o[h].index;for(let p=0;p<f.count;++p)l.push(f.getX(p)+d);d+=o[h].attributes.position.count}c.setIndex(l)}for(const d in s){const l=uf(s[d]);if(!l)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" attribute."),null;c.setAttribute(d,l)}for(const d in r){const l=r[d][0].length;if(l===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[d]=[];for(let h=0;h<l;++h){const f=[];for(let g=0;g<r[d].length;++g)f.push(r[d][g][h]);const p=uf(f);if(!p)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+d+" morphAttribute."),null;c.morphAttributes[d].push(p)}}return c}function uf(o){let e,t,n,i=-1,s=0;for(let u=0;u<o.length;++u){const d=o[u];if(e===void 0&&(e=d.array.constructor),e!==d.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=d.itemSize),t!==d.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=d.normalized),n!==d.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(i===-1&&(i=d.gpuType),i!==d.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;s+=d.count*t}const r=new e(s),a=new an(r,t,n);let c=0;for(let u=0;u<o.length;++u){const d=o[u];if(d.isInterleavedBufferAttribute){const l=c/t;for(let h=0,f=d.count;h<f;h++)for(let p=0;p<t;p++){const g=d.getComponent(h,p);a.setComponent(h+l,p,g)}}else r.set(d.array,c);c+=d.count*t}return i!==void 0&&(a.gpuType=i),a}function df(o,e){if(e===qg)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),o;if(e===kc||e===Jf){let t=o.getIndex();if(t===null){const r=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);o.setIndex(r),t=o.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const n=t.count-2,i=[];if(e===kc)for(let r=1;r<=n;r++)i.push(t.getX(0)),i.push(t.getX(r)),i.push(t.getX(r+1));else for(let r=0;r<n;r++)r%2===0?(i.push(t.getX(r)),i.push(t.getX(r+1)),i.push(t.getX(r+2))):(i.push(t.getX(r+2)),i.push(t.getX(r+1)),i.push(t.getX(r)));i.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=o.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),o}class EM{constructor(e){this.time=e.time,this.resources=e.resources,this.materials=e.materials,this.physics=e.physics,this.shadows=e.shadows,this.sounds=e.sounds,this.debug=e.debug,this.container=new et,this.container.matrixAutoUpdate=!1,this.items=[],this.floorShadows=[],this.setParsers(),this.setMerge()}setParsers(){this.parsers={},this.parsers.items=[{regex:/^shade([a-z]+)_?[0-9]{0,3}?/i,apply:(e,t)=>{const n=e.name.match(/^shade([a-z]+)_?[0-9]{0,3}?/i),i=`${n[1].substring(0,1).toLowerCase()}${n[1].substring(1)}`;let s=this.materials.shades.items[i];typeof s>"u"&&(s=new Hc);const r=t.duplicated?e.clone():e;if(r.material=s,r.children.length)for(const a of r.children)a instanceof Se&&(a.material=s);return r}},{regex:/^pure([a-z]+)_?[0-9]{0,3}?/i,apply:(e,t)=>{const i=e.name.match(/^pure([a-z]+)_?[0-9]{0,3}?/i)[1].toLowerCase();let s=this.materials.pures.items[i];typeof s>"u"&&(s=new Hc);const r=t.duplicated?e.clone():e;return r.material=s,r}},{regex:/^floor_?[0-9]{0,3}?/i,apply:(e,t)=>{const n=new ln(e.scale.x,e.scale.y,10,10),i=this.materials.items.floorShadow.clone();i.uniforms.tShadow.value=t.floorShadowTexture,i.uniforms.uShadowColor.value=new He(this.materials.items.floorShadow.shadowColor),i.uniforms.uAlpha.value=0;const s=new Se(n,i);return s.matrixAutoUpdate=!1,s.updateMatrix(),this.floorShadows.push(s),s}}],this.parsers.default={},this.parsers.default.apply=e=>{const t=e.clone();return t.material=this.materials.shades.items.white,t}}setMerge(){this.merge={},this.merge.items={},this.merge.container=new et,this.merge.container.matrixAutoUpdate=!1,this.container.add(this.merge.container),this.merge.add=(e,t)=>{let n=this.merge.items[e];n||(n={},n.geometry=new Ft,n.geometriesToMerge=[],n.material=t.material,n.material.side=qn,n.mesh=new Se(n.geometry,n.material),this.merge.container.add(n.mesh),this.merge.items[e]=n);const i=t.geometry;t.updateMatrixWorld(),i.applyMatrix(t.matrixWorld),n.geometriesToMerge.push(i)},this.merge.applyMerge=()=>{for(const e in this.merge.items){const t=this.merge.items[e];t.geometry=AM(t.geometriesToMerge),t.mesh.geometry=t.geometry}},this.merge.update=()=>{for(const e of this.items)if(e.shouldMerge){const t=[...e.container.children];for(const n of t){const i=n.material.name;i!==""&&(this.merge.add(i,n),e.container.remove(n))}e.shouldMerge=!1}this.merge.applyMerge()}}getConvertedMesh(e,t={}){const n=new et,i=new D,s=[...e];for(const r of s)if(r.name.match(/^center_?[0-9]{0,3}?/i)&&i.set(r.position.x,r.position.y,r.position.z),r instanceof Se){let a=this.parsers.items.find(u=>r.name.match(u.regex));typeof a>"u"&&(a=this.parsers.default);const c=a.apply(r,t);n.add(c)}if(i.length()>0){for(const r of n.children)r.position.sub(i);n.position.add(i)}return t.mass&&t.mass===0&&(n.matrixAutoUpdate=!1,n.updateMatrix()),n}add(e){const t={};t.merged=!1,t.shouldMerge=e.mass===0;const n=new D;e.offset&&n.copy(e.offset);const i=new ht;e.rotation&&i.copy(e.rotation);const s=typeof e.sleep>"u"?!0:e.sleep;if(t.container=this.getConvertedMesh(e.base.children,e),t.container.position.copy(n),t.container.rotation.copy(i),this.container.add(t.container),e.mass===0){t.container.matrixAutoUpdate=!1,t.container.updateMatrix();for(const r of t.container.children)r.matrixAutoUpdate=!1,r.updateMatrix()}t.collision=this.physics.addObjectFromThree({meshes:[...e.collision.children],offset:n,rotation:i,mass:e.mass,sleep:s});for(const r of t.container.children)r.position.sub(t.collision.center);return e.soundName&&t.collision.body.addEventListener("collide",r=>{const a=r.contact.getImpactVelocityAlongNormal();this.sounds.play(e.soundName,a)}),e.shadow&&this.shadows.add(t.container,e.shadow),e.mass>0&&this.time.on("tick",()=>{t.container.position.copy(t.collision.body.position),t.container.quaternion.copy(t.collision.body.quaternion)}),this.items.push(t),t}}class TM{constructor(e){this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.physics=e.physics,this.shadows=e.shadows,this.materials=e.materials,this.controls=e.controls,this.sounds=e.sounds,this.renderer=e.renderer,this.camera=e.camera,this.debug=e.debug,this.config=e.config,this.container=new et,this.position=new D,this.debug&&(this.debugFolder=this.debug.addFolder("car")),this.setModels(),this.setMovement(),this.setChassis(),this.setAntena(),this.setBackLights(),this.setWheels(),this.setTransformControls(),this.setShootingBall(),this.setKlaxon()}setModels(){this.models={},this.models.chassis=this.resources.items.carCyberTruckChassis,this.models.antena=this.resources.items.carCyberTruckAntena,this.models.backLightsBrake=this.resources.items.carCyberTruckBackLightsBrake,this.models.backLightsReverse=this.resources.items.carCyberTruckBackLightsReverse,this.models.wheel=this.resources.items.carCyberTruckWheel}setMovement(){this.movement={},this.movement.speed=new D,this.movement.localSpeed=new D,this.movement.acceleration=new D,this.movement.localAcceleration=new D,this.movement.lastScreech=0,this.time.on("tick",()=>{const e=new D;e.copy(this.chassis.object.position).sub(this.chassis.oldPosition),e.multiplyScalar(1/this.time.delta*17),this.movement.acceleration=e.clone().sub(this.movement.speed),this.movement.speed.copy(e),this.movement.localSpeed=this.movement.speed.clone().applyAxisAngle(new D(0,0,1),-this.chassis.object.rotation.z),this.movement.localAcceleration=this.movement.acceleration.clone().applyAxisAngle(new D(0,0,1),-this.chassis.object.rotation.z),this.sounds.engine.speed=this.movement.localSpeed.x,this.sounds.engine.acceleration=this.controls.actions.up?this.controls.actions.boost?1:.5:0,this.movement.localAcceleration.x>.03&&this.time.elapsed-this.movement.lastScreech>5e3&&(this.movement.lastScreech=this.time.elapsed,this.sounds.play("screech"))})}setChassis(){this.chassis={},this.chassis.offset=new D(0,0,-.28),this.chassis.object=this.objects.getConvertedMesh(this.models.chassis.scene.children),this.chassis.object.position.copy(this.physics.car.chassis.body.position),this.chassis.oldPosition=this.chassis.object.position.clone(),this.container.add(this.chassis.object),this.shadows.add(this.chassis.object,{sizeX:3,sizeY:2,offsetZ:.2}),this.time.on("tick",()=>{this.chassis.oldPosition=this.chassis.object.position.clone(),this.transformControls.enabled||(this.chassis.object.position.copy(this.physics.car.chassis.body.position).add(this.chassis.offset),this.chassis.object.quaternion.copy(this.physics.car.chassis.body.quaternion)),this.position.copy(this.chassis.object.position)})}setAntena(){if(this.antena={},this.antena.speedStrength=10,this.antena.damping=.035,this.antena.pullBackStrength=.02,this.antena.object=this.objects.getConvertedMesh(this.models.antena.scene.children),this.chassis.object.add(this.antena.object),this.antena.speed=new Fe,this.antena.absolutePosition=new Fe,this.antena.localPosition=new Fe,this.time.on("tick",()=>{const t=Math.min(Math.max(this.movement.acceleration.x,-1),1),n=Math.min(Math.max(this.movement.acceleration.y,-1),1);this.antena.speed.x-=t*this.antena.speedStrength,this.antena.speed.y-=n*this.antena.speedStrength;const i=this.antena.absolutePosition.clone(),s=i.negate().multiplyScalar(i.length()*this.antena.pullBackStrength);this.antena.speed.add(s),this.antena.speed.x*=1-this.antena.damping,this.antena.speed.y*=1-this.antena.damping,this.antena.absolutePosition.add(this.antena.speed),this.antena.localPosition.copy(this.antena.absolutePosition),this.antena.localPosition.rotateAround(new Fe,-this.chassis.object.rotation.z),this.antena.object.rotation.y=this.antena.localPosition.x*.1,this.antena.object.rotation.x=this.antena.localPosition.y*.1}),this.debug){const e=this.debugFolder.addFolder("antena");e.open(),e.add(this.antena,"speedStrength").step(.001).min(0).max(50),e.add(this.antena,"damping").step(1e-4).min(0).max(.1),e.add(this.antena,"pullBackStrength").step(1e-4).min(0).max(.1)}}setBackLights(){this.backLightsBrake={},this.backLightsBrake.material=this.materials.pures.items.red.clone(),this.backLightsBrake.material.transparent=!0,this.backLightsBrake.material.opacity=.5,this.backLightsBrake.object=this.objects.getConvertedMesh(this.models.backLightsBrake.scene.children);for(const e of this.backLightsBrake.object.children)e.material=this.backLightsBrake.material;this.chassis.object.add(this.backLightsBrake.object),this.backLightsReverse={},this.backLightsReverse.material=this.materials.pures.items.yellow.clone(),this.backLightsReverse.material.transparent=!0,this.backLightsReverse.material.opacity=.5,this.backLightsReverse.object=this.objects.getConvertedMesh(this.models.backLightsReverse.scene.children);for(const e of this.backLightsReverse.object.children)e.material=this.backLightsReverse.material;this.chassis.object.add(this.backLightsReverse.object),this.time.on("tick",()=>{this.backLightsBrake.material.opacity=this.physics.controls.actions.brake?1:.5,this.backLightsReverse.material.opacity=this.physics.controls.actions.down?1:.5})}setWheels(){this.wheels={},this.wheels.object=this.objects.getConvertedMesh(this.models.wheel.scene.children),this.wheels.items=[];for(let e=0;e<4;e++){const t=this.wheels.object.clone();this.wheels.items.push(t),this.container.add(t)}this.time.on("tick",()=>{if(!this.transformControls.enabled)for(const e in this.physics.car.wheels.bodies){const t=this.physics.car.wheels.bodies[e],n=this.wheels.items[e];n.position.copy(t.position),n.quaternion.copy(t.quaternion)}})}setTransformControls(){if(this.transformControls=new Op(this.camera.instance,this.renderer.domElement),this.transformControls.size=.5,this.transformControls.attach(this.chassis.object),this.transformControls.enabled=!1,this.transformControls.visible=this.transformControls.enabled,document.addEventListener("keydown",e=>{this.mode==="transformControls"&&(e.key==="r"?this.transformControls.setMode("rotate"):e.key==="g"&&this.transformControls.setMode("translate"))}),this.transformControls.addEventListener("dragging-changed",e=>{this.camera.orbitControls.enabled=!e.value}),this.container.add(this.transformControls),this.debug){const e=this.debugFolder.addFolder("controls");e.open(),e.add(this.transformControls,"enabled").onChange(()=>{this.transformControls.visible=this.transformControls.enabled})}}setShootingBall(){this.config.cyberTruck&&window.addEventListener("keydown",e=>{if(e.key==="b"){const t=Math.random()*Math.PI*2,n=10,i=this.position.x+Math.cos(t)*n,s=this.position.y+Math.sin(t)*n,r=2+2*Math.random(),a=this.objects.add({base:this.resources.items.bowlingBallBase.scene,collision:this.resources.items.bowlingBallCollision.scene,offset:new D(i,s,r),rotation:new ht(Math.PI*.5,0,0),duplicated:!0,shadow:{sizeX:1.5,sizeY:1.5,offsetZ:-.15,alpha:.35},mass:5,soundName:"bowlingBall",sleep:!1});let u=new ct.Vec3(this.position.x,this.position.y,this.position.z+1).vsub(a.collision.body.position);u.normalize(),u=u.scale(100),a.collision.body.applyImpulse(u,a.collision.body.position)}})}setKlaxon(){this.klaxon={},this.klaxon.lastTime=this.time.elapsed,window.addEventListener("keydown",e=>{if(e.code==="KeyH"&&(this.time.elapsed-this.klaxon.lastTime>400&&(this.physics.car.jump(!1,150),this.klaxon.lastTime=this.time.elapsed),this.sounds.play(Math.random()<.002?"carHorn2":"carHorn1")),e.key==="k"){const t=this.position.x+(Math.random()-.5)*3,n=this.position.y+(Math.random()-.5)*3,i=6+2*Math.random();this.objects.add({base:this.resources.items.hornBase.scene,collision:this.resources.items.hornCollision.scene,offset:new D(t,n,i),rotation:new ht(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),duplicated:!0,shadow:{sizeX:1.5,sizeY:1.5,offsetZ:-.15,alpha:.35},mass:5,soundName:"horn",sleep:!1})}})}}function Vi(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function Up(o,e){o.prototype=Object.create(e.prototype),o.prototype.constructor=o,o.__proto__=e}/*!
 * GSAP 3.12.5
 * https://gsap.com
 *
 * @license Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var Zn={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},qr={duration:.5,overwrite:!1,delay:0},Dh,Rn,jt,ii=1e8,Nt=1/ii,Zc=Math.PI*2,CM=Zc/4,RM=0,zp=Math.sqrt,PM=Math.cos,LM=Math.sin,yn=function(e){return typeof e=="string"},Jt=function(e){return typeof e=="function"},$i=function(e){return typeof e=="number"},Fh=function(e){return typeof e>"u"},Ri=function(e){return typeof e=="object"},On=function(e){return e!==!1},kh=function(){return typeof window<"u"},Ua=function(e){return Jt(e)||yn(e)},Vp=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},Pn=Array.isArray,Qc=/(?:-?\.?\d|\.)+/gi,Hp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,Pr=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,pc=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,Gp=/[+-]=-?[.\d]+/,Wp=/[^,'"\[\]\s]+/gi,IM=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,Yt,xi,Jc,Nh,Qn={},al={},Xp,jp=function(e){return(al=Ks(e,Qn))&&Vn},Oh=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},Ho=function(e,t){return!t&&console.warn(e)},qp=function(e,t){return e&&(Qn[e]=t)&&al&&(al[e]=t)||Qn},Go=function(){return 0},DM={suppressEvents:!0,isStart:!0,kill:!1},Xa={suppressEvents:!0,kill:!1},FM={suppressEvents:!0},Bh={},ms=[],eh={},Yp,jn={},mc={},ff=30,ja=[],Uh="",zh=function(e){var t=e[0],n,i;if(Ri(t)||Jt(t)||(e=[e]),!(n=(t._gsap||{}).harness)){for(i=ja.length;i--&&!ja[i].targetTest(t););n=ja[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new _m(e[i],n)))||e.splice(i,1);return e},Gs=function(e){return e._gsap||zh(si(e))[0]._gsap},$p=function(e,t,n){return(n=e[t])&&Jt(n)?e[t]():Fh(n)&&e.getAttribute&&e.getAttribute(t)||n},Bn=function(e,t){return(e=e.split(",")).forEach(t)||e},nn=function(e){return Math.round(e*1e5)/1e5||0},gn=function(e){return Math.round(e*1e7)/1e7||0},Or=function(e,t){var n=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),n==="+"?e+i:n==="-"?e-i:n==="*"?e*i:e/i},kM=function(e,t){for(var n=t.length,i=0;e.indexOf(t[i])<0&&++i<n;);return i<n},ll=function(){var e=ms.length,t=ms.slice(0),n,i;for(eh={},ms.length=0,n=0;n<e;n++)i=t[n],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},Kp=function(e,t,n,i){ms.length&&!Rn&&ll(),e.render(t,n,Rn&&t<0&&(e._initted||e._startAt)),ms.length&&!Rn&&ll()},Zp=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(Wp).length<2?t:yn(e)?e.trim():e},Qp=function(e){return e},ri=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},NM=function(e){return function(t,n){for(var i in n)i in t||i==="duration"&&e||i==="ease"||(t[i]=n[i])}},Ks=function(e,t){for(var n in t)e[n]=t[n];return e},pf=function o(e,t){for(var n in t)n!=="__proto__"&&n!=="constructor"&&n!=="prototype"&&(e[n]=Ri(t[n])?o(e[n]||(e[n]={}),t[n]):t[n]);return e},cl=function(e,t){var n={},i;for(i in e)i in t||(n[i]=e[i]);return n},Po=function(e){var t=e.parent||Yt,n=e.keyframes?NM(Pn(e.keyframes)):ri;if(On(e.inherit))for(;t;)n(e,t.vars.defaults),t=t.parent||t._dp;return e},OM=function(e,t){for(var n=e.length,i=n===t.length;i&&n--&&e[n]===t[n];);return n<0},Jp=function(e,t,n,i,s){var r=e[i],a;if(s)for(a=t[s];r&&r[s]>a;)r=r._prev;return r?(t._next=r._next,r._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[i]=t,t._prev=r,t.parent=t._dp=e,t},Ml=function(e,t,n,i){n===void 0&&(n="_first"),i===void 0&&(i="_last");var s=t._prev,r=t._next;s?s._next=r:e[n]===t&&(e[n]=r),r?r._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},ws=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},Ws=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},BM=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},th=function(e,t,n,i){return e._startAt&&(Rn?e._startAt.revert(Xa):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},UM=function o(e){return!e||e._ts&&o(e.parent)},mf=function(e){return e._repeat?Yr(e._tTime,e=e.duration()+e._rDelay)*e:0},Yr=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},hl=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},Sl=function(e){return e._end=gn(e._start+(e._tDur/Math.abs(e._ts||e._rts||Nt)||0))},Al=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=gn(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),Sl(e),n._dirty||Ws(n,e)),e},em=function(e,t){var n;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(n=hl(e.rawTime(),t),(!t._dur||ea(0,t.totalDuration(),n)-t._tTime>Nt)&&t.render(n,!0)),Ws(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-Nt}},Mi=function(e,t,n,i){return t.parent&&ws(t),t._start=gn(($i(n)?n:n||e!==Yt?ei(e,n,t):e._time)+t._delay),t._end=gn(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),Jp(e,t,"_first","_last",e._sort?"_start":0),nh(t)||(e._recent=t),i||em(e,t),e._ts<0&&Al(e,e._tTime),e},tm=function(e,t){return(Qn.ScrollTrigger||Oh("scrollTrigger",t))&&Qn.ScrollTrigger.create(t,e)},nm=function(e,t,n,i,s){if(Hh(e,t,s),!e._initted)return 1;if(!n&&e._pt&&!Rn&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&Yp!==Yn.frame)return ms.push(e),e._lazy=[s,i],1},zM=function o(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||o(t))},nh=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},VM=function(e,t,n,i){var s=e.ratio,r=t<0||!t&&(!e._start&&zM(e)&&!(!e._initted&&nh(e))||(e._ts<0||e._dp._ts<0)&&!nh(e))?0:1,a=e._rDelay,c=0,u,d,l;if(a&&e._repeat&&(c=ea(0,e._tDur,t),d=Yr(c,a),e._yoyo&&d&1&&(r=1-r),d!==Yr(e._tTime,a)&&(s=1-r,e.vars.repeatRefresh&&e._initted&&e.invalidate())),r!==s||Rn||i||e._zTime===Nt||!t&&e._zTime){if(!e._initted&&nm(e,t,i,n,c))return;for(l=e._zTime,e._zTime=t||(n?Nt:0),n||(n=t&&!l),e.ratio=r,e._from&&(r=1-r),e._time=0,e._tTime=c,u=e._pt;u;)u.r(r,u.d),u=u._next;t<0&&th(e,t,n,!0),e._onUpdate&&!n&&$n(e,"onUpdate"),c&&e._repeat&&!n&&e.parent&&$n(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===r&&(r&&ws(e,1),!n&&!Rn&&($n(e,r?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},HM=function(e,t,n){var i;if(n>t)for(i=e._first;i&&i._start<=n;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=n;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},$r=function(e,t,n,i){var s=e._repeat,r=gn(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=r/e._dur),e._dur=r,e._tDur=s?s<0?1e10:gn(r*(s+1)+e._rDelay*s):r,a>0&&!i&&Al(e,e._tTime=e._tDur*a),e.parent&&Sl(e),n||Ws(e.parent,e),e},gf=function(e){return e instanceof kn?Ws(e):$r(e,e._dur)},GM={_start:0,endTime:Go,totalDuration:Go},ei=function o(e,t,n){var i=e.labels,s=e._recent||GM,r=e.duration()>=ii?s.endTime(!1):e._dur,a,c,u;return yn(t)&&(isNaN(t)||t in i)?(c=t.charAt(0),u=t.substr(-1)==="%",a=t.indexOf("="),c==="<"||c===">"?(a>=0&&(t=t.replace(/=/,"")),(c==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(u?(a<0?s:n).totalDuration()/100:1)):a<0?(t in i||(i[t]=r),i[t]):(c=parseFloat(t.charAt(a-1)+t.substr(a+1)),u&&n&&(c=c/100*(Pn(n)?n[0]:n).totalDuration()),a>1?o(e,t.substr(0,a-1),n)+c:r+c)):t==null?r:+t},Lo=function(e,t,n){var i=$i(t[1]),s=(i?2:1)+(e<2?0:1),r=t[s],a,c;if(i&&(r.duration=t[1]),r.parent=n,e){for(a=r,c=n;c&&!("immediateRender"in a);)a=c.vars.defaults||{},c=On(c.vars.inherit)&&c.parent;r.immediateRender=On(a.immediateRender),e<2?r.runBackwards=1:r.startAt=t[s-1]}return new on(t[0],r,t[s+1])},As=function(e,t){return e||e===0?t(e):t},ea=function(e,t,n){return n<e?e:n>t?t:n},Cn=function(e,t){return!yn(e)||!(t=IM.exec(e))?"":t[1]},WM=function(e,t,n){return As(n,function(i){return ea(e,t,i)})},ih=[].slice,im=function(e,t){return e&&Ri(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&Ri(e[0]))&&!e.nodeType&&e!==xi},XM=function(e,t,n){return n===void 0&&(n=[]),e.forEach(function(i){var s;return yn(i)&&!t||im(i,1)?(s=n).push.apply(s,si(i)):n.push(i)})||n},si=function(e,t,n){return jt&&!t&&jt.selector?jt.selector(e):yn(e)&&!n&&(Jc||!Kr())?ih.call((t||Nh).querySelectorAll(e),0):Pn(e)?XM(e,n):im(e)?ih.call(e,0):e?[e]:[]},sh=function(e){return e=si(e)[0]||Ho("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return si(t,n.querySelectorAll?n:n===e?Ho("Invalid scope")||Nh.createElement("div"):e)}},sm=function(e){return e.sort(function(){return .5-Math.random()})},rm=function(e){if(Jt(e))return e;var t=Ri(e)?e:{each:e},n=Xs(t.ease),i=t.from||0,s=parseFloat(t.base)||0,r={},a=i>0&&i<1,c=isNaN(i)||a,u=t.axis,d=i,l=i;return yn(i)?d=l={center:.5,edges:.5,end:1}[i]||0:!a&&c&&(d=i[0],l=i[1]),function(h,f,p){var g=(p||t).length,m=r[g],v,_,y,x,M,S,A,T,b;if(!m){if(b=t.grid==="auto"?0:(t.grid||[1,ii])[1],!b){for(A=-ii;A<(A=p[b++].getBoundingClientRect().left)&&b<g;);b<g&&b--}for(m=r[g]=[],v=c?Math.min(b,g)*d-.5:i%b,_=b===ii?0:c?g*l/b-.5:i/b|0,A=0,T=ii,S=0;S<g;S++)y=S%b-v,x=_-(S/b|0),m[S]=M=u?Math.abs(u==="y"?x:y):zp(y*y+x*x),M>A&&(A=M),M<T&&(T=M);i==="random"&&sm(m),m.max=A-T,m.min=T,m.v=g=(parseFloat(t.amount)||parseFloat(t.each)*(b>g?g-1:u?u==="y"?g/b:b:Math.max(b,g/b))||0)*(i==="edges"?-1:1),m.b=g<0?s-g:s,m.u=Cn(t.amount||t.each)||0,n=n&&g<0?mm(n):n}return g=(m[h]-m.min)/m.max||0,gn(m.b+(n?n(g):g)*m.v)+m.u}},rh=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var i=gn(Math.round(parseFloat(n)/e)*e*t);return(i-i%1)/t+($i(n)?0:Cn(n))}},om=function(e,t){var n=Pn(e),i,s;return!n&&Ri(e)&&(i=n=e.radius||ii,e.values?(e=si(e.values),(s=!$i(e[0]))&&(i*=i)):e=rh(e.increment)),As(t,n?Jt(e)?function(r){return s=e(r),Math.abs(s-r)<=i?s:r}:function(r){for(var a=parseFloat(s?r.x:r),c=parseFloat(s?r.y:0),u=ii,d=0,l=e.length,h,f;l--;)s?(h=e[l].x-a,f=e[l].y-c,h=h*h+f*f):h=Math.abs(e[l]-a),h<u&&(u=h,d=l);return d=!i||u<=i?e[d]:r,s||d===r||$i(r)?d:d+Cn(r)}:rh(e))},am=function(e,t,n,i){return As(Pn(e)?!t:n===!0?!!(n=0):!i,function(){return Pn(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+n*.99))/n)*n*i)/i})},jM=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(i){return t.reduce(function(s,r){return r(s)},i)}},qM=function(e,t){return function(n){return e(parseFloat(n))+(t||Cn(n))}},YM=function(e,t,n){return cm(e,t,0,1,n)},lm=function(e,t,n){return As(n,function(i){return e[~~t(i)]})},$M=function o(e,t,n){var i=t-e;return Pn(e)?lm(e,o(0,e.length),t):As(n,function(s){return(i+(s-e)%i)%i+e})},KM=function o(e,t,n){var i=t-e,s=i*2;return Pn(e)?lm(e,o(0,e.length-1),t):As(n,function(r){return r=(s+(r-e)%s)%s||0,e+(r>i?s-r:r)})},Wo=function(e){for(var t=0,n="",i,s,r,a;~(i=e.indexOf("random(",t));)r=e.indexOf(")",i),a=e.charAt(i+7)==="[",s=e.substr(i+7,r-i-7).match(a?Wp:Qc),n+=e.substr(t,i-t)+am(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=r+1;return n+e.substr(t,e.length-t)},cm=function(e,t,n,i,s){var r=t-e,a=i-n;return As(s,function(c){return n+((c-e)/r*a||0)})},ZM=function o(e,t,n,i){var s=isNaN(e+t)?0:function(f){return(1-f)*e+f*t};if(!s){var r=yn(e),a={},c,u,d,l,h;if(n===!0&&(i=1)&&(n=null),r)e={p:e},t={p:t};else if(Pn(e)&&!Pn(t)){for(d=[],l=e.length,h=l-2,u=1;u<l;u++)d.push(o(e[u-1],e[u]));l--,s=function(p){p*=l;var g=Math.min(h,~~p);return d[g](p-g)},n=t}else i||(e=Ks(Pn(e)?[]:{},e));if(!d){for(c in t)Vh.call(a,e,c,"get",t[c]);s=function(p){return Xh(p,a)||(r?e.p:e)}}}return As(n,s)},vf=function(e,t,n){var i=e.labels,s=ii,r,a,c;for(r in i)a=i[r]-t,a<0==!!n&&a&&s>(a=Math.abs(a))&&(c=r,s=a);return c},$n=function(e,t,n){var i=e.vars,s=i[t],r=jt,a=e._ctx,c,u,d;if(s)return c=i[t+"Params"],u=i.callbackScope||e,n&&ms.length&&ll(),a&&(jt=a),d=c?s.apply(u,c):s.call(u),jt=r,d},So=function(e){return ws(e),e.scrollTrigger&&e.scrollTrigger.kill(!!Rn),e.progress()<1&&$n(e,"onInterrupt"),e},Lr,hm=[],um=function(e){if(e)if(e=!e.name&&e.default||e,kh()||e.headless){var t=e.name,n=Jt(e),i=t&&!n&&e.init?function(){this._props=[]}:e,s={init:Go,render:Xh,add:Vh,kill:fS,modifier:dS,rawVars:0},r={targetTest:0,get:0,getSetter:Wh,aliases:{},register:0};if(Kr(),e!==i){if(jn[t])return;ri(i,ri(cl(e,s),r)),Ks(i.prototype,Ks(s,cl(e,r))),jn[i.prop=t]=i,e.targetTest&&(ja.push(i),Bh[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}qp(t,i),e.register&&e.register(Vn,i,Un)}else hm.push(e)},Dt=255,Ao={aqua:[0,Dt,Dt],lime:[0,Dt,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Dt],navy:[0,0,128],white:[Dt,Dt,Dt],olive:[128,128,0],yellow:[Dt,Dt,0],orange:[Dt,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Dt,0,0],pink:[Dt,192,203],cyan:[0,Dt,Dt],transparent:[Dt,Dt,Dt,0]},gc=function(e,t,n){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(n-t)*e*6:e<.5?n:e*3<2?t+(n-t)*(2/3-e)*6:t)*Dt+.5|0},dm=function(e,t,n){var i=e?$i(e)?[e>>16,e>>8&Dt,e&Dt]:0:Ao.black,s,r,a,c,u,d,l,h,f,p;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),Ao[e])i=Ao[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),r=e.charAt(2),a=e.charAt(3),e="#"+s+s+r+r+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&Dt,i&Dt,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&Dt,e&Dt]}else if(e.substr(0,3)==="hsl"){if(i=p=e.match(Qc),!t)c=+i[0]%360/360,u=+i[1]/100,d=+i[2]/100,r=d<=.5?d*(u+1):d+u-d*u,s=d*2-r,i.length>3&&(i[3]*=1),i[0]=gc(c+1/3,s,r),i[1]=gc(c,s,r),i[2]=gc(c-1/3,s,r);else if(~e.indexOf("="))return i=e.match(Hp),n&&i.length<4&&(i[3]=1),i}else i=e.match(Qc)||Ao.transparent;i=i.map(Number)}return t&&!p&&(s=i[0]/Dt,r=i[1]/Dt,a=i[2]/Dt,l=Math.max(s,r,a),h=Math.min(s,r,a),d=(l+h)/2,l===h?c=u=0:(f=l-h,u=d>.5?f/(2-l-h):f/(l+h),c=l===s?(r-a)/f+(r<a?6:0):l===r?(a-s)/f+2:(s-r)/f+4,c*=60),i[0]=~~(c+.5),i[1]=~~(u*100+.5),i[2]=~~(d*100+.5)),n&&i.length<4&&(i[3]=1),i},fm=function(e){var t=[],n=[],i=-1;return e.split(gs).forEach(function(s){var r=s.match(Pr)||[];t.push.apply(t,r),n.push(i+=r.length+1)}),t.c=n,t},_f=function(e,t,n){var i="",s=(e+i).match(gs),r=t?"hsla(":"rgba(",a=0,c,u,d,l;if(!s)return e;if(s=s.map(function(h){return(h=dm(h,t,1))&&r+(t?h[0]+","+h[1]+"%,"+h[2]+"%,"+h[3]:h.join(","))+")"}),n&&(d=fm(e),c=n.c,c.join(i)!==d.c.join(i)))for(u=e.replace(gs,"1").split(Pr),l=u.length-1;a<l;a++)i+=u[a]+(~c.indexOf(a)?s.shift()||r+"0,0,0,0)":(d.length?d:s.length?s:n).shift());if(!u)for(u=e.split(gs),l=u.length-1;a<l;a++)i+=u[a]+s[a];return i+u[l]},gs=function(){var o="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in Ao)o+="|"+e+"\\b";return new RegExp(o+")","gi")}(),QM=/hsl[a]?\(/,pm=function(e){var t=e.join(" "),n;if(gs.lastIndex=0,gs.test(t))return n=QM.test(t),e[1]=_f(e[1],n),e[0]=_f(e[0],n,fm(e[1])),!0},Xo,Yn=function(){var o=Date.now,e=500,t=33,n=o(),i=n,s=1e3/240,r=s,a=[],c,u,d,l,h,f,p=function g(m){var v=o()-i,_=m===!0,y,x,M,S;if((v>e||v<0)&&(n+=v-t),i+=v,M=i-n,y=M-r,(y>0||_)&&(S=++l.frame,h=M-l.time*1e3,l.time=M=M/1e3,r+=y+(y>=s?4:s-y),x=1),_||(c=u(g)),x)for(f=0;f<a.length;f++)a[f](M,h,S,m)};return l={time:0,frame:0,tick:function(){p(!0)},deltaRatio:function(m){return h/(1e3/(m||60))},wake:function(){Xp&&(!Jc&&kh()&&(xi=Jc=window,Nh=xi.document||{},Qn.gsap=Vn,(xi.gsapVersions||(xi.gsapVersions=[])).push(Vn.version),jp(al||xi.GreenSockGlobals||!xi.gsap&&xi||{}),hm.forEach(um)),d=typeof requestAnimationFrame<"u"&&requestAnimationFrame,c&&l.sleep(),u=d||function(m){return setTimeout(m,r-l.time*1e3+1|0)},Xo=1,p(2))},sleep:function(){(d?cancelAnimationFrame:clearTimeout)(c),Xo=0,u=Go},lagSmoothing:function(m,v){e=m||1/0,t=Math.min(v||33,e)},fps:function(m){s=1e3/(m||240),r=l.time*1e3+s},add:function(m,v,_){var y=v?function(x,M,S,A){m(x,M,S,A),l.remove(y)}:m;return l.remove(m),a[_?"unshift":"push"](y),Kr(),y},remove:function(m,v){~(v=a.indexOf(m))&&a.splice(v,1)&&f>=v&&f--},_listeners:a},l}(),Kr=function(){return!Xo&&Yn.wake()},xt={},JM=/^[\d.\-M][\d.\-,\s]/,eS=/["']/g,tS=function(e){for(var t={},n=e.substr(1,e.length-3).split(":"),i=n[0],s=1,r=n.length,a,c,u;s<r;s++)c=n[s],a=s!==r-1?c.lastIndexOf(","):c.length,u=c.substr(0,a),t[i]=isNaN(u)?u.replace(eS,"").trim():+u,i=c.substr(a+1).trim();return t},nS=function(e){var t=e.indexOf("(")+1,n=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<n?e.indexOf(")",n+1):n)},iS=function(e){var t=(e+"").split("("),n=xt[t[0]];return n&&t.length>1&&n.config?n.config.apply(null,~e.indexOf("{")?[tS(t[1])]:nS(e).split(",").map(Zp)):xt._CE&&JM.test(e)?xt._CE("",e):n},mm=function(e){return function(t){return 1-e(1-t)}},gm=function o(e,t){for(var n=e._first,i;n;)n instanceof kn?o(n,t):n.vars.yoyoEase&&(!n._yoyo||!n._repeat)&&n._yoyo!==t&&(n.timeline?o(n.timeline,t):(i=n._ease,n._ease=n._yEase,n._yEase=i,n._yoyo=t)),n=n._next},Xs=function(e,t){return e&&(Jt(e)?e:xt[e]||iS(e))||t},tr=function(e,t,n,i){n===void 0&&(n=function(c){return 1-t(1-c)}),i===void 0&&(i=function(c){return c<.5?t(c*2)/2:1-t((1-c)*2)/2});var s={easeIn:t,easeOut:n,easeInOut:i},r;return Bn(e,function(a){xt[a]=Qn[a]=s,xt[r=a.toLowerCase()]=n;for(var c in s)xt[r+(c==="easeIn"?".in":c==="easeOut"?".out":".inOut")]=xt[a+"."+c]=s[c]}),s},vm=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},vc=function o(e,t,n){var i=t>=1?t:1,s=(n||(e?.3:.45))/(t<1?t:1),r=s/Zc*(Math.asin(1/i)||0),a=function(d){return d===1?1:i*Math.pow(2,-10*d)*LM((d-r)*s)+1},c=e==="out"?a:e==="in"?function(u){return 1-a(1-u)}:vm(a);return s=Zc/s,c.config=function(u,d){return o(e,u,d)},c},_c=function o(e,t){t===void 0&&(t=1.70158);var n=function(r){return r?--r*r*((t+1)*r+t)+1:0},i=e==="out"?n:e==="in"?function(s){return 1-n(1-s)}:vm(n);return i.config=function(s){return o(e,s)},i};Bn("Linear,Quad,Cubic,Quart,Quint,Strong",function(o,e){var t=e<5?e+1:e;tr(o+",Power"+(t-1),e?function(n){return Math.pow(n,t)}:function(n){return n},function(n){return 1-Math.pow(1-n,t)},function(n){return n<.5?Math.pow(n*2,t)/2:1-Math.pow((1-n)*2,t)/2})});xt.Linear.easeNone=xt.none=xt.Linear.easeIn;tr("Elastic",vc("in"),vc("out"),vc());(function(o,e){var t=1/e,n=2*t,i=2.5*t,s=function(a){return a<t?o*a*a:a<n?o*Math.pow(a-1.5/e,2)+.75:a<i?o*(a-=2.25/e)*a+.9375:o*Math.pow(a-2.625/e,2)+.984375};tr("Bounce",function(r){return 1-s(1-r)},s)})(7.5625,2.75);tr("Expo",function(o){return o?Math.pow(2,10*(o-1)):0});tr("Circ",function(o){return-(zp(1-o*o)-1)});tr("Sine",function(o){return o===1?1:-PM(o*CM)+1});tr("Back",_c("in"),_c("out"),_c());xt.SteppedEase=xt.steps=Qn.SteppedEase={config:function(e,t){e===void 0&&(e=1);var n=1/e,i=e+(t?0:1),s=t?1:0,r=1-Nt;return function(a){return((i*ea(0,r,a)|0)+s)*n}}};qr.ease=xt["quad.out"];Bn("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(o){return Uh+=o+","+o+"Params,"});var _m=function(e,t){this.id=RM++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:$p,this.set=t?t.getSetter:Wh},jo=function(){function o(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,$r(this,+t.duration,1,1),this.data=t.data,jt&&(this._ctx=jt,jt.data.push(this)),Xo||Yn.wake()}var e=o.prototype;return e.delay=function(n){return n||n===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+n-this._delay),this._delay=n,this):this._delay},e.duration=function(n){return arguments.length?this.totalDuration(this._repeat>0?n+(n+this._rDelay)*this._repeat:n):this.totalDuration()&&this._dur},e.totalDuration=function(n){return arguments.length?(this._dirty=0,$r(this,this._repeat<0?n:(n-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(n,i){if(Kr(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(Al(this,n),!s._dp||s.parent||em(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&n<this._tDur||this._ts<0&&n>0||!this._tDur&&!n)&&Mi(this._dp,this,this._start-this._delay)}return(this._tTime!==n||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===Nt||!n&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=n),Kp(this,n,i)),this},e.time=function(n,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),n+mf(this))%(this._dur+this._rDelay)||(n?this._dur:0),i):this._time},e.totalProgress=function(n,i){return arguments.length?this.totalTime(this.totalDuration()*n,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(n,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-n:n)+mf(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(n,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(n-1)*s,i):this._repeat?Yr(this._tTime,s)+1:1},e.timeScale=function(n,i){if(!arguments.length)return this._rts===-Nt?0:this._rts;if(this._rts===n)return this;var s=this.parent&&this._ts?hl(this.parent._time,this):this._tTime;return this._rts=+n||0,this._ts=this._ps||n===-Nt?0:this._rts,this.totalTime(ea(-Math.abs(this._delay),this._tDur,s),i!==!1),Sl(this),BM(this)},e.paused=function(n){return arguments.length?(this._ps!==n&&(this._ps=n,n?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Kr(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==Nt&&(this._tTime-=Nt)))),this):this._ps},e.startTime=function(n){if(arguments.length){this._start=n;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&Mi(i,this,n-this._delay),this}return this._start},e.endTime=function(n){return this._start+(On(n)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(n){var i=this.parent||this._dp;return i?n&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?hl(i.rawTime(n),this):this._tTime:this._tTime},e.revert=function(n){n===void 0&&(n=FM);var i=Rn;return Rn=n,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(n),this.totalTime(-.01,n.suppressEvents)),this.data!=="nested"&&n.kill!==!1&&this.kill(),Rn=i,this},e.globalTime=function(n){for(var i=this,s=arguments.length?n:i.rawTime();i;)s=i._start+s/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(n):s},e.repeat=function(n){return arguments.length?(this._repeat=n===1/0?-2:n,gf(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(n){if(arguments.length){var i=this._time;return this._rDelay=n,gf(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(n){return arguments.length?(this._yoyo=n,this):this._yoyo},e.seek=function(n,i){return this.totalTime(ei(this,n),On(i))},e.restart=function(n,i){return this.play().totalTime(n?-this._delay:0,On(i))},e.play=function(n,i){return n!=null&&this.seek(n,i),this.reversed(!1).paused(!1)},e.reverse=function(n,i){return n!=null&&this.seek(n||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(n,i){return n!=null&&this.seek(n,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(n){return arguments.length?(!!n!==this.reversed()&&this.timeScale(-this._rts||(n?-Nt:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-Nt,this},e.isActive=function(){var n=this.parent||this._dp,i=this._start,s;return!!(!n||this._ts&&this._initted&&n.isActive()&&(s=n.rawTime(!0))>=i&&s<this.endTime(!0)-Nt)},e.eventCallback=function(n,i,s){var r=this.vars;return arguments.length>1?(i?(r[n]=i,s&&(r[n+"Params"]=s),n==="onUpdate"&&(this._onUpdate=i)):delete r[n],this):r[n]},e.then=function(n){var i=this;return new Promise(function(s){var r=Jt(n)?n:Qp,a=function(){var u=i.then;i.then=null,Jt(r)&&(r=r(i))&&(r.then||r===i)&&(i.then=u),s(r),i.then=u};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){So(this)},o}();ri(jo.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-Nt,_prom:0,_ps:!1,_rts:1});var kn=function(o){Up(e,o);function e(n,i){var s;return n===void 0&&(n={}),s=o.call(this,n)||this,s.labels={},s.smoothChildTiming=!!n.smoothChildTiming,s.autoRemoveChildren=!!n.autoRemoveChildren,s._sort=On(n.sortChildren),Yt&&Mi(n.parent||Yt,Vi(s),i),n.reversed&&s.reverse(),n.paused&&s.paused(!0),n.scrollTrigger&&tm(Vi(s),n.scrollTrigger),s}var t=e.prototype;return t.to=function(i,s,r){return Lo(0,arguments,this),this},t.from=function(i,s,r){return Lo(1,arguments,this),this},t.fromTo=function(i,s,r,a){return Lo(2,arguments,this),this},t.set=function(i,s,r){return s.duration=0,s.parent=this,Po(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new on(i,s,ei(this,r),1),this},t.call=function(i,s,r){return Mi(this,on.delayedCall(0,i,s),r)},t.staggerTo=function(i,s,r,a,c,u,d){return r.duration=s,r.stagger=r.stagger||a,r.onComplete=u,r.onCompleteParams=d,r.parent=this,new on(i,r,ei(this,c)),this},t.staggerFrom=function(i,s,r,a,c,u,d){return r.runBackwards=1,Po(r).immediateRender=On(r.immediateRender),this.staggerTo(i,s,r,a,c,u,d)},t.staggerFromTo=function(i,s,r,a,c,u,d,l){return a.startAt=r,Po(a).immediateRender=On(a.immediateRender),this.staggerTo(i,s,a,c,u,d,l)},t.render=function(i,s,r){var a=this._time,c=this._dirty?this.totalDuration():this._tDur,u=this._dur,d=i<=0?0:gn(i),l=this._zTime<0!=i<0&&(this._initted||!u),h,f,p,g,m,v,_,y,x,M,S,A;if(this!==Yt&&d>c&&i>=0&&(d=c),d!==this._tTime||r||l){if(a!==this._time&&u&&(d+=this._time-a,i+=this._time-a),h=d,x=this._start,y=this._ts,v=!y,l&&(u||(a=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(S=this._yoyo,m=u+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(m*100+i,s,r);if(h=gn(d%m),d===c?(g=this._repeat,h=u):(g=~~(d/m),g&&g===d/m&&(h=u,g--),h>u&&(h=u)),M=Yr(this._tTime,m),!a&&this._tTime&&M!==g&&this._tTime-M*m-this._dur<=0&&(M=g),S&&g&1&&(h=u-h,A=1),g!==M&&!this._lock){var T=S&&M&1,b=T===(S&&g&1);if(g<M&&(T=!T),a=T?0:d%u?u:d,this._lock=1,this.render(a||(A?0:gn(g*m)),s,!u)._lock=0,this._tTime=d,!s&&this.parent&&$n(this,"onRepeat"),this.vars.repeatRefresh&&!A&&(this.invalidate()._lock=1),a&&a!==this._time||v!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(u=this._dur,c=this._tDur,b&&(this._lock=2,a=T?u:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!A&&this.invalidate()),this._lock=0,!this._ts&&!v)return this;gm(this,A)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(_=HM(this,gn(a),gn(h)),_&&(d-=h-(h=_._start))),this._tTime=d,this._time=h,this._act=!y,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&h&&!s&&!g&&($n(this,"onStart"),this._tTime!==d))return this;if(h>=a&&i>=0)for(f=this._first;f;){if(p=f._next,(f._act||h>=f._start)&&f._ts&&_!==f){if(f.parent!==this)return this.render(i,s,r);if(f.render(f._ts>0?(h-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(h-f._start)*f._ts,s,r),h!==this._time||!this._ts&&!v){_=0,p&&(d+=this._zTime=-Nt);break}}f=p}else{f=this._last;for(var w=i<0?i:h;f;){if(p=f._prev,(f._act||w<=f._end)&&f._ts&&_!==f){if(f.parent!==this)return this.render(i,s,r);if(f.render(f._ts>0?(w-f._start)*f._ts:(f._dirty?f.totalDuration():f._tDur)+(w-f._start)*f._ts,s,r||Rn&&(f._initted||f._startAt)),h!==this._time||!this._ts&&!v){_=0,p&&(d+=this._zTime=w?-Nt:Nt);break}}f=p}}if(_&&!s&&(this.pause(),_.render(h>=a?0:-Nt)._zTime=h>=a?1:-1,this._ts))return this._start=x,Sl(this),this.render(i,s,r);this._onUpdate&&!s&&$n(this,"onUpdate",!0),(d===c&&this._tTime>=this.totalDuration()||!d&&a)&&(x===this._start||Math.abs(y)!==Math.abs(this._ts))&&(this._lock||((i||!u)&&(d===c&&this._ts>0||!d&&this._ts<0)&&ws(this,1),!s&&!(i<0&&!a)&&(d||a||!c)&&($n(this,d===c&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(d<c&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,s){var r=this;if($i(s)||(s=ei(this,s,i)),!(i instanceof jo)){if(Pn(i))return i.forEach(function(a){return r.add(a,s)}),this;if(yn(i))return this.addLabel(i,s);if(Jt(i))i=on.delayedCall(0,i);else return this}return this!==i?Mi(this,i,s):this},t.getChildren=function(i,s,r,a){i===void 0&&(i=!0),s===void 0&&(s=!0),r===void 0&&(r=!0),a===void 0&&(a=-ii);for(var c=[],u=this._first;u;)u._start>=a&&(u instanceof on?s&&c.push(u):(r&&c.push(u),i&&c.push.apply(c,u.getChildren(!0,s,r)))),u=u._next;return c},t.getById=function(i){for(var s=this.getChildren(1,1,1),r=s.length;r--;)if(s[r].vars.id===i)return s[r]},t.remove=function(i){return yn(i)?this.removeLabel(i):Jt(i)?this.killTweensOf(i):(Ml(this,i),i===this._recent&&(this._recent=this._last),Ws(this))},t.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=gn(Yn.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),o.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},t.addLabel=function(i,s){return this.labels[i]=ei(this,s),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,s,r){var a=on.delayedCall(0,s||Go,r);return a.data="isPause",this._hasPause=1,Mi(this,a,ei(this,i))},t.removePause=function(i){var s=this._first;for(i=ei(this,i);s;)s._start===i&&s.data==="isPause"&&ws(s),s=s._next},t.killTweensOf=function(i,s,r){for(var a=this.getTweensOf(i,r),c=a.length;c--;)us!==a[c]&&a[c].kill(i,s);return this},t.getTweensOf=function(i,s){for(var r=[],a=si(i),c=this._first,u=$i(s),d;c;)c instanceof on?kM(c._targets,a)&&(u?(!us||c._initted&&c._ts)&&c.globalTime(0)<=s&&c.globalTime(c.totalDuration())>s:!s||c.isActive())&&r.push(c):(d=c.getTweensOf(a,s)).length&&r.push.apply(r,d),c=c._next;return r},t.tweenTo=function(i,s){s=s||{};var r=this,a=ei(r,i),c=s,u=c.startAt,d=c.onStart,l=c.onStartParams,h=c.immediateRender,f,p=on.to(r,ri({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(u&&"time"in u?u.time:r._time))/r.timeScale())||Nt,onStart:function(){if(r.pause(),!f){var m=s.duration||Math.abs((a-(u&&"time"in u?u.time:r._time))/r.timeScale());p._dur!==m&&$r(p,m,0,1).render(p._time,!0,!0),f=1}d&&d.apply(p,l||[])}},s));return h?p.render(0):p},t.tweenFromTo=function(i,s,r){return this.tweenTo(s,ri({startAt:{time:ei(this,i)}},r))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),vf(this,ei(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),vf(this,ei(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+Nt)},t.shiftChildren=function(i,s,r){r===void 0&&(r=0);for(var a=this._first,c=this.labels,u;a;)a._start>=r&&(a._start+=i,a._end+=i),a=a._next;if(s)for(u in c)c[u]>=r&&(c[u]+=i);return Ws(this)},t.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return o.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var s=this._first,r;s;)r=s._next,this.remove(s),s=r;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),Ws(this)},t.totalDuration=function(i){var s=0,r=this,a=r._last,c=ii,u,d,l;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-i:i));if(r._dirty){for(l=r.parent;a;)u=a._prev,a._dirty&&a.totalDuration(),d=a._start,d>c&&r._sort&&a._ts&&!r._lock?(r._lock=1,Mi(r,a,d-a._delay,1)._lock=0):c=d,d<0&&a._ts&&(s-=d,(!l&&!r._dp||l&&l.smoothChildTiming)&&(r._start+=d/r._ts,r._time-=d,r._tTime-=d),r.shiftChildren(-d,!1,-1/0),c=0),a._end>s&&a._ts&&(s=a._end),a=u;$r(r,r===Yt&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},e.updateRoot=function(i){if(Yt._ts&&(Kp(Yt,hl(i,Yt)),Yp=Yn.frame),Yn.frame>=ff){ff+=Zn.autoSleep||120;var s=Yt._first;if((!s||!s._ts)&&Zn.autoSleep&&Yn._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||Yn.sleep()}}},e}(jo);ri(kn.prototype,{_lock:0,_hasPause:0,_forcing:0});var sS=function(e,t,n,i,s,r,a){var c=new Un(this._pt,e,t,0,1,Sm,null,s),u=0,d=0,l,h,f,p,g,m,v,_;for(c.b=n,c.e=i,n+="",i+="",(v=~i.indexOf("random("))&&(i=Wo(i)),r&&(_=[n,i],r(_,e,t),n=_[0],i=_[1]),h=n.match(pc)||[];l=pc.exec(i);)p=l[0],g=i.substring(u,l.index),f?f=(f+1)%5:g.substr(-5)==="rgba("&&(f=1),p!==h[d++]&&(m=parseFloat(h[d-1])||0,c._pt={_next:c._pt,p:g||d===1?g:",",s:m,c:p.charAt(1)==="="?Or(m,p)-m:parseFloat(p)-m,m:f&&f<4?Math.round:0},u=pc.lastIndex);return c.c=u<i.length?i.substring(u,i.length):"",c.fp=a,(Gp.test(i)||v)&&(c.e=0),this._pt=c,c},Vh=function(e,t,n,i,s,r,a,c,u,d){Jt(i)&&(i=i(s||0,e,r));var l=e[t],h=n!=="get"?n:Jt(l)?u?e[t.indexOf("set")||!Jt(e["get"+t.substr(3)])?t:"get"+t.substr(3)](u):e[t]():l,f=Jt(l)?u?cS:bm:Gh,p;if(yn(i)&&(~i.indexOf("random(")&&(i=Wo(i)),i.charAt(1)==="="&&(p=Or(h,i)+(Cn(h)||0),(p||p===0)&&(i=p))),!d||h!==i||oh)return!isNaN(h*i)&&i!==""?(p=new Un(this._pt,e,t,+h||0,i-(h||0),typeof l=="boolean"?uS:Mm,0,f),u&&(p.fp=u),a&&p.modifier(a,this,e),this._pt=p):(!l&&!(t in e)&&Oh(t,i),sS.call(this,e,t,h,i,f,c||Zn.stringFilter,u))},rS=function(e,t,n,i,s){if(Jt(e)&&(e=Io(e,s,t,n,i)),!Ri(e)||e.style&&e.nodeType||Pn(e)||Vp(e))return yn(e)?Io(e,s,t,n,i):e;var r={},a;for(a in e)r[a]=Io(e[a],s,t,n,i);return r},ym=function(e,t,n,i,s,r){var a,c,u,d;if(jn[e]&&(a=new jn[e]).init(s,a.rawVars?t[e]:rS(t[e],i,s,r,n),n,i,r)!==!1&&(n._pt=c=new Un(n._pt,s,e,0,1,a.render,a,0,a.priority),n!==Lr))for(u=n._ptLookup[n._targets.indexOf(s)],d=a._props.length;d--;)u[a._props[d]]=c;return a},us,oh,Hh=function o(e,t,n){var i=e.vars,s=i.ease,r=i.startAt,a=i.immediateRender,c=i.lazy,u=i.onUpdate,d=i.runBackwards,l=i.yoyoEase,h=i.keyframes,f=i.autoRevert,p=e._dur,g=e._startAt,m=e._targets,v=e.parent,_=v&&v.data==="nested"?v.vars.targets:m,y=e._overwrite==="auto"&&!Dh,x=e.timeline,M,S,A,T,b,w,P,N,I,H,G,J,U;if(x&&(!h||!s)&&(s="none"),e._ease=Xs(s,qr.ease),e._yEase=l?mm(Xs(l===!0?s:l,qr.ease)):0,l&&e._yoyo&&!e._repeat&&(l=e._yEase,e._yEase=e._ease,e._ease=l),e._from=!x&&!!i.runBackwards,!x||h&&!i.stagger){if(N=m[0]?Gs(m[0]).harness:0,J=N&&i[N.prop],M=cl(i,Bh),g&&(g._zTime<0&&g.progress(1),t<0&&d&&a&&!f?g.render(-1,!0):g.revert(d&&p?Xa:DM),g._lazy=0),r){if(ws(e._startAt=on.set(m,ri({data:"isStart",overwrite:!1,parent:v,immediateRender:!0,lazy:!g&&On(c),startAt:null,delay:0,onUpdate:u&&function(){return $n(e,"onUpdate")},stagger:0},r))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Rn||!a&&!f)&&e._startAt.revert(Xa),a&&p&&t<=0&&n<=0){t&&(e._zTime=t);return}}else if(d&&p&&!g){if(t&&(a=!1),A=ri({overwrite:!1,data:"isFromStart",lazy:a&&!g&&On(c),immediateRender:a,stagger:0,parent:v},M),J&&(A[N.prop]=J),ws(e._startAt=on.set(m,A)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(Rn?e._startAt.revert(Xa):e._startAt.render(-1,!0)),e._zTime=t,!a)o(e._startAt,Nt,Nt);else if(!t)return}for(e._pt=e._ptCache=0,c=p&&On(c)||c&&!p,S=0;S<m.length;S++){if(b=m[S],P=b._gsap||zh(m)[S]._gsap,e._ptLookup[S]=H={},eh[P.id]&&ms.length&&ll(),G=_===m?S:_.indexOf(b),N&&(I=new N).init(b,J||M,e,G,_)!==!1&&(e._pt=T=new Un(e._pt,b,I.name,0,1,I.render,I,0,I.priority),I._props.forEach(function(k){H[k]=T}),I.priority&&(w=1)),!N||J)for(A in M)jn[A]&&(I=ym(A,M,e,G,b,_))?I.priority&&(w=1):H[A]=T=Vh.call(e,b,A,"get",M[A],G,_,0,i.stringFilter);e._op&&e._op[S]&&e.kill(b,e._op[S]),y&&e._pt&&(us=e,Yt.killTweensOf(b,H,e.globalTime(t)),U=!e.parent,us=0),e._pt&&c&&(eh[P.id]=1)}w&&Am(e),e._onInit&&e._onInit(e)}e._onUpdate=u,e._initted=(!e._op||e._pt)&&!U,h&&t<=0&&x.render(ii,!0,!0)},oS=function(e,t,n,i,s,r,a,c){var u=(e._pt&&e._ptCache||(e._ptCache={}))[t],d,l,h,f;if(!u)for(u=e._ptCache[t]=[],h=e._ptLookup,f=e._targets.length;f--;){if(d=h[f][t],d&&d.d&&d.d._pt)for(d=d.d._pt;d&&d.p!==t&&d.fp!==t;)d=d._next;if(!d)return oh=1,e.vars[t]="+=0",Hh(e,a),oh=0,c?Ho(t+" not eligible for reset"):1;u.push(d)}for(f=u.length;f--;)l=u[f],d=l._pt||l,d.s=(i||i===0)&&!s?i:d.s+(i||0)+r*d.c,d.c=n-d.s,l.e&&(l.e=nn(n)+Cn(l.e)),l.b&&(l.b=d.s+Cn(l.b))},aS=function(e,t){var n=e[0]?Gs(e[0]).harness:0,i=n&&n.aliases,s,r,a,c;if(!i)return t;s=Ks({},t);for(r in i)if(r in s)for(c=i[r].split(","),a=c.length;a--;)s[c[a]]=s[r];return s},lS=function(e,t,n,i){var s=t.ease||i||"power1.inOut",r,a;if(Pn(t))a=n[e]||(n[e]=[]),t.forEach(function(c,u){return a.push({t:u/(t.length-1)*100,v:c,e:s})});else for(r in t)a=n[r]||(n[r]=[]),r==="ease"||a.push({t:parseFloat(e),v:t[r],e:s})},Io=function(e,t,n,i,s){return Jt(e)?e.call(t,n,i,s):yn(e)&&~e.indexOf("random(")?Wo(e):e},xm=Uh+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",wm={};Bn(xm+",id,stagger,delay,duration,paused,scrollTrigger",function(o){return wm[o]=1});var on=function(o){Up(e,o);function e(n,i,s,r){var a;typeof i=="number"&&(s.duration=i,i=s,s=null),a=o.call(this,r?i:Po(i))||this;var c=a.vars,u=c.duration,d=c.delay,l=c.immediateRender,h=c.stagger,f=c.overwrite,p=c.keyframes,g=c.defaults,m=c.scrollTrigger,v=c.yoyoEase,_=i.parent||Yt,y=(Pn(n)||Vp(n)?$i(n[0]):"length"in i)?[n]:si(n),x,M,S,A,T,b,w,P;if(a._targets=y.length?zh(y):Ho("GSAP target "+n+" not found. https://gsap.com",!Zn.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=f,p||h||Ua(u)||Ua(d)){if(i=a.vars,x=a.timeline=new kn({data:"nested",defaults:g||{},targets:_&&_.data==="nested"?_.vars.targets:y}),x.kill(),x.parent=x._dp=Vi(a),x._start=0,h||Ua(u)||Ua(d)){if(A=y.length,w=h&&rm(h),Ri(h))for(T in h)~xm.indexOf(T)&&(P||(P={}),P[T]=h[T]);for(M=0;M<A;M++)S=cl(i,wm),S.stagger=0,v&&(S.yoyoEase=v),P&&Ks(S,P),b=y[M],S.duration=+Io(u,Vi(a),M,b,y),S.delay=(+Io(d,Vi(a),M,b,y)||0)-a._delay,!h&&A===1&&S.delay&&(a._delay=d=S.delay,a._start+=d,S.delay=0),x.to(b,S,w?w(M,b,y):0),x._ease=xt.none;x.duration()?u=d=0:a.timeline=0}else if(p){Po(ri(x.vars.defaults,{ease:"none"})),x._ease=Xs(p.ease||i.ease||"none");var N=0,I,H,G;if(Pn(p))p.forEach(function(J){return x.to(y,J,">")}),x.duration();else{S={};for(T in p)T==="ease"||T==="easeEach"||lS(T,p[T],S,p.easeEach);for(T in S)for(I=S[T].sort(function(J,U){return J.t-U.t}),N=0,M=0;M<I.length;M++)H=I[M],G={ease:H.e,duration:(H.t-(M?I[M-1].t:0))/100*u},G[T]=H.v,x.to(y,G,N),N+=G.duration;x.duration()<u&&x.to({},{duration:u-x.duration()})}}u||a.duration(u=x.duration())}else a.timeline=0;return f===!0&&!Dh&&(us=Vi(a),Yt.killTweensOf(y),us=0),Mi(_,Vi(a),s),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(l||!u&&!p&&a._start===gn(_._time)&&On(l)&&UM(Vi(a))&&_.data!=="nested")&&(a._tTime=-Nt,a.render(Math.max(0,-d)||0)),m&&tm(Vi(a),m),a}var t=e.prototype;return t.render=function(i,s,r){var a=this._time,c=this._tDur,u=this._dur,d=i<0,l=i>c-Nt&&!d?c:i<Nt?0:i,h,f,p,g,m,v,_,y,x;if(!u)VM(this,i,s,r);else if(l!==this._tTime||!i||r||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==d){if(h=l,y=this.timeline,this._repeat){if(g=u+this._rDelay,this._repeat<-1&&d)return this.totalTime(g*100+i,s,r);if(h=gn(l%g),l===c?(p=this._repeat,h=u):(p=~~(l/g),p&&p===gn(l/g)&&(h=u,p--),h>u&&(h=u)),v=this._yoyo&&p&1,v&&(x=this._yEase,h=u-h),m=Yr(this._tTime,g),h===a&&!r&&this._initted&&p===m)return this._tTime=l,this;p!==m&&(y&&this._yEase&&gm(y,v),this.vars.repeatRefresh&&!v&&!this._lock&&this._time!==g&&this._initted&&(this._lock=r=1,this.render(gn(g*p),!0).invalidate()._lock=0))}if(!this._initted){if(nm(this,d?i:h,r,s,l))return this._tTime=0,this;if(a!==this._time&&!(r&&this.vars.repeatRefresh&&p!==m))return this;if(u!==this._dur)return this.render(i,s,r)}if(this._tTime=l,this._time=h,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=_=(x||this._ease)(h/u),this._from&&(this.ratio=_=1-_),h&&!a&&!s&&!p&&($n(this,"onStart"),this._tTime!==l))return this;for(f=this._pt;f;)f.r(_,f.d),f=f._next;y&&y.render(i<0?i:y._dur*y._ease(h/this._dur),s,r)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(d&&th(this,i,s,r),$n(this,"onUpdate")),this._repeat&&p!==m&&this.vars.onRepeat&&!s&&this.parent&&$n(this,"onRepeat"),(l===this._tDur||!l)&&this._tTime===l&&(d&&!this._onUpdate&&th(this,i,!0,!0),(i||!u)&&(l===this._tDur&&this._ts>0||!l&&this._ts<0)&&ws(this,1),!s&&!(d&&!a)&&(l||a||v)&&($n(this,l===c?"onComplete":"onReverseComplete",!0),this._prom&&!(l<c&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),o.prototype.invalidate.call(this,i)},t.resetTo=function(i,s,r,a,c){Xo||Yn.wake(),this._ts||this.play();var u=Math.min(this._dur,(this._dp._time-this._start)*this._ts),d;return this._initted||Hh(this,u),d=this._ease(u/this._dur),oS(this,i,s,r,a,d,u,c)?this.resetTo(i,s,r,a,1):(Al(this,0),this.parent||Jp(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,s){if(s===void 0&&(s="all"),!i&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?So(this):this;if(this.timeline){var r=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,us&&us.vars.overwrite!==!0)._first||So(this),this.parent&&r!==this.timeline.totalDuration()&&$r(this,this._dur*this.timeline._tDur/r,0,1),this}var a=this._targets,c=i?si(i):a,u=this._ptLookup,d=this._pt,l,h,f,p,g,m,v;if((!s||s==="all")&&OM(a,c))return s==="all"&&(this._pt=0),So(this);for(l=this._op=this._op||[],s!=="all"&&(yn(s)&&(g={},Bn(s,function(_){return g[_]=1}),s=g),s=aS(a,s)),v=a.length;v--;)if(~c.indexOf(a[v])){h=u[v],s==="all"?(l[v]=s,p=h,f={}):(f=l[v]=l[v]||{},p=s);for(g in p)m=h&&h[g],m&&((!("kill"in m.d)||m.d.kill(g)===!0)&&Ml(this,m,"_pt"),delete h[g]),f!=="all"&&(f[g]=1)}return this._initted&&!this._pt&&d&&So(this),this},e.to=function(i,s){return new e(i,s,arguments[2])},e.from=function(i,s){return Lo(1,arguments)},e.delayedCall=function(i,s,r,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:a})},e.fromTo=function(i,s,r){return Lo(2,arguments)},e.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(i,s)},e.killTweensOf=function(i,s,r){return Yt.killTweensOf(i,s,r)},e}(jo);ri(on.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});Bn("staggerTo,staggerFrom,staggerFromTo",function(o){on[o]=function(){var e=new kn,t=ih.call(arguments,0);return t.splice(o==="staggerFromTo"?5:4,0,0),e[o].apply(e,t)}});var Gh=function(e,t,n){return e[t]=n},bm=function(e,t,n){return e[t](n)},cS=function(e,t,n,i){return e[t](i.fp,n)},hS=function(e,t,n){return e.setAttribute(t,n)},Wh=function(e,t){return Jt(e[t])?bm:Fh(e[t])&&e.setAttribute?hS:Gh},Mm=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},uS=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},Sm=function(e,t){var n=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*e):Math.round((n.s+n.c*e)*1e4)/1e4)+i,n=n._next;i+=t.c}t.set(t.t,t.p,i,t)},Xh=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},dS=function(e,t,n,i){for(var s=this._pt,r;s;)r=s._next,s.p===i&&s.modifier(e,t,n),s=r},fS=function(e){for(var t=this._pt,n,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?Ml(this,t,"_pt"):t.dep||(n=1),t=i;return!n},pS=function(e,t,n,i){i.mSet(e,t,i.m.call(i.tween,n,i.mt),i)},Am=function(e){for(var t=e._pt,n,i,s,r;t;){for(n=t._next,i=s;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:r)?t._prev._next=t:s=t,(t._next=i)?i._prev=t:r=t,t=n}e._pt=s},Un=function(){function o(t,n,i,s,r,a,c,u,d){this.t=n,this.s=s,this.c=r,this.p=i,this.r=a||Mm,this.d=c||this,this.set=u||Gh,this.pr=d||0,this._next=t,t&&(t._prev=this)}var e=o.prototype;return e.modifier=function(n,i,s){this.mSet=this.mSet||this.set,this.set=pS,this.m=n,this.mt=s,this.tween=i},o}();Bn(Uh+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(o){return Bh[o]=1});Qn.TweenMax=Qn.TweenLite=on;Qn.TimelineLite=Qn.TimelineMax=kn;Yt=new kn({sortChildren:!1,defaults:qr,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});Zn.stringFilter=pm;var js=[],qa={},mS=[],yf=0,gS=0,yc=function(e){return(qa[e]||mS).map(function(t){return t()})},ah=function(){var e=Date.now(),t=[];e-yf>2&&(yc("matchMediaInit"),js.forEach(function(n){var i=n.queries,s=n.conditions,r,a,c,u;for(a in i)r=xi.matchMedia(i[a]).matches,r&&(c=1),r!==s[a]&&(s[a]=r,u=1);u&&(n.revert(),c&&t.push(n))}),yc("matchMediaRevert"),t.forEach(function(n){return n.onMatch(n,function(i){return n.add(null,i)})}),yf=e,yc("matchMedia"))},Em=function(){function o(t,n){this.selector=n&&sh(n),this.data=[],this._r=[],this.isReverted=!1,this.id=gS++,t&&this.add(t)}var e=o.prototype;return e.add=function(n,i,s){Jt(n)&&(s=i,i=n,n=Jt);var r=this,a=function(){var u=jt,d=r.selector,l;return u&&u!==r&&u.data.push(r),s&&(r.selector=sh(s)),jt=r,l=i.apply(r,arguments),Jt(l)&&r._r.push(l),jt=u,r.selector=d,r.isReverted=!1,l};return r.last=a,n===Jt?a(r,function(c){return r.add(null,c)}):n?r[n]=a:a},e.ignore=function(n){var i=jt;jt=null,n(this),jt=i},e.getTweens=function(){var n=[];return this.data.forEach(function(i){return i instanceof o?n.push.apply(n,i.getTweens()):i instanceof on&&!(i.parent&&i.parent.data==="nested")&&n.push(i)}),n},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(n,i){var s=this;if(n?function(){for(var a=s.getTweens(),c=s.data.length,u;c--;)u=s.data[c],u.data==="isFlip"&&(u.revert(),u.getChildren(!0,!0,!1).forEach(function(d){return a.splice(a.indexOf(d),1)}));for(a.map(function(d){return{g:d._dur||d._delay||d._sat&&!d._sat.vars.immediateRender?d.globalTime(0):-1/0,t:d}}).sort(function(d,l){return l.g-d.g||-1/0}).forEach(function(d){return d.t.revert(n)}),c=s.data.length;c--;)u=s.data[c],u instanceof kn?u.data!=="nested"&&(u.scrollTrigger&&u.scrollTrigger.revert(),u.kill()):!(u instanceof on)&&u.revert&&u.revert(n);s._r.forEach(function(d){return d(n,s)}),s.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var r=js.length;r--;)js[r].id===this.id&&js.splice(r,1)},e.revert=function(n){this.kill(n||{})},o}(),vS=function(){function o(t){this.contexts=[],this.scope=t,jt&&jt.data.push(this)}var e=o.prototype;return e.add=function(n,i,s){Ri(n)||(n={matches:n});var r=new Em(0,s||this.scope),a=r.conditions={},c,u,d;jt&&!r.selector&&(r.selector=jt.selector),this.contexts.push(r),i=r.add("onMatch",i),r.queries=n;for(u in n)u==="all"?d=1:(c=xi.matchMedia(n[u]),c&&(js.indexOf(r)<0&&js.push(r),(a[u]=c.matches)&&(d=1),c.addListener?c.addListener(ah):c.addEventListener("change",ah)));return d&&i(r,function(l){return r.add(null,l)}),this},e.revert=function(n){this.kill(n||{})},e.kill=function(n){this.contexts.forEach(function(i){return i.kill(n,!0)})},o}(),ul={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(function(i){return um(i)})},timeline:function(e){return new kn(e)},getTweensOf:function(e,t){return Yt.getTweensOf(e,t)},getProperty:function(e,t,n,i){yn(e)&&(e=si(e)[0]);var s=Gs(e||{}).get,r=n?Qp:Zp;return n==="native"&&(n=""),e&&(t?r((jn[t]&&jn[t].get||s)(e,t,n,i)):function(a,c,u){return r((jn[a]&&jn[a].get||s)(e,a,c,u))})},quickSetter:function(e,t,n){if(e=si(e),e.length>1){var i=e.map(function(d){return Vn.quickSetter(d,t,n)}),s=i.length;return function(d){for(var l=s;l--;)i[l](d)}}e=e[0]||{};var r=jn[t],a=Gs(e),c=a.harness&&(a.harness.aliases||{})[t]||t,u=r?function(d){var l=new r;Lr._pt=0,l.init(e,n?d+n:d,Lr,0,[e]),l.render(1,l),Lr._pt&&Xh(1,Lr)}:a.set(e,c);return r?u:function(d){return u(e,c,n?d+n:d,a,1)}},quickTo:function(e,t,n){var i,s=Vn.to(e,Ks((i={},i[t]="+=0.1",i.paused=!0,i),n||{})),r=function(c,u,d){return s.resetTo(t,c,u,d)};return r.tween=s,r},isTweening:function(e){return Yt.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Xs(e.ease,qr.ease)),pf(qr,e||{})},config:function(e){return pf(Zn,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,i=e.plugins,s=e.defaults,r=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!jn[a]&&!Qn[a]&&Ho(t+" effect requires "+a+" plugin.")}),mc[t]=function(a,c,u){return n(si(a),ri(c||{},s),u)},r&&(kn.prototype[t]=function(a,c,u){return this.add(mc[t](a,Ri(c)?c:(u=c)&&{},this),u)})},registerEase:function(e,t){xt[e]=Xs(t)},parseEase:function(e,t){return arguments.length?Xs(e,t):xt},getById:function(e){return Yt.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var n=new kn(e),i,s;for(n.smoothChildTiming=On(e.smoothChildTiming),Yt.remove(n),n._dp=0,n._time=n._tTime=Yt._time,i=Yt._first;i;)s=i._next,(t||!(!i._dur&&i instanceof on&&i.vars.onComplete===i._targets[0]))&&Mi(n,i,i._start-i._delay),i=s;return Mi(Yt,n,0),n},context:function(e,t){return e?new Em(e,t):jt},matchMedia:function(e){return new vS(e)},matchMediaRefresh:function(){return js.forEach(function(e){var t=e.conditions,n,i;for(i in t)t[i]&&(t[i]=!1,n=1);n&&e.revert()})||ah()},addEventListener:function(e,t){var n=qa[e]||(qa[e]=[]);~n.indexOf(t)||n.push(t)},removeEventListener:function(e,t){var n=qa[e],i=n&&n.indexOf(t);i>=0&&n.splice(i,1)},utils:{wrap:$M,wrapYoyo:KM,distribute:rm,random:am,snap:om,normalize:YM,getUnit:Cn,clamp:WM,splitColor:dm,toArray:si,selector:sh,mapRange:cm,pipe:jM,unitize:qM,interpolate:ZM,shuffle:sm},install:jp,effects:mc,ticker:Yn,updateRoot:kn.updateRoot,plugins:jn,globalTimeline:Yt,core:{PropTween:Un,globals:qp,Tween:on,Timeline:kn,Animation:jo,getCache:Gs,_removeLinkedListItem:Ml,reverting:function(){return Rn},context:function(e){return e&&jt&&(jt.data.push(e),e._ctx=jt),jt},suppressOverwrites:function(e){return Dh=e}}};Bn("to,from,fromTo,delayedCall,set,killTweensOf",function(o){return ul[o]=on[o]});Yn.add(kn.updateRoot);Lr=ul.to({},{duration:0});var _S=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},yS=function(e,t){var n=e._targets,i,s,r;for(i in t)for(s=n.length;s--;)r=e._ptLookup[s][i],r&&(r=r.d)&&(r._pt&&(r=_S(r,i)),r&&r.modifier&&r.modifier(t[i],e,n[s],i))},xc=function(e,t){return{name:e,rawVars:1,init:function(i,s,r){r._onInit=function(a){var c,u;if(yn(s)&&(c={},Bn(s,function(d){return c[d]=1}),s=c),t){c={};for(u in s)c[u]=t(s[u]);s=c}yS(a,s)}}}},Vn=ul.registerPlugin({name:"attr",init:function(e,t,n,i,s){var r,a,c;this.tween=n;for(r in t)c=e.getAttribute(r)||"",a=this.add(e,"setAttribute",(c||0)+"",t[r],i,s,0,0,r),a.op=r,a.b=c,this._props.push(r)},render:function(e,t){for(var n=t._pt;n;)Rn?n.set(n.t,n.p,n.b,n):n.r(e,n.d),n=n._next}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n],0,0,0,0,0,1)}},xc("roundProps",rh),xc("modifiers"),xc("snap",om))||ul;on.version=kn.version=Vn.version="3.12.5";Xp=1;kh()&&Kr();xt.Power0;xt.Power1;xt.Power2;xt.Power3;xt.Power4;xt.Linear;xt.Quad;xt.Cubic;xt.Quart;xt.Quint;xt.Strong;xt.Elastic;xt.Back;xt.SteppedEase;xt.Bounce;xt.Sine;xt.Expo;xt.Circ;/*!
 * CSSPlugin 3.12.5
 * https://gsap.com
 *
 * Copyright 2008-2024, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license or for
 * Club GSAP members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var xf,ds,Br,jh,Hs,wf,qh,xS=function(){return typeof window<"u"},Ki={},Bs=180/Math.PI,Ur=Math.PI/180,br=Math.atan2,bf=1e8,Yh=/([A-Z])/g,wS=/(left|right|width|margin|padding|x)/i,bS=/[\s,\(]\S/,Ei={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},lh=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},MS=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},SS=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},AS=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},Tm=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},Cm=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},ES=function(e,t,n){return e.style[t]=n},TS=function(e,t,n){return e.style.setProperty(t,n)},CS=function(e,t,n){return e._gsap[t]=n},RS=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},PS=function(e,t,n,i,s){var r=e._gsap;r.scaleX=r.scaleY=n,r.renderTransform(s,r)},LS=function(e,t,n,i,s){var r=e._gsap;r[t]=n,r.renderTransform(s,r)},Kt="transform",zn=Kt+"Origin",IS=function o(e,t){var n=this,i=this.target,s=i.style,r=i._gsap;if(e in Ki&&s){if(this.tfm=this.tfm||{},e!=="transform")e=Ei[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return n.tfm[a]=Hi(i,a)}):this.tfm[e]=r.x?r[e]:Hi(i,e),e===zn&&(this.tfm.zOrigin=r.zOrigin);else return Ei.transform.split(",").forEach(function(a){return o.call(n,a,t)});if(this.props.indexOf(Kt)>=0)return;r.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(zn,t,"")),e=Kt}(s||t)&&this.props.push(e,t,s[e])},Rm=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},DS=function(){var e=this.props,t=this.target,n=t.style,i=t._gsap,s,r;for(s=0;s<e.length;s+=3)e[s+1]?t[e[s]]=e[s+2]:e[s+2]?n[e[s]]=e[s+2]:n.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(Yh,"-$1").toLowerCase());if(this.tfm){for(r in this.tfm)i[r]=this.tfm[r];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=qh(),(!s||!s.isStart)&&!n[Kt]&&(Rm(n),i.zOrigin&&n[zn]&&(n[zn]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},Pm=function(e,t){var n={target:e,props:[],revert:DS,save:IS};return e._gsap||Vn.core.getCache(e),t&&t.split(",").forEach(function(i){return n.save(i)}),n},Lm,ch=function(e,t){var n=ds.createElementNS?ds.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):ds.createElement(e);return n&&n.style?n:ds.createElement(e)},Ti=function o(e,t,n){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(Yh,"-$1").toLowerCase())||i.getPropertyValue(t)||!n&&o(e,Zr(t)||t,1)||""},Mf="O,Moz,ms,Ms,Webkit".split(","),Zr=function(e,t,n){var i=t||Hs,s=i.style,r=5;if(e in s&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(Mf[r]+e in s););return r<0?null:(r===3?"ms":r>=0?Mf[r]:"")+e},hh=function(){xS()&&window.document&&(xf=window,ds=xf.document,Br=ds.documentElement,Hs=ch("div")||{style:{}},ch("div"),Kt=Zr(Kt),zn=Kt+"Origin",Hs.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Lm=!!Zr("perspective"),qh=Vn.core.reverting,jh=1)},wc=function o(e){var t=ch("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),n=this.parentNode,i=this.nextSibling,s=this.style.cssText,r;if(Br.appendChild(t),t.appendChild(this),this.style.display="block",e)try{r=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=o}catch{}else this._gsapBBox&&(r=this._gsapBBox());return n&&(i?n.insertBefore(this,i):n.appendChild(this)),Br.removeChild(t),this.style.cssText=s,r},Sf=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Im=function(e){var t;try{t=e.getBBox()}catch{t=wc.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===wc||(t=wc.call(e,!0)),t&&!t.width&&!t.x&&!t.y?{x:+Sf(e,["x","cx","x1"])||0,y:+Sf(e,["y","cy","y1"])||0,width:0,height:0}:t},Dm=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&Im(e))},Zs=function(e,t){if(t){var n=e.style,i;t in Ki&&t!==zn&&(t=Kt),n.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),n.removeProperty(i==="--"?t:t.replace(Yh,"-$1").toLowerCase())):n.removeAttribute(t)}},fs=function(e,t,n,i,s,r){var a=new Un(e._pt,t,n,0,1,r?Cm:Tm);return e._pt=a,a.b=i,a.e=s,e._props.push(n),a},Af={deg:1,rad:1,turn:1},FS={grid:1,flex:1},bs=function o(e,t,n,i){var s=parseFloat(n)||0,r=(n+"").trim().substr((s+"").length)||"px",a=Hs.style,c=wS.test(t),u=e.tagName.toLowerCase()==="svg",d=(u?"client":"offset")+(c?"Width":"Height"),l=100,h=i==="px",f=i==="%",p,g,m,v;if(i===r||!s||Af[i]||Af[r])return s;if(r!=="px"&&!h&&(s=o(e,t,n,"px")),v=e.getCTM&&Dm(e),(f||r==="%")&&(Ki[t]||~t.indexOf("adius")))return p=v?e.getBBox()[c?"width":"height"]:e[d],nn(f?s/p*l:s/100*p);if(a[c?"width":"height"]=l+(h?r:i),g=~t.indexOf("adius")||i==="em"&&e.appendChild&&!u?e:e.parentNode,v&&(g=(e.ownerSVGElement||{}).parentNode),(!g||g===ds||!g.appendChild)&&(g=ds.body),m=g._gsap,m&&f&&m.width&&c&&m.time===Yn.time&&!m.uncache)return nn(s/m.width*l);if(f&&(t==="height"||t==="width")){var _=e.style[t];e.style[t]=l+i,p=e[d],_?e.style[t]=_:Zs(e,t)}else(f||r==="%")&&!FS[Ti(g,"display")]&&(a.position=Ti(e,"position")),g===e&&(a.position="static"),g.appendChild(Hs),p=Hs[d],g.removeChild(Hs),a.position="absolute";return c&&f&&(m=Gs(g),m.time=Yn.time,m.width=g[d]),nn(h?p*s/l:p&&s?l/p*s:0)},Hi=function(e,t,n,i){var s;return jh||hh(),t in Ei&&t!=="transform"&&(t=Ei[t],~t.indexOf(",")&&(t=t.split(",")[0])),Ki[t]&&t!=="transform"?(s=Yo(e,i),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:fl(Ti(e,zn))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||i||~(s+"").indexOf("calc("))&&(s=dl[t]&&dl[t](e,t,n)||Ti(e,t)||$p(e,t)||(t==="opacity"?1:0))),n&&!~(s+"").trim().indexOf(" ")?bs(e,t,s,n)+n:s},kS=function(e,t,n,i){if(!n||n==="none"){var s=Zr(t,e,1),r=s&&Ti(e,s,1);r&&r!==n?(t=s,n=r):t==="borderColor"&&(n=Ti(e,"borderTopColor"))}var a=new Un(this._pt,e.style,t,0,1,Sm),c=0,u=0,d,l,h,f,p,g,m,v,_,y,x,M;if(a.b=n,a.e=i,n+="",i+="",i==="auto"&&(g=e.style[t],e.style[t]=i,i=Ti(e,t)||i,g?e.style[t]=g:Zs(e,t)),d=[n,i],pm(d),n=d[0],i=d[1],h=n.match(Pr)||[],M=i.match(Pr)||[],M.length){for(;l=Pr.exec(i);)m=l[0],_=i.substring(c,l.index),p?p=(p+1)%5:(_.substr(-5)==="rgba("||_.substr(-5)==="hsla(")&&(p=1),m!==(g=h[u++]||"")&&(f=parseFloat(g)||0,x=g.substr((f+"").length),m.charAt(1)==="="&&(m=Or(f,m)+x),v=parseFloat(m),y=m.substr((v+"").length),c=Pr.lastIndex-y.length,y||(y=y||Zn.units[t]||x,c===i.length&&(i+=y,a.e+=y)),x!==y&&(f=bs(e,t,g,y)||0),a._pt={_next:a._pt,p:_||u===1?_:",",s:f,c:v-f,m:p&&p<4||t==="zIndex"?Math.round:0});a.c=c<i.length?i.substring(c,i.length):""}else a.r=t==="display"&&i==="none"?Cm:Tm;return Gp.test(i)&&(a.e=0),this._pt=a,a},Ef={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},NS=function(e){var t=e.split(" "),n=t[0],i=t[1]||"50%";return(n==="top"||n==="bottom"||i==="left"||i==="right")&&(e=n,n=i,i=e),t[0]=Ef[n]||n,t[1]=Ef[i]||i,t.join(" ")},OS=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n=t.t,i=n.style,s=t.u,r=n._gsap,a,c,u;if(s==="all"||s===!0)i.cssText="",c=1;else for(s=s.split(","),u=s.length;--u>-1;)a=s[u],Ki[a]&&(c=1,a=a==="transformOrigin"?zn:Kt),Zs(n,a);c&&(Zs(n,Kt),r&&(r.svg&&n.removeAttribute("transform"),Yo(n,1),r.uncache=1,Rm(i)))}},dl={clearProps:function(e,t,n,i,s){if(s.data!=="isFromStart"){var r=e._pt=new Un(e._pt,t,n,0,0,OS);return r.u=i,r.pr=-10,r.tween=s,e._props.push(n),1}}},qo=[1,0,0,1,0,0],Fm={},km=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},Tf=function(e){var t=Ti(e,Kt);return km(t)?qo:t.substr(7).match(Hp).map(nn)},$h=function(e,t){var n=e._gsap||Gs(e),i=e.style,s=Tf(e),r,a,c,u;return n.svg&&e.getAttribute("transform")?(c=e.transform.baseVal.consolidate().matrix,s=[c.a,c.b,c.c,c.d,c.e,c.f],s.join(",")==="1,0,0,1,0,0"?qo:s):(s===qo&&!e.offsetParent&&e!==Br&&!n.svg&&(c=i.display,i.display="block",r=e.parentNode,(!r||!e.offsetParent)&&(u=1,a=e.nextElementSibling,Br.appendChild(e)),s=Tf(e),c?i.display=c:Zs(e,"display"),u&&(a?r.insertBefore(e,a):r?r.appendChild(e):Br.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},uh=function(e,t,n,i,s,r){var a=e._gsap,c=s||$h(e,!0),u=a.xOrigin||0,d=a.yOrigin||0,l=a.xOffset||0,h=a.yOffset||0,f=c[0],p=c[1],g=c[2],m=c[3],v=c[4],_=c[5],y=t.split(" "),x=parseFloat(y[0])||0,M=parseFloat(y[1])||0,S,A,T,b;n?c!==qo&&(A=f*m-p*g)&&(T=x*(m/A)+M*(-g/A)+(g*_-m*v)/A,b=x*(-p/A)+M*(f/A)-(f*_-p*v)/A,x=T,M=b):(S=Im(e),x=S.x+(~y[0].indexOf("%")?x/100*S.width:x),M=S.y+(~(y[1]||y[0]).indexOf("%")?M/100*S.height:M)),i||i!==!1&&a.smooth?(v=x-u,_=M-d,a.xOffset=l+(v*f+_*g)-v,a.yOffset=h+(v*p+_*m)-_):a.xOffset=a.yOffset=0,a.xOrigin=x,a.yOrigin=M,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!n,e.style[zn]="0px 0px",r&&(fs(r,a,"xOrigin",u,x),fs(r,a,"yOrigin",d,M),fs(r,a,"xOffset",l,a.xOffset),fs(r,a,"yOffset",h,a.yOffset)),e.setAttribute("data-svg-origin",x+" "+M)},Yo=function(e,t){var n=e._gsap||new _m(e);if("x"in n&&!t&&!n.uncache)return n;var i=e.style,s=n.scaleX<0,r="px",a="deg",c=getComputedStyle(e),u=Ti(e,zn)||"0",d,l,h,f,p,g,m,v,_,y,x,M,S,A,T,b,w,P,N,I,H,G,J,U,k,q,Y,V,Z,W,L,F;return d=l=h=g=m=v=_=y=x=0,f=p=1,n.svg=!!(e.getCTM&&Dm(e)),c.translate&&((c.translate!=="none"||c.scale!=="none"||c.rotate!=="none")&&(i[Kt]=(c.translate!=="none"?"translate3d("+(c.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(c.rotate!=="none"?"rotate("+c.rotate+") ":"")+(c.scale!=="none"?"scale("+c.scale.split(" ").join(",")+") ":"")+(c[Kt]!=="none"?c[Kt]:"")),i.scale=i.rotate=i.translate="none"),A=$h(e,n.svg),n.svg&&(n.uncache?(k=e.getBBox(),u=n.xOrigin-k.x+"px "+(n.yOrigin-k.y)+"px",U=""):U=!t&&e.getAttribute("data-svg-origin"),uh(e,U||u,!!U||n.originIsAbsolute,n.smooth!==!1,A)),M=n.xOrigin||0,S=n.yOrigin||0,A!==qo&&(P=A[0],N=A[1],I=A[2],H=A[3],d=G=A[4],l=J=A[5],A.length===6?(f=Math.sqrt(P*P+N*N),p=Math.sqrt(H*H+I*I),g=P||N?br(N,P)*Bs:0,_=I||H?br(I,H)*Bs+g:0,_&&(p*=Math.abs(Math.cos(_*Ur))),n.svg&&(d-=M-(M*P+S*I),l-=S-(M*N+S*H))):(F=A[6],W=A[7],Y=A[8],V=A[9],Z=A[10],L=A[11],d=A[12],l=A[13],h=A[14],T=br(F,Z),m=T*Bs,T&&(b=Math.cos(-T),w=Math.sin(-T),U=G*b+Y*w,k=J*b+V*w,q=F*b+Z*w,Y=G*-w+Y*b,V=J*-w+V*b,Z=F*-w+Z*b,L=W*-w+L*b,G=U,J=k,F=q),T=br(-I,Z),v=T*Bs,T&&(b=Math.cos(-T),w=Math.sin(-T),U=P*b-Y*w,k=N*b-V*w,q=I*b-Z*w,L=H*w+L*b,P=U,N=k,I=q),T=br(N,P),g=T*Bs,T&&(b=Math.cos(T),w=Math.sin(T),U=P*b+N*w,k=G*b+J*w,N=N*b-P*w,J=J*b-G*w,P=U,G=k),m&&Math.abs(m)+Math.abs(g)>359.9&&(m=g=0,v=180-v),f=nn(Math.sqrt(P*P+N*N+I*I)),p=nn(Math.sqrt(J*J+F*F)),T=br(G,J),_=Math.abs(T)>2e-4?T*Bs:0,x=L?1/(L<0?-L:L):0),n.svg&&(U=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!km(Ti(e,Kt)),U&&e.setAttribute("transform",U))),Math.abs(_)>90&&Math.abs(_)<270&&(s?(f*=-1,_+=g<=0?180:-180,g+=g<=0?180:-180):(p*=-1,_+=_<=0?180:-180)),t=t||n.uncache,n.x=d-((n.xPercent=d&&(!t&&n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+r,n.y=l-((n.yPercent=l&&(!t&&n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-l)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+r,n.z=h+r,n.scaleX=nn(f),n.scaleY=nn(p),n.rotation=nn(g)+a,n.rotationX=nn(m)+a,n.rotationY=nn(v)+a,n.skewX=_+a,n.skewY=y+a,n.transformPerspective=x+r,(n.zOrigin=parseFloat(u.split(" ")[2])||!t&&n.zOrigin||0)&&(i[zn]=fl(u)),n.xOffset=n.yOffset=0,n.force3D=Zn.force3D,n.renderTransform=n.svg?US:Lm?Nm:BS,n.uncache=0,n},fl=function(e){return(e=e.split(" "))[0]+" "+e[1]},bc=function(e,t,n){var i=Cn(t);return nn(parseFloat(t)+parseFloat(bs(e,"x",n+"px",i)))+i},BS=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Nm(e,t)},Ds="0deg",vo="0px",Fs=") ",Nm=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,r=n.x,a=n.y,c=n.z,u=n.rotation,d=n.rotationY,l=n.rotationX,h=n.skewX,f=n.skewY,p=n.scaleX,g=n.scaleY,m=n.transformPerspective,v=n.force3D,_=n.target,y=n.zOrigin,x="",M=v==="auto"&&e&&e!==1||v===!0;if(y&&(l!==Ds||d!==Ds)){var S=parseFloat(d)*Ur,A=Math.sin(S),T=Math.cos(S),b;S=parseFloat(l)*Ur,b=Math.cos(S),r=bc(_,r,A*b*-y),a=bc(_,a,-Math.sin(S)*-y),c=bc(_,c,T*b*-y+y)}m!==vo&&(x+="perspective("+m+Fs),(i||s)&&(x+="translate("+i+"%, "+s+"%) "),(M||r!==vo||a!==vo||c!==vo)&&(x+=c!==vo||M?"translate3d("+r+", "+a+", "+c+") ":"translate("+r+", "+a+Fs),u!==Ds&&(x+="rotate("+u+Fs),d!==Ds&&(x+="rotateY("+d+Fs),l!==Ds&&(x+="rotateX("+l+Fs),(h!==Ds||f!==Ds)&&(x+="skew("+h+", "+f+Fs),(p!==1||g!==1)&&(x+="scale("+p+", "+g+Fs),_.style[Kt]=x||"translate(0, 0)"},US=function(e,t){var n=t||this,i=n.xPercent,s=n.yPercent,r=n.x,a=n.y,c=n.rotation,u=n.skewX,d=n.skewY,l=n.scaleX,h=n.scaleY,f=n.target,p=n.xOrigin,g=n.yOrigin,m=n.xOffset,v=n.yOffset,_=n.forceCSS,y=parseFloat(r),x=parseFloat(a),M,S,A,T,b;c=parseFloat(c),u=parseFloat(u),d=parseFloat(d),d&&(d=parseFloat(d),u+=d,c+=d),c||u?(c*=Ur,u*=Ur,M=Math.cos(c)*l,S=Math.sin(c)*l,A=Math.sin(c-u)*-h,T=Math.cos(c-u)*h,u&&(d*=Ur,b=Math.tan(u-d),b=Math.sqrt(1+b*b),A*=b,T*=b,d&&(b=Math.tan(d),b=Math.sqrt(1+b*b),M*=b,S*=b)),M=nn(M),S=nn(S),A=nn(A),T=nn(T)):(M=l,T=h,S=A=0),(y&&!~(r+"").indexOf("px")||x&&!~(a+"").indexOf("px"))&&(y=bs(f,"x",r,"px"),x=bs(f,"y",a,"px")),(p||g||m||v)&&(y=nn(y+p-(p*M+g*A)+m),x=nn(x+g-(p*S+g*T)+v)),(i||s)&&(b=f.getBBox(),y=nn(y+i/100*b.width),x=nn(x+s/100*b.height)),b="matrix("+M+","+S+","+A+","+T+","+y+","+x+")",f.setAttribute("transform",b),_&&(f.style[Kt]=b)},zS=function(e,t,n,i,s){var r=360,a=yn(s),c=parseFloat(s)*(a&&~s.indexOf("rad")?Bs:1),u=c-i,d=i+u+"deg",l,h;return a&&(l=s.split("_")[1],l==="short"&&(u%=r,u!==u%(r/2)&&(u+=u<0?r:-r)),l==="cw"&&u<0?u=(u+r*bf)%r-~~(u/r)*r:l==="ccw"&&u>0&&(u=(u-r*bf)%r-~~(u/r)*r)),e._pt=h=new Un(e._pt,t,n,i,u,MS),h.e=d,h.u="deg",e._props.push(n),h},Cf=function(e,t){for(var n in t)e[n]=t[n];return e},VS=function(e,t,n){var i=Cf({},n._gsap),s="perspective,force3D,transformOrigin,svgOrigin",r=n.style,a,c,u,d,l,h,f,p;i.svg?(u=n.getAttribute("transform"),n.setAttribute("transform",""),r[Kt]=t,a=Yo(n,1),Zs(n,Kt),n.setAttribute("transform",u)):(u=getComputedStyle(n)[Kt],r[Kt]=t,a=Yo(n,1),r[Kt]=u);for(c in Ki)u=i[c],d=a[c],u!==d&&s.indexOf(c)<0&&(f=Cn(u),p=Cn(d),l=f!==p?bs(n,c,u,p):parseFloat(u),h=parseFloat(d),e._pt=new Un(e._pt,a,c,l,h-l,lh),e._pt.u=p||0,e._props.push(c));Cf(a,i)};Bn("padding,margin,Width,Radius",function(o,e){var t="Top",n="Right",i="Bottom",s="Left",r=(e<3?[t,n,i,s]:[t+s,t+n,i+n,i+s]).map(function(a){return e<2?o+a:"border"+a+o});dl[e>1?"border"+o:o]=function(a,c,u,d,l){var h,f;if(arguments.length<4)return h=r.map(function(p){return Hi(a,p,u)}),f=h.join(" "),f.split(h[0]).length===5?h[0]:f;h=(d+"").split(" "),f={},r.forEach(function(p,g){return f[p]=h[g]=h[g]||h[(g-1)/2|0]}),a.init(c,f,l)}});var Om={name:"css",register:hh,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,i,s){var r=this._props,a=e.style,c=n.vars.startAt,u,d,l,h,f,p,g,m,v,_,y,x,M,S,A,T;jh||hh(),this.styles=this.styles||Pm(e),T=this.styles.props,this.tween=n;for(g in t)if(g!=="autoRound"&&(d=t[g],!(jn[g]&&ym(g,t,n,i,e,s)))){if(f=typeof d,p=dl[g],f==="function"&&(d=d.call(n,i,e,s),f=typeof d),f==="string"&&~d.indexOf("random(")&&(d=Wo(d)),p)p(this,e,g,d,n)&&(A=1);else if(g.substr(0,2)==="--")u=(getComputedStyle(e).getPropertyValue(g)+"").trim(),d+="",gs.lastIndex=0,gs.test(u)||(m=Cn(u),v=Cn(d)),v?m!==v&&(u=bs(e,g,u,v)+v):m&&(d+=m),this.add(a,"setProperty",u,d,i,s,0,0,g),r.push(g),T.push(g,0,a[g]);else if(f!=="undefined"){if(c&&g in c?(u=typeof c[g]=="function"?c[g].call(n,i,e,s):c[g],yn(u)&&~u.indexOf("random(")&&(u=Wo(u)),Cn(u+"")||u==="auto"||(u+=Zn.units[g]||Cn(Hi(e,g))||""),(u+"").charAt(1)==="="&&(u=Hi(e,g))):u=Hi(e,g),h=parseFloat(u),_=f==="string"&&d.charAt(1)==="="&&d.substr(0,2),_&&(d=d.substr(2)),l=parseFloat(d),g in Ei&&(g==="autoAlpha"&&(h===1&&Hi(e,"visibility")==="hidden"&&l&&(h=0),T.push("visibility",0,a.visibility),fs(this,a,"visibility",h?"inherit":"hidden",l?"inherit":"hidden",!l)),g!=="scale"&&g!=="transform"&&(g=Ei[g],~g.indexOf(",")&&(g=g.split(",")[0]))),y=g in Ki,y){if(this.styles.save(g),x||(M=e._gsap,M.renderTransform&&!t.parseTransform||Yo(e,t.parseTransform),S=t.smoothOrigin!==!1&&M.smooth,x=this._pt=new Un(this._pt,a,Kt,0,1,M.renderTransform,M,0,-1),x.dep=1),g==="scale")this._pt=new Un(this._pt,M,"scaleY",M.scaleY,(_?Or(M.scaleY,_+l):l)-M.scaleY||0,lh),this._pt.u=0,r.push("scaleY",g),g+="X";else if(g==="transformOrigin"){T.push(zn,0,a[zn]),d=NS(d),M.svg?uh(e,d,0,S,0,this):(v=parseFloat(d.split(" ")[2])||0,v!==M.zOrigin&&fs(this,M,"zOrigin",M.zOrigin,v),fs(this,a,g,fl(u),fl(d)));continue}else if(g==="svgOrigin"){uh(e,d,1,S,0,this);continue}else if(g in Fm){zS(this,M,g,h,_?Or(h,_+d):d);continue}else if(g==="smoothOrigin"){fs(this,M,"smooth",M.smooth,d);continue}else if(g==="force3D"){M[g]=d;continue}else if(g==="transform"){VS(this,d,e);continue}}else g in a||(g=Zr(g)||g);if(y||(l||l===0)&&(h||h===0)&&!bS.test(d)&&g in a)m=(u+"").substr((h+"").length),l||(l=0),v=Cn(d)||(g in Zn.units?Zn.units[g]:m),m!==v&&(h=bs(e,g,u,v)),this._pt=new Un(this._pt,y?M:a,g,h,(_?Or(h,_+l):l)-h,!y&&(v==="px"||g==="zIndex")&&t.autoRound!==!1?AS:lh),this._pt.u=v||0,m!==v&&v!=="%"&&(this._pt.b=u,this._pt.r=SS);else if(g in a)kS.call(this,e,g,u,_?_+d:d);else if(g in e)this.add(e,g,u||e[g],_?_+d:d,i,s);else if(g!=="parseTransform"){Oh(g,d);continue}y||(g in a?T.push(g,0,a[g]):T.push(g,1,u||e[g])),r.push(g)}}A&&Am(this)},render:function(e,t){if(t.tween._time||!qh())for(var n=t._pt;n;)n.r(e,n.d),n=n._next;else t.styles.revert()},get:Hi,aliases:Ei,getSetter:function(e,t,n){var i=Ei[t];return i&&i.indexOf(",")<0&&(t=i),t in Ki&&t!==zn&&(e._gsap.x||Hi(e,"x"))?n&&wf===n?t==="scale"?RS:CS:(wf=n||{})&&(t==="scale"?PS:LS):e.style&&!Fh(e.style[t])?ES:~t.indexOf("-")?TS:Wh(e,t)},core:{_removeProperty:Zs,_getMatrix:$h}};Vn.utils.checkPrefix=Zr;Vn.core.getStyleSaver=Pm;(function(o,e,t,n){var i=Bn(o+","+e+","+t,function(s){Ki[s]=1});Bn(e,function(s){Zn.units[s]="deg",Fm[s]=1}),Ei[i[13]]=o+","+e,Bn(n,function(s){var r=s.split(":");Ei[r[1]]=i[r[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");Bn("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(o){Zn.units[o]="px"});Vn.registerPlugin(Om);var ut=Vn.registerPlugin(Om)||Vn;ut.core.Tween;class HS{constructor(e,t,n){this.parameters={width:e,height:t,thickness:n},this.type="AreaFloorGeometry";const i=8,s=new Float32Array(i*3),r=new Uint32Array(i*6),a=e,c=t,u=a-n,d=c-n;s[0*3+0]=u*.5,s[0*3+1]=d*.5,s[0*3+2]=0,s[1*3+0]=u*.5,s[1*3+1]=-d*.5,s[1*3+2]=0,s[2*3+0]=-u*.5,s[2*3+1]=-d*.5,s[2*3+2]=0,s[3*3+0]=-u*.5,s[3*3+1]=d*.5,s[3*3+2]=0,s[4*3+0]=a*.5,s[4*3+1]=c*.5,s[4*3+2]=0,s[5*3+0]=a*.5,s[5*3+1]=-c*.5,s[5*3+2]=0,s[6*3+0]=-a*.5,s[6*3+1]=-c*.5,s[6*3+2]=0,s[7*3+0]=-a*.5,s[7*3+1]=c*.5,s[7*3+2]=0,r[0*3+0]=4,r[0*3+1]=0,r[0*3+2]=1,r[1*3+0]=1,r[1*3+1]=5,r[1*3+2]=4,r[2*3+0]=5,r[2*3+1]=1,r[2*3+2]=2,r[3*3+0]=2,r[3*3+1]=6,r[3*3+2]=5,r[4*3+0]=6,r[4*3+1]=2,r[4*3+2]=3,r[5*3+0]=3,r[5*3+1]=7,r[5*3+2]=6,r[6*3+0]=7,r[6*3+1]=3,r[6*3+2]=0,r[7*3+0]=0,r[7*3+1]=4,r[7*3+2]=7;const l=new Ft;return l.setIndex(new an(r,1,!1)),l.setAttribute("position",new yt(s,3)),l}}class GS{constructor(e,t,n){this.parameters={width:e,height:t,depth:n},this.type="AreaFloorGeometry";const i=8,s=new Float32Array(i*3),r=new Uint32Array(i*2),a=new Uint32Array(i*6);s[0*3+0]=e*.5,s[0*3+1]=t*.5,s[0*3+2]=0,s[1*3+0]=e*.5,s[1*3+1]=-t*.5,s[1*3+2]=0,s[2*3+0]=-e*.5,s[2*3+1]=-t*.5,s[2*3+2]=0,s[3*3+0]=-e*.5,s[3*3+1]=t*.5,s[3*3+2]=0,s[4*3+0]=e*.5,s[4*3+1]=t*.5,s[4*3+2]=n,s[5*3+0]=e*.5,s[5*3+1]=-t*.5,s[5*3+2]=n,s[6*3+0]=-e*.5,s[6*3+1]=-t*.5,s[6*3+2]=n,s[7*3+0]=-e*.5,s[7*3+1]=t*.5,s[7*3+2]=n,r[0*2+0]=0,r[0*2+1]=0,r[1*2+0]=1/3,r[1*2+1]=0,r[2*2+0]=1/3*2,r[2*2+1]=0,r[3*2+0]=1,r[3*2+1]=0,r[4*2+0]=0,r[4*2+1]=1,r[5*2+0]=1/3,r[5*2+1]=1,r[6*2+0]=1/3*2,r[6*2+1]=1,r[7*2+0]=1,r[7*2+1]=1,a[0*3+0]=0,a[0*3+1]=4,a[0*3+2]=1,a[1*3+0]=5,a[1*3+1]=1,a[1*3+2]=4,a[2*3+0]=1,a[2*3+1]=5,a[2*3+2]=2,a[3*3+0]=6,a[3*3+1]=2,a[3*3+2]=5,a[4*3+0]=2,a[4*3+1]=6,a[4*3+2]=3,a[5*3+0]=7,a[5*3+1]=3,a[5*3+2]=6,a[6*3+0]=3,a[6*3+1]=7,a[6*3+2]=0,a[7*3+0]=4,a[7*3+1]=0,a[7*3+2]=7;const c=new Ft;return c.setIndex(new an(a,1,!1)),c.setAttribute("position",new yt(s,3)),c.setAttribute("uv",new yt(r,2)),c}}var WS=`uniform float uTime;\r
uniform float uBorderAlpha;\r
uniform float uStrikeAlpha;

varying vec3 vPosition;\r
varying vec3 vModelPosition;\r
varying vec2 vUv;

void main()\r
{\r
    float uStrikeWidth = 0.5;

    float uBorderWidth = 0.1;\r

    if(vModelPosition.z < 0.0)\r
    {\r
        discard;\r
    }

    float strikeStrength = mod((vPosition.x + vPosition.y - uTime * 0.00035 + vPosition.z) / uStrikeWidth * 0.5, 1.0);\r
    strikeStrength = step(strikeStrength, 0.5) * uStrikeAlpha;

    float borderStrength = max(step(1.0 - vUv.y, uBorderWidth), step(vUv.y, uBorderWidth)) * uBorderAlpha;

    float alpha = max(strikeStrength, borderStrength);

    gl_FragColor = vec4(vec3(1.0), alpha);

}`,XS=`varying vec3 vPosition;\r
varying vec3 vModelPosition;\r
varying vec2 vUv;

void main()\r
{\r
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\r
    gl_Position = projectionMatrix * viewMatrix * modelPosition;

    vPosition = position.xyz;\r
    vModelPosition = modelPosition.xyz;\r
    vUv = uv;\r
}`;function jS(){const o={uTime:{value:null},uBorderAlpha:{value:null},uStrikeAlpha:{value:null}};return new Mn({wireframe:!1,transparent:!0,side:qn,depthTest:!0,depthWrite:!1,uniforms:o,vertexShader:XS,fragmentShader:WS})}var qS=`#define M_PI 3.1415926535897932384626433832795

uniform vec3 uColor;\r
uniform float uAlpha;\r
uniform float uLoadProgress;\r
uniform float uProgress;

varying vec3 vPosition;

void main()\r
{\r
    float angle = atan(vPosition.x, vPosition.y);\r
    float loadProgress = step(abs(angle / M_PI), uLoadProgress);\r
    float progress = step(1.0 - abs(angle / M_PI), uProgress);

    float alpha = uAlpha;\r
    alpha -= uAlpha * 0.5 * (1.0 - loadProgress);\r
    alpha *= progress;

    gl_FragColor = vec4(uColor, alpha);

}`,YS=`varying vec3 vPosition;

void main()\r
{\r
    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\r
    gl_Position = projectionMatrix * viewMatrix * modelPosition;

    vPosition = position;\r
}`;function $S(){const o={uColor:{value:null},uAlpha:{value:null},uLoadProgress:{value:null},uProgress:{value:null}};return new Mn({wireframe:!1,transparent:!0,depthTest:!0,depthWrite:!1,uniforms:o,vertexShader:YS,fragmentShader:qS})}class KS extends er{constructor(e){super(),this.config=e.config,this.renderer=e.renderer,this.resources=e.resources,this.car=e.car,this.sounds=e.sounds,this.time=e.time,this.position=e.position,this.halfExtents=e.halfExtents,this.hasKey=e.hasKey,this.testCar=e.testCar,this.active=e.active,this.container=new et,this.container.position.x=this.position.x,this.container.position.y=this.position.y,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.initialTestCar=this.testCar,this.isIn=!1,this.setFloorBorder(),this.setFence(),this.setInteractions(),this.hasKey&&this.setKey()}activate(){this.active=!0,this.isIn&&this.in()}deactivate(){this.active=!1,this.isIn&&this.out()}setFloorBorder(){this.floorBorder={},this.floorBorder.geometry=new HS(this.halfExtents.x*2,this.halfExtents.y*2,.25),this.floorBorder.material=new $S,this.floorBorder.material.uniforms.uColor.value=new He(16777215),this.floorBorder.material.uniforms.uAlpha.value=.5,this.floorBorder.material.uniforms.uLoadProgress.value=1,this.floorBorder.material.uniforms.uProgress.value=1,this.floorBorder.mesh=new Se(this.floorBorder.geometry,this.floorBorder.material),this.floorBorder.mesh.matrixAutoUpdate=!1,this.container.add(this.floorBorder.mesh)}setFence(){this.fence={},this.fence.depth=.5,this.fence.offset=.5,this.fence.geometry=new GS(this.halfExtents.x*2,this.halfExtents.y*2,this.fence.depth),this.fence.material=new jS,this.fence.material.uniforms.uBorderAlpha.value=.5,this.fence.material.uniforms.uStrikeAlpha.value=.25,this.fence.mesh=new Se(this.fence.geometry,this.fence.material),this.fence.mesh.position.z=-this.fence.depth,this.container.add(this.fence.mesh),this.time.on("tick",()=>{this.fence.material.uniforms.uTime.value=this.time.elapsed})}setKey(){this.key={},this.key.hiddenZ=1.5,this.key.shownZ=2.5,this.key.container=new et,this.key.container.position.z=this.key.hiddenZ,this.container.add(this.key.container),this.key.enter={},this.key.enter.size=1.4,this.key.enter.geometry=new ln(this.key.enter.size,this.key.enter.size/4,1,1),this.key.enter.texture=this.resources.items.areaEnterTexture,this.key.enter.texture.magFilter=Bt,this.key.enter.texture.minFilter=Vt,this.key.enter.material=new Mt({color:16777215,alphaMap:this.key.enter.texture,transparent:!0,opacity:0,depthWrite:!1}),this.key.enter.mesh=new Se(this.key.enter.geometry,this.key.enter.material),this.key.enter.mesh.rotation.x=Math.PI*.5,this.key.enter.mesh.position.x=this.key.enter.size*.75,this.key.enter.mesh.matrixAutoUpdate=!1,this.key.enter.mesh.updateMatrix(),this.key.container.add(this.key.enter.mesh),this.key.icon={},this.key.icon.size=.75,this.key.icon.geometry=new ln(this.key.icon.size,this.key.icon.size,1,1),this.key.icon.texture=this.resources.items.areaKeyEnterTexture,this.key.icon.texture.magFilter=Bt,this.key.icon.texture.minFilter=Vt,this.key.icon.material=new Mt({color:16777215,alphaMap:this.key.icon.texture,transparent:!0,opacity:0,depthWrite:!1}),this.key.icon.mesh=new Se(this.key.icon.geometry,this.key.icon.material),this.key.icon.mesh.rotation.x=Math.PI*.5,this.key.icon.mesh.position.x=-this.key.enter.size*.15,this.key.icon.mesh.matrixAutoUpdate=!1,this.key.icon.mesh.updateMatrix(),this.key.container.add(this.key.icon.mesh)}interact(e=!0){this.active&&(ut.killTweensOf(this.fence.mesh.position),ut.killTweensOf(this.floorBorder.material.uniforms.uAlpha),ut.killTweensOf(this.fence.material.uniforms.uBorderAlpha),this.hasKey&&(ut.killTweensOf(this.key.container.position),ut.killTweensOf(this.key.icon.material),ut.killTweensOf(this.key.enter.material)),ut.to(this.fence.mesh.position,{z:0,duration:.05,onComplete:()=>{ut.to(this.fence.mesh.position,{z:.5,duration:.25,ease:"back.out(2)"}),ut.fromTo(this.floorBorder.material.uniforms.uAlpha,{value:1},{value:.5,duration:1.5}),ut.fromTo(this.fence.material.uniforms.uBorderAlpha,{value:1},{value:.5,duration:1.5})}}),this.hasKey&&e&&(this.key.container.position.z=this.key.shownZ,ut.fromTo(this.key.icon.material,{opacity:1},{opacity:.5,duration:1.5}),ut.fromTo(this.key.enter.material,{opacity:1},{opacity:.5,duration:1.5})),this.sounds.play("uiArea"),this.trigger("interact"))}in(e=!0){this.isIn=!0,this.active&&(ut.killTweensOf(this.fence.mesh.position),ut.to(this.fence.mesh.position,{z:this.fence.offset,duration:.35,ease:"back.out(3)"}),this.hasKey&&(ut.killTweensOf(this.key.container.position),ut.killTweensOf(this.key.icon.material),ut.killTweensOf(this.key.enter.material),e&&(ut.to(this.key.container.position,{z:this.key.shownZ,duration:.35,ease:"back.out(3)",delay:.1}),ut.to(this.key.icon.material,{opacity:.5,duration:.35,ease:"back.out(3)",delay:.1}),ut.to(this.key.enter.material,{opacity:.5,duration:.35,ease:"back.out(3)",delay:.1}))),this.config.touch||this.renderer.domElement.classList.add("has-cursor-pointer"),this.trigger("in"))}out(){this.isIn=!1,ut.killTweensOf(this.fence.mesh.position),ut.to(this.fence.mesh.position,{z:-this.fence.depth,duration:.35,ease:"back.in(4)"}),this.hasKey&&(ut.killTweensOf(this.key.container.position),ut.killTweensOf(this.key.icon.material),ut.killTweensOf(this.key.enter.material),ut.to(this.key.container.position,{z:this.key.hiddenZ,duration:.35,ease:"back.in(4)",delay:.1}),ut.to(this.key.icon.material,{opacity:0,duration:.35,ease:"back.in(4)",delay:.1}),ut.to(this.key.enter.material,{opacity:0,duration:.35,ease:"back.in(4)",delay:.1})),this.config.touch||this.renderer.domElement.classList.remove("has-cursor-pointer"),this.trigger("out")}setInteractions(){this.mouseMesh=new Se(new ln(this.halfExtents.x*2,this.halfExtents.y*2,1,1),new Mt({transparent:!0,opacity:0})),this.mouseMesh.position.z=-.01,this.mouseMesh.matrixAutoUpdate=!1,this.mouseMesh.updateMatrix(),this.container.add(this.mouseMesh),this.time.on("tick",()=>{if(this.testCar){const e=Math.abs(this.car.position.x-this.position.x)<Math.abs(this.halfExtents.x)&&Math.abs(this.car.position.y-this.position.y)<Math.abs(this.halfExtents.y);e!==this.isIn&&(e?this.in(!this.config.touch):this.out())}}),window.addEventListener("keydown",e=>{(e.key==="f"||e.key==="e"||e.key==="Enter")&&this.isIn&&this.interact()})}}class ZS{constructor(e){this.config=e.config,this.resources=e.resources,this.car=e.car,this.sounds=e.sounds,this.renderer=e.renderer,this.camera=e.camera,this.time=e.time,this.debug=e.debug,this.items=[],this.container=new et,this.container.matrixAutoUpdate=!1,this.setMouse()}setMouse(){this.mouse={},this.mouse.raycaster=new Rh,this.mouse.coordinates=new Fe,this.mouse.currentArea=null,this.mouse.needsUpdate=!1,window.addEventListener("mousemove",e=>{this.mouse.coordinates.x=e.clientX/window.innerWidth*2-1,this.mouse.coordinates.y=-(e.clientY/window.innerHeight)*2+1,this.mouse.needsUpdate=!0}),window.addEventListener("mousedown",()=>{this.mouse.currentArea&&this.mouse.currentArea.interact(!1)}),this.renderer.domElement.addEventListener("touchstart",e=>{this.mouse.coordinates.x=e.changedTouches[0].clientX/window.innerWidth*2-1,this.mouse.coordinates.y=-(e.changedTouches[0].clientY/window.innerHeight)*2+1,this.mouse.needsUpdate=!0}),this.time.on("tick",()=>{if(this.mouse.needsUpdate){this.mouse.needsUpdate=!1,this.mouse.raycaster.setFromCamera(this.mouse.coordinates,this.camera.instance);const e=this.items.map(n=>n.mouseMesh),t=this.mouse.raycaster.intersectObjects(e);if(t.length){const n=this.items.find(i=>i.mouseMesh===t[0].object);n!==this.mouse.currentArea&&(this.mouse.currentArea!==null&&(this.mouse.currentArea.out(),this.mouse.currentArea.testCar=this.mouse.currentArea.initialTestCar),this.mouse.currentArea=n,this.mouse.currentArea.in(!1),this.mouse.currentArea.testCar=!1)}else this.mouse.currentArea!==null&&(this.mouse.currentArea.out(),this.mouse.currentArea.testCar=this.mouse.currentArea.initialTestCar,this.mouse.currentArea=null)}})}add(e){const t=new KS({config:this.config,renderer:this.renderer,resources:this.resources,car:this.car,sounds:this.sounds,time:this.time,hasKey:!0,testCar:!0,active:!0,...e});return this.container.add(t.container),this.items.push(t),t}}class QS{constructor(e){this.resources=e.resources,this.objects=e.objects,this.debug=e.debug,this.items=[],this.interDistance=1.5,this.tangentDistance=.3,this.positionRandomess=.3,this.rotationRandomess=.1,this.setModels()}setModels(){this.models={},this.models.items=[{base:this.resources.items.tilesABase.scene,collision:this.resources.items.tilesACollision.scene,chances:8},{base:this.resources.items.tilesBBase.scene,collision:this.resources.items.tilesBCollision.scene,chances:1},{base:this.resources.items.tilesCBase.scene,collision:this.resources.items.tilesCCollision.scene,chances:2},{base:this.resources.items.tilesDBase.scene,collision:this.resources.items.tilesDCollision.scene,chances:4},{base:this.resources.items.tilesEBase.scene,collision:this.resources.items.tilesECollision.scene,chances:2}];const e=this.models.items.reduce((n,i)=>n+i.chances,0);let t=0;this.models.items=this.models.items.map(n=>(n.minChances=t,t+=n.chances/e,n.maxChances=t,n.rotationIndex=0,n)),this.models.pick=()=>{const n=Math.random(),i=this.models.items.find(s=>n>=s.minChances&&n<=s.maxChances);return i.rotationIndex++,i.rotationIndex>3&&(i.rotationIndex=0),i}}add(e){const t={};t.start=e.start,t.delta=e.delta,t.distance=t.delta.length(),t.count=Math.floor(t.distance/this.interDistance),t.directionVector=t.delta.clone().normalize(),t.interVector=t.directionVector.clone().multiplyScalar(this.interDistance),t.centeringVector=t.delta.clone().sub(t.interVector.clone().multiplyScalar(t.count)),t.tangentVector=t.directionVector.clone().rotateAround(new Fe(0,0),Math.PI*.5).multiplyScalar(this.tangentDistance),t.angle=t.directionVector.angle();for(let n=0;n<t.count;n++){const i=this.models.pick(),s=t.start.clone().add(t.interVector.clone().multiplyScalar(n)).add(t.centeringVector);s.x+=(Math.random()-.5)*this.positionRandomess,s.y+=(Math.random()-.5)*this.positionRandomess;const r=t.tangentVector;n%1===0&&r.negate(),s.add(r);let a=t.angle+(Math.random()-.5)*this.rotationRandomess+i.rotationIndex/4*Math.PI*2;this.objects.add({base:i.base.clone(),collision:i.collision,offset:new D(s.x,s.y,0),rotation:new ht(0,0,a),material:new wl({color:"#ffffff"}),duplicated:!0,mass:0})}}}class JS{constructor(e){this.resources=e.resources,this.objects=e.objects}add(e){const t={};t.coordinates=[],t.items=[];const n=e.shape;let i=n.widthCount,s=n.heightCount;switch(e.shape.type){case"rectangle":case"brick":for(let r=0;r<s;r++){const a=r===s-1;let c=0,u=i;for(e.shape.type==="brick"&&a&&e.shape.equilibrateLastLine&&(r%2===0?u--:c++);c<u;c++){const d=new D;d.add(n.offsetWidth.clone().multiplyScalar(c-(n.widthCount-1)*.5)),d.add(n.offsetHeight.clone().multiplyScalar(r)),d.x+=(Math.random()-.5)*n.randomOffset.x,d.y+=(Math.random()-.5)*n.randomOffset.y,d.z+=(Math.random()-.5)*n.randomOffset.z,e.shape.type==="brick"&&r%2===0&&d.add(n.offsetWidth.clone().multiplyScalar(.5));const l=new ht;l.x+=(Math.random()-.5)*n.randomRotation.x,l.y+=(Math.random()-.5)*n.randomRotation.y,l.z+=(Math.random()-.5)*n.randomRotation.z,t.coordinates.push({offset:d,rotation:l})}}break;case"triangle":s=n.widthCount;for(let r=0;r<s;r++){for(let a=0;a<i;a++){const c=new D;c.add(n.offsetWidth.clone().multiplyScalar(a-(n.widthCount-1)*.5)),c.add(n.offsetWidth.clone().multiplyScalar(r*.5)),c.add(n.offsetHeight.clone().multiplyScalar(r)),c.x+=(Math.random()-.5)*n.randomOffset.x,c.y+=(Math.random()-.5)*n.randomOffset.y,c.z+=(Math.random()-.5)*n.randomOffset.z,e.shape.type==="brick"&&r%2===0&&c.add(n.offsetWidth.clone().multiplyScalar(.5));const u=new ht;u.x+=(Math.random()-.5)*n.randomRotation.x,u.y+=(Math.random()-.5)*n.randomRotation.y,u.z+=(Math.random()-.5)*n.randomRotation.z,t.coordinates.push({offset:c,rotation:u})}i--}break}for(const r of t.coordinates){const a={...e.object};a.offset=e.object.offset.clone().add(r.offset).add(n.position),a.rotation=e.object.rotation.clone(),a.rotation.x+=r.rotation.x,a.rotation.y+=r.rotation.y,a.rotation.z+=r.rotation.z,t.items.push(this.objects.add(a))}return t}}class eA{constructor(e){this.config=e.config,this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.areas=e.areas,this.walls=e.walls,this.tiles=e.tiles,this.debug=e.debug,this.x=e.x,this.y=e.y,this.container=new et,this.container.matrixAutoUpdate=!1,this.container.updateMatrix(),this.setStatic(),this.setInstructions(),this.setOtherInstructions(),this.setTitles(),this.setTiles(),this.setDikes(),this.setName()}setStatic(){this.objects.add({base:this.resources.items.introStaticBase.scene,collision:this.resources.items.introStaticCollision.scene,floorShadowTexture:this.resources.items.introStaticFloorShadowTexture,offset:new D(0,0,0),mass:0})}setInstructions(){this.instructions={},this.instructions.arrows={},this.instructions.arrows.label={},this.instructions.arrows.label.texture=this.config.touch?this.resources.items.introInstructionsControlsTexture:this.resources.items.introInstructionsArrowsTexture,this.instructions.arrows.label.texture.magFilter=Bt,this.instructions.arrows.label.texture.minFilter=Vt,this.instructions.arrows.label.material=new Mt({transparent:!0,alphaMap:this.instructions.arrows.label.texture,color:16777215,depthWrite:!1,opacity:0}),this.instructions.arrows.label.geometry=this.resources.items.introInstructionsLabels.scene.children.find(e=>e.name==="arrows").geometry,this.instructions.arrows.label.mesh=new Se(this.instructions.arrows.label.geometry,this.instructions.arrows.label.material),this.container.add(this.instructions.arrows.label.mesh),this.config.touch||(this.instructions.arrows.up=this.objects.add({base:this.resources.items.introArrowKeyBase.scene,collision:this.resources.items.introArrowKeyCollision.scene,offset:new D(0,0,0),rotation:new ht(0,0,0),duplicated:!0,shadow:{sizeX:1,sizeY:1,offsetZ:-.2,alpha:.5},mass:1.5,soundName:"brick"}),this.instructions.arrows.down=this.objects.add({base:this.resources.items.introArrowKeyBase.scene,collision:this.resources.items.introArrowKeyCollision.scene,offset:new D(0,-.8,0),rotation:new ht(0,0,Math.PI),duplicated:!0,shadow:{sizeX:1,sizeY:1,offsetZ:-.2,alpha:.5},mass:1.5,soundName:"brick"}),this.instructions.arrows.left=this.objects.add({base:this.resources.items.introArrowKeyBase.scene,collision:this.resources.items.introArrowKeyCollision.scene,offset:new D(-.8,-.8,0),rotation:new ht(0,0,Math.PI*.5),duplicated:!0,shadow:{sizeX:1,sizeY:1,offsetZ:-.2,alpha:.5},mass:1.5,soundName:"brick"}),this.instructions.arrows.right=this.objects.add({base:this.resources.items.introArrowKeyBase.scene,collision:this.resources.items.introArrowKeyCollision.scene,offset:new D(.8,-.8,0),rotation:new ht(0,0,-Math.PI*.5),duplicated:!0,shadow:{sizeX:1,sizeY:1,offsetZ:-.2,alpha:.5},mass:1.5,soundName:"brick"}))}setName(){this.nameInstructions={},this.nameInstructions.container=new et,this.nameInstructions.container.position.x=4,this.nameInstructions.container.position.y=-8,this.nameInstructions.container.matrixAutoUpdate=!1,this.nameInstructions.container.updateMatrix(),this.container.add(this.nameInstructions.container),this.nameInstructions.label={},this.nameInstructions.label.geometry=new ln(6,3,1,1),this.nameInstructions.label.texture=this.resources.items.introNameTexture,this.nameInstructions.label.texture.magFilter=Bt,this.nameInstructions.label.texture.minFilter=Vt,this.nameInstructions.label.material=new Mt({transparent:!0,alphaMap:this.nameInstructions.label.texture,color:16777215,depthWrite:!1,opacity:1}),this.nameInstructions.label.mesh=new Se(this.nameInstructions.label.geometry,this.nameInstructions.label.material),this.nameInstructions.label.mesh.matrixAutoUpdate=!1,this.nameInstructions.container.add(this.nameInstructions.label.mesh)}setOtherInstructions(){this.config.touch||(this.otherInstructions={},this.otherInstructions.x=16,this.otherInstructions.y=-2,this.otherInstructions.container=new et,this.otherInstructions.container.position.x=this.otherInstructions.x,this.otherInstructions.container.position.y=this.otherInstructions.y,this.otherInstructions.container.matrixAutoUpdate=!1,this.otherInstructions.container.updateMatrix(),this.container.add(this.otherInstructions.container),this.otherInstructions.label={},this.otherInstructions.label.geometry=new ln(6,6,1,1),this.otherInstructions.label.texture=this.resources.items.introInstructionsOtherTexture,this.otherInstructions.label.texture.magFilter=Bt,this.otherInstructions.label.texture.minFilter=Vt,this.otherInstructions.label.material=new Mt({transparent:!0,alphaMap:this.otherInstructions.label.texture,color:16777215,depthWrite:!1,opacity:0}),this.otherInstructions.label.mesh=new Se(this.otherInstructions.label.geometry,this.otherInstructions.label.material),this.otherInstructions.label.mesh.matrixAutoUpdate=!1,this.otherInstructions.container.add(this.otherInstructions.label.mesh),this.otherInstructions.horn=this.objects.add({base:this.resources.items.hornBase.scene,collision:this.resources.items.hornCollision.scene,offset:new D(this.otherInstructions.x+1.25,this.otherInstructions.y-2.75,.2),rotation:new ht(0,0,.5),duplicated:!0,shadow:{sizeX:1.65,sizeY:.75,offsetZ:-.1,alpha:.4},mass:1.5,soundName:"horn",sleep:!1}))}setTitles(){this.objects.add({base:this.resources.items.introCreativeBase.scene,collision:this.resources.items.introCreativeCollision.scene,offset:new D(0,0,0),rotation:new ht(0,0,.25),shadow:{sizeX:5,sizeY:1.5,offsetZ:-.6,alpha:.3},mass:1.5,sleep:!1,soundName:"brick"}),this.objects.add({base:this.resources.items.introDevBase.scene,collision:this.resources.items.introDevCollision.scene,offset:new D(0,0,0),rotation:new ht(0,0,0),shadow:{sizeX:2.5,sizeY:1.5,offsetZ:-.6,alpha:.3},mass:1.5,soundName:"brick"})}setTiles(){this.tiles.add({start:new Fe(0,-4.5),delta:new Fe(0,-4.5)})}setDikes(){this.dikes={},this.dikes.brickOptions={base:this.resources.items.brickBase.scene,collision:this.resources.items.brickCollision.scene,offset:new D(0,0,.1),rotation:new ht(0,0,0),duplicated:!0,shadow:{sizeX:1.2,sizeY:1.8,offsetZ:-.15,alpha:.35},mass:.5,soundName:"brick"},this.walls.add({object:{...this.dikes.brickOptions,rotation:new ht(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:3,heightCount:2,position:new D(this.x+0,this.y-4,0),offsetWidth:new D(1.05,0,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!0,widthCount:5,heightCount:2,position:new D(this.x-12,this.y-13,0),offsetWidth:new D(0,1.05,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:{...this.dikes.brickOptions,rotation:new ht(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:3,heightCount:2,position:new D(this.x+8,this.y+6,0),offsetWidth:new D(1.05,0,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!1,widthCount:3,heightCount:2,position:new D(this.x+9.9,this.y+4.7,0),offsetWidth:new D(0,-1.05,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:{...this.dikes.brickOptions,rotation:new ht(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:3,heightCount:2,position:new D(this.x-14,this.y+2,0),offsetWidth:new D(1.05,0,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!1,widthCount:3,heightCount:2,position:new D(this.x-14.8,this.y+.7,0),offsetWidth:new D(0,-1.05,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!0,widthCount:3,heightCount:2,position:new D(this.x-14.8,this.y-3.5,0),offsetWidth:new D(0,-1.05,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.config.touch||(this.walls.add({object:{...this.dikes.brickOptions,rotation:new ht(0,0,Math.PI*.5)},shape:{type:"brick",equilibrateLastLine:!0,widthCount:2,heightCount:2,position:new D(this.x+18.5,this.y+3,0),offsetWidth:new D(1.05,0,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}),this.walls.add({object:this.dikes.brickOptions,shape:{type:"brick",equilibrateLastLine:!1,widthCount:2,heightCount:2,position:new D(this.x+19.9,this.y+2.2,0),offsetWidth:new D(0,-1.05,0),offsetHeight:new D(0,0,.45),randomOffset:new D(0,0,0),randomRotation:new D(0,0,.2)}}))}}class tA{constructor(e){this.time=e.time,this.resources=e.resources,this.objects=e.objects,this.areas=e.areas,this.tiles=e.tiles,this.debug=e.debug,this.x=e.x,this.y=e.y,this.container=new et,this.container.matrixAutoUpdate=!1,this.setLinks(),this.setActivities(),this.setTiles()}setLinks(){this.links={},this.links.x=1.95,this.links.y=-1.5,this.links.halfExtents={},this.links.halfExtents.x=1,this.links.halfExtents.y=1,this.links.distanceBetween=2.4,this.links.labelWidth=this.links.halfExtents.x*2+1,this.links.labelGeometry=new ln(this.links.labelWidth,this.links.labelWidth*.25,1,1),this.links.labelOffset=-1.6,this.links.items=[],this.links.container=new et,this.links.container.matrixAutoUpdate=!1,this.container.add(this.links.container),this.links.options=[{href:"https://twitter.com/jumpiix24/",labelTexture:this.resources.items.informationContactTwitterLabelTexture},{href:"https://github.com/jumpiix/",labelTexture:this.resources.items.informationContactGithubLabelTexture},{href:"https://www.linkedin.com/in/jumpiix/",labelTexture:this.resources.items.informationContactLinkedinLabelTexture},{href:"mailto:unterguggenberger.david@gmail.com",labelTexture:this.resources.items.informationContactMailLabelTexture}];let e=0;for(const t of this.links.options){const n={};n.x=this.x+this.links.x+this.links.distanceBetween*e,n.y=this.y+this.links.y,n.href=t.href,n.area=this.areas.add({position:new Fe(n.x,n.y),halfExtents:new Fe(this.links.halfExtents.x,this.links.halfExtents.y)}),n.area.on("interact",()=>{window.open(t.href,"_blank")}),n.texture=t.labelTexture,n.texture.magFilter=Bt,n.texture.minFilter=Vt,n.labelMesh=new Se(this.links.labelGeometry,new Mt({wireframe:!1,color:16777215,alphaMap:t.labelTexture,depthTest:!0,depthWrite:!1,transparent:!0})),n.labelMesh.position.x=n.x+this.links.labelWidth*.5-this.links.halfExtents.x,n.labelMesh.position.y=n.y+this.links.labelOffset,n.labelMesh.matrixAutoUpdate=!1,n.labelMesh.updateMatrix(),this.links.container.add(n.labelMesh),this.links.items.push(n),e++}}setActivities(){this.activities={},this.activities.x=this.x+0,this.activities.y=this.y-10,this.activities.multiplier=5.5,this.activities.geometry=new ln(2*this.activities.multiplier,1*this.activities.multiplier,1,1),this.activities.texture=this.resources.items.informationActivitiesTexture,this.activities.texture.magFilter=Bt,this.activities.texture.minFilter=Vt,this.activities.material=new Mt({wireframe:!1,color:16777215,alphaMap:this.activities.texture,transparent:!0}),this.activities.mesh=new Se(this.activities.geometry,this.activities.material),this.activities.mesh.position.x=this.activities.x,this.activities.mesh.position.y=this.activities.y,this.activities.mesh.matrixAutoUpdate=!1,this.activities.mesh.updateMatrix(),this.container.add(this.activities.mesh)}setTiles(){this.tiles.add({start:new Fe(this.x-1.2,this.y+13),delta:new Fe(0,-20)})}}const nA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAA0CAMAAADG3yrFAAAAYFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////98JRy6AAAAH3RSTlMAu0T56AQTUMyoLX97pM+vn1QwlCsOzoh2cGtFQDnR6vXj9wAAANpJREFUSMft08sOgjAQheERKJRrEQQVL33/t7S3tAk1OU1cmfAvJrPo4ltM6UtsE2JjlNTCpYovlFIvTT0lVElXRbCyUO/egxpFmYTIpyl3EIxoiVoLwYiBETEHwQi9NRaCEToHwQgTWy0EIzykxggECQgf4wYCEBEEIgIEIADEIhq9AUhARHUWEiNWg8CQ2iMAJEbEkPMOwQ0CQwICQRyi0xuA7BAAAhCmi4cEBIYsAYEhd4+AkBuNaooMJox6lsnN9JLJPfVvSOxKqmw8JTQ+6G87TvQ40Z/7AKq5RWVOmj58AAAAAElFTkSuQmCC",Rf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAkCAMAAADFCSheAAAAXVBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9RKvvlAAAAHnRSTlMARLvoBBP4UC3MqKR9z3lTMK+A+p8OlGvRuohwRTwkmquJAAAAxUlEQVQ4y5XOtxLCQBRDURnWORsH4v7/Z/Jmx2MVwGi5hSoVB19y2zhuDlEtpbfKBTHVPlQjotzv5ZClZ/tdW5tzGoW4DENGiEBMQLNDJKJ1gCNEIGAVhAgEQIhCWIRoxAGpNEJBiDhyJSGMiCwgNCQgGjBCBEJAAqIAGCERCEL6nwgNqYiQECI+6wghogwIDSFCQ4jQECKgIURoSO+tDpaGLERoyIMIBekw246JbAzq1Ue34hV/ToAp9nuHlcy3k25+4r/eTIAs8/NO/cUAAAAASUVORK5CYII=",iA="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAMAAAAM7l6QAAAANlBMVEUAAAD////////////////////////////////////////////////////////////////////xY8b8AAAAEXRSTlMA/OdVKViVlFDu3nHpGAi2RvH48bcAAACESURBVCjPdc8xFoMwEANR4YVkbQPJ3v+y8CjUSKj9jQaYvwm72Hsgq+rrdFuqOmbRRWvH0eiiSwIrXTQAulVxUbqquir9IypOtU71XlTvVPX+sCqL+N/ru8fzudOdBvutst/pBtCtWqeqq9JV1ZNqfVDV82aq+gT+rSVgfNQ48L5zPXEBEccPFOsAa88AAAAASUVORK5CYII=";class sA extends er{constructor(e){super(),this.config=e.config,this.sizes=e.sizes,this.time=e.time,this.camera=e.camera,this.sounds=e.sounds,this.setActions(),this.setKeyboard()}setActions(){this.actions={},this.actions.up=!1,this.actions.right=!1,this.actions.down=!1,this.actions.left=!1,this.actions.brake=!1,this.actions.boost=!1,document.addEventListener("visibilitychange",()=>{document.hidden||(this.actions.up=!1,this.actions.right=!1,this.actions.down=!1,this.actions.left=!1,this.actions.brake=!1,this.actions.boost=!1)})}setKeyboard(){this.keyboard={},this.keyboard.events={},this.keyboard.events.keyDown=e=>{switch(e.code){case"ArrowUp":case"KeyW":this.camera.pan.reset(),this.actions.up=!0;break;case"ArrowRight":case"KeyD":this.actions.right=!0;break;case"ArrowDown":case"KeyS":this.camera.pan.reset(),this.actions.down=!0;break;case"ArrowLeft":case"KeyA":this.actions.left=!0;break;case"ControlLeft":case"ControlRight":case"Space":this.actions.brake=!0;break;case"ShiftLeft":case"ShiftRight":this.actions.boost=!0;break}},this.keyboard.events.keyUp=e=>{switch(e.code){case"ArrowUp":case"KeyW":this.actions.up=!1;break;case"ArrowRight":case"KeyD":this.actions.right=!1;break;case"ArrowDown":case"KeyS":this.actions.down=!1;break;case"ArrowLeft":case"KeyA":this.actions.left=!1;break;case"ControlLeft":case"ControlRight":case"Space":this.actions.brake=!1;break;case"ShiftLeft":case"ShiftRight":this.actions.boost=!1;break;case"KeyR":this.trigger("action",["reset"]);break}},document.addEventListener("keydown",this.keyboard.events.keyDown),document.addEventListener("keyup",this.keyboard.events.keyUp)}setTouch(){this.touch={},this.touch.joystick={},this.touch.joystick.active=!1,this.touch.joystick.$element=document.createElement("div"),this.touch.joystick.$element.style.userSelect="none",this.touch.joystick.$element.style.position="fixed",this.touch.joystick.$element.style.bottom="10px",this.touch.joystick.$element.style.left="10px",this.touch.joystick.$element.style.width="170px",this.touch.joystick.$element.style.height="170px",this.touch.joystick.$element.style.borderRadius="50%",this.touch.joystick.$element.style.transition="opacity 0.3s 0.0s",this.touch.joystick.$element.style.willChange="opacity",this.touch.joystick.$element.style.opacity="0",document.body.appendChild(this.touch.joystick.$element),this.touch.joystick.$cursor=document.createElement("div"),this.touch.joystick.$cursor.style.position="absolute",this.touch.joystick.$cursor.style.top="calc(50% - 30px)",this.touch.joystick.$cursor.style.left="calc(50% - 30px)",this.touch.joystick.$cursor.style.width="60px",this.touch.joystick.$cursor.style.height="60px",this.touch.joystick.$cursor.style.border="2px solid #ffffff",this.touch.joystick.$cursor.style.borderRadius="50%",this.touch.joystick.$cursor.style.boxSizing="border-box",this.touch.joystick.$cursor.style.pointerEvents="none",this.touch.joystick.$cursor.style.willChange="transform",this.touch.joystick.$element.appendChild(this.touch.joystick.$cursor),this.touch.joystick.$limit=document.createElement("div"),this.touch.joystick.$limit.style.position="absolute",this.touch.joystick.$limit.style.top="calc(50% - 75px)",this.touch.joystick.$limit.style.left="calc(50% - 75px)",this.touch.joystick.$limit.style.width="150px",this.touch.joystick.$limit.style.height="150px",this.touch.joystick.$limit.style.border="2px solid #ffffff",this.touch.joystick.$limit.style.borderRadius="50%",this.touch.joystick.$limit.style.opacity="0.25",this.touch.joystick.$limit.style.pointerEvents="none",this.touch.joystick.$limit.style.boxSizing="border-box",this.touch.joystick.$element.appendChild(this.touch.joystick.$limit),this.touch.joystick.angle={},this.touch.joystick.angle.offset=Math.PI*.18,this.touch.joystick.angle.center={},this.touch.joystick.angle.center.x=0,this.touch.joystick.angle.center.y=0,this.touch.joystick.angle.current={},this.touch.joystick.angle.current.x=0,this.touch.joystick.angle.current.y=0,this.touch.joystick.angle.originalValue=0,this.touch.joystick.angle.value=-Math.PI*.5,this.touch.joystick.resize=()=>{const e=this.touch.joystick.$element.getBoundingClientRect();this.touch.joystick.angle.center.x=e.left+e.width*.5,this.touch.joystick.angle.center.y=e.top+e.height*.5},this.sizes.on("resize",this.touch.joystick.resize),this.touch.joystick.resize(),this.time.on("tick",()=>{if(this.touch.joystick.active){this.touch.joystick.angle.originalValue=-Math.atan2(this.touch.joystick.angle.current.y-this.touch.joystick.angle.center.y,this.touch.joystick.angle.current.x-this.touch.joystick.angle.center.x),this.touch.joystick.angle.value=this.touch.joystick.angle.originalValue+this.touch.joystick.angle.offset;const e=Math.hypot(this.touch.joystick.angle.current.y-this.touch.joystick.angle.center.y,this.touch.joystick.angle.current.x-this.touch.joystick.angle.center.x);let t=e;t>20&&(t=20+Math.log(e-20)*5),t>43&&(t=43);const n=Math.sin(this.touch.joystick.angle.originalValue+Math.PI*.5)*t,i=Math.cos(this.touch.joystick.angle.originalValue+Math.PI*.5)*t;this.touch.joystick.$cursor.style.transform=`translateX(${n}px) translateY(${i}px)`}}),this.touch.joystick.events={},this.touch.joystick.touchIdentifier=null,this.touch.joystick.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.touch.joystick.active=!0,this.touch.joystick.touchIdentifier=t.identifier,this.touch.joystick.angle.current.x=t.clientX,this.touch.joystick.angle.current.y=t.clientY,this.touch.joystick.$limit.style.opacity="0.5",document.addEventListener("touchend",this.touch.joystick.events.touchend),document.addEventListener("touchmove",this.touch.joystick.events.touchmove,{passive:!1}),this.trigger("joystickStart"))},this.touch.joystick.events.touchmove=e=>{e.preventDefault();const n=[...e.changedTouches].find(i=>i.identifier===this.touch.joystick.touchIdentifier);n&&(this.touch.joystick.angle.current.x=n.clientX,this.touch.joystick.angle.current.y=n.clientY,this.trigger("joystickMove"))},this.touch.joystick.events.touchend=e=>{[...e.changedTouches].find(i=>i.identifier===this.touch.joystick.touchIdentifier)&&(this.touch.joystick.active=!1,this.touch.joystick.$limit.style.opacity="0.25",this.touch.joystick.$cursor.style.transform="translateX(0px) translateY(0px)",document.removeEventListener("touchend",this.touch.joystick.events.touchend),this.trigger("joystickEnd"))},this.touch.joystick.$element.addEventListener("touchstart",this.touch.joystick.events.touchstart,{passive:!1}),this.touch.boost={},this.touch.boost.$element=document.createElement("div"),this.touch.boost.$element.style.userSelect="none",this.touch.boost.$element.style.position="fixed",this.touch.boost.$element.style.bottom="calc(70px * 3 + 15px)",this.touch.boost.$element.style.right="0px",this.touch.boost.$element.style.width="95px",this.touch.boost.$element.style.height="70px",this.touch.boost.$element.style.transition="opacity 0.3s 0.4s",this.touch.boost.$element.style.willChange="opacity",this.touch.boost.$element.style.opacity="0",document.body.appendChild(this.touch.boost.$element),this.touch.boost.$border=document.createElement("div"),this.touch.boost.$border.style.position="absolute",this.touch.boost.$border.style.top="calc(50% - 30px)",this.touch.boost.$border.style.left="calc(50% - 30px)",this.touch.boost.$border.style.width="60px",this.touch.boost.$border.style.height="60px",this.touch.boost.$border.style.border="2px solid #ffffff",this.touch.boost.$border.style.borderRadius="10px",this.touch.boost.$border.style.boxSizing="border-box",this.touch.boost.$border.style.opacity="0.25",this.touch.boost.$border.style.willChange="opacity",this.touch.boost.$element.appendChild(this.touch.boost.$border),this.touch.boost.$icon=document.createElement("div"),this.touch.boost.$icon.style.position="absolute",this.touch.boost.$icon.style.top="calc(50% - 13px)",this.touch.boost.$icon.style.left="calc(50% - 11px)",this.touch.boost.$icon.style.width="22px",this.touch.boost.$icon.style.height="26px",this.touch.boost.$icon.style.backgroundImage=`url(${nA})`,this.touch.boost.$icon.style.backgroundSize="cover",this.touch.boost.$element.appendChild(this.touch.boost.$icon),this.touch.boost.events={},this.touch.boost.touchIdentifier=null,this.touch.boost.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.boost.touchIdentifier=t.identifier,this.actions.up=!0,this.actions.boost=!0,this.touch.boost.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.boost.events.touchend))},this.touch.boost.events.touchend=e=>{[...e.changedTouches].find(i=>i.identifier===this.touch.boost.touchIdentifier)&&(this.actions.up=!1,this.actions.boost=!1,this.touch.boost.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.boost.events.touchend))},this.touch.boost.$element.addEventListener("touchstart",this.touch.boost.events.touchstart),this.touch.forward={},this.touch.forward.$element=document.createElement("div"),this.touch.forward.$element.style.userSelect="none",this.touch.forward.$element.style.position="fixed",this.touch.forward.$element.style.bottom="calc(70px * 2 + 15px)",this.touch.forward.$element.style.right="0px",this.touch.forward.$element.style.width="95px",this.touch.forward.$element.style.height="70px",this.touch.forward.$element.style.transition="opacity 0.3s 0.3s",this.touch.forward.$element.style.willChange="opacity",this.touch.forward.$element.style.opacity="0",document.body.appendChild(this.touch.forward.$element),this.touch.forward.$border=document.createElement("div"),this.touch.forward.$border.style.position="absolute",this.touch.forward.$border.style.top="calc(50% - 30px)",this.touch.forward.$border.style.left="calc(50% - 30px)",this.touch.forward.$border.style.width="60px",this.touch.forward.$border.style.height="60px",this.touch.forward.$border.style.border="2px solid #ffffff",this.touch.forward.$border.style.borderRadius="10px",this.touch.forward.$border.style.boxSizing="border-box",this.touch.forward.$border.style.opacity="0.25",this.touch.forward.$border.style.willChange="opacity",this.touch.forward.$element.appendChild(this.touch.forward.$border),this.touch.forward.$icon=document.createElement("div"),this.touch.forward.$icon.style.position="absolute",this.touch.forward.$icon.style.top="calc(50% - 9px)",this.touch.forward.$icon.style.left="calc(50% - 11px)",this.touch.forward.$icon.style.width="22px",this.touch.forward.$icon.style.height="18px",this.touch.forward.$icon.style.backgroundImage=`url(${Rf})`,this.touch.forward.$icon.style.backgroundSize="cover",this.touch.forward.$element.appendChild(this.touch.forward.$icon),this.touch.forward.events={},this.touch.forward.touchIdentifier=null,this.touch.forward.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.forward.touchIdentifier=t.identifier,this.actions.up=!0,this.touch.forward.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.forward.events.touchend))},this.touch.forward.events.touchend=e=>{[...e.changedTouches].find(i=>i.identifier===this.touch.forward.touchIdentifier)&&(this.actions.up=!1,this.touch.forward.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.forward.events.touchend))},this.touch.forward.$element.addEventListener("touchstart",this.touch.forward.events.touchstart),this.touch.brake={},this.touch.brake.$element=document.createElement("div"),this.touch.brake.$element.style.userSelect="none",this.touch.brake.$element.style.position="fixed",this.touch.brake.$element.style.bottom="calc(70px + 15px)",this.touch.brake.$element.style.right="0px",this.touch.brake.$element.style.width="95px",this.touch.brake.$element.style.height="70px",this.touch.brake.$element.style.transition="opacity 0.3s 0.2s",this.touch.brake.$element.style.willChange="opacity",this.touch.brake.$element.style.opacity="0",document.body.appendChild(this.touch.brake.$element),this.touch.brake.$border=document.createElement("div"),this.touch.brake.$border.style.position="absolute",this.touch.brake.$border.style.top="calc(50% - 30px)",this.touch.brake.$border.style.left="calc(50% - 30px)",this.touch.brake.$border.style.width="60px",this.touch.brake.$border.style.height="60px",this.touch.brake.$border.style.border="2px solid #ffffff",this.touch.brake.$border.style.borderRadius="10px",this.touch.brake.$border.style.boxSizing="border-box",this.touch.brake.$border.style.opacity="0.25",this.touch.brake.$border.style.willChange="opacity",this.touch.brake.$element.appendChild(this.touch.brake.$border),this.touch.brake.$icon=document.createElement("div"),this.touch.brake.$icon.style.position="absolute",this.touch.brake.$icon.style.top="calc(50% - 7px)",this.touch.brake.$icon.style.left="calc(50% - 7px)",this.touch.brake.$icon.style.width="15px",this.touch.brake.$icon.style.height="15px",this.touch.brake.$icon.style.backgroundImage=`url(${iA})`,this.touch.brake.$icon.style.backgroundSize="cover",this.touch.brake.$icon.style.transform="rotate(180deg)",this.touch.brake.$element.appendChild(this.touch.brake.$icon),this.touch.brake.events={},this.touch.brake.touchIdentifier=null,this.touch.brake.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.touch.brake.touchIdentifier=t.identifier,this.actions.brake=!0,this.touch.brake.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.brake.events.touchend))},this.touch.brake.events.touchend=e=>{[...e.changedTouches].find(i=>i.identifier===this.touch.brake.touchIdentifier)&&(this.actions.brake=!1,this.touch.brake.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.brake.events.touchend))},this.touch.brake.$element.addEventListener("touchstart",this.touch.brake.events.touchstart),this.touch.backward={},this.touch.backward.$element=document.createElement("div"),this.touch.backward.$element.style.userSelect="none",this.touch.backward.$element.style.position="fixed",this.touch.backward.$element.style.bottom="15px",this.touch.backward.$element.style.right="0px",this.touch.backward.$element.style.width="95px",this.touch.backward.$element.style.height="70px",this.touch.backward.$element.style.transition="opacity 0.3s 0.1s",this.touch.backward.$element.style.willChange="opacity",this.touch.backward.$element.style.opacity="0",document.body.appendChild(this.touch.backward.$element),this.touch.backward.$border=document.createElement("div"),this.touch.backward.$border.style.position="absolute",this.touch.backward.$border.style.top="calc(50% - 30px)",this.touch.backward.$border.style.left="calc(50% - 30px)",this.touch.backward.$border.style.width="60px",this.touch.backward.$border.style.height="60px",this.touch.backward.$border.style.border="2px solid #ffffff",this.touch.backward.$border.style.borderRadius="10px",this.touch.backward.$border.style.boxSizing="border-box",this.touch.backward.$border.style.opacity="0.25",this.touch.backward.$border.style.willChange="opacity",this.touch.backward.$element.appendChild(this.touch.backward.$border),this.touch.backward.$icon=document.createElement("div"),this.touch.backward.$icon.style.position="absolute",this.touch.backward.$icon.style.top="calc(50% - 9px)",this.touch.backward.$icon.style.left="calc(50% - 11px)",this.touch.backward.$icon.style.width="22px",this.touch.backward.$icon.style.height="18px",this.touch.backward.$icon.style.backgroundImage=`url(${Rf})`,this.touch.backward.$icon.style.backgroundSize="cover",this.touch.backward.$icon.style.transform="rotate(180deg)",this.touch.backward.$element.appendChild(this.touch.backward.$icon),this.touch.backward.events={},this.touch.backward.touchIdentifier=null,this.touch.backward.events.touchstart=e=>{e.preventDefault();const t=e.changedTouches[0];t&&(this.camera.pan.reset(),this.touch.backward.touchIdentifier=t.identifier,this.actions.down=!0,this.touch.backward.$border.style.opacity="0.5",document.addEventListener("touchend",this.touch.backward.events.touchend))},this.touch.backward.events.touchend=e=>{[...e.changedTouches].find(i=>i.identifier===this.touch.backward.touchIdentifier)&&(this.actions.down=!1,this.touch.backward.$border.style.opacity="0.25",document.removeEventListener("touchend",this.touch.backward.events.touchend))},this.touch.backward.$element.addEventListener("touchstart",this.touch.backward.events.touchstart),this.touch.reveal=()=>{this.touch.joystick.$element.style.opacity=1,this.touch.backward.$element.style.opacity=1,this.touch.brake.$element.style.opacity=1,this.touch.forward.$element.style.opacity=1,this.touch.boost.$element.style.opacity=1}}}var hi={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(o){(function(){var e=function(){this.init()};e.prototype={init:function(){var l=this||t;return l._counter=1e3,l._html5AudioPool=[],l.html5PoolSize=10,l._codecs={},l._howls=[],l._muted=!1,l._volume=1,l._canPlayEvent="canplaythrough",l._navigator=typeof window<"u"&&window.navigator?window.navigator:null,l.masterGain=null,l.noAudio=!1,l.usingWebAudio=!0,l.autoSuspend=!0,l.ctx=null,l.autoUnlock=!0,l._setup(),l},volume:function(l){var h=this||t;if(l=parseFloat(l),h.ctx||d(),typeof l<"u"&&l>=0&&l<=1){if(h._volume=l,h._muted)return h;h.usingWebAudio&&h.masterGain.gain.setValueAtTime(l,t.ctx.currentTime);for(var f=0;f<h._howls.length;f++)if(!h._howls[f]._webAudio)for(var p=h._howls[f]._getSoundIds(),g=0;g<p.length;g++){var m=h._howls[f]._soundById(p[g]);m&&m._node&&(m._node.volume=m._volume*l)}return h}return h._volume},mute:function(l){var h=this||t;h.ctx||d(),h._muted=l,h.usingWebAudio&&h.masterGain.gain.setValueAtTime(l?0:h._volume,t.ctx.currentTime);for(var f=0;f<h._howls.length;f++)if(!h._howls[f]._webAudio)for(var p=h._howls[f]._getSoundIds(),g=0;g<p.length;g++){var m=h._howls[f]._soundById(p[g]);m&&m._node&&(m._node.muted=l?!0:m._muted)}return h},stop:function(){for(var l=this||t,h=0;h<l._howls.length;h++)l._howls[h].stop();return l},unload:function(){for(var l=this||t,h=l._howls.length-1;h>=0;h--)l._howls[h].unload();return l.usingWebAudio&&l.ctx&&typeof l.ctx.close<"u"&&(l.ctx.close(),l.ctx=null,d()),l},codecs:function(l){return(this||t)._codecs[l.replace(/^x-/,"")]},_setup:function(){var l=this||t;if(l.state=l.ctx&&l.ctx.state||"suspended",l._autoSuspend(),!l.usingWebAudio)if(typeof Audio<"u")try{var h=new Audio;typeof h.oncanplaythrough>"u"&&(l._canPlayEvent="canplay")}catch{l.noAudio=!0}else l.noAudio=!0;try{var h=new Audio;h.muted&&(l.noAudio=!0)}catch{}return l.noAudio||l._setupCodecs(),l},_setupCodecs:function(){var l=this||t,h=null;try{h=typeof Audio<"u"?new Audio:null}catch{return l}if(!h||typeof h.canPlayType!="function")return l;var f=h.canPlayType("audio/mpeg;").replace(/^no$/,""),p=l._navigator?l._navigator.userAgent:"",g=p.match(/OPR\/(\d+)/g),m=g&&parseInt(g[0].split("/")[1],10)<33,v=p.indexOf("Safari")!==-1&&p.indexOf("Chrome")===-1,_=p.match(/Version\/(.*?) /),y=v&&_&&parseInt(_[1],10)<15;return l._codecs={mp3:!!(!m&&(f||h.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!f,opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(h.canPlayType('audio/wav; codecs="1"')||h.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!h.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(h.canPlayType("audio/x-m4b;")||h.canPlayType("audio/m4b;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!h.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(h.canPlayType("audio/x-flac;")||h.canPlayType("audio/flac;")).replace(/^no$/,"")},l},_unlockAudio:function(){var l=this||t;if(!(l._audioUnlocked||!l.ctx)){l._audioUnlocked=!1,l.autoUnlock=!1,!l._mobileUnloaded&&l.ctx.sampleRate!==44100&&(l._mobileUnloaded=!0,l.unload()),l._scratchBuffer=l.ctx.createBuffer(1,1,22050);var h=function(f){for(;l._html5AudioPool.length<l.html5PoolSize;)try{var p=new Audio;p._unlocked=!0,l._releaseHtml5Audio(p)}catch{l.noAudio=!0;break}for(var g=0;g<l._howls.length;g++)if(!l._howls[g]._webAudio)for(var m=l._howls[g]._getSoundIds(),v=0;v<m.length;v++){var _=l._howls[g]._soundById(m[v]);_&&_._node&&!_._node._unlocked&&(_._node._unlocked=!0,_._node.load())}l._autoResume();var y=l.ctx.createBufferSource();y.buffer=l._scratchBuffer,y.connect(l.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof l.ctx.resume=="function"&&l.ctx.resume(),y.onended=function(){y.disconnect(0),l._audioUnlocked=!0,document.removeEventListener("touchstart",h,!0),document.removeEventListener("touchend",h,!0),document.removeEventListener("click",h,!0),document.removeEventListener("keydown",h,!0);for(var x=0;x<l._howls.length;x++)l._howls[x]._emit("unlock")}};return document.addEventListener("touchstart",h,!0),document.addEventListener("touchend",h,!0),document.addEventListener("click",h,!0),document.addEventListener("keydown",h,!0),l}},_obtainHtml5Audio:function(){var l=this||t;if(l._html5AudioPool.length)return l._html5AudioPool.pop();var h=new Audio().play();return h&&typeof Promise<"u"&&(h instanceof Promise||typeof h.then=="function")&&h.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(l){var h=this||t;return l._unlocked&&h._html5AudioPool.push(l),h},_autoSuspend:function(){var l=this;if(!(!l.autoSuspend||!l.ctx||typeof l.ctx.suspend>"u"||!t.usingWebAudio)){for(var h=0;h<l._howls.length;h++)if(l._howls[h]._webAudio){for(var f=0;f<l._howls[h]._sounds.length;f++)if(!l._howls[h]._sounds[f]._paused)return l}return l._suspendTimer&&clearTimeout(l._suspendTimer),l._suspendTimer=setTimeout(function(){if(l.autoSuspend){l._suspendTimer=null,l.state="suspending";var p=function(){l.state="suspended",l._resumeAfterSuspend&&(delete l._resumeAfterSuspend,l._autoResume())};l.ctx.suspend().then(p,p)}},3e4),l}},_autoResume:function(){var l=this;if(!(!l.ctx||typeof l.ctx.resume>"u"||!t.usingWebAudio))return l.state==="running"&&l.ctx.state!=="interrupted"&&l._suspendTimer?(clearTimeout(l._suspendTimer),l._suspendTimer=null):l.state==="suspended"||l.state==="running"&&l.ctx.state==="interrupted"?(l.ctx.resume().then(function(){l.state="running";for(var h=0;h<l._howls.length;h++)l._howls[h]._emit("resume")}),l._suspendTimer&&(clearTimeout(l._suspendTimer),l._suspendTimer=null)):l.state==="suspending"&&(l._resumeAfterSuspend=!0),l}};var t=new e,n=function(l){var h=this;if(!l.src||l.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}h.init(l)};n.prototype={init:function(l){var h=this;return t.ctx||d(),h._autoplay=l.autoplay||!1,h._format=typeof l.format!="string"?l.format:[l.format],h._html5=l.html5||!1,h._muted=l.mute||!1,h._loop=l.loop||!1,h._pool=l.pool||5,h._preload=typeof l.preload=="boolean"||l.preload==="metadata"?l.preload:!0,h._rate=l.rate||1,h._sprite=l.sprite||{},h._src=typeof l.src!="string"?l.src:[l.src],h._volume=l.volume!==void 0?l.volume:1,h._xhr={method:l.xhr&&l.xhr.method?l.xhr.method:"GET",headers:l.xhr&&l.xhr.headers?l.xhr.headers:null,withCredentials:l.xhr&&l.xhr.withCredentials?l.xhr.withCredentials:!1},h._duration=0,h._state="unloaded",h._sounds=[],h._endTimers={},h._queue=[],h._playLock=!1,h._onend=l.onend?[{fn:l.onend}]:[],h._onfade=l.onfade?[{fn:l.onfade}]:[],h._onload=l.onload?[{fn:l.onload}]:[],h._onloaderror=l.onloaderror?[{fn:l.onloaderror}]:[],h._onplayerror=l.onplayerror?[{fn:l.onplayerror}]:[],h._onpause=l.onpause?[{fn:l.onpause}]:[],h._onplay=l.onplay?[{fn:l.onplay}]:[],h._onstop=l.onstop?[{fn:l.onstop}]:[],h._onmute=l.onmute?[{fn:l.onmute}]:[],h._onvolume=l.onvolume?[{fn:l.onvolume}]:[],h._onrate=l.onrate?[{fn:l.onrate}]:[],h._onseek=l.onseek?[{fn:l.onseek}]:[],h._onunlock=l.onunlock?[{fn:l.onunlock}]:[],h._onresume=[],h._webAudio=t.usingWebAudio&&!h._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(h),h._autoplay&&h._queue.push({event:"play",action:function(){h.play()}}),h._preload&&h._preload!=="none"&&h.load(),h},load:function(){var l=this,h=null;if(t.noAudio){l._emit("loaderror",null,"No audio support.");return}typeof l._src=="string"&&(l._src=[l._src]);for(var f=0;f<l._src.length;f++){var p,g;if(l._format&&l._format[f])p=l._format[f];else{if(g=l._src[f],typeof g!="string"){l._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}p=/^data:audio\/([^;,]+);/i.exec(g),p||(p=/\.([^.]+)$/.exec(g.split("?",1)[0])),p&&(p=p[1].toLowerCase())}if(p||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),p&&t.codecs(p)){h=l._src[f];break}}if(!h){l._emit("loaderror",null,"No codec support for selected audio sources.");return}return l._src=h,l._state="loading",window.location.protocol==="https:"&&h.slice(0,5)==="http:"&&(l._html5=!0,l._webAudio=!1),new i(l),l._webAudio&&r(l),l},play:function(l,h){var f=this,p=null;if(typeof l=="number")p=l,l=null;else{if(typeof l=="string"&&f._state==="loaded"&&!f._sprite[l])return null;if(typeof l>"u"&&(l="__default",!f._playLock)){for(var g=0,m=0;m<f._sounds.length;m++)f._sounds[m]._paused&&!f._sounds[m]._ended&&(g++,p=f._sounds[m]._id);g===1?l=null:p=null}}var v=p?f._soundById(p):f._inactiveSound();if(!v)return null;if(p&&!l&&(l=v._sprite||"__default"),f._state!=="loaded"){v._sprite=l,v._ended=!1;var _=v._id;return f._queue.push({event:"play",action:function(){f.play(_)}}),_}if(p&&!v._paused)return h||f._loadQueue("play"),v._id;f._webAudio&&t._autoResume();var y=Math.max(0,v._seek>0?v._seek:f._sprite[l][0]/1e3),x=Math.max(0,(f._sprite[l][0]+f._sprite[l][1])/1e3-y),M=x*1e3/Math.abs(v._rate),S=f._sprite[l][0]/1e3,A=(f._sprite[l][0]+f._sprite[l][1])/1e3;v._sprite=l,v._ended=!1;var T=function(){v._paused=!1,v._seek=y,v._start=S,v._stop=A,v._loop=!!(v._loop||f._sprite[l][2])};if(y>=A){f._ended(v);return}var b=v._node;if(f._webAudio){var w=function(){f._playLock=!1,T(),f._refreshBuffer(v);var H=v._muted||f._muted?0:v._volume;b.gain.setValueAtTime(H,t.ctx.currentTime),v._playStart=t.ctx.currentTime,typeof b.bufferSource.start>"u"?v._loop?b.bufferSource.noteGrainOn(0,y,86400):b.bufferSource.noteGrainOn(0,y,x):v._loop?b.bufferSource.start(0,y,86400):b.bufferSource.start(0,y,x),M!==1/0&&(f._endTimers[v._id]=setTimeout(f._ended.bind(f,v),M)),h||setTimeout(function(){f._emit("play",v._id),f._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?w():(f._playLock=!0,f.once("resume",w),f._clearTimer(v._id))}else{var P=function(){b.currentTime=y,b.muted=v._muted||f._muted||t._muted||b.muted,b.volume=v._volume*t.volume(),b.playbackRate=v._rate;try{var H=b.play();if(H&&typeof Promise<"u"&&(H instanceof Promise||typeof H.then=="function")?(f._playLock=!0,T(),H.then(function(){f._playLock=!1,b._unlocked=!0,h?f._loadQueue():f._emit("play",v._id)}).catch(function(){f._playLock=!1,f._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),v._ended=!0,v._paused=!0})):h||(f._playLock=!1,T(),f._emit("play",v._id)),b.playbackRate=v._rate,b.paused){f._emit("playerror",v._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}l!=="__default"||v._loop?f._endTimers[v._id]=setTimeout(f._ended.bind(f,v),M):(f._endTimers[v._id]=function(){f._ended(v),b.removeEventListener("ended",f._endTimers[v._id],!1)},b.addEventListener("ended",f._endTimers[v._id],!1))}catch(G){f._emit("playerror",v._id,G)}};b.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(b.src=f._src,b.load());var N=window&&window.ejecta||!b.readyState&&t._navigator.isCocoonJS;if(b.readyState>=3||N)P();else{f._playLock=!0,f._state="loading";var I=function(){f._state="loaded",P(),b.removeEventListener(t._canPlayEvent,I,!1)};b.addEventListener(t._canPlayEvent,I,!1),f._clearTimer(v._id)}}return v._id},pause:function(l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"pause",action:function(){h.pause(l)}}),h;for(var f=h._getSoundIds(l),p=0;p<f.length;p++){h._clearTimer(f[p]);var g=h._soundById(f[p]);if(g&&!g._paused&&(g._seek=h.seek(f[p]),g._rateSeek=0,g._paused=!0,h._stopFade(f[p]),g._node))if(h._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),h._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||h._emit("pause",g?g._id:null)}return h},stop:function(l,h){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"stop",action:function(){f.stop(l)}}),f;for(var p=f._getSoundIds(l),g=0;g<p.length;g++){f._clearTimer(p[g]);var m=f._soundById(p[g]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,f._stopFade(p[g]),m._node&&(f._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),f._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&f._clearSound(m._node))),h||f._emit("stop",m._id))}return f},mute:function(l,h){var f=this;if(f._state!=="loaded"||f._playLock)return f._queue.push({event:"mute",action:function(){f.mute(l,h)}}),f;if(typeof h>"u")if(typeof l=="boolean")f._muted=l;else return f._muted;for(var p=f._getSoundIds(h),g=0;g<p.length;g++){var m=f._soundById(p[g]);m&&(m._muted=l,m._interval&&f._stopFade(m._id),f._webAudio&&m._node?m._node.gain.setValueAtTime(l?0:m._volume,t.ctx.currentTime):m._node&&(m._node.muted=t._muted?!0:l),f._emit("mute",m._id))}return f},volume:function(){var l=this,h=arguments,f,p;if(h.length===0)return l._volume;if(h.length===1||h.length===2&&typeof h[1]>"u"){var g=l._getSoundIds(),m=g.indexOf(h[0]);m>=0?p=parseInt(h[0],10):f=parseFloat(h[0])}else h.length>=2&&(f=parseFloat(h[0]),p=parseInt(h[1],10));var v;if(typeof f<"u"&&f>=0&&f<=1){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"volume",action:function(){l.volume.apply(l,h)}}),l;typeof p>"u"&&(l._volume=f),p=l._getSoundIds(p);for(var _=0;_<p.length;_++)v=l._soundById(p[_]),v&&(v._volume=f,h[2]||l._stopFade(p[_]),l._webAudio&&v._node&&!v._muted?v._node.gain.setValueAtTime(f,t.ctx.currentTime):v._node&&!v._muted&&(v._node.volume=f*t.volume()),l._emit("volume",v._id))}else return v=p?l._soundById(p):l._sounds[0],v?v._volume:0;return l},fade:function(l,h,f,p){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(l,h,f,p)}}),g;l=Math.min(Math.max(0,parseFloat(l)),1),h=Math.min(Math.max(0,parseFloat(h)),1),f=parseFloat(f),g.volume(l,p);for(var m=g._getSoundIds(p),v=0;v<m.length;v++){var _=g._soundById(m[v]);if(_){if(p||g._stopFade(m[v]),g._webAudio&&!_._muted){var y=t.ctx.currentTime,x=y+f/1e3;_._volume=l,_._node.gain.setValueAtTime(l,y),_._node.gain.linearRampToValueAtTime(h,x)}g._startFadeInterval(_,l,h,f,m[v],typeof p>"u")}}return g},_startFadeInterval:function(l,h,f,p,g,m){var v=this,_=h,y=f-h,x=Math.abs(y/.01),M=Math.max(4,x>0?p/x:p),S=Date.now();l._fadeTo=f,l._interval=setInterval(function(){var A=(Date.now()-S)/p;S=Date.now(),_+=y*A,_=Math.round(_*100)/100,y<0?_=Math.max(f,_):_=Math.min(f,_),v._webAudio?l._volume=_:v.volume(_,l._id,!0),m&&(v._volume=_),(f<h&&_<=f||f>h&&_>=f)&&(clearInterval(l._interval),l._interval=null,l._fadeTo=null,v.volume(f,l._id),v._emit("fade",l._id))},M)},_stopFade:function(l){var h=this,f=h._soundById(l);return f&&f._interval&&(h._webAudio&&f._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(f._interval),f._interval=null,h.volume(f._fadeTo,l),f._fadeTo=null,h._emit("fade",l)),h},loop:function(){var l=this,h=arguments,f,p,g;if(h.length===0)return l._loop;if(h.length===1)if(typeof h[0]=="boolean")f=h[0],l._loop=f;else return g=l._soundById(parseInt(h[0],10)),g?g._loop:!1;else h.length===2&&(f=h[0],p=parseInt(h[1],10));for(var m=l._getSoundIds(p),v=0;v<m.length;v++)g=l._soundById(m[v]),g&&(g._loop=f,l._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=f,f&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,l.playing(m[v])&&(l.pause(m[v],!0),l.play(m[v],!0)))));return l},rate:function(){var l=this,h=arguments,f,p;if(h.length===0)p=l._sounds[0]._id;else if(h.length===1){var g=l._getSoundIds(),m=g.indexOf(h[0]);m>=0?p=parseInt(h[0],10):f=parseFloat(h[0])}else h.length===2&&(f=parseFloat(h[0]),p=parseInt(h[1],10));var v;if(typeof f=="number"){if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"rate",action:function(){l.rate.apply(l,h)}}),l;typeof p>"u"&&(l._rate=f),p=l._getSoundIds(p);for(var _=0;_<p.length;_++)if(v=l._soundById(p[_]),v){l.playing(p[_])&&(v._rateSeek=l.seek(p[_]),v._playStart=l._webAudio?t.ctx.currentTime:v._playStart),v._rate=f,l._webAudio&&v._node&&v._node.bufferSource?v._node.bufferSource.playbackRate.setValueAtTime(f,t.ctx.currentTime):v._node&&(v._node.playbackRate=f);var y=l.seek(p[_]),x=(l._sprite[v._sprite][0]+l._sprite[v._sprite][1])/1e3-y,M=x*1e3/Math.abs(v._rate);(l._endTimers[p[_]]||!v._paused)&&(l._clearTimer(p[_]),l._endTimers[p[_]]=setTimeout(l._ended.bind(l,v),M)),l._emit("rate",v._id)}}else return v=l._soundById(p),v?v._rate:l._rate;return l},seek:function(){var l=this,h=arguments,f,p;if(h.length===0)l._sounds.length&&(p=l._sounds[0]._id);else if(h.length===1){var g=l._getSoundIds(),m=g.indexOf(h[0]);m>=0?p=parseInt(h[0],10):l._sounds.length&&(p=l._sounds[0]._id,f=parseFloat(h[0]))}else h.length===2&&(f=parseFloat(h[0]),p=parseInt(h[1],10));if(typeof p>"u")return 0;if(typeof f=="number"&&(l._state!=="loaded"||l._playLock))return l._queue.push({event:"seek",action:function(){l.seek.apply(l,h)}}),l;var v=l._soundById(p);if(v)if(typeof f=="number"&&f>=0){var _=l.playing(p);_&&l.pause(p,!0),v._seek=f,v._ended=!1,l._clearTimer(p),!l._webAudio&&v._node&&!isNaN(v._node.duration)&&(v._node.currentTime=f);var y=function(){_&&l.play(p,!0),l._emit("seek",p)};if(_&&!l._webAudio){var x=function(){l._playLock?setTimeout(x,0):y()};setTimeout(x,0)}else y()}else if(l._webAudio){var M=l.playing(p)?t.ctx.currentTime-v._playStart:0,S=v._rateSeek?v._rateSeek-v._seek:0;return v._seek+(S+M*Math.abs(v._rate))}else return v._node.currentTime;return l},playing:function(l){var h=this;if(typeof l=="number"){var f=h._soundById(l);return f?!f._paused:!1}for(var p=0;p<h._sounds.length;p++)if(!h._sounds[p]._paused)return!0;return!1},duration:function(l){var h=this,f=h._duration,p=h._soundById(l);return p&&(f=h._sprite[p._sprite][1]/1e3),f},state:function(){return this._state},unload:function(){for(var l=this,h=l._sounds,f=0;f<h.length;f++)h[f]._paused||l.stop(h[f]._id),l._webAudio||(l._clearSound(h[f]._node),h[f]._node.removeEventListener("error",h[f]._errorFn,!1),h[f]._node.removeEventListener(t._canPlayEvent,h[f]._loadFn,!1),h[f]._node.removeEventListener("ended",h[f]._endFn,!1),t._releaseHtml5Audio(h[f]._node)),delete h[f]._node,l._clearTimer(h[f]._id);var p=t._howls.indexOf(l);p>=0&&t._howls.splice(p,1);var g=!0;for(f=0;f<t._howls.length;f++)if(t._howls[f]._src===l._src||l._src.indexOf(t._howls[f]._src)>=0){g=!1;break}return s&&g&&delete s[l._src],t.noAudio=!1,l._state="unloaded",l._sounds=[],l=null,null},on:function(l,h,f,p){var g=this,m=g["_on"+l];return typeof h=="function"&&m.push(p?{id:f,fn:h,once:p}:{id:f,fn:h}),g},off:function(l,h,f){var p=this,g=p["_on"+l],m=0;if(typeof h=="number"&&(f=h,h=null),h||f)for(m=0;m<g.length;m++){var v=f===g[m].id;if(h===g[m].fn&&v||!h&&v){g.splice(m,1);break}}else if(l)p["_on"+l]=[];else{var _=Object.keys(p);for(m=0;m<_.length;m++)_[m].indexOf("_on")===0&&Array.isArray(p[_[m]])&&(p[_[m]]=[])}return p},once:function(l,h,f){var p=this;return p.on(l,h,f,1),p},_emit:function(l,h,f){for(var p=this,g=p["_on"+l],m=g.length-1;m>=0;m--)(!g[m].id||g[m].id===h||l==="load")&&(setTimeout((function(v){v.call(this,h,f)}).bind(p,g[m].fn),0),g[m].once&&p.off(l,g[m].fn,g[m].id));return p._loadQueue(l),p},_loadQueue:function(l){var h=this;if(h._queue.length>0){var f=h._queue[0];f.event===l&&(h._queue.shift(),h._loadQueue()),l||f.action()}return h},_ended:function(l){var h=this,f=l._sprite;if(!h._webAudio&&l._node&&!l._node.paused&&!l._node.ended&&l._node.currentTime<l._stop)return setTimeout(h._ended.bind(h,l),100),h;var p=!!(l._loop||h._sprite[f][2]);if(h._emit("end",l._id),!h._webAudio&&p&&h.stop(l._id,!0).play(l._id),h._webAudio&&p){h._emit("play",l._id),l._seek=l._start||0,l._rateSeek=0,l._playStart=t.ctx.currentTime;var g=(l._stop-l._start)*1e3/Math.abs(l._rate);h._endTimers[l._id]=setTimeout(h._ended.bind(h,l),g)}return h._webAudio&&!p&&(l._paused=!0,l._ended=!0,l._seek=l._start||0,l._rateSeek=0,h._clearTimer(l._id),h._cleanBuffer(l._node),t._autoSuspend()),!h._webAudio&&!p&&h.stop(l._id,!0),h},_clearTimer:function(l){var h=this;if(h._endTimers[l]){if(typeof h._endTimers[l]!="function")clearTimeout(h._endTimers[l]);else{var f=h._soundById(l);f&&f._node&&f._node.removeEventListener("ended",h._endTimers[l],!1)}delete h._endTimers[l]}return h},_soundById:function(l){for(var h=this,f=0;f<h._sounds.length;f++)if(l===h._sounds[f]._id)return h._sounds[f];return null},_inactiveSound:function(){var l=this;l._drain();for(var h=0;h<l._sounds.length;h++)if(l._sounds[h]._ended)return l._sounds[h].reset();return new i(l)},_drain:function(){var l=this,h=l._pool,f=0,p=0;if(!(l._sounds.length<h)){for(p=0;p<l._sounds.length;p++)l._sounds[p]._ended&&f++;for(p=l._sounds.length-1;p>=0;p--){if(f<=h)return;l._sounds[p]._ended&&(l._webAudio&&l._sounds[p]._node&&l._sounds[p]._node.disconnect(0),l._sounds.splice(p,1),f--)}}},_getSoundIds:function(l){var h=this;if(typeof l>"u"){for(var f=[],p=0;p<h._sounds.length;p++)f.push(h._sounds[p]._id);return f}else return[l]},_refreshBuffer:function(l){var h=this;return l._node.bufferSource=t.ctx.createBufferSource(),l._node.bufferSource.buffer=s[h._src],l._panner?l._node.bufferSource.connect(l._panner):l._node.bufferSource.connect(l._node),l._node.bufferSource.loop=l._loop,l._loop&&(l._node.bufferSource.loopStart=l._start||0,l._node.bufferSource.loopEnd=l._stop||0),l._node.bufferSource.playbackRate.setValueAtTime(l._rate,t.ctx.currentTime),h},_cleanBuffer:function(l){var h=this,f=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!l.bufferSource)return h;if(t._scratchBuffer&&l.bufferSource&&(l.bufferSource.onended=null,l.bufferSource.disconnect(0),f))try{l.bufferSource.buffer=t._scratchBuffer}catch{}return l.bufferSource=null,h},_clearSound:function(l){var h=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);h||(l.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(l){this._parent=l,this.init()};i.prototype={init:function(){var l=this,h=l._parent;return l._muted=h._muted,l._loop=h._loop,l._volume=h._volume,l._rate=h._rate,l._seek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++t._counter,h._sounds.push(l),l.create(),l},create:function(){var l=this,h=l._parent,f=t._muted||l._muted||l._parent._muted?0:l._volume;return h._webAudio?(l._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),l._node.gain.setValueAtTime(f,t.ctx.currentTime),l._node.paused=!0,l._node.connect(t.masterGain)):t.noAudio||(l._node=t._obtainHtml5Audio(),l._errorFn=l._errorListener.bind(l),l._node.addEventListener("error",l._errorFn,!1),l._loadFn=l._loadListener.bind(l),l._node.addEventListener(t._canPlayEvent,l._loadFn,!1),l._endFn=l._endListener.bind(l),l._node.addEventListener("ended",l._endFn,!1),l._node.src=h._src,l._node.preload=h._preload===!0?"auto":h._preload,l._node.volume=f*t.volume(),l._node.load()),l},reset:function(){var l=this,h=l._parent;return l._muted=h._muted,l._loop=h._loop,l._volume=h._volume,l._rate=h._rate,l._seek=0,l._rateSeek=0,l._paused=!0,l._ended=!0,l._sprite="__default",l._id=++t._counter,l},_errorListener:function(){var l=this;l._parent._emit("loaderror",l._id,l._node.error?l._node.error.code:0),l._node.removeEventListener("error",l._errorFn,!1)},_loadListener:function(){var l=this,h=l._parent;h._duration=Math.ceil(l._node.duration*10)/10,Object.keys(h._sprite).length===0&&(h._sprite={__default:[0,h._duration*1e3]}),h._state!=="loaded"&&(h._state="loaded",h._emit("load"),h._loadQueue()),l._node.removeEventListener(t._canPlayEvent,l._loadFn,!1)},_endListener:function(){var l=this,h=l._parent;h._duration===1/0&&(h._duration=Math.ceil(l._node.duration*10)/10,h._sprite.__default[1]===1/0&&(h._sprite.__default[1]=h._duration*1e3),h._ended(l)),l._node.removeEventListener("ended",l._endFn,!1)}};var s={},r=function(l){var h=l._src;if(s[h]){l._duration=s[h].duration,u(l);return}if(/^data:[^;]+;base64,/.test(h)){for(var f=atob(h.split(",")[1]),p=new Uint8Array(f.length),g=0;g<f.length;++g)p[g]=f.charCodeAt(g);c(p.buffer,l)}else{var m=new XMLHttpRequest;m.open(l._xhr.method,h,!0),m.withCredentials=l._xhr.withCredentials,m.responseType="arraybuffer",l._xhr.headers&&Object.keys(l._xhr.headers).forEach(function(v){m.setRequestHeader(v,l._xhr.headers[v])}),m.onload=function(){var v=(m.status+"")[0];if(v!=="0"&&v!=="2"&&v!=="3"){l._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}c(m.response,l)},m.onerror=function(){l._webAudio&&(l._html5=!0,l._webAudio=!1,l._sounds=[],delete s[h],l.load())},a(m)}},a=function(l){try{l.send()}catch{l.onerror()}},c=function(l,h){var f=function(){h._emit("loaderror",null,"Decoding audio data failed.")},p=function(g){g&&h._sounds.length>0?(s[h._src]=g,u(h,g)):f()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(l).then(p).catch(f):t.ctx.decodeAudioData(l,p,f)},u=function(l,h){h&&!l._duration&&(l._duration=h.duration),Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue())},d=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var l=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),h=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),f=h?parseInt(h[1],10):null;if(l&&f&&f<9){var p=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!p&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};o.Howler=t,o.Howl=n,typeof go<"u"?(go.HowlerGlobal=e,go.Howler=t,go.Howl=n,go.Sound=i):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=i)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var i=n._howls.length-1;i>=0;i--)n._howls[i].stereo(t);return n},HowlerGlobal.prototype.pos=function(t,n,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(n=typeof n!="number"?s._pos[1]:n,i=typeof i!="number"?s._pos[2]:i,typeof t=="number")s._pos=[t,n,i],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(t,n,i,s,r,a){var c=this;if(!c.ctx||!c.ctx.listener)return c;var u=c._orientation;if(n=typeof n!="number"?u[1]:n,i=typeof i!="number"?u[2]:i,s=typeof s!="number"?u[3]:s,r=typeof r!="number"?u[4]:r,a=typeof a!="number"?u[5]:a,typeof t=="number")c._orientation=[t,n,i,s,r,a],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(a,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(t,n,i,s,r,a);else return u;return c},Howl.prototype.init=function(t){return function(n){var i=this;return i._orientation=n.orientation||[1,0,0],i._stereo=n.stereo||null,i._pos=n.pos||null,i._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},i._onstereo=n.onstereo?[{fn:n.onstereo}]:[],i._onpos=n.onpos?[{fn:n.onpos}]:[],i._onorientation=n.onorientation?[{fn:n.onorientation}]:[],t.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(t,n)}}),i;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof t=="number")i._stereo=t,i._pos=[t,0,0];else return i._stereo;for(var r=i._getSoundIds(n),a=0;a<r.length;a++){var c=i._soundById(r[a]);if(c)if(typeof t=="number")c._stereo=t,c._pos=[t,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&e(c,s),s==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(t,0,0):c._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),i._emit("stereo",c._id);else return c._stereo}return i},Howl.prototype.pos=function(t,n,i,s){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"pos",action:function(){r.pos(t,n,i,s)}}),r;if(n=typeof n!="number"?0:n,i=typeof i!="number"?-.5:i,typeof s>"u")if(typeof t=="number")r._pos=[t,n,i];else return r._pos;for(var a=r._getSoundIds(s),c=0;c<a.length;c++){var u=r._soundById(a[c]);if(u)if(typeof t=="number")u._pos=[t,n,i],u._node&&((!u._panner||u._panner.pan)&&e(u,"spatial"),typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):u._panner.setPosition(t,n,i)),r._emit("pos",u._id);else return u._pos}return r},Howl.prototype.orientation=function(t,n,i,s){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"orientation",action:function(){r.orientation(t,n,i,s)}}),r;if(n=typeof n!="number"?r._orientation[1]:n,i=typeof i!="number"?r._orientation[2]:i,typeof s>"u")if(typeof t=="number")r._orientation=[t,n,i];else return r._orientation;for(var a=r._getSoundIds(s),c=0;c<a.length;c++){var u=r._soundById(a[c]);if(u)if(typeof t=="number")u._orientation=[t,n,i],u._node&&(u._panner||(u._pos||(u._pos=r._pos||[0,0,-.5]),e(u,"spatial")),typeof u._panner.orientationX<"u"?(u._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),u._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),u._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):u._panner.setOrientation(t,n,i)),r._emit("orientation",u._id);else return u._orientation}return r},Howl.prototype.pannerAttr=function(){var t=this,n=arguments,i,s,r;if(!t._webAudio)return t;if(n.length===0)return t._pannerAttr;if(n.length===1)if(typeof n[0]=="object")i=n[0],typeof s>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),t._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:t._panningModel});else return r=t._soundById(parseInt(n[0],10)),r?r._pannerAttr:t._pannerAttr;else n.length===2&&(i=n[0],s=parseInt(n[1],10));for(var a=t._getSoundIds(s),c=0;c<a.length;c++)if(r=t._soundById(a[c]),r){var u=r._pannerAttr;u={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:u.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:u.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:u.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:u.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:u.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:u.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:u.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:u.panningModel};var d=r._panner;d||(r._pos||(r._pos=t._pos||[0,0,-.5]),e(r,"spatial"),d=r._panner),d.coneInnerAngle=u.coneInnerAngle,d.coneOuterAngle=u.coneOuterAngle,d.coneOuterGain=u.coneOuterGain,d.distanceModel=u.distanceModel,d.maxDistance=u.maxDistance,d.refDistance=u.refDistance,d.rolloffFactor=u.rolloffFactor,d.panningModel=u.panningModel}return t},Sound.prototype.init=function(t){return function(){var n=this,i=n._parent;n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,t.call(this),n._stereo?i.stereo(n._stereo):n._pos&&i.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var n=this,i=n._parent;return n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,n._stereo?i.stereo(n._stereo):n._pos?i.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,i._refreshBuffer(n)),t.call(this)}}(Sound.prototype.reset);var e=function(t,n){n=n||"spatial",n==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(hi);class rA{constructor(e){this.time=e.time,this.debug=e.debug,this.debug&&(this.debugFolder=this.debug.addFolder("sounds")),this.items=[],this.setSettings(),this.setMasterVolume(),this.setMute(),this.setEngine()}setSettings(){this.settings=[{name:"reveal",sounds:["./sounds/reveal/reveal-1.mp3"],minDelta:100,velocityMin:0,velocityMultiplier:1,volumeMin:1,volumeMax:1,rateMin:1,rateMax:1},{name:"brick",sounds:["./sounds/bricks/brick-1.mp3","./sounds/bricks/brick-2.mp3","./sounds/bricks/brick-4.mp3","./sounds/bricks/brick-6.mp3","./sounds/bricks/brick-7.mp3","./sounds/bricks/brick-8.mp3"],minDelta:100,velocityMin:1,velocityMultiplier:.75,volumeMin:.2,volumeMax:.85,rateMin:.5,rateMax:.75},{name:"bowlingPin",sounds:["./sounds/bowling/pin-1.mp3"],minDelta:0,velocityMin:1,velocityMultiplier:.5,volumeMin:.35,volumeMax:1,rateMin:.1,rateMax:.85},{name:"bowlingBall",sounds:["./sounds/bowling/pin-1.mp3","./sounds/bowling/pin-1.mp3","./sounds/bowling/pin-1.mp3"],minDelta:0,velocityMin:1,velocityMultiplier:.5,volumeMin:.35,volumeMax:1,rateMin:.1,rateMax:.2},{name:"carHit",sounds:["./sounds/car-hits/car-hit-1.mp3","./sounds/car-hits/car-hit-3.mp3","./sounds/car-hits/car-hit-4.mp3","./sounds/car-hits/car-hit-5.mp3"],minDelta:100,velocityMin:2,velocityMultiplier:1,volumeMin:.2,volumeMax:.6,rateMin:.35,rateMax:.55},{name:"woodHit",sounds:["./sounds/wood-hits/wood-hit-1.mp3"],minDelta:30,velocityMin:1,velocityMultiplier:1,volumeMin:.5,volumeMax:1,rateMin:.75,rateMax:1.5},{name:"screech",sounds:["./sounds/screeches/screech-1.mp3"],minDelta:1e3,velocityMin:0,velocityMultiplier:1,volumeMin:.75,volumeMax:1,rateMin:.9,rateMax:1.1},{name:"uiArea",sounds:["./sounds/ui/area-1.mp3"],minDelta:100,velocityMin:0,velocityMultiplier:1,volumeMin:.75,volumeMax:1,rateMin:.95,rateMax:1.05},{name:"carHorn1",sounds:["./sounds/car-horns/car-horn-1.mp3"],minDelta:0,velocityMin:0,velocityMultiplier:1,volumeMin:.95,volumeMax:1,rateMin:1,rateMax:1},{name:"carHorn2",sounds:["./sounds/car-horns/car-horn-2.mp3"],minDelta:0,velocityMin:0,velocityMultiplier:1,volumeMin:.95,volumeMax:1,rateMin:1,rateMax:1},{name:"horn",sounds:["./sounds/horns/horn-1.mp3","./sounds/horns/horn-2.mp3","./sounds/horns/horn-3.mp3"],minDelta:100,velocityMin:1,velocityMultiplier:.75,volumeMin:.5,volumeMax:1,rateMin:.75,rateMax:1}];for(const e of this.settings)this.add(e)}setMasterVolume(){this.masterVolume=.5,hi.Howler.volume(this.masterVolume),window.requestAnimationFrame(()=>{hi.Howler.volume(this.masterVolume)}),this.debug&&this.debugFolder.add(this,"masterVolume").step(.001).min(0).max(1).onChange(()=>{hi.Howler.volume(this.masterVolume)})}setMute(){this.muted=typeof this.debug<"u",hi.Howler.mute(this.muted),window.addEventListener("keydown",e=>{e.key==="m"&&(this.muted=!this.muted,hi.Howler.mute(this.muted))}),document.addEventListener("visibilitychange",()=>{document.hidden?hi.Howler.mute(!0):hi.Howler.mute(this.muted)}),this.debug&&this.debugFolder.add(this,"muted").listen().onChange(()=>{hi.Howler.mute(this.muted)})}setEngine(){if(this.engine={},this.engine.progress=0,this.engine.progressEasingUp=.3,this.engine.progressEasingDown=.15,this.engine.speed=0,this.engine.speedMultiplier=2.5,this.engine.acceleration=0,this.engine.accelerationMultiplier=.4,this.engine.rate={},this.engine.rate.min=.4,this.engine.rate.max=1.4,this.engine.volume={},this.engine.volume.min=.4,this.engine.volume.max=1,this.engine.volume.master=0,this.engine.sound=new hi.Howl({src:["./sounds/engines/1/low_off.mp3"],loop:!0}),this.engine.sound.play(),this.time.on("tick",()=>{let e=Math.abs(this.engine.speed)*this.engine.speedMultiplier+Math.max(this.engine.acceleration,0)*this.engine.accelerationMultiplier;e=Math.min(Math.max(e,0),1),this.engine.progress+=(e-this.engine.progress)*this.engine[e>this.engine.progress?"progressEasingUp":"progressEasingDown"];const t=this.engine.rate.max-this.engine.rate.min;this.engine.sound.rate(this.engine.rate.min+t*this.engine.progress);const n=this.engine.volume.max-this.engine.volume.min;this.engine.sound.volume((this.engine.volume.min+n*this.engine.progress)*this.engine.volume.master)}),this.debug){const e=this.debugFolder.addFolder("engine");e.open(),e.add(this.engine,"progressEasingUp").step(.001).min(0).max(1).name("progressEasingUp"),e.add(this.engine,"progressEasingDown").step(.001).min(0).max(1).name("progressEasingDown"),e.add(this.engine.rate,"min").step(.001).min(0).max(4).name("rateMin"),e.add(this.engine.rate,"max").step(.001).min(0).max(4).name("rateMax"),e.add(this.engine,"speedMultiplier").step(.01).min(0).max(5).name("speedMultiplier"),e.add(this.engine,"accelerationMultiplier").step(.01).min(0).max(100).name("accelerationMultiplier"),e.add(this.engine,"progress").step(.01).min(0).max(1).name("progress").listen()}}add(e){const t={name:e.name,minDelta:e.minDelta,velocityMin:e.velocityMin,velocityMultiplier:e.velocityMultiplier,volumeMin:e.volumeMin,volumeMax:e.volumeMax,rateMin:e.rateMin,rateMax:e.rateMax,lastTime:0,sounds:[]};for(const n of e.sounds){const i=new hi.Howl({src:[n]});t.sounds.push(i)}this.items.push(t)}play(e,t){const n=this.items.find(r=>r.name===e),i=Date.now(),s=typeof t>"u"?0:t;if(n&&i>n.lastTime+n.minDelta&&(n.velocityMin===0||s>n.velocityMin)){const r=n.sounds[Math.floor(Math.random()*n.sounds.length)];let a=Math.min(Math.max((s-n.velocityMin)*n.velocityMultiplier,n.volumeMin),n.volumeMax);a=Math.pow(a,2),r.volume(a);const c=n.rateMax-n.rateMin;r.rate(n.rateMin+Math.random()*c),r.play(),n.lastTime=i}}}class oA{constructor(e){this.resources=e.resources,this.car=e.car,this.walls=e.walls,this.objects=e.objects,this.materials=e.materials,this.areas=e.areas,this.config=e.config,this.physics=e.physics,this.container=new et,this.container.matrixAutoUpdate=!1,this.setKonamiCode(),this.setWigs()}setKonamiCode(){this.konamiCode={},this.konamiCode.x=-60,this.konamiCode.y=-100,this.konamiCode.sequence=["ArrowUp","ArrowUp","ArrowDown","ArrowDown","ArrowLeft","ArrowRight","ArrowLeft","ArrowRight"],this.config.touch||this.konamiCode.sequence.push("b","a"),this.konamiCode.keyIndex=0,this.konamiCode.latestKeys=[],this.konamiCode.count=0,this.config.touch?this.konamiCode.labelTexture=this.resources.items.konamiLabelTouchTexture:this.konamiCode.labelTexture=this.resources.items.konamiLabelTexture,this.konamiCode.labelTexture.magFilter=Bt,this.konamiCode.labelTexture.minFilter=Vt,this.konamiCode.label=new Se(new ln(8,8/16),new Mt({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.konamiCode.labelTexture})),this.konamiCode.label.position.x=this.konamiCode.x+5,this.konamiCode.label.position.y=this.konamiCode.y,this.konamiCode.label.matrixAutoUpdate=!1,this.konamiCode.label.updateMatrix(),this.container.add(this.konamiCode.label),this.konamiCode.lemonOption={base:this.resources.items.lemonBase.scene,collision:this.resources.items.lemonCollision.scene,offset:new D(0,0,0),rotation:new ht(Math.PI*.5,-Math.PI*.3,0),duplicated:!0,shadow:{sizeX:1.2,sizeY:1.8,offsetZ:-.15,alpha:.35},mass:.5,sleep:!0,soundName:"woodHit"},this.objects.add({...this.konamiCode.lemonOption,offset:new D(this.konamiCode.x,this.konamiCode.y,.4)}),this.konamiCode.testInput=e=>{if(this.konamiCode.latestKeys.push(e),this.konamiCode.latestKeys.length>this.konamiCode.sequence.length&&this.konamiCode.latestKeys.shift(),this.konamiCode.sequence.toString()===this.konamiCode.latestKeys.toString()){this.konamiCode.count++;for(let t=0;t<Math.pow(3,this.konamiCode.count);t++)window.setTimeout(()=>{const n=this.car.chassis.object.position.x+(Math.random()-.5)*10,i=this.car.chassis.object.position.y+(Math.random()-.5)*10;this.objects.add({...this.konamiCode.lemonOption,offset:new D(n,i,10),rotation:new ht(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),sleep:!1})},t*50)}},window.addEventListener("keydown",e=>{this.konamiCode.testInput(e.key)}),this.konamiCode.touch={},this.konamiCode.touch.x=0,this.konamiCode.touch.y=0,this.konamiCode.touch.touchstart=e=>{window.addEventListener("touchend",this.konamiCode.touch.touchend),this.konamiCode.touch.x=e.changedTouches[0].clientX,this.konamiCode.touch.y=e.changedTouches[0].clientY},this.konamiCode.touch.touchend=e=>{window.removeEventListener("touchend",this.konamiCode.touch.touchend);const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,i=t-this.konamiCode.touch.x,s=n-this.konamiCode.touch.y;if(Math.hypot(i,s)>30){const a=Math.atan2(s,i);let c=null;a<-Math.PI*.75?c="ArrowLeft":a<-Math.PI*.25?c="ArrowUp":a<Math.PI*.25?c="ArrowRight":a<Math.PI*.75?c="ArrowDown":c="ArrowLeft",this.konamiCode.testInput(c)}},window.addEventListener("touchstart",this.konamiCode.touch.touchstart)}setWigs(){this.wigs={},this.wigs.currentWig=null,this.wigs.container=new et,this.wigs.container.position.x=-.1,this.wigs.container.position.y=-30,this.wigs.container.matrixAutoUpdate=!1,this.wigs.container.updateMatrix(),this.container.add(this.wigs.container),this.wigs.materials=[this.materials.shades.items.green,this.materials.shades.items.red,this.materials.shades.items.emeraldGreen,this.materials.shades.items.purple,this.materials.shades.items.yellow,this.materials.shades.items.white],this.wigs.list=[this.resources.items.wig1,this.resources.items.wig2,this.resources.items.wig3,this.resources.items.wig4],this.wigs.items=[];for(const e of this.wigs.list){const t=new et;t.visible=!1,t.matrixAutoUpdate=!1,this.wigs.container.add(t);const n=[...e.scene.children];for(const i of n)i.material=this.wigs.materials[0],t.add(i);this.wigs.items.push(t)}this.wigs.change=()=>{this.wigs.currentWig&&(this.wigs.currentWig.visible=!1);let e=null;do e=this.wigs.items[Math.floor(Math.random()*this.wigs.items.length)];while(this.wigs.currentWig===e);this.wigs.currentWig=e,this.wigs.currentWig.visible=!0;const t=this.wigs.materials[Math.floor(Math.random()*this.wigs.materials.length)];for(const n of this.wigs.currentWig.children)n.material=t},this.wigs.area=this.areas.add({position:new Fe(0,80),halfExtents:new Fe(2,2)}),this.wigs.area.on("interact",this.wigs.change),this.resources.items.areaQuestionMarkTexture.magFilter=Bt,this.resources.items.areaQuestionMarkTexture.minFilter=Vt,this.wigs.areaLabel=new Se(new ln(1,1),new Mt({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.resources.items.areaQuestionMarkTexture})),this.wigs.areaLabel.position.x=0,this.wigs.areaLabel.position.y=80,this.wigs.areaLabel.matrixAutoUpdate=!1,this.wigs.areaLabel.updateMatrix(),this.container.add(this.wigs.areaLabel)}}class aA{constructor(e){this.config=e.config,this.debug=e.debug,this.resources=e.resources,this.time=e.time,this.sizes=e.sizes,this.camera=e.camera,this.scene=e.scene,this.renderer=e.renderer,this.passes=e.passes,this.debug&&(this.debugFolder=this.debug.addFolder("world"),this.debugFolder.open()),this.container=new et,this.container.matrixAutoUpdate=!1,this.setSounds(),this.setControls(),this.setFloor(),this.setAreas(),this.setStartingScreen()}start(){window.setTimeout(()=>{this.camera.pan.enable()},2e3),this.setReveal(),this.setMaterials(),this.setShadows(),this.setPhysics(),this.setZones(),this.setObjects(),this.setCar(),this.areas.car=this.car,this.setTiles(),this.setWalls(),this.setSections(),this.setEasterEggs()}setReveal(){this.reveal={},this.reveal.matcapsProgress=0,this.reveal.floorShadowsProgress=0,this.reveal.previousMatcapsProgress=null,this.reveal.previousFloorShadowsProgress=null,this.reveal.go=()=>{ut.fromTo(this.reveal,{matcapsProgress:0},{matcapsProgress:1,duration:3}),ut.fromTo(this.reveal,{floorShadowsProgress:0},{floorShadowsProgress:1,duration:3,delay:.5}),ut.fromTo(this.shadows,{alpha:0},{alpha:.5,duration:3,delay:.5}),this.sections.intro&&(ut.fromTo(this.sections.intro.instructions.arrows.label.material,{opacity:0},{opacity:1,duration:.3,delay:.5}),this.sections.intro.otherInstructions&&ut.fromTo(this.sections.intro.otherInstructions.label.material,{opacity:0},{opacity:1,duration:.3,delay:.75})),this.physics.car.chassis.body.sleep(),this.physics.car.chassis.body.position.set(0,0,12),window.setTimeout(()=>{this.physics.car.chassis.body.wakeUp()},300),ut.fromTo(this.sounds.engine.volume,{master:0},{master:.7,duration:.5,delay:.3,ease:"power2.in"}),window.setTimeout(()=>{this.sounds.play("reveal")},400),this.controls.touch&&window.setTimeout(()=>{this.controls.touch.reveal()},400)},this.time.on("tick",()=>{if(this.reveal.matcapsProgress!==this.reveal.previousMatcapsProgress){for(const e in this.materials.shades.items){const t=this.materials.shades.items[e];t.uniforms.uRevealProgress.value=this.reveal.matcapsProgress}this.reveal.previousMatcapsProgress=this.reveal.matcapsProgress}if(this.reveal.floorShadowsProgress!==this.reveal.previousFloorShadowsProgress){for(const e of this.objects.floorShadows)e.material.uniforms.uAlpha.value=this.reveal.floorShadowsProgress;this.reveal.previousFloorShadowsProgress=this.reveal.floorShadowsProgress}}),this.debug&&(this.debugFolder.add(this.reveal,"matcapsProgress").step(1e-4).min(0).max(1).name("matcapsProgress"),this.debugFolder.add(this.reveal,"floorShadowsProgress").step(1e-4).min(0).max(1).name("floorShadowsProgress"),this.debugFolder.add(this.reveal,"go").name("reveal"))}setStartingScreen(){this.startingScreen={},this.startingScreen.area=this.areas.add({position:new Fe(0,0),halfExtents:new Fe(2.35,1.5),hasKey:!1,testCar:!1,active:!1}),this.startingScreen.loadingLabel={},this.startingScreen.loadingLabel.geometry=new ln(2.5,2.5/4),this.startingScreen.loadingLabel.image=new Image,this.startingScreen.loadingLabel.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABABAMAAAAHc7SNAAAAMFBMVEUAAAD///9ra2ucnJzR0dH09PQmJiaNjY24uLjp6end3d1CQkLFxcVYWFiqqqp9fX3nQ5qrAAAEVUlEQVRo3u3YT08TQRQA8JEtW6CATGnDdvljaTwYE2IBI/HGRrwSetGTsZh4MPFQYiQe229gE++WePFY9Oqh1cRzieEDYIgXLxjPJu5M33vbZQszW+fgoS+B7ewO836znRl2lg1jGMP4P2Okw0yFvaKsklr3I99Tvl3iPPelGbQhKqxB4eN6N/7gVcsvbEAz1F4RLn67zzl/v6/oLvejGBQ9LsNphio4UFjmEAsVJuOK/zkDtc6w+gyTcZ3LyP6IAzjBDA+pj6LkEgAjW4kANsMAC6vmOvqAMU5RgVOTskQACicCmCcA9AXjkT5gj1MswqlxWcoTgKJ6HuAQAD5guNoAu8QpMnBul1ONMGD2PCBbRgDAKYq6AEtmXvtdj3S6GhRyW1t1DvkAgM0ggG7mu1t3xWFHFzAqv3wYCi0mY1UCGgiQPU+1oWIY8LoXcAA3qeYfr+kClvHW14PJ5OfCAgHYNAoDAORBQIrDvHjqH5c0ANTbORzBacbAQgUC2IAKAzI9gCSHlWEMLmgBPJxMvyARpIICALDm4nkAbwIA71EZx5UOgO48JnLoOhQIAN9sOgKoBoAE5r0aB8ARcNhtFzrg0VQmwCp8CAMeAADGc44S5GMBsF1aCEU2LcAcAPDCvwFytBDehCaUgJxRAKeF8BNUUQJ43iiAUlqwFKoBrTCAHjiagwEgU0YM5IYWYD4KoIgPwIXQwUbVgCXzgLpIBJNeDciWTQNskVsq1ADX/6kYBdCTjse5owbMiX+IpgGWOCPSuWpA2vN/TAMm5QTYg5IC4FdbMA0YF5Nb5s2rAaLyhzBgektGZWDArrgqi0U1QHxf38OABDwUDgTAjGfyPlTVgJT/67FBACbqyGYaaoBctQwD2vI4DecVAPkgZRhQlxPQks2rAePGAbZsRlaa1QBYEQBUHRCAmaXD0QDYxgFWdye05R9cDQCrmQYkeBA6gGXTgNEeQF4DMG4S4MLjOUZRA5A0CcjADgmjqgGwSwSg9wK1GIBS74KTgTxv/EHoiaVQsTOS5RoCJuiZyosB8EIrHpyowFiYofO0i4wCjhCQwL0hq2sCaFNM22S4JXloLk0AuLDTBzCBAAt3xykeA7CHe/mDbgdTvQ9GswSAwdbqA0giYASHjQUJnhQKhQ6z/d8rDA4hAG2Dsk042ejubHMM2nV6AMf93pCkaRjhh0WsWuz+6aasl2FwiAImReEts1/CSaFfwFouAJxC4RW+I4oCThBQE1X2WbKkBFDkqYDtJ0SHaYKq3pJJwCECjjiFPoC1w+2P0gumurgeBjT6AhIIGKOelGIAngWlFnRnMZjMIYBb7gtIIsAuYU+8GICpEhYyZVgIZ2g9rYYAX1lfAKvjnxzjnWrHALDn9K1h2k2aoI1ewGd2AWAVAVMHcKdW4wDYje739pNufJXhkJohgLu9zy4CHCKAJYUge4ddCojGyPrp9kaHmYjUi9N7+2wYwxjGZfEXMKxGE0GkkfIAAAAASUVORK5CYII=",this.startingScreen.loadingLabel.texture=new qt(this.startingScreen.loadingLabel.image),this.startingScreen.loadingLabel.texture.magFilter=Bt,this.startingScreen.loadingLabel.texture.minFilter=Vt,this.startingScreen.loadingLabel.texture.needsUpdate=!0,this.startingScreen.loadingLabel.material=new Mt({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.startingScreen.loadingLabel.texture}),this.startingScreen.loadingLabel.mesh=new Se(this.startingScreen.loadingLabel.geometry,this.startingScreen.loadingLabel.material),this.startingScreen.loadingLabel.mesh.matrixAutoUpdate=!1,this.container.add(this.startingScreen.loadingLabel.mesh),this.startingScreen.startLabel={},this.startingScreen.startLabel.geometry=new ln(2.5,2.5/4),this.startingScreen.startLabel.image=new Image,this.startingScreen.startLabel.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAABABAMAAAAHc7SNAAAAMFBMVEUAAAD///+cnJxra2vR0dHd3d0mJib09PRYWFjp6em4uLhCQkKqqqqNjY19fX3FxcV3XeRgAAADsklEQVRo3u3YsU9TQRwH8KNgLSDQg9ZCAak1IdE4PKPu1NTEsSzOMDl3I3GpcXAxBhLjXFxNjJgQJ2ON0Rnj4uAAEyv8B/L7tV++5/VN+CM69Ldwfa+534d7d793VzeIQQzi/49c4v5lPF/1vvhFm++rjIpcyErrmrSCuz+cxng1iL/If8drPJD2Lc/Iy4VhaZWlFd4tLPfuMc6e/5LvRilJA2SkVSQA8c0OsI0uNtIAU9rsB8y1rAAZjyimAUa1mQDAeGwF+MA+9lIA69qs9AMKVoDP8vhf35A+NiMAc7YJKFSrX7tcI8BW9+k/O/kz6zSunjSnncMHiQYBcmdXrh3xCVbc2WO8N/YZZI0AxxwMArKivmwAwFKSPmV0UwBbCpj5E+C+yzUbQAaJVwUSA9SFjwFgHQ0jAMrBWgzAPCtHgFFbQAlpEwKC2zWUQgJGbAH+naSdu/fTxQAthPL5/ADD6OCpQwCAsb6LsbEGcBluOAYBmG2fkMIawHVWXEsDIGUGpZCAIRsAS93DPgDbhUmUQgKe2NUB90hfhK0YwEJYHkYpJGDbqBKiB86CGLAlzd6/S8CEvh8sACiBvrSXCshKblWEgNy2vkAMAHwGfjECcJHOu5qUQgDm6vXulshZAXJNL9GJAeg+LxeKPQBj1gzgdlnuCWAhbOi7LwaU9u0A2VWPpUgAC+GR5k0iwBtnB3Bj3qMaRYB17X0IOQhYcjYA7guxxyIAGfd1HNqchPfly7aACQUshAA2W1r5G1yG415YpgB3qIIkAHBH2D075QnQ10fHDsCl+CoGSKpiN8kMAVqIN00BsitnVgKyPIBMB4ADKU92AA5BKQIgszjKBGBLagpwB5xZBGS6pbcuizQAXMA6NAK86OCQ3okAI55BQPe7VoDxXzU/iwPASgS4GAASAiYxWgYAzvAa1loA2AkAFQIU2zEELCJtDDgIAG0CFLvp7LblC2kAtF6eTEJJ2CBAr88bAXKY4WkASbzXmwt5AvTvohHA4WSUBmj2Jt+IThQChrAOLQC13vPFMAOAQwuyTAeAKVQto3OBDOdESh2YxNZPbpYBQNbEAoBfod7e1i1BiwB0voSZWgwAOWgtAGPhD18E8ASIiRIAXNPwXJBtcqMbAFAIr5weIJMAcIx1aAAIqk0lAuycompyFwBMHAsAZlj/lgw0rsy2AkhbsgK4Q+70CUBjxeFXsUb0G1HJDJC9rketZRcCWCJwHM8DgJm7b7ch+XizXm25QQxiEOcXvwGCWOhbCZC0qAAAAABJRU5ErkJggg==",this.startingScreen.startLabel.texture=new qt(this.startingScreen.startLabel.image),this.startingScreen.startLabel.texture.magFilter=Bt,this.startingScreen.startLabel.texture.minFilter=Vt,this.startingScreen.startLabel.texture.needsUpdate=!0,this.startingScreen.startLabel.material=new Mt({transparent:!0,depthWrite:!1,color:16777215,alphaMap:this.startingScreen.startLabel.texture}),this.startingScreen.startLabel.material.opacity=0,this.startingScreen.startLabel.mesh=new Se(this.startingScreen.startLabel.geometry,this.startingScreen.startLabel.material),this.startingScreen.startLabel.mesh.matrixAutoUpdate=!1,this.container.add(this.startingScreen.startLabel.mesh),this.resources.on("progress",e=>{this.startingScreen.area.floorBorder.material.uniforms.uAlpha.value=1,this.startingScreen.area.floorBorder.material.uniforms.uLoadProgress.value=e}),this.resources.on("ready",()=>{window.requestAnimationFrame(()=>{this.startingScreen.area.activate(),ut.to(this.startingScreen.area.floorBorder.material.uniforms.uAlpha,{value:.3,duration:.3}),ut.to(this.startingScreen.loadingLabel.material,{opacity:0,duration:.3}),ut.to(this.startingScreen.startLabel.material,{opacity:1,duration:.3,delay:.3})})}),this.startingScreen.area.on("interact",()=>{this.startingScreen.area.deactivate(),ut.to(this.startingScreen.area.floorBorder.material.uniforms.uProgress,{value:0,duration:.3,delay:.4}),ut.to(this.startingScreen.startLabel.material,{opacity:0,duration:.3,delay:.4}),this.start(),window.setTimeout(()=>{this.reveal.go()},600)})}setSounds(){this.sounds=new rA({debug:this.debugFolder,time:this.time})}setAxes(){this.axis=new Cb,this.container.add(this.axis)}setControls(){this.controls=new sA({config:this.config,sizes:this.sizes,time:this.time,camera:this.camera,sounds:this.sounds})}setMaterials(){this.materials=new sM({resources:this.resources,debug:this.debugFolder})}setFloor(){this.floor=new lM({debug:this.debugFolder}),this.container.add(this.floor.container)}setShadows(){this.shadows=new yM({time:this.time,debug:this.debugFolder,renderer:this.renderer,camera:this.camera}),this.container.add(this.shadows.container)}setPhysics(){this.physics=new bM({config:this.config,debug:this.debug,scene:this.scene,time:this.time,sizes:this.sizes,controls:this.controls,sounds:this.sounds}),this.container.add(this.physics.models.container)}setZones(){this.zones=new SM({time:this.time,physics:this.physics,debug:this.debugFolder}),this.container.add(this.zones.container)}setAreas(){this.areas=new ZS({config:this.config,resources:this.resources,debug:this.debug,renderer:this.renderer,camera:this.camera,car:this.car,sounds:this.sounds,time:this.time}),this.container.add(this.areas.container)}setTiles(){this.tiles=new QS({resources:this.resources,objects:this.objects,debug:this.debug})}setWalls(){this.walls=new JS({resources:this.resources,objects:this.objects})}setObjects(){this.objects=new EM({time:this.time,resources:this.resources,materials:this.materials,physics:this.physics,shadows:this.shadows,sounds:this.sounds,debug:this.debugFolder}),this.container.add(this.objects.container)}setCar(){this.car=new TM({time:this.time,resources:this.resources,objects:this.objects,physics:this.physics,shadows:this.shadows,materials:this.materials,controls:this.controls,sounds:this.sounds,renderer:this.renderer,camera:this.camera,debug:this.debugFolder,config:this.config}),this.container.add(this.car.container)}setSections(){this.sections={};const e={config:this.config,time:this.time,resources:this.resources,camera:this.camera,passes:this.passes,objects:this.objects,areas:this.areas,zones:this.zones,walls:this.walls,tiles:this.tiles,debug:this.debugFolder};this.sections.intro=new eA({...e,x:0,y:0}),this.container.add(this.sections.intro.container),this.sections.information=new tA({...e,x:1.2,y:-20}),this.container.add(this.sections.information.container)}setEasterEggs(){this.easterEggs=new oA({resources:this.resources,car:this.car,walls:this.walls,objects:this.objects,materials:this.materials,areas:this.areas,config:this.config,physics:this.physics}),this.container.add(this.easterEggs.container)}}class lA extends Ci{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new fA(t)}),this.register(function(t){return new pA(t)}),this.register(function(t){return new MA(t)}),this.register(function(t){return new SA(t)}),this.register(function(t){return new AA(t)}),this.register(function(t){return new gA(t)}),this.register(function(t){return new vA(t)}),this.register(function(t){return new _A(t)}),this.register(function(t){return new yA(t)}),this.register(function(t){return new dA(t)}),this.register(function(t){return new xA(t)}),this.register(function(t){return new mA(t)}),this.register(function(t){return new bA(t)}),this.register(function(t){return new wA(t)}),this.register(function(t){return new hA(t)}),this.register(function(t){return new EA(t)}),this.register(function(t){return new TA(t)})}load(e,t,n,i){const s=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const u=Nr.extractUrlBase(e);r=Nr.resolveURL(u,this.path)}else r=Nr.extractUrlBase(e);this.manager.itemStart(e);const a=function(u){i?i(u):console.error(u),s.manager.itemError(e),s.manager.itemEnd(e)},c=new zo(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(u){try{s.parse(u,r,function(d){t(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},n,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,i){let s;const r={},a={},c=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===Bm){try{r[_t.KHR_BINARY_GLTF]=new CA(e)}catch(l){i&&i(l);return}s=JSON.parse(r[_t.KHR_BINARY_GLTF].content)}else s=JSON.parse(c.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new VA(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const l=this.pluginCallbacks[d](u);l.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[l.name]=l,r[l.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const l=s.extensionsUsed[d],h=s.extensionsRequired||[];switch(l){case _t.KHR_MATERIALS_UNLIT:r[l]=new uA;break;case _t.KHR_DRACO_MESH_COMPRESSION:r[l]=new RA(s,this.dracoLoader);break;case _t.KHR_TEXTURE_TRANSFORM:r[l]=new PA;break;case _t.KHR_MESH_QUANTIZATION:r[l]=new LA;break;default:h.indexOf(l)>=0&&a[l]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+l+'".')}}u.setExtensions(r),u.setPlugins(a),u.parse(n,i)}parseAsync(e,t){const n=this;return new Promise(function(i,s){n.parse(e,t,i,s)})}}function cA(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const _t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class hA{constructor(e){this.parser=e,this.name=_t.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,i=t.length;n<i;n++){const s=t[n];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let i=t.cache.get(n);if(i)return i;const s=t.json,c=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let u;const d=new He(16777215);c.color!==void 0&&d.setRGB(c.color[0],c.color[1],c.color[2],_n);const l=c.range!==void 0?c.range:0;switch(c.type){case"directional":u=new Rp(d),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new Gc(d),u.distance=l;break;case"spot":u=new Cp(d),u.distance=l,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,u.angle=c.spot.outerConeAngle,u.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return u.position.set(0,0,0),u.decay=2,ls(u,c),c.intensity!==void 0&&(u.intensity=c.intensity),u.name=t.createUniqueName(c.name||"light_"+e),i=Promise.resolve(u),t.cache.add(n,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,n=this.parser,s=n.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return n._getNodeRef(t.cache,a,c)})}}class uA{constructor(){this.name=_t.KHR_MATERIALS_UNLIT}getMaterialType(){return Mt}extendParams(e,t,n){const i=[];e.color=new He(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const r=s.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],_n),e.opacity=r[3]}s.baseColorTexture!==void 0&&i.push(n.assignTexture(e,"map",s.baseColorTexture,sn))}return Promise.all(i)}}class dA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class fA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(s.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Fe(a,a)}return Promise.all(s)}}class pA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_DISPERSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class mA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&s.push(n.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class gA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_SHEEN}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new He(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],_n)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&s.push(n.assignTexture(t,"sheenColorMap",r.sheenColorTexture,sn)),r.sheenRoughnessTexture!==void 0&&s.push(n.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class vA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&s.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class _A{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_VOLUME}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&s.push(n.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new He().setRGB(a[0],a[1],a[2],_n),Promise.all(s)}}class yA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_IOR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class xA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_SPECULAR}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&s.push(n.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new He().setRGB(a[0],a[1],a[2],_n),r.specularColorTexture!==void 0&&s.push(n.assignTexture(t,"specularColorMap",r.specularColorTexture,sn)),Promise.all(s)}}class wA{constructor(e){this.parser=e,this.name=_t.EXT_MATERIALS_BUMP}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&s.push(n.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}}class bA{constructor(e){this.parser=e,this.name=_t.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const n=this.parser.json.materials[e];return!n.extensions||!n.extensions[this.name]?null:Li}extendMaterialParams(e,t){const n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&s.push(n.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class MA{constructor(e){this.parser=e,this.name=_t.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}}class SA{constructor(e){this.parser=e,this.name=_t.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let c=n.textureLoader;if(a.uri){const u=n.options.manager.getHandler(a.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,r.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class AA{constructor(e){this.parser=e,this.name=_t.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let c=n.textureLoader;if(a.uri){const u=n.options.manager.getHandler(a.uri);u!==null&&(c=u)}return this.detectSupport().then(function(u){if(u)return n.loadTextureImage(e,r.source,c);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class EA{constructor(e){this.name=_t.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const c=i.byteOffset||0,u=i.byteLength||0,d=i.count,l=i.byteStride,h=new Uint8Array(a,c,u);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(d,l,h,i.mode,i.filter).then(function(f){return f.buffer}):r.ready.then(function(){const f=new ArrayBuffer(d*l);return r.decodeGltfBuffer(new Uint8Array(f),d,l,h,i.mode,i.filter),f})})}else return null}}class TA{constructor(e){this.name=_t.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,n=t.nodes[e];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const i=t.meshes[n.mesh];for(const u of i.primitives)if(u.mode!==ti.TRIANGLES&&u.mode!==ti.TRIANGLE_STRIP&&u.mode!==ti.TRIANGLE_FAN&&u.mode!==void 0)return null;const r=n.extensions[this.name].attributes,a=[],c={};for(const u in r)a.push(this.parser.getDependency("accessor",r[u]).then(d=>(c[u]=d,c[u])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(u=>{const d=u.pop(),l=d.isGroup?d.children:[d],h=u[0].count,f=[];for(const p of l){const g=new Ye,m=new D,v=new Lt,_=new D(1,1,1),y=new Iw(p.geometry,p.material,h);for(let x=0;x<h;x++)c.TRANSLATION&&m.fromBufferAttribute(c.TRANSLATION,x),c.ROTATION&&v.fromBufferAttribute(c.ROTATION,x),c.SCALE&&_.fromBufferAttribute(c.SCALE,x),y.setMatrixAt(x,g.compose(m,v,_));for(const x in c)if(x==="_COLOR_0"){const M=c[x];y.instanceColor=new Bc(M.array,M.itemSize,M.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&p.geometry.setAttribute(x,c[x]);et.prototype.copy.call(y,p),this.parser.assignFinalMaterial(y),f.push(y)}return d.isGroup?(d.clear(),d.add(...f),d):f[0]}))}}const Bm="glTF",_o=12,Pf={JSON:1313821514,BIN:5130562};class CA{constructor(e){this.name=_t.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,_o),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Bm)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-_o,s=new DataView(e,_o);let r=0;for(;r<i;){const a=s.getUint32(r,!0);r+=4;const c=s.getUint32(r,!0);if(r+=4,c===Pf.JSON){const u=new Uint8Array(e,_o+r,a);this.content=n.decode(u)}else if(c===Pf.BIN){const u=_o+r;this.body=e.slice(u,u+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class RA{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=_t.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},c={},u={};for(const d in r){const l=dh[d]||d.toLowerCase();a[l]=r[d]}for(const d in e.attributes){const l=dh[d]||d.toLowerCase();if(r[d]!==void 0){const h=n.accessors[e.attributes[d]],f=zr[h.componentType];u[l]=f.name,c[l]=h.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(l,h){i.decodeDracoFile(d,function(f){for(const p in f.attributes){const g=f.attributes[p],m=c[p];m!==void 0&&(g.normalized=m)}l(f)},a,u,_n,h)})})}}class PA{constructor(){this.name=_t.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class LA{constructor(){this.name=_t.KHR_MESH_QUANTIZATION}}class Um extends Jo{constructor(e,t,n,i){super(e,t,n,i)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let r=0;r!==i;r++)t[r]=n[s+r];return t}interpolate_(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,u=a*3,d=i-t,l=(n-t)/d,h=l*l,f=h*l,p=e*u,g=p-u,m=-2*f+3*h,v=f-h,_=1-m,y=v-h+l;for(let x=0;x!==a;x++){const M=r[g+x+a],S=r[g+x+c]*d,A=r[p+x+a],T=r[p+x]*d;s[x]=_*M+y*S+m*A+v*T}return s}}const IA=new Lt;class DA extends Um{interpolate_(e,t,n,i){const s=super.interpolate_(e,t,n,i);return IA.fromArray(s).normalize().toArray(s),s}}const ti={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},zr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Lf={9728:Bt,9729:Vt,9984:Wf,9985:Ha,9986:yo,9987:Gi},If={33071:Si,33648:Za,10497:vs},Mc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},dh={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},rs={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},FA={CUBICSPLINE:void 0,LINEAR:Wr,STEP:ko},Sc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function kA(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new wl({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:qi})),o.DefaultMaterial}function ks(o,e,t){for(const n in t.extensions)o[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function ls(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function NA(o,e,t){let n=!1,i=!1,s=!1;for(let u=0,d=e.length;u<d;u++){const l=e[u];if(l.POSITION!==void 0&&(n=!0),l.NORMAL!==void 0&&(i=!0),l.COLOR_0!==void 0&&(s=!0),n&&i&&s)break}if(!n&&!i&&!s)return Promise.resolve(o);const r=[],a=[],c=[];for(let u=0,d=e.length;u<d;u++){const l=e[u];if(n){const h=l.POSITION!==void 0?t.getDependency("accessor",l.POSITION):o.attributes.position;r.push(h)}if(i){const h=l.NORMAL!==void 0?t.getDependency("accessor",l.NORMAL):o.attributes.normal;a.push(h)}if(s){const h=l.COLOR_0!==void 0?t.getDependency("accessor",l.COLOR_0):o.attributes.color;c.push(h)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(u){const d=u[0],l=u[1],h=u[2];return n&&(o.morphAttributes.position=d),i&&(o.morphAttributes.normal=l),s&&(o.morphAttributes.color=h),o.morphTargetsRelative=!0,o})}function OA(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let n=0,i=t.length;n<i;n++)o.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function BA(o){let e;const t=o.extensions&&o.extensions[_t.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+Ac(t.attributes):e=o.indices+":"+Ac(o.attributes)+":"+o.mode,o.targets!==void 0)for(let n=0,i=o.targets.length;n<i;n++)e+=":"+Ac(o.targets[n]);return e}function Ac(o){let e="";const t=Object.keys(o).sort();for(let n=0,i=t.length;n<i;n++)e+=t[n]+":"+o[t[n]]+";";return e}function fh(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function UA(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const zA=new Ye;class VA{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new cA,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,i=!1,s=-1;typeof navigator<"u"&&(n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||n||i&&s<98?this.textureLoader=new Tp(this.options.manager):this.textureLoader=new gb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new zo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:n,userData:{}};return ks(s,a,i),ls(a,i),Promise.all(n._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){for(const c of a.scenes)c.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i].joints;for(let a=0,c=r.length;a<c;a++)e[r[a]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(n[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const i=n.clone(),s=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[u,d]of r.children.entries())s(d,a.children[u])};return s(n,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const i=e(t[n]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&n.push(s)}return n}getDependency(e,t){const n=e+":"+t;let i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(n,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,r){return n.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[_t.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,r){n.load(Nr.resolveURL(t.uri,i.path),s,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const i=t.byteLength||0,s=t.byteOffset||0;return n.slice(s,s+i)})}loadAccessor(e){const t=this,n=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=Mc[i.type],a=zr[i.componentType],c=i.normalized===!0,u=new a(i.count*r);return Promise.resolve(new an(u,r,c))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(r){const a=r[0],c=Mc[i.type],u=zr[i.componentType],d=u.BYTES_PER_ELEMENT,l=d*c,h=i.byteOffset||0,f=i.bufferView!==void 0?n.bufferViews[i.bufferView].byteStride:void 0,p=i.normalized===!0;let g,m;if(f&&f!==l){const v=Math.floor(h/f),_="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+v+":"+i.count;let y=t.cache.get(_);y||(g=new u(a,v*f,i.count*f/d),y=new Cw(g,f/d),t.cache.add(_,y)),m=new bh(y,c,h%f/d,p)}else a===null?g=new u(i.count*c):g=new u(a,h,i.count*c),m=new an(g,c,p);if(i.sparse!==void 0){const v=Mc.SCALAR,_=zr[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,x=i.sparse.values.byteOffset||0,M=new _(r[1],y,i.sparse.count*v),S=new u(r[2],x,i.sparse.count*c);a!==null&&(m=new an(m.array.slice(),m.itemSize,m.normalized));for(let A=0,T=M.length;A<T;A++){const b=M[A];if(m.setX(b,S[A*c]),c>=2&&m.setY(b,S[A*c+1]),c>=3&&m.setZ(b,S[A*c+2]),c>=4&&m.setW(b,S[A*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return m})}loadTexture(e){const t=this.json,n=this.options,s=t.textures[e].source,r=t.images[s];let a=this.textureLoader;if(r.uri){const c=n.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,n){const i=this,s=this.json,r=s.textures[e],a=s.images[t],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const u=this.loadImageSource(t,n).then(function(d){d.flipY=!1,d.name=r.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const h=(s.samplers||{})[r.sampler]||{};return d.magFilter=Lf[h.magFilter]||Vt,d.minFilter=Lf[h.minFilter]||Gi,d.wrapS=If[h.wrapS]||vs,d.wrapT=If[h.wrapT]||vs,i.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[c]=u,u}loadImageSource(e,t){const n=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(l=>l.clone());const r=i.images[e],a=self.URL||self.webkitURL;let c=r.uri||"",u=!1;if(r.bufferView!==void 0)c=n.getDependency("bufferView",r.bufferView).then(function(l){u=!0;const h=new Blob([l],{type:r.mimeType});return c=a.createObjectURL(h),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(c).then(function(l){return new Promise(function(h,f){let p=h;t.isImageBitmapLoader===!0&&(p=function(g){const m=new qt(g);m.needsUpdate=!0,h(m)}),t.load(Nr.resolveURL(l,s.path),p,void 0,f)})}).then(function(l){return u===!0&&a.revokeObjectURL(c),l.userData.mimeType=r.mimeType||UA(r.uri),l}).catch(function(l){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),l});return this.sourceCache[e]=d,d}assignTexture(e,t,n,i){const s=this;return this.getDependency("texture",n.index).then(function(r){if(!r)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(r=r.clone(),r.channel=n.texCoord),s.extensions[_t.KHR_TEXTURE_TRANSFORM]){const a=n.extensions!==void 0?n.extensions[_t.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=s.associations.get(r);r=s.extensions[_t.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),s.associations.set(r,c)}}return i!==void 0&&(r.colorSpace=i),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new xp,Kn.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,c.sizeAttenuation=!1,this.cache.add(a,c)),n=c}else if(e.isLine){const a="LineBasicMaterial:"+n.uuid;let c=this.cache.get(a);c||(c=new eo,Kn.prototype.copy.call(c,n),c.color.copy(n.color),c.map=n.map,this.cache.add(a,c)),n=c}if(i||s||r){let a="ClonedMaterial:"+n.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=n.clone(),s&&(c.vertexColors=!0),r&&(c.flatShading=!0),i&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(n))),n=c}e.material=n}getMaterialType(){return wl}loadMaterial(e){const t=this,n=this.json,i=this.extensions,s=n.materials[e];let r;const a={},c=s.extensions||{},u=[];if(c[_t.KHR_MATERIALS_UNLIT]){const l=i[_t.KHR_MATERIALS_UNLIT];r=l.getMaterialType(),u.push(l.extendParams(a,s,t))}else{const l=s.pbrMetallicRoughness||{};if(a.color=new He(1,1,1),a.opacity=1,Array.isArray(l.baseColorFactor)){const h=l.baseColorFactor;a.color.setRGB(h[0],h[1],h[2],_n),a.opacity=h[3]}l.baseColorTexture!==void 0&&u.push(t.assignTexture(a,"map",l.baseColorTexture,sn)),a.metalness=l.metallicFactor!==void 0?l.metallicFactor:1,a.roughness=l.roughnessFactor!==void 0?l.roughnessFactor:1,l.metallicRoughnessTexture!==void 0&&(u.push(t.assignTexture(a,"metalnessMap",l.metallicRoughnessTexture)),u.push(t.assignTexture(a,"roughnessMap",l.metallicRoughnessTexture))),r=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),u.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=qn);const d=s.alphaMode||Sc.OPAQUE;if(d===Sc.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===Sc.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&r!==Mt&&(u.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Fe(1,1),s.normalTexture.scale!==void 0)){const l=s.normalTexture.scale;a.normalScale.set(l,l)}if(s.occlusionTexture!==void 0&&r!==Mt&&(u.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&r!==Mt){const l=s.emissiveFactor;a.emissive=new He().setRGB(l[0],l[1],l[2],_n)}return s.emissiveTexture!==void 0&&r!==Mt&&u.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,sn)),Promise.all(u).then(function(){const l=new r(a);return s.name&&(l.name=s.name),ls(l,s),t.associations.set(l,{materials:e}),s.extensions&&ks(i,l,s),l})}createUniqueName(e){const t=bt.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,n=this.extensions,i=this.primitiveCache;function s(a){return n[_t.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Df(c,a,t)})}const r=[];for(let a=0,c=e.length;a<c;a++){const u=e[a],d=BA(u),l=i[d];if(l)r.push(l.promise);else{let h;u.extensions&&u.extensions[_t.KHR_DRACO_MESH_COMPRESSION]?h=s(u):h=Df(new Ft,u,t),i[d]={primitive:u,promise:h},r.push(h)}}return Promise.all(r)}loadMesh(e){const t=this,n=this.json,i=this.extensions,s=n.meshes[e],r=s.primitives,a=[];for(let c=0,u=r.length;c<u;c++){const d=r[c].material===void 0?kA(this.cache):this.getDependency("material",r[c].material);a.push(d)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(c){const u=c.slice(0,c.length-1),d=c[c.length-1],l=[];for(let f=0,p=d.length;f<p;f++){const g=d[f],m=r[f];let v;const _=u[f];if(m.mode===ti.TRIANGLES||m.mode===ti.TRIANGLE_STRIP||m.mode===ti.TRIANGLE_FAN||m.mode===void 0)v=s.isSkinnedMesh===!0?new _p(g,_):new Se(g,_),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),m.mode===ti.TRIANGLE_STRIP?v.geometry=df(v.geometry,Jf):m.mode===ti.TRIANGLE_FAN&&(v.geometry=df(v.geometry,kc));else if(m.mode===ti.LINES)v=new yp(g,_);else if(m.mode===ti.LINE_STRIP)v=new Xn(g,_);else if(m.mode===ti.LINE_LOOP)v=new Dw(g,_);else if(m.mode===ti.POINTS)v=new Fw(g,_);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(v.geometry.morphAttributes).length>0&&OA(v,s),v.name=t.createUniqueName(s.name||"mesh_"+e),ls(v,s),m.extensions&&ks(i,v,m),t.assignFinalMaterial(v),l.push(v)}for(let f=0,p=l.length;f<p;f++)t.associations.set(l[f],{meshes:e,primitives:f});if(l.length===1)return s.extensions&&ks(i,l[0],s),l[0];const h=new Xi;s.extensions&&ks(i,h,s),t.associations.set(h,{meshes:e});for(let f=0,p=l.length;f<p;f++)h.add(l[f]);return h})}loadCamera(e){let t;const n=this.json.cameras[e],i=n[n.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?t=new Tn(bn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):n.type==="orthographic"&&(t=new Qo(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),ls(t,n),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],n=[];for(let i=0,s=t.joints.length;i<s;i++)n.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",t.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(i){const s=i.pop(),r=i,a=[],c=[];for(let u=0,d=r.length;u<d;u++){const l=r[u];if(l){a.push(l);const h=new Ye;s!==null&&h.fromArray(s.array,u*16),c.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[u])}return new _l(a,c)})}loadAnimation(e){const t=this.json,n=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,r=[],a=[],c=[],u=[],d=[];for(let l=0,h=i.channels.length;l<h;l++){const f=i.channels[l],p=i.samplers[f.sampler],g=f.target,m=g.node,v=i.parameters!==void 0?i.parameters[p.input]:p.input,_=i.parameters!==void 0?i.parameters[p.output]:p.output;g.node!==void 0&&(r.push(this.getDependency("node",m)),a.push(this.getDependency("accessor",v)),c.push(this.getDependency("accessor",_)),u.push(p),d.push(g))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c),Promise.all(u),Promise.all(d)]).then(function(l){const h=l[0],f=l[1],p=l[2],g=l[3],m=l[4],v=[];for(let _=0,y=h.length;_<y;_++){const x=h[_],M=f[_],S=p[_],A=g[_],T=m[_];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const b=n._createAnimationTracks(x,M,S,A,T);if(b)for(let w=0;w<b.length;w++)v.push(b[w])}return new Ep(s,void 0,v)})}createNodeMesh(e){const t=this.json,n=this,i=t.nodes[e];return i.mesh===void 0?null:n.getDependency("mesh",i.mesh).then(function(s){const r=n._getNodeRef(n.meshCache,i.mesh,s);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,u=i.weights.length;c<u;c++)a.morphTargetInfluences[c]=i.weights[c]}),r})}loadNode(e){const t=this.json,n=this,i=t.nodes[e],s=n._loadNodeShallow(e),r=[],a=i.children||[];for(let u=0,d=a.length;u<d;u++)r.push(n.getDependency("node",a[u]));const c=i.skin===void 0?Promise.resolve(null):n.getDependency("skin",i.skin);return Promise.all([s,Promise.all(r),c]).then(function(u){const d=u[0],l=u[1],h=u[2];h!==null&&d.traverse(function(f){f.isSkinnedMesh&&f.bind(h,zA)});for(let f=0,p=l.length;f<p;f++)d.add(l[f]);return d})}_loadNodeShallow(e){const t=this.json,n=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],r=s.name?i.createUniqueName(s.name):"",a=[],c=i._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(e)});return c&&a.push(c),s.camera!==void 0&&a.push(i.getDependency("camera",s.camera).then(function(u){return i._getNodeRef(i.cameraCache,s.camera,u)})),i._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(e)}).forEach(function(u){a.push(u)}),this.nodeCache[e]=Promise.all(a).then(function(u){let d;if(s.isBone===!0?d=new nl:u.length>1?d=new Xi:u.length===1?d=u[0]:d=new et,d!==u[0])for(let l=0,h=u.length;l<h;l++)d.add(u[l]);if(s.name&&(d.userData.name=s.name,d.name=r),ls(d,s),s.extensions&&ks(n,d,s),s.matrix!==void 0){const l=new Ye;l.fromArray(s.matrix),d.applyMatrix4(l)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return i.associations.has(d)||i.associations.set(d,{}),i.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,n=this.json.scenes[e],i=this,s=new Xi;n.name&&(s.name=i.createUniqueName(n.name)),ls(s,n),n.extensions&&ks(t,s,n);const r=n.nodes||[],a=[];for(let c=0,u=r.length;c<u;c++)a.push(i.getDependency("node",r[c]));return Promise.all(a).then(function(c){for(let d=0,l=c.length;d<l;d++)s.add(c[d]);const u=d=>{const l=new Map;for(const[h,f]of i.associations)(h instanceof Kn||h instanceof qt)&&l.set(h,f);return d.traverse(h=>{const f=i.associations.get(h);f!=null&&l.set(h,f)}),l};return i.associations=u(s),s})}_createAnimationTracks(e,t,n,i,s){const r=[],a=e.name?e.name:e.uuid,c=[];rs[s.path]===rs.weights?e.traverse(function(h){h.morphTargetInfluences&&c.push(h.name?h.name:h.uuid)}):c.push(a);let u;switch(rs[s.path]){case rs.weights:u=Ys;break;case rs.rotation:u=Yi;break;case rs.position:case rs.scale:u=$s;break;default:switch(n.itemSize){case 1:u=Ys;break;case 2:case 3:default:u=$s;break}break}const d=i.interpolation!==void 0?FA[i.interpolation]:Wr,l=this._getArrayFromAccessor(n);for(let h=0,f=c.length;h<f;h++){const p=new u(c[h]+"."+rs[s.path],t.array,l,d);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(p),r.push(p)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const n=fh(t.constructor),i=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s++)i[s]=t[s]*n;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(n){const i=this instanceof Yi?DA:Um;return new i(this.times,this.values,this.getValueSize()/3,n)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function HA(o,e,t){const n=e.attributes,i=new Zi;if(n.POSITION!==void 0){const a=t.json.accessors[n.POSITION],c=a.min,u=a.max;if(c!==void 0&&u!==void 0){if(i.set(new D(c[0],c[1],c[2]),new D(u[0],u[1],u[2])),a.normalized){const d=fh(zr[a.componentType]);i.min.multiplyScalar(d),i.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new D,c=new D;for(let u=0,d=s.length;u<d;u++){const l=s[u];if(l.POSITION!==void 0){const h=t.json.accessors[l.POSITION],f=h.min,p=h.max;if(f!==void 0&&p!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(p[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(p[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(p[2]))),h.normalized){const g=fh(zr[h.componentType]);c.multiplyScalar(g)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}o.boundingBox=i;const r=new Pi;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,o.boundingSphere=r}function Df(o,e,t){const n=e.attributes,i=[];function s(r,a){return t.getDependency("accessor",r).then(function(c){o.setAttribute(a,c)})}for(const r in n){const a=dh[r]||r.toLowerCase();a in o.attributes||i.push(s(n[r],a))}if(e.indices!==void 0&&!o.index){const r=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});i.push(r)}return Et.workingColorSpace!==_n&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Et.workingColorSpace}" not supported.`),ls(o,e),HA(o,e,t),Promise.all(i).then(function(){return e.targets!==void 0?NA(o,e.targets,t):o})}/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ni=Uint8Array,Ir=Uint16Array,GA=Int32Array,zm=new ni([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vm=new ni([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),WA=new ni([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hm=function(o,e){for(var t=new Ir(31),n=0;n<31;++n)t[n]=e+=1<<o[n-1];for(var i=new GA(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},Gm=Hm(zm,2),Wm=Gm.b,XA=Gm.r;Wm[28]=258,XA[258]=28;var jA=Hm(Vm,0),qA=jA.b,ph=new Ir(32768);for(var Ht=0;Ht<32768;++Ht){var os=(Ht&43690)>>1|(Ht&21845)<<1;os=(os&52428)>>2|(os&13107)<<2,os=(os&61680)>>4|(os&3855)<<4,ph[Ht]=((os&65280)>>8|(os&255)<<8)>>1}var Do=function(o,e,t){for(var n=o.length,i=0,s=new Ir(e);i<n;++i)o[i]&&++s[o[i]-1];var r=new Ir(e);for(i=1;i<e;++i)r[i]=r[i-1]+s[i-1]<<1;var a;if(t){a=new Ir(1<<e);var c=15-e;for(i=0;i<n;++i)if(o[i])for(var u=i<<4|o[i],d=e-o[i],l=r[o[i]-1]++<<d,h=l|(1<<d)-1;l<=h;++l)a[ph[l]>>c]=u}else for(a=new Ir(n),i=0;i<n;++i)o[i]&&(a[i]=ph[r[o[i]-1]++]>>15-o[i]);return a},ta=new ni(288);for(var Ht=0;Ht<144;++Ht)ta[Ht]=8;for(var Ht=144;Ht<256;++Ht)ta[Ht]=9;for(var Ht=256;Ht<280;++Ht)ta[Ht]=7;for(var Ht=280;Ht<288;++Ht)ta[Ht]=8;var Xm=new ni(32);for(var Ht=0;Ht<32;++Ht)Xm[Ht]=5;var YA=Do(ta,9,1),$A=Do(Xm,5,1),Ec=function(o){for(var e=o[0],t=1;t<o.length;++t)o[t]>e&&(e=o[t]);return e},ci=function(o,e,t){var n=e/8|0;return(o[n]|o[n+1]<<8)>>(e&7)&t},Tc=function(o,e){var t=e/8|0;return(o[t]|o[t+1]<<8|o[t+2]<<16)>>(e&7)},KA=function(o){return(o+7)/8|0},ZA=function(o,e,t){return(t==null||t>o.length)&&(t=o.length),new ni(o.subarray(e,t))},QA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ui=function(o,e,t){var n=new Error(e||QA[o]);if(n.code=o,Error.captureStackTrace&&Error.captureStackTrace(n,ui),!t)throw n;return n},JA=function(o,e,t,n){var i=o.length,s=0;if(!i||e.f&&!e.l)return t||new ni(0);var r=!t,a=r||e.i!=2,c=e.i;r&&(t=new ni(i*3));var u=function(de){var _e=t.length;if(de>_e){var Me=new ni(Math.max(_e*2,de));Me.set(t),t=Me}},d=e.f||0,l=e.p||0,h=e.b||0,f=e.l,p=e.d,g=e.m,m=e.n,v=i*8;do{if(!f){d=ci(o,l,1);var _=ci(o,l+1,3);if(l+=3,_)if(_==1)f=YA,p=$A,g=9,m=5;else if(_==2){var S=ci(o,l,31)+257,A=ci(o,l+10,15)+4,T=S+ci(o,l+5,31)+1;l+=14;for(var b=new ni(T),w=new ni(19),P=0;P<A;++P)w[WA[P]]=ci(o,l+P*3,7);l+=A*3;for(var N=Ec(w),I=(1<<N)-1,H=Do(w,N,1),P=0;P<T;){var G=H[ci(o,l,I)];l+=G&15;var y=G>>4;if(y<16)b[P++]=y;else{var J=0,U=0;for(y==16?(U=3+ci(o,l,3),l+=2,J=b[P-1]):y==17?(U=3+ci(o,l,7),l+=3):y==18&&(U=11+ci(o,l,127),l+=7);U--;)b[P++]=J}}var k=b.subarray(0,S),q=b.subarray(S);g=Ec(k),m=Ec(q),f=Do(k,g,1),p=Do(q,m,1)}else ui(1);else{var y=KA(l)+4,x=o[y-4]|o[y-3]<<8,M=y+x;if(M>i){c&&ui(0);break}a&&u(h+x),t.set(o.subarray(y,M),h),e.b=h+=x,e.p=l=M*8,e.f=d;continue}if(l>v){c&&ui(0);break}}a&&u(h+131072);for(var Y=(1<<g)-1,V=(1<<m)-1,Z=l;;Z=l){var J=f[Tc(o,l)&Y],W=J>>4;if(l+=J&15,l>v){c&&ui(0);break}if(J||ui(2),W<256)t[h++]=W;else if(W==256){Z=l,f=null;break}else{var L=W-254;if(W>264){var P=W-257,F=zm[P];L=ci(o,l,(1<<F)-1)+Wm[P],l+=F}var X=p[Tc(o,l)&V],ee=X>>4;X||ui(3),l+=X&15;var q=qA[ee];if(ee>3){var F=Vm[ee];q+=Tc(o,l)&(1<<F)-1,l+=F}if(l>v){c&&ui(0);break}a&&u(h+131072);var re=h+L;if(h<q){var K=s-q,O=Math.min(q,re);for(K+h<0&&ui(3);h<O;++h)t[h]=n[K+h]}for(;h<re;++h)t[h]=t[h-q]}}e.l=f,e.p=Z,e.b=h,e.f=d,f&&(d=1,e.m=g,e.d=p,e.n=m)}while(!d);return h!=t.length&&r?ZA(t,0,h):t.subarray(0,h)},eE=new ni(0),tE=function(o,e){return((o[0]&15)!=8||o[0]>>4>7||(o[0]<<8|o[1])%31)&&ui(6,"invalid zlib data"),(o[1]>>5&1)==+!e&&ui(6,"invalid zlib data: "+(o[1]&32?"need":"unexpected")+" dictionary"),(o[1]>>3&4)+2};function nE(o,e){return JA(o.subarray(tE(o,e),-4),{i:2},e,e)}var iE=typeof TextDecoder<"u"&&new TextDecoder,sE=0;try{iE.decode(eE,{stream:!0}),sE=1}catch{}function jm(o,e,t){const n=t.length-o-1;if(e>=t[n])return n-1;if(e<=t[o])return o;let i=o,s=n,r=Math.floor((i+s)/2);for(;e<t[r]||e>=t[r+1];)e<t[r]?s=r:i=r,r=Math.floor((i+s)/2);return r}function rE(o,e,t,n){const i=[],s=[],r=[];i[0]=1;for(let a=1;a<=t;++a){s[a]=e-n[o+1-a],r[a]=n[o+a]-e;let c=0;for(let u=0;u<a;++u){const d=r[u+1],l=s[a-u],h=i[u]/(d+l);i[u]=c+d*h,c=l*h}i[a]=c}return i}function oE(o,e,t,n){const i=jm(o,n,e),s=rE(i,n,o,e),r=new At(0,0,0,0);for(let a=0;a<=o;++a){const c=t[i-o+a],u=s[a],d=c.w*u;r.x+=c.x*d,r.y+=c.y*d,r.z+=c.z*d,r.w+=c.w*u}return r}function aE(o,e,t,n,i){const s=[];for(let l=0;l<=t;++l)s[l]=0;const r=[];for(let l=0;l<=n;++l)r[l]=s.slice(0);const a=[];for(let l=0;l<=t;++l)a[l]=s.slice(0);a[0][0]=1;const c=s.slice(0),u=s.slice(0);for(let l=1;l<=t;++l){c[l]=e-i[o+1-l],u[l]=i[o+l]-e;let h=0;for(let f=0;f<l;++f){const p=u[f+1],g=c[l-f];a[l][f]=p+g;const m=a[f][l-1]/a[l][f];a[f][l]=h+p*m,h=g*m}a[l][l]=h}for(let l=0;l<=t;++l)r[0][l]=a[l][t];for(let l=0;l<=t;++l){let h=0,f=1;const p=[];for(let g=0;g<=t;++g)p[g]=s.slice(0);p[0][0]=1;for(let g=1;g<=n;++g){let m=0;const v=l-g,_=t-g;l>=g&&(p[f][0]=p[h][0]/a[_+1][v],m=p[f][0]*a[v][_]);const y=v>=-1?1:-v,x=l-1<=_?g-1:t-l;for(let S=y;S<=x;++S)p[f][S]=(p[h][S]-p[h][S-1])/a[_+1][v+S],m+=p[f][S]*a[v+S][_];l<=_&&(p[f][g]=-p[h][g-1]/a[_+1][l],m+=p[f][g]*a[l][_]),r[g][l]=m;const M=h;h=f,f=M}}let d=t;for(let l=1;l<=n;++l){for(let h=0;h<=t;++h)r[l][h]*=d;d*=t-l}return r}function lE(o,e,t,n,i){const s=i<o?i:o,r=[],a=jm(o,n,e),c=aE(a,n,o,s,e),u=[];for(let d=0;d<t.length;++d){const l=t[d].clone(),h=l.w;l.x*=h,l.y*=h,l.z*=h,u[d]=l}for(let d=0;d<=s;++d){const l=u[a-o].clone().multiplyScalar(c[d][0]);for(let h=1;h<=o;++h)l.add(u[a-o+h].clone().multiplyScalar(c[d][h]));r[d]=l}for(let d=s+1;d<=i+1;++d)r[d]=new At(0,0,0);return r}function cE(o,e){let t=1;for(let i=2;i<=o;++i)t*=i;let n=1;for(let i=2;i<=e;++i)n*=i;for(let i=2;i<=o-e;++i)n*=i;return t/n}function hE(o){const e=o.length,t=[],n=[];for(let s=0;s<e;++s){const r=o[s];t[s]=new D(r.x,r.y,r.z),n[s]=r.w}const i=[];for(let s=0;s<e;++s){const r=t[s].clone();for(let a=1;a<=s;++a)r.sub(i[s-a].clone().multiplyScalar(cE(s,a)*n[a]));i[s]=r.divideScalar(n[0])}return i}function uE(o,e,t,n,i){const s=lE(o,e,t,n,i);return hE(s)}class dE extends kw{constructor(e,t,n,i,s){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=s||this.knots.length-1;for(let r=0;r<n.length;++r){const a=n[r];this.controlPoints[r]=new At(a.x,a.y,a.z,a.w)}}getPoint(e,t=new D){const n=t,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=oE(this.degree,this.knots,this.controlPoints,i);return s.w!==1&&s.divideScalar(s.w),n.set(s.x,s.y,s.z)}getTangent(e,t=new D){const n=t,i=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=uE(this.degree,this.knots,this.controlPoints,i,1);return n.copy(s[1]).normalize(),n}}let gt,tn,Fn;class fE extends Ci{constructor(e){super(e)}load(e,t,n,i){const s=this,r=s.path===""?Nr.extractUrlBase(e):s.path,a=new zo(this.manager);a.setPath(s.path),a.setResponseType("arraybuffer"),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(c){try{t(s.parse(c,r))}catch(u){i?i(u):console.error(u),s.manager.itemError(e)}},n,i)}parse(e,t){if(yE(e))gt=new _E().parse(e);else{const i=Km(e);if(!xE(i))throw new Error("THREE.FBXLoader: Unknown format.");if(kf(i)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+kf(i));gt=new vE().parse(i)}const n=new Tp(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new pE(n,this.manager).parse(gt)}}class pE{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){tn=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),i=this.parseDeformers(),s=new mE().parse(i);return this.parseScene(i,s,n),Fn}parseConnections(){const e=new Map;return"Connections"in gt&&gt.Connections.connections.forEach(function(n){const i=n[0],s=n[1],r=n[2];e.has(i)||e.set(i,{parents:[],children:[]});const a={ID:s,relationship:r};e.get(i).parents.push(a),e.has(s)||e.set(s,{parents:[],children:[]});const c={ID:i,relationship:r};e.get(s).children.push(c)}),e}parseImages(){const e={},t={};if("Video"in gt.Objects){const n=gt.Objects.Video;for(const i in n){const s=n[i],r=parseInt(i);if(e[r]=s.RelativeFilename||s.Filename,"Content"in s){const a=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,c=typeof s.Content=="string"&&s.Content!=="";if(a||c){const u=this.parseImage(n[i]);t[s.RelativeFilename||s.Filename]=u}}}}for(const n in e){const i=e[n];t[i]!==void 0?e[n]=t[i]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();let s;switch(i){case"bmp":s="image/bmp";break;case"jpg":case"jpeg":s="image/jpeg";break;case"png":s="image/png";break;case"tif":s="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),s="image/tga";break;default:console.warn('FBXLoader: Image type "'+i+'" is not supported.');return}if(typeof t=="string")return"data:"+s+";base64,"+t;{const r=new Uint8Array(t);return window.URL.createObjectURL(new Blob([r],{type:s}))}}parseTextures(e){const t=new Map;if("Texture"in gt.Objects){const n=gt.Objects.Texture;for(const i in n){const s=this.parseTexture(n[i],e);t.set(parseInt(i),s)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const i=e.WrapModeU,s=e.WrapModeV,r=i!==void 0?i.value:0,a=s!==void 0?s.value:0;if(n.wrapS=r===0?vs:Si,n.wrapT=a===0?vs:Si,"Scaling"in e){const c=e.Scaling.value;n.repeat.x=c[0],n.repeat.y=c[1]}if("Translation"in e){const c=e.Translation.value;n.offset.x=c[0],n.offset.y=c[1]}return n}loadTexture(e,t){let n;const i=this.textureLoader.path,s=tn.get(e.id).children;s!==void 0&&s.length>0&&t[s[0].ID]!==void 0&&(n=t[s[0].ID],(n.indexOf("blob:")===0||n.indexOf("data:")===0)&&this.textureLoader.setPath(void 0));let r;const a=e.FileName.slice(-3).toLowerCase();if(a==="tga"){const c=this.manager.getHandler(".tga");c===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new qt):(c.setPath(this.textureLoader.path),r=c.load(n))}else if(a==="dds"){const c=this.manager.getHandler(".dds");c===null?(console.warn("FBXLoader: DDS loader not found, creating placeholder texture for",e.RelativeFilename),r=new qt):(c.setPath(this.textureLoader.path),r=c.load(n))}else a==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new qt):r=this.textureLoader.load(n);return this.textureLoader.setPath(i),r}parseMaterials(e){const t=new Map;if("Material"in gt.Objects){const n=gt.Objects.Material;for(const i in n){const s=this.parseMaterial(n[i],e);s!==null&&t.set(parseInt(i),s)}}return t}parseMaterial(e,t){const n=e.id,i=e.attrName;let s=e.ShadingModel;if(typeof s=="object"&&(s=s.value),!tn.has(n))return null;const r=this.parseParameters(e,t,n);let a;switch(s.toLowerCase()){case"phong":a=new ac;break;case"lambert":a=new Jw;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),a=new ac;break}return a.setValues(r),a.name=i,a}parseParameters(e,t,n){const i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new He().fromArray(e.Diffuse.value).convertSRGBToLinear():e.DiffuseColor&&(e.DiffuseColor.type==="Color"||e.DiffuseColor.type==="ColorRGB")&&(i.color=new He().fromArray(e.DiffuseColor.value).convertSRGBToLinear()),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new He().fromArray(e.Emissive.value).convertSRGBToLinear():e.EmissiveColor&&(e.EmissiveColor.type==="Color"||e.EmissiveColor.type==="ColorRGB")&&(i.emissive=new He().fromArray(e.EmissiveColor.value).convertSRGBToLinear()),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new He().fromArray(e.Specular.value).convertSRGBToLinear():e.SpecularColor&&e.SpecularColor.type==="Color"&&(i.specular=new He().fromArray(e.SpecularColor.value).convertSRGBToLinear());const s=this;return tn.get(n).children.forEach(function(r){const a=r.relationship;switch(a){case"Bump":i.bumpMap=s.getTexture(t,r.ID);break;case"Maya|TEX_ao_map":i.aoMap=s.getTexture(t,r.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=s.getTexture(t,r.ID),i.map!==void 0&&(i.map.colorSpace=sn);break;case"DisplacementColor":i.displacementMap=s.getTexture(t,r.ID);break;case"EmissiveColor":i.emissiveMap=s.getTexture(t,r.ID),i.emissiveMap!==void 0&&(i.emissiveMap.colorSpace=sn);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=s.getTexture(t,r.ID);break;case"ReflectionColor":i.envMap=s.getTexture(t,r.ID),i.envMap!==void 0&&(i.envMap.mapping=Ka,i.envMap.colorSpace=sn);break;case"SpecularColor":i.specularMap=s.getTexture(t,r.ID),i.specularMap!==void 0&&(i.specularMap.colorSpace=sn);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=s.getTexture(t,r.ID),i.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a);break}}),i}getTexture(e,t){return"LayeredTexture"in gt.Objects&&t in gt.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=tn.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in gt.Objects){const n=gt.Objects.Deformer;for(const i in n){const s=n[i],r=tn.get(parseInt(i));if(s.attrType==="Skin"){const a=this.parseSkeleton(r,n);a.ID=i,r.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),a.geometryID=r.parents[0].ID,e[i]=a}else if(s.attrType==="BlendShape"){const a={id:i};a.rawTargets=this.parseMorphTargets(r,n),a.id=i,r.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=a}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(i){const s=t[i.ID];if(s.attrType!=="Cluster")return;const r={ID:i.ID,indices:[],weights:[],transformLink:new Ye().fromArray(s.TransformLink.a)};"Indexes"in s&&(r.indices=s.Indexes.a,r.weights=s.Weights.a),n.push(r)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let i=0;i<e.children.length;i++){const s=e.children[i],r=t[s.ID],a={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if(r.attrType!=="BlendShapeChannel")return;a.geoID=tn.get(parseInt(s.ID)).children.filter(function(c){return c.relationship===void 0})[0].ID,n.push(a)}return n}parseScene(e,t,n){Fn=new Xi;const i=this.parseModels(e.skeletons,t,n),s=gt.Objects.Model,r=this;i.forEach(function(c){const u=s[c.ID];r.setLookAtProperties(c,u),tn.get(c.ID).parents.forEach(function(l){const h=i.get(l.ID);h!==void 0&&h.add(c)}),c.parent===null&&Fn.add(c)}),this.bindSkeleton(e.skeletons,t,i),this.addGlobalSceneSettings(),Fn.traverse(function(c){if(c.userData.transformData){c.parent&&(c.userData.transformData.parentMatrix=c.parent.matrix,c.userData.transformData.parentMatrixWorld=c.parent.matrixWorld);const u=Ym(c.userData.transformData);c.applyMatrix4(u),c.updateWorldMatrix()}});const a=new gE().parse();Fn.children.length===1&&Fn.children[0].isGroup&&(Fn.children[0].animations=a,Fn=Fn.children[0]),Fn.animations=a}parseModels(e,t,n){const i=new Map,s=gt.Objects.Model;for(const r in s){const a=parseInt(r),c=s[r],u=tn.get(a);let d=this.buildSkeleton(u,e,a,c.attrName);if(!d){switch(c.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,t,n);break;case"NurbsCurve":d=this.createCurve(u,t);break;case"LimbNode":case"Root":d=new nl;break;case"Null":default:d=new Xi;break}d.name=c.attrName?bt.sanitizeNodeName(c.attrName):"",d.userData.originalName=c.attrName,d.ID=a}this.getTransformData(d,c),i.set(a,d)}return i}buildSkeleton(e,t,n,i){let s=null;return e.parents.forEach(function(r){for(const a in t){const c=t[a];c.rawBones.forEach(function(u,d){if(u.ID===r.ID){const l=s;s=new nl,s.matrixWorld.copy(u.transformLink),s.name=i?bt.sanitizeNodeName(i):"",s.userData.originalName=i,s.ID=n,c.bones[d]=s,l!==null&&s.add(l)}})}}),s}createCamera(e){let t,n;if(e.children.forEach(function(i){const s=gt.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new et;else{let i=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(i=1);let s=1;n.NearPlane!==void 0&&(s=n.NearPlane.value/1e3);let r=1e3;n.FarPlane!==void 0&&(r=n.FarPlane.value/1e3);let a=window.innerWidth,c=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(a=n.AspectWidth.value,c=n.AspectHeight.value);const u=a/c;let d=45;n.FieldOfView!==void 0&&(d=n.FieldOfView.value);const l=n.FocalLength?n.FocalLength.value:null;switch(i){case 0:t=new Tn(d,u,s,r),l!==null&&t.setFocalLength(l);break;case 1:t=new Qo(-a/2,a/2,c/2,-c/2,s,r);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+i+"."),t=new et;break}}return t}createLight(e){let t,n;if(e.children.forEach(function(i){const s=gt.Objects.NodeAttribute[i.ID];s!==void 0&&(n=s)}),n===void 0)t=new et;else{let i;n.LightType===void 0?i=0:i=n.LightType.value;let s=16777215;n.Color!==void 0&&(s=new He().fromArray(n.Color.value).convertSRGBToLinear());let r=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(r=0);let a=0;n.FarAttenuationEnd!==void 0&&(n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?a=0:a=n.FarAttenuationEnd.value);const c=1;switch(i){case 0:t=new Gc(s,r,a,c);break;case 1:t=new Rp(s,r);break;case 2:let u=Math.PI/3;n.InnerAngle!==void 0&&(u=bn.degToRad(n.InnerAngle.value));let d=0;n.OuterAngle!==void 0&&(d=bn.degToRad(n.OuterAngle.value),d=Math.max(d,1)),t=new Cp(s,r,a,u,d,c);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new Gc(s,r);break}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let i,s=null,r=null;const a=[];return e.children.forEach(function(c){t.has(c.ID)&&(s=t.get(c.ID)),n.has(c.ID)&&a.push(n.get(c.ID))}),a.length>1?r=a:a.length>0?r=a[0]:(r=new ac({name:Ci.DEFAULT_MATERIAL_NAME,color:13421772}),a.push(r)),"color"in s.attributes&&a.forEach(function(c){c.vertexColors=!0}),s.FBX_Deformer?(i=new _p(s,r),i.normalizeSkinWeights()):i=new Se(s,r),i}createCurve(e,t){const n=e.children.reduce(function(s,r){return t.has(r.ID)&&(s=t.get(r.ID)),s},null),i=new eo({name:Ci.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Xn(n,i)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?n.eulerOrder=$m(t.RotationOrder.value):n.eulerOrder="ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&tn.get(e.ID).children.forEach(function(i){if(i.relationship==="LookAtProperty"){const s=gt.Objects.Model[i.ID];if("Lcl_Translation"in s){const r=s.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(r),Fn.add(e.target)):e.lookAt(new D().fromArray(r))}}})}bindSkeleton(e,t,n){const i=this.parsePoseNodes();for(const s in e){const r=e[s];tn.get(parseInt(r.ID)).parents.forEach(function(c){if(t.has(c.ID)){const u=c.ID;tn.get(u).parents.forEach(function(l){n.has(l.ID)&&n.get(l.ID).bind(new _l(r.bones),i[l.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in gt.Objects){const t=gt.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const i=t[n].PoseNode;Array.isArray(i)?i.forEach(function(s){e[s.Node]=new Ye().fromArray(s.Matrix.a)}):e[i.Node]=new Ye().fromArray(i.Matrix.a)}}return e}addGlobalSceneSettings(){if("GlobalSettings"in gt){if("AmbientColor"in gt.GlobalSettings){const e=gt.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],i=e[2];if(t!==0||n!==0||i!==0){const s=new He(t,n,i).convertSRGBToLinear();Fn.add(new mb(s,1))}}"UnitScaleFactor"in gt.GlobalSettings&&(Fn.userData.unitScaleFactor=gt.GlobalSettings.UnitScaleFactor.value)}}}class mE{constructor(){this.negativeMaterialIndices=!1}parse(e){const t=new Map;if("Geometry"in gt.Objects){const n=gt.Objects.Geometry;for(const i in n){const s=tn.get(parseInt(i)),r=this.parseGeometry(s,n[i],e);t.set(parseInt(i),r)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const i=n.skeletons,s=[],r=e.parents.map(function(l){return gt.Objects.Model[l.ID]});if(r.length===0)return;const a=e.children.reduce(function(l,h){return i[h.ID]!==void 0&&(l=i[h.ID]),l},null);e.children.forEach(function(l){n.morphTargets[l.ID]!==void 0&&s.push(n.morphTargets[l.ID])});const c=r[0],u={};"RotationOrder"in c&&(u.eulerOrder=$m(c.RotationOrder.value)),"InheritType"in c&&(u.inheritType=parseInt(c.InheritType.value)),"GeometricTranslation"in c&&(u.translation=c.GeometricTranslation.value),"GeometricRotation"in c&&(u.rotation=c.GeometricRotation.value),"GeometricScaling"in c&&(u.scale=c.GeometricScaling.value);const d=Ym(u);return this.genGeometry(t,a,s,d)}genGeometry(e,t,n,i){const s=new Ft;e.attrName&&(s.name=e.attrName);const r=this.parseGeoNode(e,t),a=this.genBuffers(r),c=new yt(a.vertex,3);if(c.applyMatrix4(i),s.setAttribute("position",c),a.colors.length>0&&s.setAttribute("color",new yt(a.colors,3)),t&&(s.setAttribute("skinIndex",new yh(a.weightsIndices,4)),s.setAttribute("skinWeight",new yt(a.vertexWeights,4)),s.FBX_Deformer=t),a.normal.length>0){const u=new dt().getNormalMatrix(i),d=new yt(a.normal,3);d.applyNormalMatrix(u),s.setAttribute("normal",d)}if(a.uvs.forEach(function(u,d){const l=d===0?"uv":`uv${d}`;s.setAttribute(l,new yt(a.uvs[d],2))}),r.material&&r.material.mappingType!=="AllSame"){let u=a.materialIndex[0],d=0;if(a.materialIndex.forEach(function(l,h){l!==u&&(s.addGroup(d,h-d,u),u=l,d=h)}),s.groups.length>0){const l=s.groups[s.groups.length-1],h=l.start+l.count;h!==a.materialIndex.length&&s.addGroup(h,a.materialIndex.length-h,u)}s.groups.length===0&&s.addGroup(0,a.materialIndex.length,a.materialIndex[0])}return this.addMorphTargets(s,e,n,i),s}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let i=0;for(;e.LayerElementUV[i];)e.LayerElementUV[i].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[i])),i++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(i,s){i.indices.forEach(function(r,a){n.weightTable[r]===void 0&&(n.weightTable[r]=[]),n.weightTable[r].push({id:s,weight:i.weights[a]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,i=0,s=!1,r=[],a=[],c=[],u=[],d=[],l=[];const h=this;return e.vertexIndices.forEach(function(f,p){let g,m=!1;f<0&&(f=f^-1,m=!0);let v=[],_=[];if(r.push(f*3,f*3+1,f*3+2),e.color){const y=za(p,n,f,e.color);c.push(y[0],y[1],y[2])}if(e.skeleton){if(e.weightTable[f]!==void 0&&e.weightTable[f].forEach(function(y){_.push(y.weight),v.push(y.id)}),_.length>4){s||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),s=!0);const y=[0,0,0,0],x=[0,0,0,0];_.forEach(function(M,S){let A=M,T=v[S];x.forEach(function(b,w,P){if(A>b){P[w]=A,A=b;const N=y[w];y[w]=T,T=N}})}),v=y,_=x}for(;_.length<4;)_.push(0),v.push(0);for(let y=0;y<4;++y)d.push(_[y]),l.push(v[y])}if(e.normal){const y=za(p,n,f,e.normal);a.push(y[0],y[1],y[2])}e.material&&e.material.mappingType!=="AllSame"&&(g=za(p,n,f,e.material)[0],g<0&&(h.negativeMaterialIndices=!0,g=0)),e.uv&&e.uv.forEach(function(y,x){const M=za(p,n,f,y);u[x]===void 0&&(u[x]=[]),u[x].push(M[0]),u[x].push(M[1])}),i++,m&&(h.genFace(t,e,r,g,a,c,u,d,l,i),n++,i=0,r=[],a=[],c=[],u=[],d=[],l=[])}),t}getNormalNewell(e){const t=new D(0,0,0);for(let n=0;n<e.length;n++){const i=e[n],s=e[(n+1)%e.length];t.x+=(i.y-s.y)*(i.z+s.z),t.y+=(i.z-s.z)*(i.x+s.x),t.z+=(i.x-s.x)*(i.y+s.y)}return t.normalize(),t}getNormalTangentAndBitangent(e){const t=this.getNormalNewell(e),i=(Math.abs(t.z)>.5?new D(0,1,0):new D(0,0,1)).cross(t).normalize(),s=t.clone().cross(i).normalize();return{normal:t,tangent:i,bitangent:s}}flattenVertex(e,t,n){return new Fe(e.dot(t),e.dot(n))}genFace(e,t,n,i,s,r,a,c,u,d){let l;if(d>3){const h=[];for(let m=0;m<n.length;m+=3)h.push(new D(t.vertexPositions[n[m]],t.vertexPositions[n[m+1]],t.vertexPositions[n[m+2]]));const{tangent:f,bitangent:p}=this.getNormalTangentAndBitangent(h),g=[];for(const m of h)g.push(this.flattenVertex(m,f,p));l=Ah.triangulateShape(g,[])}else l=[[0,1,2]];for(const[h,f,p]of l)e.vertex.push(t.vertexPositions[n[h*3]]),e.vertex.push(t.vertexPositions[n[h*3+1]]),e.vertex.push(t.vertexPositions[n[h*3+2]]),e.vertex.push(t.vertexPositions[n[f*3]]),e.vertex.push(t.vertexPositions[n[f*3+1]]),e.vertex.push(t.vertexPositions[n[f*3+2]]),e.vertex.push(t.vertexPositions[n[p*3]]),e.vertex.push(t.vertexPositions[n[p*3+1]]),e.vertex.push(t.vertexPositions[n[p*3+2]]),t.skeleton&&(e.vertexWeights.push(c[h*4]),e.vertexWeights.push(c[h*4+1]),e.vertexWeights.push(c[h*4+2]),e.vertexWeights.push(c[h*4+3]),e.vertexWeights.push(c[f*4]),e.vertexWeights.push(c[f*4+1]),e.vertexWeights.push(c[f*4+2]),e.vertexWeights.push(c[f*4+3]),e.vertexWeights.push(c[p*4]),e.vertexWeights.push(c[p*4+1]),e.vertexWeights.push(c[p*4+2]),e.vertexWeights.push(c[p*4+3]),e.weightsIndices.push(u[h*4]),e.weightsIndices.push(u[h*4+1]),e.weightsIndices.push(u[h*4+2]),e.weightsIndices.push(u[h*4+3]),e.weightsIndices.push(u[f*4]),e.weightsIndices.push(u[f*4+1]),e.weightsIndices.push(u[f*4+2]),e.weightsIndices.push(u[f*4+3]),e.weightsIndices.push(u[p*4]),e.weightsIndices.push(u[p*4+1]),e.weightsIndices.push(u[p*4+2]),e.weightsIndices.push(u[p*4+3])),t.color&&(e.colors.push(r[h*3]),e.colors.push(r[h*3+1]),e.colors.push(r[h*3+2]),e.colors.push(r[f*3]),e.colors.push(r[f*3+1]),e.colors.push(r[f*3+2]),e.colors.push(r[p*3]),e.colors.push(r[p*3+1]),e.colors.push(r[p*3+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(s[h*3]),e.normal.push(s[h*3+1]),e.normal.push(s[h*3+2]),e.normal.push(s[f*3]),e.normal.push(s[f*3+1]),e.normal.push(s[f*3+2]),e.normal.push(s[p*3]),e.normal.push(s[p*3+1]),e.normal.push(s[p*3+2])),t.uv&&t.uv.forEach(function(g,m){e.uvs[m]===void 0&&(e.uvs[m]=[]),e.uvs[m].push(a[m][h*2]),e.uvs[m].push(a[m][h*2+1]),e.uvs[m].push(a[m][f*2]),e.uvs[m].push(a[m][f*2+1]),e.uvs[m].push(a[m][p*2]),e.uvs[m].push(a[m][p*2+1])})}addMorphTargets(e,t,n,i){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const s=this;n.forEach(function(r){r.rawTargets.forEach(function(a){const c=gt.Objects.Geometry[a.geoID];c!==void 0&&s.genMorphGeometry(e,t,c,i,a.name)})})}genMorphGeometry(e,t,n,i,s){const r=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],a=n.Vertices!==void 0?n.Vertices.a:[],c=n.Indexes!==void 0?n.Indexes.a:[],u=e.attributes.position.count*3,d=new Float32Array(u);for(let p=0;p<c.length;p++){const g=c[p]*3;d[g]=a[p*3],d[g+1]=a[p*3+1],d[g+2]=a[p*3+2]}const l={vertexIndices:r,vertexPositions:d},h=this.genBuffers(l),f=new yt(h.vertex,3);f.name=s||n.attrName,f.applyMatrix4(i),e.morphAttributes.position.push(f)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Normals.a;let s=[];return n==="IndexToDirect"&&("NormalIndex"in e?s=e.NormalIndex.a:"NormalsIndex"in e&&(s=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:s,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.UV.a;let s=[];return n==="IndexToDirect"&&(s=e.UVIndex.a),{dataSize:2,buffer:i,indices:s,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,i=e.Colors.a;let s=[];n==="IndexToDirect"&&(s=e.ColorIndex.a);for(let r=0,a=new He;r<i.length;r+=4)a.fromArray(i,r).convertSRGBToLinear().toArray(i,r);return{dataSize:4,buffer:i,indices:s,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const i=e.Materials.a,s=[];for(let r=0;r<i.length;++r)s.push(r);return{dataSize:1,buffer:i,indices:s,mappingType:t,referenceType:n}}parseNurbsGeometry(e){const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ft;const n=t-1,i=e.KnotVector.a,s=[],r=e.Points.a;for(let l=0,h=r.length;l<h;l+=4)s.push(new At().fromArray(r,l));let a,c;if(e.Form==="Closed")s.push(s[0]);else if(e.Form==="Periodic"){a=n,c=i.length-1-a;for(let l=0;l<n;++l)s.push(s[l])}const d=new dE(n,i,s,a,c).getPoints(s.length*12);return new Ft().setFromPoints(d)}}class gE{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const i=t[n],s=this.addClip(i);e.push(s)}return e}parseClips(){if(gt.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=gt.Objects.AnimationCurveNode,t=new Map;for(const n in e){const i=e[n];if(i.attrName.match(/S|R|T|DeformPercent/)!==null){const s={id:i.id,attr:i.attrName,curves:{}};t.set(s.id,s)}}return t}parseAnimationCurves(e){const t=gt.Objects.AnimationCurve;for(const n in t){const i={id:t[n].id,times:t[n].KeyTime.a.map(wE),values:t[n].KeyValueFloat.a},s=tn.get(i.id);if(s!==void 0){const r=s.parents[0].ID,a=s.parents[0].relationship;a.match(/X/)?e.get(r).curves.x=i:a.match(/Y/)?e.get(r).curves.y=i:a.match(/Z/)?e.get(r).curves.z=i:a.match(/DeformPercent/)&&e.has(r)&&(e.get(r).curves.morph=i)}}}parseAnimationLayers(e){const t=gt.Objects.AnimationLayer,n=new Map;for(const i in t){const s=[],r=tn.get(parseInt(i));r!==void 0&&(r.children.forEach(function(c,u){if(e.has(c.ID)){const d=e.get(c.ID);if(d.curves.x!==void 0||d.curves.y!==void 0||d.curves.z!==void 0){if(s[u]===void 0){const l=tn.get(c.ID).parents.filter(function(h){return h.relationship!==void 0})[0].ID;if(l!==void 0){const h=gt.Objects.Model[l.toString()];if(h===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",c);return}const f={modelName:h.attrName?bt.sanitizeNodeName(h.attrName):"",ID:h.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};Fn.traverse(function(p){p.ID===h.id&&(f.transform=p.matrix,p.userData.transformData&&(f.eulerOrder=p.userData.transformData.eulerOrder))}),f.transform||(f.transform=new Ye),"PreRotation"in h&&(f.preRotation=h.PreRotation.value),"PostRotation"in h&&(f.postRotation=h.PostRotation.value),s[u]=f}}s[u]&&(s[u][d.attr]=d)}else if(d.curves.morph!==void 0){if(s[u]===void 0){const l=tn.get(c.ID).parents.filter(function(v){return v.relationship!==void 0})[0].ID,h=tn.get(l).parents[0].ID,f=tn.get(h).parents[0].ID,p=tn.get(f).parents[0].ID,g=gt.Objects.Model[p],m={modelName:g.attrName?bt.sanitizeNodeName(g.attrName):"",morphName:gt.Objects.Deformer[l].attrName};s[u]=m}s[u][d.attr]=d}}}),n.set(parseInt(i),s))}return n}parseAnimStacks(e){const t=gt.Objects.AnimationStack,n={};for(const i in t){const s=tn.get(parseInt(i)).children;s.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const r=e.get(s[0].ID);n[i]={name:t[i].attrName,layer:r}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(i){t=t.concat(n.generateTracks(i))}),new Ep(e.name,-1,t)}generateTracks(e){const t=[];let n=new D,i=new D;if(e.transform&&e.transform.decompose(n,new Lt,i),n=n.toArray(),i=i.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");s!==void 0&&t.push(s)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const s=this.generateRotationTrack(e.modelName,e.R.curves,e.preRotation,e.postRotation,e.eulerOrder);s!==void 0&&t.push(s)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");s!==void 0&&t.push(s)}if(e.DeformPercent!==void 0){const s=this.generateMorphTrack(e);s!==void 0&&t.push(s)}return t}generateVectorTrack(e,t,n,i){const s=this.getTimesForAllAxes(t),r=this.getKeyframeTrackValues(s,t,n);return new $s(e+"."+i,s,r)}generateRotationTrack(e,t,n,i,s){let r,a;if(t.x!==void 0&&t.y!==void 0&&t.z!==void 0){const l=this.interpolateRotations(t.x,t.y,t.z,s);r=l[0],a=l[1]}n!==void 0&&(n=n.map(bn.degToRad),n.push(s),n=new ht().fromArray(n),n=new Lt().setFromEuler(n)),i!==void 0&&(i=i.map(bn.degToRad),i.push(s),i=new ht().fromArray(i),i=new Lt().setFromEuler(i).invert());const c=new Lt,u=new ht,d=[];if(!a||!r)return new Yi(e+".quaternion",[0],[0]);for(let l=0;l<a.length;l+=3)u.set(a[l],a[l+1],a[l+2],s),c.setFromEuler(u),n!==void 0&&c.premultiply(n),i!==void 0&&c.multiply(i),l>2&&new Lt().fromArray(d,(l-3)/3*4).dot(c)<0&&c.set(-c.x,-c.y,-c.z,-c.w),c.toArray(d,l/3*4);return new Yi(e+".quaternion",r,d)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(s){return s/100}),i=Fn.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ys(e.modelName+".morphTargetInfluences["+i+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,i){return n-i}),t.length>1){let n=1,i=t[0];for(let s=1;s<t.length;s++){const r=t[s];r!==i&&(t[n]=r,i=r,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const i=n,s=[];let r=-1,a=-1,c=-1;return e.forEach(function(u){if(t.x&&(r=t.x.times.indexOf(u)),t.y&&(a=t.y.times.indexOf(u)),t.z&&(c=t.z.times.indexOf(u)),r!==-1){const d=t.x.values[r];s.push(d),i[0]=d}else s.push(i[0]);if(a!==-1){const d=t.y.values[a];s.push(d),i[1]=d}else s.push(i[1]);if(c!==-1){const d=t.z.values[c];s.push(d),i[2]=d}else s.push(i[2])}),s}interpolateRotations(e,t,n,i){const s=[],r=[];s.push(e.times[0]),r.push(bn.degToRad(e.values[0])),r.push(bn.degToRad(t.values[0])),r.push(bn.degToRad(n.values[0]));for(let a=1;a<e.values.length;a++){const c=[e.values[a-1],t.values[a-1],n.values[a-1]];if(isNaN(c[0])||isNaN(c[1])||isNaN(c[2]))continue;const u=c.map(bn.degToRad),d=[e.values[a],t.values[a],n.values[a]];if(isNaN(d[0])||isNaN(d[1])||isNaN(d[2]))continue;const l=d.map(bn.degToRad),h=[d[0]-c[0],d[1]-c[1],d[2]-c[2]],f=[Math.abs(h[0]),Math.abs(h[1]),Math.abs(h[2])];if(f[0]>=180||f[1]>=180||f[2]>=180){const g=Math.max(...f)/180,m=new ht(...u,i),v=new ht(...l,i),_=new Lt().setFromEuler(m),y=new Lt().setFromEuler(v);_.dot(y)&&y.set(-y.x,-y.y,-y.z,-y.w);const x=e.times[a-1],M=e.times[a]-x,S=new Lt,A=new ht;for(let T=0;T<1;T+=1/g)S.copy(_.clone().slerp(y.clone(),T)),s.push(x+T*M),A.setFromQuaternion(S,i),r.push(A.x),r.push(A.y),r.push(A.z)}else s.push(e.times[a]),r.push(bn.degToRad(e.values[a])),r.push(bn.degToRad(t.values[a])),r.push(bn.degToRad(n.values[a]))}return[s,r]}}class vE{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new qm,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(i,s){const r=i.match(/^[\s\t]*;/),a=i.match(/^[\s\t]*$/);if(r||a)return;const c=i.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),u=i.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),d=i.match("^\\t{"+(t.currentIndent-1)+"}}");c?t.parseNodeBegin(i,c):u?t.parseNodeProperty(i,u,n[++s]):d?t.popStack():i.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(i)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(c){return c.trim().replace(/^"/,"").replace(/"$/,"")}),s={name:n},r=this.parseNodeAttr(i),a=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,s):n in a?(n==="PoseNode"?a.PoseNode.push(s):a[n].id!==void 0&&(a[n]={},a[n][a[n].id]=a[n]),r.id!==""&&(a[n][r.id]=s)):typeof r.id=="number"?(a[n]={},a[n][r.id]=s):n!=="Properties70"&&(n==="PoseNode"?a[n]=[s]:a[n]=s),typeof r.id=="number"&&(s.id=r.id),r.name!==""&&(s.attrName=r.name),r.type!==""&&(s.attrType=r.type),this.pushStack(s)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",i="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:n,type:i}}parseNodeProperty(e,t,n){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),s=t[2].replace(/^"/,"").replace(/"$/,"").trim();i==="Content"&&s===","&&(s=n.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if(r.name==="Properties70"){this.parseNodeSpecialProperty(e,i,s);return}if(i==="C"){const c=s.split(",").slice(1),u=parseInt(c[0]),d=parseInt(c[1]);let l=s.split(",").slice(3);l=l.map(function(h){return h.trim().replace(/^"/,"")}),i="connections",s=[u,d],ME(s,l),r[i]===void 0&&(r[i]=[])}i==="Node"&&(r.id=s),i in r&&Array.isArray(r[i])?r[i].push(s):i!=="a"?r[i]=s:r.a=s,this.setCurrentProp(r,i),i==="a"&&s.slice(-1)!==","&&(r.a=Rc(s))}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Rc(t.a))}parseNodeSpecialProperty(e,t,n){const i=n.split('",').map(function(d){return d.trim().replace(/^\"/,"").replace(/\s/,"_")}),s=i[0],r=i[1],a=i[2],c=i[3];let u=i[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=Rc(u);break}this.getPrevNode()[s]={type:r,type2:a,flag:c,value:u},this.setCurrentProp(this.getPrevNode(),s)}}class _E{parse(e){const t=new Ff(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const i=new qm;for(;!this.endOfContent(t);){const s=this.parseNode(t,n);s!==null&&i.add(s.name,s)}return i}endOfContent(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},i=t>=7500?e.getUint64():e.getUint32(),s=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const r=e.getUint8(),a=e.getString(r);if(i===0)return null;const c=[];for(let h=0;h<s;h++)c.push(this.parseProperty(e));const u=c.length>0?c[0]:"",d=c.length>1?c[1]:"",l=c.length>2?c[2]:"";for(n.singleProperty=s===1&&e.getOffset()===i;i>e.getOffset();){const h=this.parseNode(e,t);h!==null&&this.parseSubNode(a,n,h)}return n.propertyList=c,typeof u=="number"&&(n.id=u),d!==""&&(n.attrName=d),l!==""&&(n.attrType=l),a!==""&&(n.name=a),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const i=n.propertyList[0];Array.isArray(i)?(t[n.name]=n,n.a=i):t[n.name]=i}else if(e==="Connections"&&n.name==="C"){const i=[];n.propertyList.forEach(function(s,r){r!==0&&i.push(s)}),t.connections===void 0&&(t.connections=[]),t.connections.push(i)}else if(n.name==="Properties70")Object.keys(n).forEach(function(s){t[s]=n[s]});else if(e==="Properties70"&&n.name==="P"){let i=n.propertyList[0],s=n.propertyList[1];const r=n.propertyList[2],a=n.propertyList[3];let c;i.indexOf("Lcl ")===0&&(i=i.replace("Lcl ","Lcl_")),s.indexOf("Lcl ")===0&&(s=s.replace("Lcl ","Lcl_")),s==="Color"||s==="ColorRGB"||s==="Vector"||s==="Vector3D"||s.indexOf("Lcl_")===0?c=[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:c=n.propertyList[4],t[i]={type:s,type2:r,flag:a,value:c}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const i=e.getUint32(),s=e.getUint32(),r=e.getUint32();if(s===0)switch(t){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}const a=nE(new Uint8Array(e.getArrayBuffer(r))),c=new Ff(a.buffer);switch(t){case"b":case"c":return c.getBooleanArray(i);case"d":return c.getFloat64Array(i);case"f":return c.getFloat32Array(i);case"i":return c.getInt32Array(i);case"l":return c.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Ff{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t!==void 0?t:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t&2147483648?(t=~t&4294967295,e=~e&4294967295,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(t*4294967296+e)):t*4294967296+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),t*4294967296+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){const t=this.offset;let n=new Uint8Array(this.dv.buffer,t,e);this.skip(e);const i=n.indexOf(0);return i>=0&&(n=new Uint8Array(this.dv.buffer,t,i)),this._textDecoder.decode(n)}}class qm{add(e,t){this[e]=t}}function yE(o){const e="Kaydara FBX Binary  \0";return o.byteLength>=e.length&&e===Km(o,0,e.length)}function xE(o){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let t=0;function n(i){const s=o[i-1];return o=o.slice(t+i),t++,s}for(let i=0;i<e.length;++i)if(n(1)===e[i])return!1;return!0}function kf(o){const e=/FBXVersion: (\d+)/,t=o.match(e);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function wE(o){return o/46186158e3}const bE=[];function za(o,e,t,n){let i;switch(n.mappingType){case"ByPolygonVertex":i=o;break;case"ByPolygon":i=e;break;case"ByVertice":i=t;break;case"AllSame":i=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(i=n.indices[i]);const s=i*n.dataSize,r=s+n.dataSize;return SE(bE,n.buffer,s,r)}const Cc=new ht,Mr=new D;function Ym(o){const e=new Ye,t=new Ye,n=new Ye,i=new Ye,s=new Ye,r=new Ye,a=new Ye,c=new Ye,u=new Ye,d=new Ye,l=new Ye,h=new Ye,f=o.inheritType?o.inheritType:0;if(o.translation&&e.setPosition(Mr.fromArray(o.translation)),o.preRotation){const w=o.preRotation.map(bn.degToRad);w.push(o.eulerOrder||ht.DEFAULT_ORDER),t.makeRotationFromEuler(Cc.fromArray(w))}if(o.rotation){const w=o.rotation.map(bn.degToRad);w.push(o.eulerOrder||ht.DEFAULT_ORDER),n.makeRotationFromEuler(Cc.fromArray(w))}if(o.postRotation){const w=o.postRotation.map(bn.degToRad);w.push(o.eulerOrder||ht.DEFAULT_ORDER),i.makeRotationFromEuler(Cc.fromArray(w)),i.invert()}o.scale&&s.scale(Mr.fromArray(o.scale)),o.scalingOffset&&a.setPosition(Mr.fromArray(o.scalingOffset)),o.scalingPivot&&r.setPosition(Mr.fromArray(o.scalingPivot)),o.rotationOffset&&c.setPosition(Mr.fromArray(o.rotationOffset)),o.rotationPivot&&u.setPosition(Mr.fromArray(o.rotationPivot)),o.parentMatrixWorld&&(l.copy(o.parentMatrix),d.copy(o.parentMatrixWorld));const p=t.clone().multiply(n).multiply(i),g=new Ye;g.extractRotation(d);const m=new Ye;m.copyPosition(d);const v=m.clone().invert().multiply(d),_=g.clone().invert().multiply(v),y=s,x=new Ye;if(f===0)x.copy(g).multiply(p).multiply(_).multiply(y);else if(f===1)x.copy(g).multiply(_).multiply(p).multiply(y);else{const P=new Ye().scale(new D().setFromMatrixScale(l)).clone().invert(),N=_.clone().multiply(P);x.copy(g).multiply(p).multiply(N).multiply(y)}const M=u.clone().invert(),S=r.clone().invert();let A=e.clone().multiply(c).multiply(u).multiply(t).multiply(n).multiply(i).multiply(M).multiply(a).multiply(r).multiply(s).multiply(S);const T=new Ye().copyPosition(A),b=d.clone().multiply(T);return h.copyPosition(b),A=h.clone().multiply(x),A.premultiply(d.invert()),A}function $m(o){o=o||0;const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return o===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[o]}function Rc(o){return o.split(",").map(function(t){return parseFloat(t)})}function Km(o,e,t){return e===void 0&&(e=0),t===void 0&&(t=o.byteLength),new TextDecoder().decode(new Uint8Array(o,e,t))}function ME(o,e){for(let t=0,n=o.length,i=e.length;t<i;t++,n++)o[n]=e[t]}function SE(o,e,t,n){for(let i=t,s=0;i<n;i++,s++)o[s]=e[i];return o}const Pc=new WeakMap;class Nf extends Ci{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,i){const s=new zo(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,r=>{this.parse(r,t,i)},n,i)}parse(e,t,n=()=>{}){this.decodeDracoFile(e,t,null,null,sn).catch(n)}decodeDracoFile(e,t,n,i,s=_n,r=()=>{}){const a={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:s};return this.decodeGeometry(e,a).then(t).catch(r)}decodeGeometry(e,t){const n=JSON.stringify(t);if(Pc.has(e)){const c=Pc.get(e);if(c.key===n)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,r=e.byteLength,a=this._getWorker(s,r).then(c=>(i=c,new Promise((u,d)=>{i._callbacks[s]={resolve:u,reject:d},i.postMessage({type:"decode",id:s,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return a.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),Pc.set(e,{key:n,promise:a}),a}_createGeometry(e){const t=new Ft;e.index&&t.setIndex(new an(e.index.array,1));for(let n=0;n<e.attributes.length;n++){const i=e.attributes[n],s=i.name,r=i.array,a=i.itemSize,c=new an(r,a);s==="color"&&(this._assignVertexColorSpace(c,i.vertexColorSpace),c.normalized=!(r instanceof Float32Array)),t.setAttribute(s,c)}return t}_assignVertexColorSpace(e,t){if(t!==sn)return;const n=new He;for(let i=0,s=e.count;i<s;i++)n.fromBufferAttribute(e,i).convertSRGBToLinear(),e.setXYZ(i,n.r,n.g,n.b)}_loadLibrary(e,t){const n=new zo(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((i,s)=>{n.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(n=>{const i=n[0];e||(this.decoderConfig.wasmBinary=n[1]);const s=AE.toString(),r=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const r=s.data;switch(r.type){case"decode":i._callbacks[r.id].resolve(r);break;case"error":i._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[e]=t,n._taskLoad+=t,n})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function AE(){let o,e;onmessage=function(r){const a=r.data;switch(a.type){case"init":o=a.decoderConfig,e=new Promise(function(d){o.onModuleLoaded=function(l){d({draco:l})},DracoDecoderModule(o)});break;case"decode":const c=a.buffer,u=a.taskConfig;e.then(d=>{const l=d.draco,h=new l.Decoder;try{const f=t(l,h,new Int8Array(c),u),p=f.attributes.map(g=>g.array.buffer);f.index&&p.push(f.index.array.buffer),self.postMessage({type:"decode",id:a.id,geometry:f},p)}catch(f){console.error(f),self.postMessage({type:"error",id:a.id,error:f.message})}finally{l.destroy(h)}});break}};function t(r,a,c,u){const d=u.attributeIDs,l=u.attributeTypes;let h,f;const p=a.GetEncodedGeometryType(c);if(p===r.TRIANGULAR_MESH)h=new r.Mesh,f=a.DecodeArrayToMesh(c,c.byteLength,h);else if(p===r.POINT_CLOUD)h=new r.PointCloud,f=a.DecodeArrayToPointCloud(c,c.byteLength,h);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||h.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const g={index:null,attributes:[]};for(const m in d){const v=self[l[m]];let _,y;if(u.useUniqueIDs)y=d[m],_=a.GetAttributeByUniqueId(h,y);else{if(y=a.GetAttributeId(h,r[d[m]]),y===-1)continue;_=a.GetAttribute(h,y)}const x=i(r,a,h,m,v,_);m==="color"&&(x.vertexColorSpace=u.vertexColorSpace),g.attributes.push(x)}return p===r.TRIANGULAR_MESH&&(g.index=n(r,a,h)),r.destroy(h),g}function n(r,a,c){const d=c.num_faces()*3,l=d*4,h=r._malloc(l);a.GetTrianglesUInt32Array(c,l,h);const f=new Uint32Array(r.HEAPF32.buffer,h,d).slice();return r._free(h),{array:f,itemSize:1}}function i(r,a,c,u,d,l){const h=l.num_components(),p=c.num_points()*h,g=p*d.BYTES_PER_ELEMENT,m=s(r,d),v=r._malloc(g);a.GetAttributeDataArrayForAllPoints(c,l,m,g,v);const _=new d(r.HEAPF32.buffer,v,p).slice();return r._free(v),{name:u,array:_,itemSize:h}}function s(r,a){switch(a){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}let EE=class extends er{constructor(){super(),this.setLoaders(),this.toLoad=0,this.loaded=0,this.items={}}setLoaders(){this.loaders=[],this.loaders.push({extensions:["jpg","png","webp"],action:i=>{const s=new Image;s.addEventListener("load",()=>{this.fileLoadEnd(i,s)}),s.addEventListener("error",()=>{this.fileLoadEnd(i,s)}),s.src=i.source}});const e=new Nf;e.setDecoderPath("draco/"),e.setDecoderConfig({type:"js"}),this.loaders.push({extensions:["drc"],action:i=>{e.load(i.source,s=>{this.fileLoadEnd(i,s),Nf.releaseDecoderModule()})}});const t=new lA;t.setDRACOLoader(e),this.loaders.push({extensions:["glb","gltf"],action:i=>{t.load(i.source,s=>{this.fileLoadEnd(i,s)})}});const n=new fE;this.loaders.push({extensions:["fbx"],action:i=>{n.load(i.source,s=>{this.fileLoadEnd(i,s)})}})}load(e=[]){for(const t of e){this.toLoad++;const n=t.source.match(/\.([a-z]+)$/);if(typeof n[1]<"u"){const i=n[1],s=this.loaders.find(r=>r.extensions.find(a=>a===i));s?s.action(t):console.warn(`Cannot found loader for ${t}`)}else console.warn(`Cannot found extension of ${t}`)}}fileLoadEnd(e,t){this.loaded++,this.items[e.name]=t,this.trigger("fileEnd",[e,t]),this.loaded===this.toLoad&&this.trigger("end")}};class TE extends er{constructor(){super(),this.loader=new EE,this.items={},this.loader.load([{name:"matcapBeige",source:"./models/matcaps/beige.png",type:"texture"},{name:"matcapBlack",source:"./models/matcaps/black.png",type:"texture"},{name:"matcapOrange",source:"./models/matcaps/orange.png",type:"texture"},{name:"matcapRed",source:"./models/matcaps/red.png",type:"texture"},{name:"matcapWhite",source:"./models/matcaps/white.png",type:"texture"},{name:"matcapGreen",source:"./models/matcaps/green.png",type:"texture"},{name:"matcapBrown",source:"./models/matcaps/brown.png",type:"texture"},{name:"matcapGray",source:"./models/matcaps/gray.png",type:"texture"},{name:"matcapEmeraldGreen",source:"./models/matcaps/emeraldGreen.png",type:"texture"},{name:"matcapPurple",source:"./models/matcaps/purple.png",type:"texture"},{name:"matcapBlue",source:"./models/matcaps/blue.png",type:"texture"},{name:"matcapYellow",source:"./models/matcaps/yellow.png",type:"texture"},{name:"matcapMetal",source:"./models/matcaps/metal.png",type:"texture"},{name:"matcapGold",source:"./models/matcaps/gold.png",type:"texture"},{name:"introStaticBase",source:"./models/intro/static/base.glb"},{name:"introStaticCollision",source:"./models/intro/static/collision.glb"},{name:"introStaticFloorShadow",source:"./models/intro/static/floorShadow.png",type:"texture"},{name:"introName",source:"./models/intro/name.png",type:"texture"},{name:"introInstructionsLabels",source:"./models/intro/instructions/labels.glb"},{name:"introInstructionsArrows",source:"./models/intro/instructions/arrows.png",type:"texture"},{name:"introInstructionsControls",source:"./models/intro/instructions/controls.png",type:"texture"},{name:"introInstructionsOther",source:"./models/intro/instructions/other.png",type:"texture"},{name:"introArrowKeyBase",source:"./models/intro/arrowKey/base.glb"},{name:"introArrowKeyCollision",source:"./models/intro/arrowKey/collision.glb"},{name:"introCreativeBase",source:"./models/intro/creative/base.glb"},{name:"introCreativeCollision",source:"./models/intro/creative/collision.glb"},{name:"introDevBase",source:"./models/intro/dev/base.glb"},{name:"introDevCollision",source:"./models/intro/dev/collision.glb"},{name:"carCyberTruckChassis",source:"./models/car/cyberTruck/chassis.glb"},{name:"carCyberTruckWheel",source:"./models/car/cyberTruck/wheel.glb"},{name:"carCyberTruckBackLightsBrake",source:"./models/car/cyberTruck/backLightsBrake.glb"},{name:"carCyberTruckBackLightsReverse",source:"./models/car/cyberTruck/backLightsReverse.glb"},{name:"carCyberTruckAntena",source:"./models/car/cyberTruck/antena.glb"},{name:"informationContactTwitterLabel",source:"./models/information/static/contactTwitterLabel.png",type:"texture"},{name:"informationContactGithubLabel",source:"./models/information/static/contactGithubLabel.png",type:"texture"},{name:"informationContactLinkedinLabel",source:"./models/information/static/contactLinkedinLabel.png",type:"texture"},{name:"informationContactMailLabel",source:"./models/information/static/contactMailLabel.png",type:"texture"},{name:"informationActivities",source:"./models/information/static/activities.png",type:"texture"},{name:"brickBase",source:"./models/brick/base.glb"},{name:"brickCollision",source:"./models/brick/collision.glb"},{name:"hornBase",source:"./models/horn/base.glb"},{name:"hornCollision",source:"./models/horn/collision.glb"},{name:"lemonBase",source:"./models/lemon/base.glb"},{name:"lemonCollision",source:"./models/lemon/collision.glb"},{name:"areaKeyEnter",source:"./models/area/keyEnter.png",type:"texture"},{name:"areaEnter",source:"./models/area/enter.png",type:"texture"},{name:"areaOpen",source:"./models/area/open.png",type:"texture"},{name:"areaReset",source:"./models/area/reset.png",type:"texture"},{name:"areaQuestionMark",source:"./models/area/questionMark.png",type:"texture"},{name:"tilesABase",source:"./models/tiles/a/base.glb"},{name:"tilesACollision",source:"./models/tiles/a/collision.glb"},{name:"tilesBBase",source:"./models/tiles/b/base.glb"},{name:"tilesBCollision",source:"./models/tiles/b/collision.glb"},{name:"tilesCBase",source:"./models/tiles/c/base.glb"},{name:"tilesCCollision",source:"./models/tiles/c/collision.glb"},{name:"tilesDBase",source:"./models/tiles/d/base.glb"},{name:"tilesDCollision",source:"./models/tiles/d/collision.glb"},{name:"tilesEBase",source:"./models/tiles/e/base.glb"},{name:"tilesECollision",source:"./models/tiles/e/collision.glb"},{name:"konamiLabel",source:"./models/konami/label.png",type:"texture"},{name:"konamiLabelTouch",source:"./models/konami/label-touch.png",type:"texture"},{name:"wig1",source:"./models/wigs/wig1.glb"},{name:"wig2",source:"./models/wigs/wig2.glb"},{name:"wig3",source:"./models/wigs/wig3.glb"},{name:"wig4",source:"./models/wigs/wig4.glb"}]),this.loader.on("fileEnd",(e,t)=>{if(this.items[e.name]=t,e.type==="texture"){const n=new qt(t);n.needsUpdate=!0,this.items[`${e.name}Texture`]=n}this.trigger("progress",[this.loader.loaded/this.loader.toLoad])}),this.loader.on("end",()=>{this.trigger("ready")})}}const Of={type:"change"},Lc={type:"start"},Bf={type:"end"},Va=new Qr,Uf=new as,CE=Math.cos(70*bn.DEG2RAD);class RE extends Qs{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new D,this.cursor=new D,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:nr.ROTATE,MIDDLE:nr.DOLLY,RIGHT:nr.PAN},this.touches={ONE:ir.ROTATE,TWO:ir.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(E){E.addEventListener("keydown",Ke),this._domElementKeyEvents=E},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ke),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Of),n.update(),s=i.NONE},this.update=function(){const E=new D,te=new Lt().setFromUnitVectors(e.up,new D(0,1,0)),se=te.clone().invert(),ye=new D,Te=new Lt,nt=new D,ot=2*Math.PI;return function(Ut=null){const pt=n.object.position;E.copy(pt).sub(n.target),E.applyQuaternion(te),a.setFromVector3(E),n.autoRotate&&s===i.NONE&&N(w(Ut)),n.enableDamping?(a.theta+=c.theta*n.dampingFactor,a.phi+=c.phi*n.dampingFactor):(a.theta+=c.theta,a.phi+=c.phi);let mt=n.minAzimuthAngle,oe=n.maxAzimuthAngle;isFinite(mt)&&isFinite(oe)&&(mt<-Math.PI?mt+=ot:mt>Math.PI&&(mt-=ot),oe<-Math.PI?oe+=ot:oe>Math.PI&&(oe-=ot),mt<=oe?a.theta=Math.max(mt,Math.min(oe,a.theta)):a.theta=a.theta>(mt+oe)/2?Math.max(mt,a.theta):Math.min(oe,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(d,n.dampingFactor):n.target.add(d),n.target.sub(n.cursor),n.target.clampLength(n.minTargetRadius,n.maxTargetRadius),n.target.add(n.cursor);let pe=!1;if(n.zoomToCursor&&S||n.object.isOrthographicCamera)a.radius=Y(a.radius);else{const ve=a.radius;a.radius=Y(a.radius*u),pe=ve!=a.radius}if(E.setFromSpherical(a),E.applyQuaternion(se),pt.copy(n.target).add(E),n.object.lookAt(n.target),n.enableDamping===!0?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,d.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),d.set(0,0,0)),n.zoomToCursor&&S){let ve=null;if(n.object.isPerspectiveCamera){const xe=E.length();ve=Y(xe*u);const Qe=xe-ve;n.object.position.addScaledVector(x,Qe),n.object.updateMatrixWorld(),pe=!!Qe}else if(n.object.isOrthographicCamera){const xe=new D(M.x,M.y,0);xe.unproject(n.object);const Qe=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),n.object.updateProjectionMatrix(),pe=Qe!==n.object.zoom;const ke=new D(M.x,M.y,0);ke.unproject(n.object),n.object.position.sub(ke).add(xe),n.object.updateMatrixWorld(),ve=E.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;ve!==null&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(ve).add(n.object.position):(Va.origin.copy(n.object.position),Va.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(Va.direction))<CE?e.lookAt(n.target):(Uf.setFromNormalAndCoplanarPoint(n.object.up,n.target),Va.intersectPlane(Uf,n.target))))}else if(n.object.isOrthographicCamera){const ve=n.object.zoom;n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/u)),ve!==n.object.zoom&&(n.object.updateProjectionMatrix(),pe=!0)}return u=1,S=!1,pe||ye.distanceToSquared(n.object.position)>r||8*(1-Te.dot(n.object.quaternion))>r||nt.distanceToSquared(n.target)>r?(n.dispatchEvent(Of),ye.copy(n.object.position),Te.copy(n.object.quaternion),nt.copy(n.target),!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",at),n.domElement.removeEventListener("pointerdown",B),n.domElement.removeEventListener("pointercancel",ie),n.domElement.removeEventListener("wheel",ge),n.domElement.removeEventListener("pointermove",C),n.domElement.removeEventListener("pointerup",ie),n.domElement.getRootNode().removeEventListener("keydown",Ee,{capture:!0}),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",Ke),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=i.NONE;const r=1e-6,a=new Wd,c=new Wd;let u=1;const d=new D,l=new Fe,h=new Fe,f=new Fe,p=new Fe,g=new Fe,m=new Fe,v=new Fe,_=new Fe,y=new Fe,x=new D,M=new Fe;let S=!1;const A=[],T={};let b=!1;function w(E){return E!==null?2*Math.PI/60*n.autoRotateSpeed*E:2*Math.PI/60/60*n.autoRotateSpeed}function P(E){const te=Math.abs(E*.01);return Math.pow(.95,n.zoomSpeed*te)}function N(E){c.theta-=E}function I(E){c.phi-=E}const H=function(){const E=new D;return function(se,ye){E.setFromMatrixColumn(ye,0),E.multiplyScalar(-se),d.add(E)}}(),G=function(){const E=new D;return function(se,ye){n.screenSpacePanning===!0?E.setFromMatrixColumn(ye,1):(E.setFromMatrixColumn(ye,0),E.crossVectors(n.object.up,E)),E.multiplyScalar(se),d.add(E)}}(),J=function(){const E=new D;return function(se,ye){const Te=n.domElement;if(n.object.isPerspectiveCamera){const nt=n.object.position;E.copy(nt).sub(n.target);let ot=E.length();ot*=Math.tan(n.object.fov/2*Math.PI/180),H(2*se*ot/Te.clientHeight,n.object.matrix),G(2*ye*ot/Te.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(H(se*(n.object.right-n.object.left)/n.object.zoom/Te.clientWidth,n.object.matrix),G(ye*(n.object.top-n.object.bottom)/n.object.zoom/Te.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function U(E){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u/=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function k(E){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?u*=E:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function q(E,te){if(!n.zoomToCursor)return;S=!0;const se=n.domElement.getBoundingClientRect(),ye=E-se.left,Te=te-se.top,nt=se.width,ot=se.height;M.x=ye/nt*2-1,M.y=-(Te/ot)*2+1,x.set(M.x,M.y,1).unproject(n.object).sub(n.object.position).normalize()}function Y(E){return Math.max(n.minDistance,Math.min(n.maxDistance,E))}function V(E){l.set(E.clientX,E.clientY)}function Z(E){q(E.clientX,E.clientX),v.set(E.clientX,E.clientY)}function W(E){p.set(E.clientX,E.clientY)}function L(E){h.set(E.clientX,E.clientY),f.subVectors(h,l).multiplyScalar(n.rotateSpeed);const te=n.domElement;N(2*Math.PI*f.x/te.clientHeight),I(2*Math.PI*f.y/te.clientHeight),l.copy(h),n.update()}function F(E){_.set(E.clientX,E.clientY),y.subVectors(_,v),y.y>0?U(P(y.y)):y.y<0&&k(P(y.y)),v.copy(_),n.update()}function X(E){g.set(E.clientX,E.clientY),m.subVectors(g,p).multiplyScalar(n.panSpeed),J(m.x,m.y),p.copy(g),n.update()}function ee(E){q(E.clientX,E.clientY),E.deltaY<0?k(P(E.deltaY)):E.deltaY>0&&U(P(E.deltaY)),n.update()}function re(E){let te=!1;switch(E.code){case n.keys.UP:E.ctrlKey||E.metaKey||E.shiftKey?I(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):J(0,n.keyPanSpeed),te=!0;break;case n.keys.BOTTOM:E.ctrlKey||E.metaKey||E.shiftKey?I(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):J(0,-n.keyPanSpeed),te=!0;break;case n.keys.LEFT:E.ctrlKey||E.metaKey||E.shiftKey?N(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):J(n.keyPanSpeed,0),te=!0;break;case n.keys.RIGHT:E.ctrlKey||E.metaKey||E.shiftKey?N(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):J(-n.keyPanSpeed,0),te=!0;break}te&&(E.preventDefault(),n.update())}function K(E){if(A.length===1)l.set(E.pageX,E.pageY);else{const te=vt(E),se=.5*(E.pageX+te.x),ye=.5*(E.pageY+te.y);l.set(se,ye)}}function O(E){if(A.length===1)p.set(E.pageX,E.pageY);else{const te=vt(E),se=.5*(E.pageX+te.x),ye=.5*(E.pageY+te.y);p.set(se,ye)}}function de(E){const te=vt(E),se=E.pageX-te.x,ye=E.pageY-te.y,Te=Math.sqrt(se*se+ye*ye);v.set(0,Te)}function _e(E){n.enableZoom&&de(E),n.enablePan&&O(E)}function Me(E){n.enableZoom&&de(E),n.enableRotate&&K(E)}function me(E){if(A.length==1)h.set(E.pageX,E.pageY);else{const se=vt(E),ye=.5*(E.pageX+se.x),Te=.5*(E.pageY+se.y);h.set(ye,Te)}f.subVectors(h,l).multiplyScalar(n.rotateSpeed);const te=n.domElement;N(2*Math.PI*f.x/te.clientHeight),I(2*Math.PI*f.y/te.clientHeight),l.copy(h)}function le(E){if(A.length===1)g.set(E.pageX,E.pageY);else{const te=vt(E),se=.5*(E.pageX+te.x),ye=.5*(E.pageY+te.y);g.set(se,ye)}m.subVectors(g,p).multiplyScalar(n.panSpeed),J(m.x,m.y),p.copy(g)}function ue(E){const te=vt(E),se=E.pageX-te.x,ye=E.pageY-te.y,Te=Math.sqrt(se*se+ye*ye);_.set(0,Te),y.set(0,Math.pow(_.y/v.y,n.zoomSpeed)),U(y.y),v.copy(_);const nt=(E.pageX+te.x)*.5,ot=(E.pageY+te.y)*.5;q(nt,ot)}function We(E){n.enableZoom&&ue(E),n.enablePan&&le(E)}function Ge(E){n.enableZoom&&ue(E),n.enableRotate&&me(E)}function B(E){n.enabled!==!1&&(A.length===0&&(n.domElement.setPointerCapture(E.pointerId),n.domElement.addEventListener("pointermove",C),n.domElement.addEventListener("pointerup",ie)),!Je(E)&&(Ze(E),E.pointerType==="touch"?Ce(E):he(E)))}function C(E){n.enabled!==!1&&(E.pointerType==="touch"?$e(E):fe(E))}function ie(E){switch(ze(E),A.length){case 0:n.domElement.releasePointerCapture(E.pointerId),n.domElement.removeEventListener("pointermove",C),n.domElement.removeEventListener("pointerup",ie),n.dispatchEvent(Bf),s=i.NONE;break;case 1:const te=A[0],se=T[te];Ce({pointerId:te,pageX:se.x,pageY:se.y});break}}function he(E){let te;switch(E.button){case 0:te=n.mouseButtons.LEFT;break;case 1:te=n.mouseButtons.MIDDLE;break;case 2:te=n.mouseButtons.RIGHT;break;default:te=-1}switch(te){case nr.DOLLY:if(n.enableZoom===!1)return;Z(E),s=i.DOLLY;break;case nr.ROTATE:if(E.ctrlKey||E.metaKey||E.shiftKey){if(n.enablePan===!1)return;W(E),s=i.PAN}else{if(n.enableRotate===!1)return;V(E),s=i.ROTATE}break;case nr.PAN:if(E.ctrlKey||E.metaKey||E.shiftKey){if(n.enableRotate===!1)return;V(E),s=i.ROTATE}else{if(n.enablePan===!1)return;W(E),s=i.PAN}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(Lc)}function fe(E){switch(s){case i.ROTATE:if(n.enableRotate===!1)return;L(E);break;case i.DOLLY:if(n.enableZoom===!1)return;F(E);break;case i.PAN:if(n.enablePan===!1)return;X(E);break}}function ge(E){n.enabled===!1||n.enableZoom===!1||s!==i.NONE||(E.preventDefault(),n.dispatchEvent(Lc),ee(Ie(E)),n.dispatchEvent(Bf))}function Ie(E){const te=E.deltaMode,se={clientX:E.clientX,clientY:E.clientY,deltaY:E.deltaY};switch(te){case 1:se.deltaY*=16;break;case 2:se.deltaY*=100;break}return E.ctrlKey&&!b&&(se.deltaY*=10),se}function Ee(E){E.key==="Control"&&(b=!0,n.domElement.getRootNode().addEventListener("keyup",we,{passive:!0,capture:!0}))}function we(E){E.key==="Control"&&(b=!1,n.domElement.getRootNode().removeEventListener("keyup",we,{passive:!0,capture:!0}))}function Ke(E){n.enabled===!1||n.enablePan===!1||re(E)}function Ce(E){switch(rt(E),A.length){case 1:switch(n.touches.ONE){case ir.ROTATE:if(n.enableRotate===!1)return;K(E),s=i.TOUCH_ROTATE;break;case ir.PAN:if(n.enablePan===!1)return;O(E),s=i.TOUCH_PAN;break;default:s=i.NONE}break;case 2:switch(n.touches.TWO){case ir.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;_e(E),s=i.TOUCH_DOLLY_PAN;break;case ir.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Me(E),s=i.TOUCH_DOLLY_ROTATE;break;default:s=i.NONE}break;default:s=i.NONE}s!==i.NONE&&n.dispatchEvent(Lc)}function $e(E){switch(rt(E),s){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;me(E),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;le(E),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;We(E),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ge(E),n.update();break;default:s=i.NONE}}function at(E){n.enabled!==!1&&E.preventDefault()}function Ze(E){A.push(E.pointerId)}function ze(E){delete T[E.pointerId];for(let te=0;te<A.length;te++)if(A[te]==E.pointerId){A.splice(te,1);return}}function Je(E){for(let te=0;te<A.length;te++)if(A[te]==E.pointerId)return!0;return!1}function rt(E){let te=T[E.pointerId];te===void 0&&(te=new Fe,T[E.pointerId]=te),te.set(E.pageX,E.pageY)}function vt(E){const te=E.pointerId===A[0]?A[1]:A[0];return T[te]}n.domElement.addEventListener("contextmenu",at),n.domElement.addEventListener("pointerdown",B),n.domElement.addEventListener("pointercancel",ie),n.domElement.addEventListener("wheel",ge,{passive:!1}),n.domElement.getRootNode().addEventListener("keydown",Ee,{passive:!0,capture:!0}),this.update()}}class PE{constructor(e){this.time=e.time,this.sizes=e.sizes,this.renderer=e.renderer,this.debug=e.debug,this.config=e.config,this.container=new et,this.container.matrixAutoUpdate=!1,this.target=new D(0,0,0),this.targetEased=new D(0,0,0),this.easing=.15,this.debug&&(this.debugFolder=this.debug.addFolder("camera")),this.setAngle(),this.setInstance(),this.setZoom(),this.setPan(),this.setOrbitControls()}setAngle(){this.angle={},this.angle.items={default:new D(0,-1.45,1.15),projects:new D(.38,-1.4,1.63)},this.angle.value=new D,this.angle.value.copy(this.angle.items.default),this.angle.set=e=>{const t=this.angle.items[e];typeof t<"u"&&ut.to(this.angle.value,{...t,duration:2,ease:"power1.inOut"})},this.debug&&(this.debugFolder.add(this,"easing").step(1e-4).min(0).max(1).name("easing"),this.debugFolder.add(this.angle.value,"x").step(.001).min(-2).max(2).name("invertDirectionX").listen(),this.debugFolder.add(this.angle.value,"y").step(.001).min(-2).max(2).name("invertDirectionY").listen(),this.debugFolder.add(this.angle.value,"z").step(.001).min(-2).max(2).name("invertDirectionZ").listen())}setInstance(){this.instance=new Tn(40,this.sizes.viewport.width/this.sizes.viewport.height,1,80),this.instance.up.set(0,0,1),this.instance.position.copy(this.angle.value),this.instance.lookAt(new D),this.container.add(this.instance),this.sizes.on("resize",()=>{this.instance.aspect=this.sizes.viewport.width/this.sizes.viewport.height,this.instance.updateProjectionMatrix()}),this.time.on("tick",()=>{this.orbitControls.enabled||(this.targetEased.x+=(this.target.x-this.targetEased.x)*this.easing,this.targetEased.y+=(this.target.y-this.targetEased.y)*this.easing,this.targetEased.z+=(this.target.z-this.targetEased.z)*this.easing,this.instance.position.copy(this.targetEased).add(this.angle.value.clone().normalize().multiplyScalar(this.zoom.distance)),this.instance.lookAt(this.targetEased),this.instance.position.x+=this.pan.value.x,this.instance.position.y+=this.pan.value.y)})}setZoom(){this.zoom={},this.zoom.easing=.1,this.zoom.minDistance=14,this.zoom.amplitude=15,this.zoom.value=this.config.cyberTruck?.3:.5,this.zoom.targetValue=this.zoom.value,this.zoom.distance=this.zoom.minDistance+this.zoom.amplitude*this.zoom.value,document.addEventListener("mousewheel",e=>{this.zoom.targetValue+=e.deltaY*.001,this.zoom.targetValue=Math.min(Math.max(this.zoom.targetValue,0),1)},{passive:!0}),this.zoom.touch={},this.zoom.touch.startDistance=0,this.zoom.touch.startValue=0,this.renderer.domElement.addEventListener("touchstart",e=>{e.touches.length===2&&(this.zoom.touch.startDistance=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientX-e.touches[1].clientX),this.zoom.touch.startValue=this.zoom.targetValue)}),this.renderer.domElement.addEventListener("touchmove",e=>{if(e.touches.length===2){e.preventDefault();const n=Math.hypot(e.touches[0].clientX-e.touches[1].clientX,e.touches[0].clientX-e.touches[1].clientX)/this.zoom.touch.startDistance;this.zoom.targetValue=this.zoom.touch.startValue-(n-1),this.zoom.targetValue=Math.min(Math.max(this.zoom.targetValue,0),1)}}),this.time.on("tick",()=>{this.zoom.value+=(this.zoom.targetValue-this.zoom.value)*this.zoom.easing,this.zoom.distance=this.zoom.minDistance+this.zoom.amplitude*this.zoom.value})}setPan(){this.pan={},this.pan.enabled=!1,this.pan.active=!1,this.pan.easing=.1,this.pan.start={},this.pan.start.x=0,this.pan.start.y=0,this.pan.value={},this.pan.value.x=0,this.pan.value.y=0,this.pan.targetValue={},this.pan.targetValue.x=this.pan.value.x,this.pan.targetValue.y=this.pan.value.y,this.pan.raycaster=new Rh,this.pan.mouse=new Fe,this.pan.needsUpdate=!1,this.pan.hitMesh=new Se(new ln(500,500,1,1),new Mt({color:16711680,wireframe:!0,visible:!1})),this.container.add(this.pan.hitMesh),this.pan.reset=()=>{this.pan.targetValue.x=0,this.pan.targetValue.y=0},this.pan.enable=()=>{this.pan.enabled=!0,this.renderer.domElement.classList.add("has-cursor-grab")},this.pan.disable=()=>{this.pan.enabled=!1,this.renderer.domElement.classList.remove("has-cursor-grab")},this.pan.down=(e,t)=>{if(!this.pan.enabled)return;this.renderer.domElement.classList.add("has-cursor-grabbing"),this.pan.active=!0,this.pan.mouse.x=e/this.sizes.viewport.width*2-1,this.pan.mouse.y=-(t/this.sizes.viewport.height)*2+1,this.pan.raycaster.setFromCamera(this.pan.mouse,this.instance);const n=this.pan.raycaster.intersectObjects([this.pan.hitMesh]);n.length&&(this.pan.start.x=n[0].point.x,this.pan.start.y=n[0].point.y)},this.pan.move=(e,t)=>{this.pan.enabled&&this.pan.active&&(this.pan.mouse.x=e/this.sizes.viewport.width*2-1,this.pan.mouse.y=-(t/this.sizes.viewport.height)*2+1,this.pan.needsUpdate=!0)},this.pan.up=()=>{this.pan.active=!1,this.renderer.domElement.classList.remove("has-cursor-grabbing")},window.addEventListener("mousedown",e=>{this.pan.down(e.clientX,e.clientY)}),window.addEventListener("mousemove",e=>{this.pan.move(e.clientX,e.clientY)}),window.addEventListener("mouseup",()=>{this.pan.up()}),this.renderer.domElement.addEventListener("touchstart",e=>{e.touches.length===1&&this.pan.down(e.touches[0].clientX,e.touches[0].clientY)}),this.renderer.domElement.addEventListener("touchmove",e=>{e.touches.length===1&&this.pan.move(e.touches[0].clientX,e.touches[0].clientY)}),this.renderer.domElement.addEventListener("touchend",()=>{this.pan.up()}),this.time.on("tick",()=>{if(this.pan.active&&this.pan.needsUpdate){this.pan.raycaster.setFromCamera(this.pan.mouse,this.instance);const e=this.pan.raycaster.intersectObjects([this.pan.hitMesh]);e.length&&(this.pan.targetValue.x=-(e[0].point.x-this.pan.start.x),this.pan.targetValue.y=-(e[0].point.y-this.pan.start.y)),this.pan.needsUpdate=!1}this.pan.value.x+=(this.pan.targetValue.x-this.pan.value.x)*this.pan.easing,this.pan.value.y+=(this.pan.targetValue.y-this.pan.value.y)*this.pan.easing})}setOrbitControls(){this.orbitControls=new RE(this.instance,this.renderer.domElement),this.orbitControls.enabled=!1,this.orbitControls.enableKeys=!1,this.orbitControls.zoomSpeed=.5,this.debug&&this.debugFolder.add(this.orbitControls,"enabled").name("orbitControlsEnabled")}}const LE={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`};class El{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}const IE=new Qo(-1,1,1,-1,0,1);class DE extends Ft{constructor(){super(),this.setAttribute("position",new yt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new yt([0,2,0,0,2,0],2))}}const FE=new DE;class kE{constructor(e){this._mesh=new Se(FE,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,IE)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class Ya extends El{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof Mn?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=lp.clone(e.uniforms),this.material=new Mn({name:e.name!==void 0?e.name:"unspecified",defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new kE(this.material)}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}class zf extends El{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const i=e.getContext(),s=e.state;s.buffers.color.setMask(!1),s.buffers.depth.setMask(!1),s.buffers.color.setLocked(!0),s.buffers.depth.setLocked(!0);let r,a;this.inverse?(r=0,a=1):(r=1,a=0),s.buffers.stencil.setTest(!0),s.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),s.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),s.buffers.stencil.setClear(a),s.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),s.buffers.color.setLocked(!1),s.buffers.depth.setLocked(!1),s.buffers.color.setMask(!0),s.buffers.depth.setMask(!0),s.buffers.stencil.setLocked(!1),s.buffers.stencil.setFunc(i.EQUAL,1,4294967295),s.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),s.buffers.stencil.setLocked(!0)}}class NE extends El{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class OE{constructor(e,t){if(this.renderer=e,this._pixelRatio=e.getPixelRatio(),t===void 0){const n=e.getSize(new Fe);this._width=n.width,this._height=n.height,t=new ys(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:$o}),t.texture.name="EffectComposer.rt1"}else this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new Ya(LE),this.copyPass.material.blending=ji,this.clock=new vb}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let i=0,s=this.passes.length;i<s;i++){const r=this.passes[i];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),r.needsSwap){if(n){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}zf!==void 0&&(r instanceof zf?n=!0:r instanceof NE&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new Fe);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(n,i),this.renderTarget2.setSize(n,i);for(let s=0;s<this.passes.length;s++)this.passes[s].setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}class BE extends El{constructor(e,t,n=null,i=null,s=null){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=i,this.clearAlpha=s,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new He}render(e,t,n){const i=e.autoClear;e.autoClear=!1;let s,r;this.overrideMaterial!==null&&(r=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(e.getClearColor(this._oldClearColor),e.setClearColor(this.clearColor)),this.clearAlpha!==null&&(s=e.getClearAlpha(),e.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear===!0&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor!==null&&e.setClearColor(this._oldClearColor),this.clearAlpha!==null&&e.setClearAlpha(s),this.overrideMaterial!==null&&(this.scene.overrideMaterial=r),e.autoClear=i}}var UE=`#define M_PI 3.1415926535897932384626433832795

uniform sampler2D tDiffuse;\r
uniform vec2 uResolution;\r
uniform vec2 uStrength;

varying vec2 vUv;

vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\r
  vec4 color = vec4(0.0);\r
  vec2 off1 = vec2(1.3846153846) * direction;\r
  vec2 off2 = vec2(3.2307692308) * direction;\r
  color += texture2D(image, uv) * 0.2270270270;\r
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\r
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\r
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\r
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\r
  return color;\r
}

void main()\r
{\r
    vec4 diffuseColor = texture2D(tDiffuse, vUv);\r
    vec4 blurColor = blur9(tDiffuse, vUv, uResolution, uStrength);\r
    float blurStrength = 1.0 - sin(vUv.y * M_PI);\r
    gl_FragColor = mix(diffuseColor, blurColor, blurStrength);\r
}`,zE=`varying vec2 vUv;

void main()\r
{\r
    vUv = uv;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`;const Vf={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:null},uStrength:{type:"v2",value:null}},vertexShader:zE,fragmentShader:UE};var VE=`uniform sampler2D tDiffuse;\r
uniform vec2 uPosition;\r
uniform float uRadius;\r
uniform vec3 uColor;\r
uniform float uAlpha;

varying vec2 vUv;

void main()\r
{\r
    vec4 diffuseColor = texture2D(tDiffuse, vUv);

    float glowStrength = distance(vUv, uPosition) / uRadius;\r
    glowStrength = 1.0 - glowStrength;\r
    glowStrength *= uAlpha;\r
    glowStrength = clamp(glowStrength, 0.0, 1.0);\r
    vec3 color = mix(diffuseColor.rgb, uColor, glowStrength);

    gl_FragColor = vec4(color, 1.0);\r
}`,HE=`varying vec2 vUv;

void main()\r
{\r
    vUv = uv;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`;const GE={uniforms:{tDiffuse:{type:"t",value:null},uPosition:{type:"v2",value:null},uRadius:{type:"f",value:null},uColor:{type:"v3",value:null},uAlpha:{type:"f",value:null}},vertexShader:HE,fragmentShader:VE};class WE{constructor(e){this.$canvas=e.$canvas,this.time=new Qb,this.sizes=new Zb,this.resources=new TE,this.setConfig(),this.setDebug(),this.setRenderer(),this.setCamera(),this.setPasses(),this.setWorld(),this.setTitle()}setConfig(){this.config={},this.config.debug=window.location.hash==="#debug",this.config.cyberTruck=window.location.hash==="#cybertruck",this.config.touch=!1,window.addEventListener("touchstart",()=>{this.config.touch=!0,this.world.controls.setTouch(),this.passes.horizontalBlurPass.strength=1,this.passes.horizontalBlurPass.material.uniforms.uStrength.value=new Fe(this.passes.horizontalBlurPass.strength,0),this.passes.verticalBlurPass.strength=1,this.passes.verticalBlurPass.material.uniforms.uStrength.value=new Fe(0,this.passes.verticalBlurPass.strength)},{once:!0})}setDebug(){this.config.debug&&(this.debug=new Kb({width:420}))}setRenderer(){this.scene=new Tw,this.renderer=new Ew({canvas:this.$canvas,alpha:!0,powerPreference:"high-performance"}),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(2),this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.renderer.autoClear=!1,this.sizes.on("resize",()=>{this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height)})}setCamera(){this.camera=new PE({time:this.time,sizes:this.sizes,renderer:this.renderer,debug:this.debug,config:this.config}),this.scene.add(this.camera.container),this.time.on("tick",()=>{this.world&&this.world.car&&(this.camera.target.x=this.world.car.chassis.object.position.x,this.camera.target.y=this.world.car.chassis.object.position.y)})}setPasses(){if(this.passes={},this.debug&&(this.passes.debugFolder=this.debug.addFolder("postprocess")),this.passes.composer=new OE(this.renderer),this.passes.renderPass=new BE(this.scene,this.camera.instance),this.passes.horizontalBlurPass=new Ya(Vf),this.passes.horizontalBlurPass.strength=this.config.touch?0:1,this.passes.horizontalBlurPass.material.uniforms.uResolution.value=new Fe(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.horizontalBlurPass.material.uniforms.uStrength.value=new Fe(this.passes.horizontalBlurPass.strength,0),this.passes.verticalBlurPass=new Ya(Vf),this.passes.verticalBlurPass.strength=this.config.touch?0:1,this.passes.verticalBlurPass.material.uniforms.uResolution.value=new Fe(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.verticalBlurPass.material.uniforms.uStrength.value=new Fe(0,this.passes.verticalBlurPass.strength),this.debug){const e=this.passes.debugFolder.addFolder("blur");e.open(),e.add(this.passes.horizontalBlurPass.material.uniforms.uStrength.value,"x").step(.001).min(0).max(10),e.add(this.passes.verticalBlurPass.material.uniforms.uStrength.value,"y").step(.001).min(0).max(10)}if(this.passes.glowsPass=new Ya(GE),this.passes.glowsPass.color="#1c1c1c",this.passes.glowsPass.material.uniforms.uPosition.value=new Fe(0,.25),this.passes.glowsPass.material.uniforms.uRadius.value=.7,this.passes.glowsPass.material.uniforms.uColor.value=new He(this.passes.glowsPass.color),this.passes.glowsPass.material.uniforms.uColor.value.convertLinearToSRGB(),this.passes.glowsPass.material.uniforms.uAlpha.value=.55,this.debug){const e=this.passes.debugFolder.addFolder("glows");e.open(),e.add(this.passes.glowsPass.material.uniforms.uPosition.value,"x").step(.001).min(-1).max(2).name("positionX"),e.add(this.passes.glowsPass.material.uniforms.uPosition.value,"y").step(.001).min(-1).max(2).name("positionY"),e.add(this.passes.glowsPass.material.uniforms.uRadius,"value").step(.001).min(0).max(2).name("radius"),e.addColor(this.passes.glowsPass,"color").name("color").onChange(()=>{this.passes.glowsPass.material.uniforms.uColor.value=new He(this.passes.glowsPass.color)}),e.add(this.passes.glowsPass.material.uniforms.uAlpha,"value").step(.001).min(0).max(1).name("alpha")}this.passes.composer.addPass(this.passes.renderPass),this.passes.composer.addPass(this.passes.horizontalBlurPass),this.passes.composer.addPass(this.passes.verticalBlurPass),this.passes.composer.addPass(this.passes.glowsPass),this.time.on("tick",()=>{this.passes.horizontalBlurPass.enabled=this.passes.horizontalBlurPass.material.uniforms.uStrength.value.x>0,this.passes.verticalBlurPass.enabled=this.passes.verticalBlurPass.material.uniforms.uStrength.value.y>0,this.passes.composer.render()}),this.sizes.on("resize",()=>{this.renderer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.composer.setSize(this.sizes.viewport.width,this.sizes.viewport.height),this.passes.horizontalBlurPass.material.uniforms.uResolution.value.x=this.sizes.viewport.width,this.passes.horizontalBlurPass.material.uniforms.uResolution.value.y=this.sizes.viewport.height,this.passes.verticalBlurPass.material.uniforms.uResolution.value.x=this.sizes.viewport.width,this.passes.verticalBlurPass.material.uniforms.uResolution.value.y=this.sizes.viewport.height})}setWorld(){this.world=new aA({config:this.config,debug:this.debug,resources:this.resources,time:this.time,sizes:this.sizes,camera:this.camera,scene:this.scene,renderer:this.renderer,passes:this.passes}),this.scene.add(this.world.container)}setTitle(){this.title={},this.title.frequency=300,this.title.width=20,this.title.position=0,this.title.$element=document.querySelector("title"),this.title.absolutePosition=Math.round(this.title.width*.25),this.time.on("tick",()=>{this.world.physics&&(this.title.absolutePosition+=this.world.physics.car.forwardSpeed,this.title.absolutePosition<0&&(this.title.absolutePosition=0))}),window.setInterval(()=>{this.title.position=Math.round(this.title.absolutePosition%this.title.width),document.title=`${"_".repeat(this.title.width-this.title.position)}${"_".repeat(this.title.position)}`},this.title.frequency)}destructor(){this.time.off("tick"),this.sizes.off("resize"),this.camera.orbitControls.dispose(),this.renderer.dispose(),this.debug.destroy()}}window.application=new WE({$canvas:document.querySelector(".js-canvas"),useComposer:!0});
//# sourceMappingURL=index-BbFNjG8N.js.map
